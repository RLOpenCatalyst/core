<style type="text/css">
.smart-form .toggle input:checked + i:before {
		right: 46px !important;
}
</style>

<div class="row">
    <div class="col-md-12">
        <div class="col-md-12">
            <form action="" id="myForm">
                <div class="widget-box">
                    <div class="widget-header">
                        <h4 class="widget-margin" style="color:black;">Create Organization</h4>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main" style="min-height:200px">
                            <section id="widget-grid" class="">
                                <!-- START ROW -->
                                <div class="row">
                                    <!-- Widget ID (each widget will need unique ID)-->
                                    <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                                        <!-- widget div-->
                                        <div>
                                            <!-- widget content -->
                                            <div class="widget-body no-padding">
                                                <div class="col-lg-6 col-md-6">
                                                    <label for="name">Name:
                                                    <span class="control-label redSpan">&nbsp;*</span></label>
                                                    <input autofocus name="ctl00$MainContent$orgname" value="" id="orgname" unique="true"  uniqueconditionedby="orgname" class="form-control" cdata="catalyst" type="text" cat-validation="required,nospecial,max15,nospace"><span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                                    <input id="orgid" type="hidden" />
                                                </div>
                                                <div class="col-lg-6 col-md-6">
                                                    <label for="name">Domain Name:</label>
                                                    <input name="ctl00$MainContent$domainname" value="" id="domainname" class="form-control" type="text"  cdata="catalyst" maxlength="35">
                                                    <span data-val-controltovalidate="domainname" id="MainContent_Req_domainname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                                                </div>
												<div class="col-lg-6 col-md-6">
													<label for="name">Planned Cost:</label>
													<span>
														<img data-toggle="popover" data-html="true" data-placement="left" title="Planned Cost for a Month." src="img/help.png"/>
													</span>
													<input name="ctl00$MainContent$plannedCost" value="" id="plannedCost" class="form-control" type="text"  cdata="catalyst" maxlength="35">
													<span data-val-controltovalidate="plannedCost" id="MainContent_Req_plannedCost" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="visibility:hidden;">Required</span>
												</div>
                                                <div class="col-lg-6 orgactive hidden">
                                                    <label for="name">Organization Status:</label>
                                                    <div class="clearfix" style="border:1px solid silver" >
                                                        <div class="btn-group pull-left" style="padding:5px;margin-top:-22px;width:100%">
                                                            <div style="padding-top:5px;">
                                                                <label for="active" style="width:20%"><input name="ctl00$MainContent$domainname" value="" id="active" class="hidden" type="text"  cdata="catalyst" style="margin-top:-25px" value="true"></label>
                                                                <div class="input-group from-control col-md-12 smart-form">
                                                                    <label class="toggle font-sm" ><input onclick='if($(this).is(":checked")) {$(this).closest("label").css("background-color","#ffffff");$(this).css("border-color","#ffffff");}else{$(this).closest("label").css("background-color","#ffffff");$(this).css("border-color","red");}' type="checkbox" name="checkbox-toggle" value="true" style="width:100%" id="currentorgstatus"><i data-swchoff-text="Active" data-swchon-text="Inactive" style="width:61px;"></i>Current Status</label>
                                                                </div>
                                                            </div>
                                                            <label for="name">
                                                                <div style="margin-top:5px" class="control-label"><br/>Note:<br/><span style="color:#CC0000">Deactivating is cascading and would deactivate all entities depending on this organization.</span></div>
                                                            </label>
                                                            <div>
                                                                <a class="btn btn-primary btn-mini pull-right hidden" onclick="" id="btnenablement">
                                                                <i class="ace-icon fa fa-check bigger-110"></i>
                                                                Change
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- end widget content -->
                                        </div>
                                        <!-- end widget div -->
                                    </div>
                                    <!-- end widget -->
                                </div>
                                <!-- END ROW -->
                            </section>
                            <!-- end widget grid -->
                        </div>
                    </div>
                    <div class="widget-toolbox clearfix">
                        <div class="btn-group pull-right">
                            <a class="btn btn-default" onclick="window.history.back();" style="margin-right:11px;" id="btncancel">
                            <i class="ace-icon fa fa-times bigger-110"></i>
                            Cancel
                            </a>
                            <button class="btn btn-primary btn-mini">
                            <i class="ace-icon fa fa-check bigger-110"></i>
                            Save
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>

	 function inLineReady() {
	 	$("input[type='text']").on("click", function() {
	 		$(this).select();
	 		$("#msgOrgName").hide();
	 	});
	 	readform(1);

	 	//Force opening the left navigation menu
	 	if ($('#navSettings').is(":visible") == false) {
	 		$('#navSettings').css("display", '');
	 		$('#navSettings > ul > li').first().addClass('open');
	 		$('#navSettings > ul > li > ul').css("display", "none");
	 		$('#navSettings > ul > li > ul').first().css("display", "block");
	 	}
	 	//redrawing the breadcrumb and selecting the tree
	 	$('#ulsettingstree > li').removeClass('active');
	 	$('#ulsettingstree > li').each(function() {
	 		if ($(this).text().trim() == "Organizations")
	 			$(this).addClass('active');
	 	});
	 	drawBreadCrumb1();
	 	enableUniqueCheckingForInputs(1);
	 	//enabling active org section
	 	if (typeof $('#myForm').find('button').first().attr('rowid') != "undefined")
	 		$('#myForm').find('.orgactive').first().removeClass('hidden');
	 	else
	 		$('#myForm').find('.orgactive').first().addClass('hidden');

	 	if ($('#active').val() == "false") {
	 		if (!$('#currentorgstatus').is(':checked'))
	 			$('#currentorgstatus').trigger('click');
	 	}
	 }

	 var btnenablement = function() {
	 	var data1 = new FormData();
	 	if (confirm('You have selected to change the status of this organization. Proceed?')) {
	 		var $deactivatebtn = $(this);
	 		$deactivatebtn.attr('disabled', 'disabled');
	 		var orgid__ = $('#myForm').find('button').first().attr('rowid');
	 		var action = "true";
	 		if ($('#currentorgstatus').is(':checked') == true) {
	 			action = "false";
	 		}

	 		var retVal = false;
	 		if (orgid__) {
	 			$deactivatebtn.parent().prepend('<label id="masterativatessavespinner" class="" style="float:left;"><img  style="margin-left:5px;margin-right:25px;margin-top:8px;" src="img/select2-spinner.gif"></img> </label>');

	 			data1.append("orgid", orgid__);

	 			$.ajax({
	 				url: '/d4dMasters/deactivateorg/' + action,
	 				data: data1,
	 				processData: false,
	 				contentType: false,
	 				type: 'POST',
	 				async: false,
	 				success: function(data, success) {
	 					$('#masterativatessavespinner').detach();
	 					$deactivatebtn.removeAttr('disabled');
	 					retVal = true;
	 				},
	 				error: function(jqxhr) {
	 					$('#masterativatessavespinner').detach();
	 					$deactivatebtn.removeAttr('disabled');
	 					alert(jqxhr.status);
	 					retVal = false;
	 				}
	 			});
	 		}
	 	}
	 	return retVal;
	 };


	 function readform_todelete(formName) {
	 	var formData = null;
	 	readMasterJson(1);
	 	formData = d4ddata.masterjson;

	 	var formSchema = null;
	 	var orgName = url.substr(url.indexOf("?") + 1);

	 	var editMode = false;
	 	$.each(formData.rows.row, function(i, item) {
	 		if (item.field[0].values.value.toLowerCase() == orgName.toLowerCase()) {
	 			formSchema = item.field;
	 			editMode = true;
	 			return (false);
	 		}
	 		formSchema = item.field;
	 	});
	 	if (editMode == false)
	 		return;
	 	var formSchemaNew = formSchema;

	 	$.each(formSchemaNew, function(i, item) {
	 		var inputC = null;
	 		$.each(item, function(k, v) {
	 			if (k == "name") {
	 				inputC = $("#" + v);
	 			}
	 		});
	 		$.each(item, function(k, v) {
	 			if (k == "values") {
	 				if (inputC) {
	 					$.each(v, function(k1, v1) {
	 						if (inputC.getType().toLowerCase() == "text") {
	 							if (inputC.attr("datavalues")) {
	 								$.each(v[k1], function(i) {
	 									addToCodeList(v[k1][i]);
	 								});
	 							} else
	 								inputC.val(v[k1]);

	 						}
	 						if (inputC.getType().toLowerCase() == "file") {}
	 						if (inputC.getType().toLowerCase() == "hidden") {
	 							inputC.val(getUUID());
	 						}
	 					});
	 				}
	 				inputC = null;
	 			}
	 		});
	 	});
	 }
	 $.fn.getType = function() {
	 	if ($(this).length) {
	 		return this[0].tagName == "INPUT" ? this[0].type.toLowerCase() : this[0].tagName.toLowerCase();
	 	} else {
	 		return "undefined";
	 	}
	 }

	 function validateForm() {
	 	return (true);
	 }
	 inLineReady();

	 $(document).ready(function() {
	 	var rowid = $('#myForm').find('button').first().attr('rowid');
	 	if (typeof rowid == "undefined") {
	 		$('#active').val('true');
	 	}
	 	$("#orgname").focus();
	 	$('#myForm').submit(function() {
	 		if ($('#currentorgstatus').is(':checked').toString() == $('#active').val()) {
	 			if (!btnenablement()) {
	 				return false;
	 			}
	 			$('#active').detach();
	 		}
	 		console.log('serialize ==> ', $(this).serialize());
	 		$(this).validate();

	 		if ($(this).valid) {
	 			if (!saveform('1')) return false;

	 		} else {
	 			alert('invalid valid form submitted'); // for demo
	 		}
	 		return false; // for demo
	 	});
	 });

	 function isUserTypeSuperAdmin() {
	 	$.get('/d4dMasters/loggedInUser', function(data) {
	 		if (!data.isSuperAdmin) {
	 			$('#orgname').attr('disabled', 'disabled');
	 		}
	 	});
	 }
</script>
