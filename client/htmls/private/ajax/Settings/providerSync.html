<style>
    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        border-top: 0px !important;
    }

    tr.show-settings:hover .settings{
        display:block;
    }

    div.settings{
        display:none;
        width: 32px;
        height: 18px;
    }

    .dropdown-content{
        border-radius: 5px;
        left: -30px;
        min-width: 98px;
        right: 0;
    }

    .show-settings input{
        border: 1px solid #999;
    }

    .marginSpaceTop {
        margin-top:20px;"
    }
    .styleRight{
        float:right;
        margin-top: 4px;
    }
    .border-grey{
        border: 1px solid #ddd;
    }
    .colorGreen{
        color:green;
    }
    .spanformSaveCSS{
        float: left;
        margin-right: 7px;
        margin-top: 7px;
    }
    .marginbottomCSS{
        margin-bottom: 0px !important;
    }
    .margin-top10{
        margin-top: 10px;
    }
    .saveBtnTagsCSS{
        float: right;
        font-size: 10px;
        padding: 2px 4px;
    }
    .width-90{
        width:90%;
    }
</style>

<!--button to navigate back to provider list-->
<button class="btn btn-minier btn-primary styleRight" onclick="window.history.back();"><i class="ace-icon ace-icon fa fa-chevron-left bigger-110"></i>&nbsp;List of Providers</button>

<!--tabs start here-->
<ul class="nav nav-tabs " role="tablist">
    <li class="active">
        <a href="#tagsId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Tags">Tags</a>
    </li>
    <li id="mappingLiTabId">
        <a href="#mappingsId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Mappings">Mappings</a>
    </li>
    <li>
        <a href="#instancesId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Instances">Instances</a>
    </li>
</ul>

<!--tab content starts here-->
<div class="tab-content">
    <!-- Tab panes -->
    <div  class="tab-pane active tagsContainer" id="tagsId">
        <div  class="tabContent table-responsive" id="tagsIdDiv">
            <table class="table table-hover table-bordered text-center" id="tagsTable" style="font-size:13px;";>
                <thead>
                <tr>
                    <th class="text-center">Tag Name</th>
                    <th class="text-center">Description</th>
                </tr>
                </thead>
                <tbody class="tagstblTbody">
                </tbody>
            </table>
        </div>
        <div>
            <div action="" id="tagsFormId">
                <div class="widget-box">
                    <div class="widget-header">
                        <h4 class="widget-margin" style="color:#666;font-size:14px">Create tag name to catalyst entity mapping</h4>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            <section id="widget-grid-tag" class="">
                                <div class="row">
                                    <div class="jarviswidget" id="wid-id-tag" data-widget-editbutton="false" data-widget-custombutton="false">
                                        <div>
                                            <div class="widget-body no-padding">
                                                <div class="col-lg-6 marginSpaceTop">
                                                    <label for="projectnameLabel" id="projectnameLabelId" catalystEntitytype="project">Project</label>
                                                    <div class="input-groups">
                                                        <select id="tagsProjectSelect"  class="width-100 form-control">
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 marginSpaceTop">
                                                    <label for="envnameLabel" id="envnameLabelId" catalystEntitytype="environment">Environment</label>
                                                    <div class="input-groups">
                                                        <select id="tagsEnvSelect" class="width-100 form-control" >
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                    <div class="widget-toolbox clearfix">
                        <div class="btn-group pull-right">
                            <span id="spantagsformSaveId" class="colorGreen spanformSaveCSS"></span>
                            <button class="btn btn-primary btn-mini btntagsFormSave">
                            <i class="ace-icon fa fa-check bigger-110"></i>
                            Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div  class="tab-pane mappingsListContainer" id="mappingsId">
        <div class="row">
            <div class="col-lg-6">
                <div  class="tabContent table-responsive marginbottomCSS" id="mappingprojectIdDiv">
                    <table class="table table-hover table-bordered text-center" id="mappingprojectTable" style="font-size:13px;margin-top:10px";>
                        <thead>
                        <tr>
                            <th class="text-center">Catalyst Project</th>
                            <th class="text-center">Project Tag Name</th>
                        </tr>
                        </thead>
                        <tbody class="mappingprojecttblTbody">
                        </tbody>
                    </table>
                </div>
                <div class="widget-toolbox clearfix">
                    <div class="btn-group pull-right">
                        <span id="spanprojectMappingSaveId" class="colorGreen spanformSaveCSS"></span>
                        <button class="btn btn-primary btn-mini btnprojectMappingSave">
                        <i class="ace-icon fa fa-check bigger-110"></i>
                        Save
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div  class="tabContent table-responsive marginbottomCSS" id="mappingenvIdDiv">
                    <table class="table table-hover table-bordered text-center" id="mappingenvTable" style="font-size:13px;margin-top:10px";>
                        <thead>
                        <tr>
                            <th class="text-center">Catalyst Environment</th>
                            <th class="text-center">Environment Tag Name</th>
                        </tr>
                        </thead>
                        <tbody class="mappingenvtblTbody">
                        </tbody>
                    </table>
                </div>
                <div class="widget-toolbox clearfix">
                    <div class="btn-group pull-right">
                        <span id="spanenvMappingSaveId" class="colorGreen spanformSaveCSS"></span>
                        <button class="btn btn-primary btn-mini btnenvMappingSave">
                        <i class="ace-icon fa fa-check bigger-110"></i>
                        Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div  class="tab-pane instancesContainer" id="instancesId">
        <div class="col-lg-6 col-md-6">
            <label for="chooseCatalyst">Choose Catalyst Status:</label>
            <div class="input-groups">
                <select id="chooseCtalystSelectId" name="" class="required width-100 form-control">
                    <option val="Managed" data-catalystStatus="Managed">Managed</option>
                    <option val="Assigned" data-catalystStatus="Assigned">Assigned</option>
                    <option val="Unasssigned" data-catalystStatus="Unassigned">Unasssigned</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 margin-top10">
            <div id="Managed">
                <!--managed instances-->
                <div  class="tab-pane active instancesListContainer" id="organiz">
                    <div  class="tabContent table-responsive" id="instanceListDiv" >
                        <table class="table table-hover table-bordered" id="instanceListTable" style="font-size:13px;margin-bottom:55px;text-align: center";>
                            <thead>
                            <tr>
                                <th style="text-align: center">InstanceId</th>
                                <th style="text-align: center">OS</th>
                                <th style="text-align: center">IP Address</th>
                                <th style="text-align: center">Region</th>
                                <th style="text-align: center">Status</th>
                                <th style="text-align: center">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="managedInstance">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="Assigned" hidden>
                <!--unmanaged instances-->
                <div  class="tab-pane unmanagedInstancesListContainer" id="unmanaged">
                    <div  class="tabContent table-responsive" id="unmanagedinstanceListDiv" >
                        <table class="table table-hover table-bordered" id="unmanagedinstanceListTable" style="font-size:13px;margin-bottom:55px;text-align: center";>
                            <thead>
                            <tr>
                                <th style="text-align: center">InstanceId</th>
                                <th style="text-align: center">OS</th>
                                <th style="text-align: center">IP Address</th>
                                <th style="text-align: center">Region</th>
                                <th style="text-align: center">Status</th>
                                <th style="text-align: center">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="unManagedInstance">
                            </tbody>
                        </table>
                    </div>
                    <footer class="footer">
                        <div style="text-align:center" class="clearfix form-actions">
                            <div>
                                <input type="button" id="providerSyncBtn" style="margin-left:200px;" value="Import Instances" class="btn btn-primary showChefImportNodesModalBtn">
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
            <div id="Unassigned" hidden>
                <div  class="tab-pane unassignedInstancesListContainer" id="unassigned">
                    <div  class="tabContent table-responsive" id="unassignedinstanceListDiv" >
                        <table class="table table-hover table-bordered" id="unassignedinstanceListTable" style="font-size:13px;margin-bottom:55px;text-align:center";>
                            <thead>
                            <tr>
                                <th style="text-align: center">Node</th>
                                <th style="text-align: center">OS</th>
                                <th style="text-align: center">IP Address</th>
                                <th style="text-align: center">Status</th>
                                <th style="text-align: center">Project Tag</th>
                                <th style="text-align: center">Env. Tag</th>
                            </tr>
                            </thead>
                            <tbody class="unAssignedInstance">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--import instance modal-->
<div class="modal fade" id="providerSyncModal" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="" id="myForm12" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Import Instance</h4>
                </div>
                <div class="modal-body modalbody-height">
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Organization</label>
                        <div class="input-groups">
                            <select id="providerSyncOrgSelect"  class="width-100 form-control" disabled>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Business Groups<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncBgSelect"  class="width-100 form-control" cdata="catalyst" cat-validation="required" autofocus>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="exampleInputEmail1">Project<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncProjectSelect"  class="width-100 form-control">
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Environment<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncEnvSelect"  class="width-100 form-control" >
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="exampleInputEmail1">Config Management<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncInfraManagerSelect"  class="width-100 form-control" >
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection marginSpaceTop" >
                        <label for="exampleInputEmail1">Username<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <input type="text" name="importUsernameInput" class="form-control" id="importUsernameInput" required value="" autofocus>
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-user txt-color-teal"></i> Please enter Instance Username</b>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="">Choose Authentication Type</label>
                        <div class="input-groups">
                            <select id="pemFileDropdown2"  class="authenticationType width-100 form-control" cdata="catalyst" cat-validation="required">
                                <option value="password">Password</option>
                                <option value="pemFile">Pem File</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection authPassword marginSpaceTop">
                        <label for="exampleInputEmail1">Password</label>
                        <div class="input-groups">
                            <input type="password" class="form-control" id="importPasswordInput" required="true" cdata="catalyst" cat-validation="required"><span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-lock txt-color-teal"></i> Please enter Instance Password</b>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection authPemFile marginSpaceTop" >
                        <div class="smart-forms">
                            <label for="exampleInputEmail1">Pem File</label>
                            <div class="input-groups">
                                <label for="" name="field" class="file">
                                    <span class="button btn-primary">Browse</span>
                                    <input id="importPemfileInput" type="file" class="gui-file" onchange="$(this).next().val(this.files[0].name)">
                                    <input type="text" readonly="" class="gui-input">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="marginForButtons">
                        <label id="saveSpinner" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                        <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="button" class="btn btn-primary importNodesBtn">Sync</button>
                    </div>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="providerSyncResultModal" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Importing Instances</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


<!--tab content over-->
<script type="text/javascript">
    //initialising the datatable before DOM Ready...
    if (!$.fn.dataTable.isDataTable('#tagsTable')) {
        var $tagsDatatable = $('#tagsTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }
    if (!$.fn.dataTable.isDataTable('#mappingprojectTable')) {
        var $mappingprojectDatatable = $('#mappingprojectTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }
    if (!$.fn.dataTable.isDataTable('#mappingenvTable')) {
        var $mappingenvDatatable = $('#mappingenvTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }

    //initialising the datatable for Managed...
    if (!$.fn.dataTable.isDataTable('#instanceListTable')) {
        var $instanceManagedDatatable = $('#instanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }
    //initialising the datatable for Assigned...
    if (!$.fn.dataTable.isDataTable('#unmanagedinstanceListTable')) {
        var $instanceUnManagedDatatable = $('#unmanagedinstanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }
    //initialising the datatable for Assigned...
    if (!$.fn.dataTable.isDataTable('#unassignedinstanceListTable')) {
        var $instanceUnAssignedDatatable = $('#unassignedinstanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }

    $(document).ready(function(e) {
        var urlParams = {};
        (window.onpopstate = function() {
            var url = window.location.href;
            var indexOfQues = url.lastIndexOf("?");
            if (indexOfQues != -1) {
                var sub = url.substring(indexOfQues + 1);
                //console.log(sub);
                urlParams.providerId = sub;
            }
        })();
        if (!urlParams.providerId) {
            return;
        }
        if(urlParams.providerId && urlParams.providerId.indexOf("#ajax") == -1){
          getTagsListData(urlParams.providerId);
          getManagedInstances();
          getUnmanagedInstances();
        }
        //loading Managed Data
        function getTagsListData(providerId) {
            $.get('/providers/' + providerId + '/tags', function(tagsList) {
                loadTagsTabData(tagsList,providerId);
                $('#tagsIdDiv').show();
            }).fail(function(jxhr) {
                var msg = "Tags List Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
            /*var tagsListdummy = {
                "tags": [{
                    "name": "env",
                    "description": null
                }, {
                    "name": "application",
                    "description": "Project name"
                },{
                    "name": "testingEnv",
                    "description": ""
                }],
                "count": 2,
                "pageSize": 10,
                "pageIndex": 1
            };
            loadTagsTabData(tagsListdummy,providerId);*/
        }

        function loadTagsTabData(tagsListData,providerId) {
            var $projecttagsList = $('#tagsProjectSelect');
            var $envtagsList = $('#tagsEnvSelect');
            $projecttagsList.empty();
            $envtagsList.empty();
            $tagsDatatable.clear().draw();
            var $tbody = $('#tagsTable tbody').empty();
            for (var i = 0; i < tagsListData.length; i++) {
                //For Dropdown
                $projecttagsList.append($('<option></option>').val(tagsListData[i].name).html(tagsListData[i].name));
                $envtagsList.append($('<option></option>').val(tagsListData[i].name).html(tagsListData[i].name));

                //For Table
                var $tr = $('<tr class=""></tr>');
                var $tdName = $('<td class="tagName"></td>').append(tagsListData[i].name);
                $tr.append($tdName);

                if(tagsListData[i].description){
                    var $inputTxt = '';
                    var tagsDescription = tagsListData[i].description;
                    $inputTxt = $('<input id="tagdescinputId'+i+'" value="'+tagsDescription+'" type="text" class="width-90 border-grey"></input><a class="btn btn-primary saveBtnTagsCSS" title="Save"><i class="ace-icon fa fa-save bigger-110"></i></a>');
                }else{
                    var $inputTxt = '';
                    $inputTxt = $('<input id="tagdescinputId'+i+'" type="text" class="width-90 border-grey"></input><a class="btn btn-primary saveBtnTagsCSS" title="Save"><i class="ace-icon fa fa-save bigger-110"></i></a>');
                }
                
                $inputTxt.keypress(function(event){
                    var keycode = (event.keyCode ? event.keyCode : event.which);
                    if(keycode == '13'){
                        var $this = $(this);
                        var id = $this.attr('id');
                        var tagName = $this.parents().eq(1).find('.tagName').html();
                        var tagDesc = $this.parents().eq(1).find('input').val();
                       
                        //Send the body update tag
                        var objupdatetagDesc = {};
                        objupdatetagDesc["description"] = tagDesc;

                        $.ajax({
                            url: '/providers/'+ providerId +'/tags/'+ tagName,
                            method: 'PUT',
                            data: JSON.stringify(objupdatetagDesc),
                            contentType: "application/json",
                            success: function() {
                                $('#'+id).css('background-color','lightyellow');
                            },
                            error: function(jxhr) {
                                //alert("Tags description not saved....");
                            }
                        }); 
                    }
                    //Stop the event from propogation to other handlers
                    //If this line will be removed, then keypress event handler attached 
                    //at document level will also be triggered
                    event.stopPropagation();
                });
    
                $inputTxt.filter('.saveBtnTagsCSS').off("click").on("click",function(){
                    var $this = $(this);
                    var tagName = $this.parents().eq(1).find('.tagName').html();
                    var tagDesc = $this.parents().eq(1).find('input').val();
                
                    //Send the body update tag
                    var objupdatetagDesc = {};
                    objupdatetagDesc["description"] = tagDesc;
                    $.ajax({
                        url: '/providers/'+ providerId +'/tags/'+ tagName,
                        method: 'PUT',
                        data: JSON.stringify(objupdatetagDesc),
                        contentType: "application/json",
                        success: function() {
                            $this.parents().eq(1).find('input').css('background-color','lightyellow');
                        },
                        error: function(jxhr) {
                            //alert("Tags description not saved....");
                        }
                    });
                });
                var $tdDesc = $('<td></td>').append($inputTxt);
                $tr.append($tdDesc);

                $tbody.append($tr);
                $tagsDatatable.row.add($tr).draw();
            }
            var blankArr = [];
            loaddefaultTagMappingSelection(blankArr);
        }
        /*var tagsListSelected = {
            "tagNameMappings": [{
                "tagName": "application",
                "tagValues": ["proj1", "proj2"],
                "catalystEntityType": "project",
                "catalystEntityMapping": [{
                    "catalystEntityId": "<MongoID>",
                    "catalystEntityName": "Project1",
                    "tagValue": "proj1"
                }, {
                    "catalystEntityId": "<MongoID>",
                    "catalystEntityName": "Project2",
                    "tagValue": "proj2"
                }]
            }, {
                "tagName": "testingEnv",
                "tagValues": ["prod", "dev"],
                "catalystEntityType": "environment",
                "catalystEntityMapping": [{
                    "catalystEntityId": "<MongoID>",
                    "catalystEntityName": "Development",
                    "tagValue": "dev"
                }, {
                    "catalystEntityId": "<MongoID>",
                    "catalystEntityName": "Production",
                    "tagValue": "prod"
                }]
            }],
            "count": 2,
            "pageSize": 10,
            "pageIndex": 1
        };*/
        function loaddefaultTagMappingSelection(catalystEntityTypeListPassed){
            $.ajax({
                url: '/providers/'+urlParams.providerId+'/tag-mappings',
                method: 'GET',
                contentType: "application/json",
                success: function(tagsListSelected) {
                    //For tags tab.....
                    var $projecttagsList = $('#tagsProjectSelect');
                    var $envtagsList = $('#tagsEnvSelect');
                    var catalystEntityProjName = $('#projectnameLabelId').attr('catalystEntitytype');
                    var catalystEntityEnvName = $('#envnameLabelId').attr('catalystEntitytype');

                    for(var i=0;i<tagsListSelected.length;i++){
                        var objcatalystEntityType = tagsListSelected[i].catalystEntityType;
                        var objtagName = tagsListSelected[i].tagName;
                        var tagValues = tagsListSelected[i].tagValues;
                        var catalystEntityMapping = tagsListSelected[i].catalystEntityMapping;
                        if(objcatalystEntityType == catalystEntityProjName){
                            $projecttagsList.val(objtagName);

                            //For Mapping tab.....
                            //For project catalystEntityType
                            $mappingprojectDatatable.clear().draw();
                            var $tbody = $('#mappingprojectTable tbody').empty();

                            for(var j = 0; j < catalystEntityTypeListPassed.length; j++){
                                //For Table
                                var $tr = $('<tr id="'+catalystEntityTypeListPassed[j].rowid+'" class=""></tr>');

                                var $tdprojectName = $('<td class="mappingprojectName"></td>').append(catalystEntityTypeListPassed[j].projectname);
                                $tr.append($tdprojectName);


                                var $mappingprojectSelectList= $('<select class="mappingprojectSelectId"></select>');
                                $mappingprojectSelectList.empty();
                                for(var k=0; k< tagValues.length; k++){
                                    $mappingprojectSelectList.append($('<option></option>').val(tagValues[k]).html(tagValues[k]));
                                }
                                
                                var $tdprojectTagName = $('<td class="mappingprojectTagName"></td>').append($mappingprojectSelectList);
                                $tr.append($tdprojectTagName);

                                $tbody.append($tr);
                                $mappingprojectDatatable.row.add($tr).draw();
                                //alert(catalystEntityTypeListPassed[j].rowid);
                                for(var l = 0; l < catalystEntityMapping.length; l++){
                                    
                                    if(catalystEntityTypeListPassed[j].rowid == catalystEntityMapping[l].catalystEntityId){
                                        //alert("Matched");
                                        $mappingprojectSelectList.val(catalystEntityMapping[l].tagValue);
                                    }
                                }
                            }
                        }
                        //For environment catalystEntityType
                        if(objcatalystEntityType == catalystEntityEnvName){
                            $envtagsList.val(objtagName);
                            /*//For Mapping tab.....
                            //For environment catalystEntityType
                            $mappingenvDatatable.clear().draw();
                            var $tbody = $('#mappingenvTable tbody').empty();

                            for(var m = 0; m < catalystEntityTypeListPassed.length; m++){
                                //For Table
                                //alert(catalystEntityTypeListPassed[m].environmentname);
                                var $tr = $('<tr id="'+catalystEntityTypeListPassed[m].rowid+'" class=""></tr>');

                                var $tdenvName = $('<td class="mappingenvName"></td>').append(catalystEntityTypeListPassed[m].environmentname);
                                $tr.append($tdenvName);

                                var $mappingenvSelectList= $('<select class="mappingenvSelectId"></select>');
                                $mappingenvSelectList.empty();
                                for(var n=0; n< tagValues.length; n++){
                                    $mappingenvSelectList.append($('<option></option>').val(tagValues[n]).html(tagValues[n]));
                                }
                                
                                var $tdenvTagName = $('<td class="mappingenvTagName"></td>').append($mappingenvSelectList);
                                $tr.append($tdenvTagName);


                                $tbody.append($tr);
                                $mappingenvDatatable.row.add($tr).draw();

                                for(var p = 0; p < catalystEntityMapping.length; p++){
                                    if(catalystEntityTypeListPassed[m].rowid == catalystEntityMapping[p].catalystEntityId){
                                        //alert("Matched");
                                        $mappingenvSelectList.val(catalystEntityMapping[p].tagValue);
                                    }
                                }
                            }*/
                        }
                    }
                },
                error: function(jxhr) {
                    //alert("Tags description not saved....");
                }
            });
            
        }
        $('.btntagsFormSave').on('click',function(){
            var $projecttagsList = $('#tagsProjectSelect');
            var $envtagsList = $('#tagsEnvSelect');

            var catalystEntityProjName = $('#projectnameLabelId').attr('catalystEntitytype');
            var catalystEntityEnvName = $('#envnameLabelId').attr('catalystEntitytype');

            var tagsProjSelectedVal = $projecttagsList.val();
            var tagsenvSelectedVal = $envtagsList.val();

            if(tagsProjSelectedVal == tagsenvSelectedVal){
                alert("Tag name cannot be same to create catalyst entity mapping");
                return;
            }

            //Creating the data to Post for Save tags.
            var tagsData = [{
                    "catalystEntityType": catalystEntityProjName,
                    "tagName": tagsProjSelectedVal
                },
                {
                    "catalystEntityType": catalystEntityEnvName,
                    "tagName": tagsenvSelectedVal
                }];
            $.ajax({
                url: '/providers/'+urlParams.providerId+'/tag-mappings',
                method: 'POST',
                data: JSON.stringify(tagsData),
                contentType: "application/json",
                success: function(tagsListPost) {
                    $('#spantagsformSaveId').html("Saved successfully");
                    getprojectData();
                    getenvironmentData();
                },
                error: function(jxhr) {
                    //alert("Tags description not saved....");
                }
            });
        });
        
        //Mapping tabs operation starts....
        getprojectData();
        getenvironmentData();
        //For Project Mapping
        function getprojectData(){
            $.get('/d4dMasters/readmasterjsonnew/4', function(projectist) {
                loaddefaultTagMappingSelection(projectist);
            }).fail(function(jxhr) {
                var msg = "Getting Project List Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function projectMappingList(projectList){
            $mappingprojectDatatable.clear().draw();
            var $tbody = $('#mappingprojectTable tbody').empty();



            $.get('/providers/'+urlParams.providerId+'/tag-mappings/project', function(data) {
                //Bring the total for loop inside it.
            }).fail(function(jxhr) {
                var msg = "Tags mapping Project Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });

            var tagValues = ["proj1", "proj2"];
            var catalystEntityMapping = [
                {
                    "catalystEntityId": "c7d5ec5e-47ed-418a-b6ba-6b137f7af6bf",
                    "catalystEntityName": "Project1",
                    "tagValue": "proj1"
                },
                {
                    "catalystEntityId": "b38ccedc-da2c-4e2c-a278-c66333564719",
                    "catalystEntityName": "Project2",
                    "tagValue": "proj2"

                }
            ];
            for(var i = 0; i < projectList.length; i++){
                //For Table
                var $tr = $('<tr id="'+projectList[i].rowid+'" class=""></tr>');

                var $tdprojectName = $('<td class="mappingprojectName"></td>').append(projectList[i].projectname);
                $tr.append($tdprojectName);


                var $mappingprojectSelectList= $('<select class="mappingprojectSelectId"></select>');
                $mappingprojectSelectList.empty();
                for(var j=0; j< tagValues.length; j++){
                    $mappingprojectSelectList.append($('<option></option>').val(tagValues[j]).html(tagValues[j]));
                }
                
                var $tdprojectTagName = $('<td class="mappingprojectTagName"></td>').append($mappingprojectSelectList);
                $tr.append($tdprojectTagName);

                $tbody.append($tr);
                $mappingprojectDatatable.row.add($tr).draw();
                //alert(projectList[i].rowid);
                for(var k = 0; k < catalystEntityMapping.length; k++){
                    
                    if(projectList[i].rowid == catalystEntityMapping[k].catalystEntityId){
                        //alert("Matched");
                        $mappingprojectSelectList.val(catalystEntityMapping[k].tagValue);
                    }
                }
            }
        }

        //For Environment Mapping
        function getenvironmentData(){
            $.get('/d4dMasters/readmasterjsonnew/3', function(envList) {
                envMappingList(envList);
            }).fail(function(jxhr) {
                var msg = "Project Mapping Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function envMappingList(envList){
            $mappingenvDatatable.clear().draw();
            var $tbody = $('#mappingenvTable tbody').empty();
            //console.log("Environment List: ",envList);

            $.get('/providers/'+urlParams.providerId+'/tag-mappings/environment', function(data) {
                
                for(var i = 0; i < envList.length; i++){
                    //For Table
                    //alert(envList[i].environmentname);
                    var $tr = $('<tr id="'+envList[i].rowid+'" class=""></tr>');

                    var $tdenvName = $('<td class="mappingenvName"></td>').append(envList[i].environmentname);
                    $tr.append($tdenvName);

                    var $mappingenvSelectList= $('<select class="mappingenvSelectId"></select>');
                    $mappingenvSelectList.empty();
                    for(var j=0; j< data.tagValues.length; j++){
                        $mappingenvSelectList.append($('<option></option>').val(data.tagValues[j]).html(data.tagValues[j]));
                    }
                    
                    var $tdenvTagName = $('<td class="mappingenvTagName"></td>').append($mappingenvSelectList);
                    $tr.append($tdenvTagName);


                    $tbody.append($tr);
                    $mappingenvDatatable.row.add($tr).draw();

                    for(var k = 0; k < data.catalystEntityMapping.length; k++){
                        if(envList[i].rowid == data.catalystEntityMapping[k].catalystEntityId){
                            //alert("Matched");
                            $mappingenvSelectList.val(data.catalystEntityMapping[k].tagValue);
                        }
                    }
                }
            }).fail(function(jxhr) {
                
            });


            /*var tagValues = ["Dev", "QA", "Stage","Production"];
            var catalystEntityMappingEnv = [
                {
                    "catalystEntityId": "5e5a6c85-e5fa-4bfe-a6ea-ee21dd455dee",
                    "catalystEntityName": "env1",
                    "tagValue": "Dev"
                },
                {
                    "catalystEntityId": "6a170bc5-947f-49e1-a9a0-13958857367e",
                    "catalystEntityName": "env2",
                    "tagValue": "QA"
                },
                {
                    "catalystEntityId": "8a94fd8e-f305-47a4-b674-d85ec12725fe",
                    "catalystEntityName": "env4",
                    "tagValue": "Production"

                },
                {
                    "catalystEntityId": "8dc13728-35e4-4b74-abd6-2aec1ed70e16",
                    "catalystEntityName": "env3",
                    "tagValue": "Stage"
                }
            ];*/
            
            /*for(var i = 0; i < envList.length; i++){
                //For Table
                //alert(envList[i].environmentname);
                var $tr = $('<tr id="'+envList[i].rowid+'" class=""></tr>');

                var $tdenvName = $('<td class="mappingenvName"></td>').append(envList[i].environmentname);
                $tr.append($tdenvName);

                var $mappingenvSelectList= $('<select class="mappingenvSelectId"></select>');
                $mappingenvSelectList.empty();
                for(var j=0; j< tagValues.length; j++){
                    $mappingenvSelectList.append($('<option></option>').val(tagValues[j]).html(tagValues[j]));
                }
                
                var $tdenvTagName = $('<td class="mappingenvTagName"></td>').append($mappingenvSelectList);
                $tr.append($tdenvTagName);


                $tbody.append($tr);
                $mappingenvDatatable.row.add($tr).draw();

                for(var k = 0; k < catalystEntityMappingEnv.length; k++){
                    if(envList[i].rowid == catalystEntityMappingEnv[k].catalystEntityId){
                        //alert("Matched");
                        $mappingenvSelectList.val(catalystEntityMappingEnv[k].tagValue);
                    }
                }
            }*/

        }

        $('.btnprojectMappingSave').on('click',function(){
            var projectMappingObj = {
                "catalystEntityMapping": []
            };
            var counter =0;
            $('#mappingprojectTable tbody tr').each(function() {
                counter++;
                $tr = $(this);
                var projmappingcatalystEntityId = $tr.attr('id');
                //configureEnvArraySequence.push(envUniqueTextAllEnv);
                var mappingprojectSelectTagName = $tr.find('.mappingprojectSelectId :selected').val();

                var objprojectMapping = {};
                objprojectMapping["catalystEntityId"] = projmappingcatalystEntityId;
                objprojectMapping["tagValue"] = mappingprojectSelectTagName;

                //console.log(objprojectMapping);
                projectMappingObj.catalystEntityMapping.push(objprojectMapping);
                // $('#spanprojectMappingSaveId').html('Saved successfully');

                if(counter == $('#mappingprojectTable tbody tr').length){
                    $.ajax({
                        url: '/providers/'+urlParams.providerId+'/tag-mappings/project',
                        data: JSON.stringify(projectMappingObj),
                        type: 'PATCH',
                        contentType: "application/json",
                        success: function(data) {
                            $('#spanprojectMappingSaveId').html('Saved successfully');
                        },
                        error: function(jqxhr) {
                            
                        }
                    });
                }                
            });
        });


        $('.btnenvMappingSave').on('click',function(){
            var envMappingObj = {
                "catalystEntityMapping": []
            };
            var counter =0;
            var envMappingSequence = [];
            $('#mappingenvTable tbody tr').each(function() {
                counter++;
                $tr = $(this);
                var envmappingcatalystEntityId = $tr.attr('id');
                //configureEnvArraySequence.push(envUniqueTextAllEnv);
                var mappingenvSelectTagName = $tr.find('.mappingenvSelectId :selected').val();

                var objenvMapping = {};
                objenvMapping["catalystEntityId"] = envmappingcatalystEntityId;
                objenvMapping["tagValue"] = mappingenvSelectTagName;

                envMappingObj.catalystEntityMapping.push(objenvMapping);
                //console.log(envMappingObj);
                //$('#spanenvMappingSaveId').html('Saved successfully');
                if(counter == $('#mappingenvTable tbody tr').length){
                    $.ajax({
                        url: '/providers/'+urlParams.providerId+'/tag-mappings/environment',
                        data: JSON.stringify(envMappingObj),
                        type: 'PATCH',
                        contentType: "application/json",
                        success: function(data) {
                            $('#spanenvMappingSaveId').html('Saved successfully');
                        },
                        error: function(jqxhr) {
                            
                        }
                    });
                }                
            });
        });















        //Instances Tabs Starts here......
        var $chooseCtalystSelectId = $('#chooseCtalystSelectId');
        $chooseCtalystSelectId.change(function(e) {
            var catalystStatusType = $('#chooseCtalystSelectId :selected').attr('data-catalystStatus');
            if ($('#chooseCtalystSelectId :selected').text() == 'Managed') {
                $('#Managed').show();
                $('#Assigned').hide();
                $('#Unassigned').hide();
            } else if (catalystStatusType == 'Assigned') {
                $('#Managed').hide();
                $('#Assigned').show();
                $('#Unasssigned').hide();
            } else {
                $('#Managed').hide();
                $('#Assigned').hide();
                $('#Unassigned').show();
            }
        });

        var $orgListInput = $('#providerSyncOrgSelect').attr('disabled', 'disabled');
        var $bgList = $('#providerSyncBgSelect');
        var $projectList = $('#providerSyncProjectSelect');
        var $envList = $('#providerSyncEnvSelect');
        var $infraManagerList = $('#providerSyncInfraManagerSelect');

        $('#providerSyncBtn').click(function(e) {
            $('#saveSpinner').addClass('hidden');
            $('.importNodesBtn').removeAttr('disabled');
            var perm = haspermission('instancelaunch', 'execute');

            if (!perm) {
                bootbox.alert('Insufficient permission to perform operation.');
                $('#chefImportNodesModal').modal('hide');
                return;
            } else {
                var $checkBoxes = $('.nodeCheckBox:checked');
                if (!$checkBoxes.length) {
                    bootbox.alert('Please Choose instances first');
                    return;
                }
                $('#providerSyncModal').modal('show');
                $('#myForm12').trigger("reset");
                $envList.empty();

                $('#pemFileDropdown2').change();
            }
        });

        $(".authPassword").show();
        $(".authPemFile").hide();
        $('.authenticationType').change(function(e) {
            if (this.value == "password") {
                $(".authPassword").show();
                $(".authPemFile").hide();
            } else {
                $(".authPassword").hide();
                $(".authPemFile").show();
            }
        });


        var serviceURL = "../d4dMasters/";

        function getRelatedValues_Top(jsonID, comparedField, filterByValue, outputField) {
            var result = [];
            readMasterJson_Top(jsonID);
            if (d4ddata) {
                $.each(d4ddata, function(k, v) {
                    if (v[comparedField] == filterByValue && v[outputField]) {
                        result.push(v['rowid'] + '|' + v[outputField]);
                    }
                });
            }
            return (result);
        }

        function getRelatedValues_Top_rowid(jsonID, comparedField, filterByValue, outputField) {
            var result = [];
            readMasterJson_Top(jsonID);
            if (d4ddata) {
                $.each(d4ddata, function(k, v) {
                    if (v[comparedField] == filterByValue && v[outputField]) {
                        var rowids = v[outputField + '_rowid'].split(',');
                        var txts = v[outputField].split(',');
                        for (var i = 0; i < txts.length; i++) {
                            result.push(rowids[i] + '|' + txts[i]);
                        }
                    }
                });
            }
            return (result);
        }


        function readMasterJson_Top(section) {
            $.ajax({
                type: "get",
                dataType: "text",
                async: false,
                url: serviceURL + "readmasterjsonnew/" + section,
                success: function(data) {
                    d4ddata = JSON.parse(data);
                },
                failure: function(data) {
                    alert(data.toString());
                }
            });
            return (d4ddata);
        }


        //loading provider with org
        $.get('/providers/' + urlParams.providerId, function(provider) {
            var org = provider.org
            $orgListInput.append($('<option></option>').val(org.rowid).html(org.orgname).attr('selected', 'selected'));
            $bgList.empty();
            $bgList.append($('<option></option>').val('choose').html('Choose'));
            var getBGs = getRelatedValues_Top(2, "orgname_rowid", org.rowid, "productgroupname");
            for (var i = 0; i < getBGs.length; i++) {
                if (getBGs[i].indexOf('|') >= 0) {
                    var txtval = getBGs[i].split('|');
                    $bgList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                }

            }

            $bgList.change(function(e) {
                var bgName = $(this).val();
                if (bgName == 'choose') {
                    return;
                }
                $projectList.empty();
                $projectList.append($('<option></option>').val('choose').html('Choose'));

                var getProjs = getRelatedValues_Top(4, "productgroupname_rowid", bgName, "projectname");
                // alert(JSON.stringify(getProjs));
                for (var i = 0; i < getProjs.length; i++) {
                    if (getProjs[i].indexOf('|') >= 0) {
                        var txtval = getProjs[i].split('|');
                        $projectList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                    }
                }
            });
            $projectList.change(function(e) {
                var projName = $(this).val();
                if (projName == 'choose') {
                    return;
                }
                var getEnvs_ = getRelatedValues_Top_rowid(4, "rowid", projName, "environmentname");
                var getEnvs = getEnvs_.toString().replace(/"/g, '').split(',');
                for (var i = 0; i < getEnvs.length; i++) {
                    if (getEnvs[i].indexOf('|') >= 0) {
                        var txtval = getEnvs[i].split('|');
                        $envList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                    }
                }
            });
            // loading inframanagers
            $.get(serviceURL + 'organization/' + org.rowid + '/configmanagement/list', function(configMgmntList) {
                var $configManagementDropdown = $('#providerSyncInfraManagerSelect');
                for (var i = 0; i < configMgmntList.length; i++) {
                    var $options = $('<option></option>');
                    var name;
                    if (configMgmntList[i].configType === 'puppet') {
                        name = configMgmntList[i].puppetservername;
                    } else {
                        name = configMgmntList[i].configname;
                    }
                    $options.html(name);
                    $options.val(configMgmntList[i].rowid);
                    $configManagementDropdown.append($options);
                }
            });

        });


        function loadManagedInstances(managnedData) {
            $instanceManagedDatatable.clear().draw();
            var $tbody = $('#managedInstance tbody').empty();
            for (var i = 0; i < managnedData.length; i++) {
                var $tr = $('<tr class="managedInstance"></tr>').attr('data-id',managnedData[i]._id);
                var $tdId = $('<td></td>').append(managnedData[i].platformId);
                $tr.append($tdId);

                var $tdOs = $('<td></td>').append(managnedData[i].hardware.os);
                $tr.append($tdOs);

                var $tdIpAddress = $('<td></td>').append(managnedData[i].instanceIP);
                $tr.append($tdIpAddress);

                var region = '';
                if (managnedData[i].providerData && managnedData[i].providerData.region) {
                    region = managnedData[i].providerData.region;
                }
                var $tdRegion = $('<td></td>').append(region);
                $tr.append($tdRegion);
                var $tdStatus = $('<td></td>').append(managnedData[i].instanceState);
                $tr.append($tdStatus);

                var $button = '';

                if (managnedData[i].instanceState === 'terminated') {

                    $button = $('<div style="margin-left:14px;" class="btn-group"><button class="btn btn-danger pull-left btn-sg tableactionbutton globalTrackUrlRemove" data-placement="top" value="Remove" title="Delete"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
                    $button.click(function() {
                        var $this = $(this);
                        var $tr = $this.parents('tr.managedInstance');
                        var id = $this.parents('tr').attr('data-id');
                        bootbox.confirm({
                            message: 'Are you sure you want to Delete Managed Instance -&nbsp;',
                            title: "Warning",
                            callback: function(result) {
                                if (result) {
                                    $.ajax({
                                        url: '/instances/' + id,
                                        method: 'DELETE',
                                        success: function() {
                                            $instanceManagedDatatable.row($tr).remove().draw(false);
                                        },
                                        error: function(jxhr) {
                                            bootbox.alert(result);
                                            var msg = "Unable to Delete Managed Instances please try again later";
                                            if (jxhr.responseJSON && jxhr.responseJSON.message) {
                                                msg = jxhr.responseJSON.message;
                                            } else if (jxhr.responseText) {
                                                msg = jxhr.responseText;
                                            }
                                            bootbox.alert(msg);
                                        }
                                    });
                                } else {
                                    return;
                                }
                            }
                        });
                        return false;
                    });
                }
                var $tdAction = $('<td></td>').append($button);
                $tr.append($tdAction);
                $tbody.append($tr);
                $instanceManagedDatatable.row.add($tr).draw();
            }
        }


        function loadUnmanagedInstances(unManagnedData) {
            var unmanagedInstances=unManagnedData.unmanagedInstances;
            $instanceUnManagedDatatable.clear().draw();
            var $tbody = $('#unManagedInstance tbody').empty();
            for (var i = 0; i < unmanagedInstances.length; i++) {
                var $tr = $('<tr></tr>').attr('instanceId', unmanagedInstances[i]._id);
                var $tdId = $('<td></td>').append(unmanagedInstances[i].platformId);
                $tr.append($tdId);

                var $tdOs = $('<td></td>').append(unmanagedInstances[i].os);
                $tr.append($tdOs);

                var $tdIpAddress = $('<td></td>').append(unmanagedInstances[i].ip);
                $tr.append($tdIpAddress);

                var region = '';
                if (unmanagedInstances[i].providerData && unmanagedInstances[i].providerData.region) {
                    region = unmanagedInstances[i].providerData.region;
                }
                var $tdRegion = $('<td></td>').append(region);
                $tr.append($tdRegion);
                var $tdStatus = $('<td></td>').append(unmanagedInstances[i].state);
                $tr.append($tdStatus);
                var $input = '';
                if (unmanagedInstances[i].state === 'running') {
                    $input = $('<input class="nodeCheckBox" type="checkbox">').val(unmanagedInstances[i]._id);
                }
                var $tdAction = $('<td></td>').append($input);
                $tr.append($tdAction);
                $tbody.append($tr);
                $instanceUnManagedDatatable.row.add($tr).draw();
            }
        }

        //loading Managed Data
        function getManagedInstances() {
            $.get('/providers/' + urlParams.providerId + '/managedInstances', function(managedInstances) {
                loadManagedInstances(managedInstances);
                $('#instanceListDiv').show();
            }).fail(function(jxhr) {
                var msg = "Provider Sync Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        //loading Assigned Data
        function getUnmanagedInstances() {
            $.get('/providers/' + urlParams.providerId + '/unmanagedInstances?'+'page=1&pageSize=60&sortBy=state&sortOrder=desc', function(unmanagnedInstances) {
                loadUnmanagedInstances(unmanagnedInstances);
                $('#unmanagedinstanceListDiv').show();
            }).fail(function(jxhr) {
                var msg = "Provider Sync Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        //loading UnAssigned Data
        function getUnassignedInstances() {
            $.get('/providers/'+ urlParams.providerId +'/unassigned-instances', function(unassignedInstances) {
                loadUnassignedInstances(unassignedInstances);
                $('#unassignedinstanceListDiv').show();
            }).fail(function(jxhr) {
                var msg = "Unassigned Instances Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        $('.importNodesBtn').click(function(e) {
            var $checkBoxes = $('.nodeCheckBox:checked');
            var reqBody = {};
            reqBody.orgId = $orgListInput.val();
            reqBody.bgId = $bgList.val();
            reqBody.projectId = $projectList.val();
            //Added By Durgesh For Project Name
            reqBody.projectName = $projectList.find('option:selected').text();
            //End By Durgesh
            reqBody.envId = $envList.val();
            reqBody.configManagmentId = $infraManagerList.val();


            if (!((reqBody.bgId && reqBody.bgId.length) && (reqBody.projectId && reqBody.projectId.length) && reqBody.projectId !== 'choose' && reqBody.bgId !== 'choose')) {
                alert('Please Select a Business Group & Project');
                return;
            }

            reqBody.instanceIds = [];
            $checkBoxes.each(function() {
                reqBody.instanceIds.push($(this).val());
            });

            reqBody.credentials = {};
            reqBody.credentials.username = $('#importUsernameInput').val();

            var $dropdown = $('#pemFileDropdown2');
            if (!($dropdown.val() === 'pemFile')) {
                reqBody.credentials.password = $('#importPasswordInput').val();
                if (!reqBody.credentials.username) {
                    alert('Please Enter Username');
                    return;
                }
                if (!reqBody.credentials.password) {
                    alert('Please Enter Password or Choose a Pem file');
                    return;
                }
                makeRequest();
            } else {
                var pemFileInput = $('#importPemfileInput').get(0);
                if (!reqBody.credentials.username) {
                    alert('Please Enter Username');
                    return;
                }
                if (!pemFileInput.files.length) {
                    alert('Please Choose a Pem file');
                    return;
                }
                var reader = new FileReader();
                reader.onload = function(e) {
                    reqBody.credentials.pemFileData = e.target.result;

                    makeRequest();

                };
                // Read in the image file as a data URL.
                reader.readAsText(pemFileInput.files[0]);

            }

            function makeRequest() {
                $('#saveSpinner').removeClass('hidden');
                $('.importNodesBtn').attr('disabled', 'disabled');
                console.log("Arab");
                console.log(reqBody);
                $.post('../providers/' + urlParams.providerId + '/sync', reqBody, function(data) {
                    console.log(data);
                    $('#providerSyncModal').modal('hide');
                    var $chefResultModalContainer = $('#providerSyncResultModal');
                    var $modalBody = $chefResultModalContainer.find('.modal-body');
                    $modalBody.empty();
                    var $progressBar = $('<progress value="0" max="' + reqBody.instanceIds.length + '"></progress>').css({
                        width: '100%'
                    });
                    var $msgDiv = $('<div class="messageDiv"></div>').css({
                        width: '100%'
                    });

                    $modalBody.append($progressBar).append($msgDiv);
                    $('#saveSpinner').addClass('hidden');

                    $('#chefImportNodesModal').modal('hide');
                    $chefResultModalContainer.modal('show');
                    var timeout;
                    var count = 0;

                    function pollTaskStatus(taskId, timestamp) {
                        timeout = setTimeout(function() {
                            $.get('../taskstatus/' + taskId + '/status?timestamp=' + timestamp, function(data) {
                                console.log(data);
                                if (!data.completed) {
                                    if (data.statusList && data.statusList.length) {

                                        $progressBar.val(data.statusList.length);
                                        $msgDiv.empty();
                                        for (var i = 0; i < data.statusList.length; i++) {
                                            $msgDiv.append($('<div></div>').append(data.statusList[i].status.message));
                                        }

                                        pollTaskStatus(taskId, data.statusList[data.statusList.length - 1].timestamp);
                                    } else {
                                        pollTaskStatus(taskId, timestamp);
                                    }
                                } else {
                                    if (data.statusList && data.statusList.length) {
                                        $progressBar.val(data.statusList.length);
                                        $msgDiv.empty();
                                        for (var i = 0; i < data.statusList.length; i++) {
                                            $msgDiv.append($('<div></div>').append(data.statusList[i].status.message));
                                        }
                                    }
                                    $progressBar.val(reqBody.selectedNodes.length);
                                    if (reqBody.selectedNodes.length) {
                                        var nodeData = $($checkBoxes[0]).data('node');
                                        if (nodeData && nodeData.chef_environment) {
                                        }
                                    }
                                }
                            })
                        }, 1000);

                    }
                    pollTaskStatus(data.taskId, 0);
                    //Refreshing the workzone tree
                }).error(function() {
                    bootbox.alert('Unable to import instances. Please try again later');
                });
            }
        });

    });
</script>