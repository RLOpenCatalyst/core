<style>
    .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
        border-top: 0px !important;
    }

    tr.show-settings:hover .settings{
        display:block;
    }

    div.settings{
        display:none;
        width: 32px;
        height: 18px;
    }

    .dropdown-content{
        border-radius: 5px;
        left: -30px;
        min-width: 98px;
        right: 0;
    }

    .show-settings input{
        border: 1px solid #999;
    }

    .marginSpaceTop {
        margin-top:20px;
    }
    .styleRight{
        float:right;
        margin-top: 4px;
    }
    .border-grey{
        border: 1px solid #ddd;
    }
    .colorGreen{
        color:green;
    }
    .spanformSaveCSS{
        float: left;
        margin-right: 7px;
        margin-top: 7px;
    }
    .marginbottomCSS{
        margin-bottom: 0px !important;
    }
    .margin-top10{
        margin-top: 10px;
    }
    .margin-top45{
        margin-top: 45px;
    }
    .marginbottom0{
        margin-bottom: 0px;
    }
    .saveBtnTagsCSS{
        float: right;
        font-size: 10px;
        padding: 2px 4px;
    }
    .fntsize13mrgtop45{
        font-size:13px;
        margin-top:45px !important;
    }
    .marginleft200{
        margin-left:200px;
    }
    .left0{
        left:0px !important;
    }
    .fnt14clr666{
        color:#666;
        font-size:14px;
    }
    .fntsize13mrgtop10{
        font-size:13px;
        margin-top:10px;
    }
    .marginleft5right25{
        margin-left:5px;
        margin-right:25px;
    }
    .marginleft14{
        margin-left: 14px;
    }
    .margintop-25left250{
        margin-top: -25px;
        margin-left: 250px;
    }
    .width-90{
        width:90%;
    }
    input[type=search] {
        border-color: #ddd !important;
    }
    .tagsContainer .dataTables_wrapper .dataTables_paginate .paginate_button{
        font-size: 12px !important;
        padding: 7px;
    }
    #tagsTable_info{
        font-size: 12px !important;
    }
</style>

<!--button to navigate back to provider list-->
<button class="btn btn-minier btn-primary styleRight" onclick="window.history.back();"><i class="ace-icon ace-icon fa fa-chevron-left bigger-110"></i>&nbsp;List of Providers</button>

<!--tabs start here-->
<ul class="nav nav-tabs " role="tablist">
    <li class="active">
        <a href="#tagsId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Tags">Tags</a>
    </li>
    <li id="mappingLiTabId">
        <a href="#mappingsId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Mappings">Mappings</a>
    </li>
    <li>
        <a href="#instancesId" role="tab" data-toggle="tab" data-toggle="tooltip" title="Instances">Instances</a>
    </li>
    <li>
        <a href="#rdsId" role="tab" data-toggle="tab" data-toggle="tooltip" title="RDS">RDS</a>
    </li>
    <li>
        <a href="#s3Id" role="tab" data-toggle="tab" data-toggle="tooltip" title="S3">S3</a>
    </li>
</ul>

<!--tab content starts here-->
<div class="tab-content">
    <!-- Tab panes -->
    <div class="tab-pane active tagsContainer" id="tagsId">
        <div class="tabContent table-responsive col-lg-6 left0" id="tagsIdDiv">
            <table class="table table-hover table-bordered fntsize13mrgtop45" id="tagsTable">
                <thead>
                <tr>
                    <th class="text-center">Tag Name</th>
                    <th class="text-center">Description</th>
                </tr>
                </thead>
                <tbody class="tagstblTbody">
                </tbody>
            </table>
        </div>
        <div class="col-lg-6">
            <div action="" id="tagsFormId">
                <div class="widget-box margin-top45">
                    <div class="widget-header">
                        <h4 class="widget-margin fnt14clr666">Create tag name to catalyst entity mapping</h4>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            <section id="widget-grid-tag" class="">
                                <div class="row">
                                    <div class="jarviswidget" id="wid-id-tag" data-widget-editbutton="false" data-widget-custombutton="false">
                                        <div>
                                            <div class="widget-body no-padding">
                                                <div class="col-lg-6 marginSpaceTop">
                                                    <label for="projectnameLabel" id="projectnameLabelId" catalystEntitytype="project">Project</label>
                                                    <div class="input-groups">
                                                        <select id="tagsProjectSelect"  class="width-100 form-control">
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 marginSpaceTop">
                                                    <label for="envnameLabel" id="envnameLabelId" catalystEntitytype="environment">Environment</label>
                                                    <div class="input-groups">
                                                        <select id="tagsEnvSelect" class="width-100 form-control" >
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                    <div class="widget-toolbox clearfix">
                        <div class="btn-group pull-right">
                            <span id="spantagsformSaveId" class="colorGreen spanformSaveCSS"></span>
                            <button class="btn btn-primary btn-mini btntagsFormSave">
                                <i class="ace-icon fa fa-check bigger-110"></i>
                                Save
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div  class="tab-pane mappingsListContainer" id="mappingsId">
        <div class="row">
            <div class="col-lg-6">
                <div  class="tabContent table-responsive marginbottomCSS" id="mappingprojectIdDiv">
                    <table class="table table-hover table-bordered text-center fntsize13mrgtop10" id="mappingprojectTable">
                        <thead>
                        <tr>
                            <th class="text-center">Catalyst Project</th>
                            <th class="text-center">Project Tag Value</th>
                        </tr>
                        </thead>
                        <tbody class="mappingprojecttblTbody">
                        </tbody>
                    </table>
                </div>
                <div class="widget-toolbox clearfix">
                    <div class="btn-group pull-right">
                        <span id="spanprojectMappingSaveId" class="colorGreen spanformSaveCSS"></span>
                        <button class="btn btn-primary btn-mini btnprojectMappingSave">
                            <i class="ace-icon fa fa-check bigger-110"></i>
                            Save
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div  class="tabContent table-responsive marginbottomCSS" id="mappingenvIdDiv">
                    <table class="table table-hover table-bordered text-center fntsize13mrgtop10" id="mappingenvTable">
                        <thead>
                        <tr>
                            <th class="text-center">Catalyst Environment</th>
                            <th class="text-center">Environment Tag Value</th>
                        </tr>
                        </thead>
                        <tbody class="mappingenvtblTbody">
                        </tbody>
                    </table>
                </div>
                <div class="widget-toolbox clearfix">
                    <div class="btn-group pull-right">
                        <span id="spanenvMappingSaveId" class="colorGreen spanformSaveCSS"></span>
                        <button class="btn btn-primary btn-mini btnenvMappingSave">
                            <i class="ace-icon fa fa-check bigger-110"></i>
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div  class="tab-pane instancesContainer" id="instancesId">
        <div class="col-lg-6 col-md-6">
            <label for="chooseCatalyst">Catalyst Status:</label>
            <div class="input-groups">
                <select id="chooseCtalystSelectId" name="" class="required width-100 form-control">
                    <option val="Managed" data-catalystStatus="Managed">Managed</option>
                    <option val="Assigned" data-catalystStatus="Assigned">Assigned</option>
                    <option val="Unasssigned" data-catalystStatus="Unassigned">Unasssigned</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 margin-top10">
            <div id="Managed">
                <!--managed instances-->
                <div  class="tab-pane active instancesListContainer" id="organiz">
                    <div  class="tabContent table-responsive" id="instanceListDiv" >
                        <table class="table table-hover table-bordered text-center fntsize13mrgtop45" id="instanceListTable">
                            <thead>
                            <tr>
                                <th class="text-center">InstanceId</th>
                                <th class="text-center">OS</th>
                                <th class="text-center">IP Address</th>
                                <th class="text-center">Region</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Project</th>
                                <th class="text-center">Environment</th>
                                <th class="text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="managedInstance">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="Assigned" hidden>
                <!--unmanaged instances-->
                <div  class="tab-pane unmanagedInstancesListContainer" id="unmanaged">
                    <div  class="tabContent table-responsive" id="unmanagedinstanceListDiv" >
                        <table class="table table-hover table-bordered text-center fntsize13mrgtop45" id="unmanagedinstanceListTable">
                            <thead>
                            <tr>
                                <th class="text-center">InstanceId</th>
                                <th class="text-center">OS</th>
                                <th class="text-center">IP Address</th>
                                <th class="text-center">Region</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Project</th>
                                <th class="text-center">Environment</th>
                                <th class="text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="unManagedInstance">
                            </tbody>
                        </table>
                    </div>
                    <footer class="footer">
                        <div class="clearfix form-actions text-center">
                            <div>
                                <input type="button" id="providerSyncBtn" value="Import Instances" class="btn btn-primary showChefImportNodesModalBtn marginleft200">
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
            <div id="Unassigned" hidden>
                <div  class="tab-pane unassignedInstancesListContainer" id="unassigned">
                    <div  class="tabContent table-responsive" id="unassignedinstanceListDiv" >
                        <table class="table table-hover table-bordered text-center fntsize13mrgtop45" id="unassignedinstanceListTable">
                            <thead>
                            <tr>
                                <th class="text-center">InstanceId</th>
                                <th class="text-center">OS</th>
                                <th class="text-center">IP Address</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Project Tag Value</th>
                                <th class="text-center">Env. Tag Value</th>
                                <th class="text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="unAssignedInstance">
                            </tbody>
                        </table>
                    </div>
                    <footer class="footer">
                        <div class="clearfix form-actions text-center marginleft200 marginbottom0">
                            <div>
                                <input type="button" id="unassignedSyncBtn" value="Update Tags" class="btn btn-primary">
                            </div>
                            <div class="margintop-25left250">
                                <span id="spanunassignedformSaveId" class="colorGreen marginleft14"></span>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>
    <!--rds data-->
    <div  class="tab-pane rdsContainer" id="rdsId">
        <div class="col-lg-6 col-md-6">
            <label for="chooseCatalyst">Catalyst Status:</label>
            <div class="input-groups">
                <select id="chooseCatalystRDSId" name="" class="required width-100 form-control">
                    <option val="Unasssigned" data-catalystStatus="rdsUnassigned">Unasssigned</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 margin-top10">
            <div id="rdsUnassigned">
                <div class="tab-pane unassignedRDSListContainer">
                    <div class="tabContent table-responsive" id="unassignedRDSListDiv" >
                        <table class="table table-hover table-bordered text-center fntsize13mrgtop45" id="unassignedRDSListTable">
                            <thead>
                            <tr>
                                <th class="text-center">DBInstance</th>
                                <th class="text-center">Type</th>
                                <th class="text-center">Status</th>
                                <th class="text-center">Region</th>
                                <th class="text-center">Instance Class</th>
                                <th class="text-center">Multi-AZ</th>
                                <th class="text-center">Created</th>
                            </tr>
                            </thead>
                            <tbody class="unAssignedRDS">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--rds tab ends here-->
    <!--s3 data-->
    <div  class="tab-pane s3Container" id="s3Id">
        <div class="col-lg-6 col-md-6">
            <label for="chooseCatalyst">Catalyst Status:</label>
            <div class="input-groups">
                <select id="chooseCatalystS3Id" name="" class="required width-100 form-control">
                    <option val="Unasssigned" data-catalystStatus="s3Unassigned">Unasssigned</option>
                </select>
            </div>
        </div>
        <div class="col-lg-12 margin-top10">
            <div id="s3Unassigned">
                <div class="tab-pane unassignedS3ListContainer">
                    <div class="tabContent table-responsive" id="unassignedS3ListDiv" >
                        <table class="table table-hover table-bordered text-center fntsize13mrgtop45" id="unassignedS3ListTable">
                            <thead>
                            <tr>
                                <th class="text-center">Bucket Name</th>
                                <th class="text-center">Bucket Owner</th>
                                <th class="text-center">Org Name</th>
                                <th class="text-center">Size(MB)</th>
                                <th class="text-center">Created</th>
                            </tr>
                            </thead>
                            <tbody class="unAssignedS3">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--s3 data tab ends here-->
</div>

<!--import instance modal-->
<div class="modal fade" id="providerSyncModal" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="" id="myForm12" autocomplete="off">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Import Instance</h4>
                </div>
                <div class="modal-body modalbody-height">
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Organization</label>
                        <div class="input-groups">
                            <select id="providerSyncOrgSelect"  class="width-100 form-control" disabled>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Business Groups<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncBgSelect"  class="width-100 form-control" cdata="catalyst" cat-validation="required" autofocus>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="exampleInputEmail1">Project<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncProjectSelect"  class="width-100 form-control">
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop">
                        <label for="exampleInputEmail1">Environment<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncEnvSelect"  class="width-100 form-control" >
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="exampleInputEmail1">Config Management<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <select id="providerSyncInfraManagerSelect"  class="width-100 form-control" >
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection marginSpaceTop" >
                        <label for="exampleInputEmail1">Username<span class="control-label redSpan">&nbsp;*</span></label>
                        <div class="input-groups">
                            <input type="text" name="importUsernameInput" class="form-control" id="importUsernameInput" required value="" autofocus>
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-user txt-color-teal"></i> Please enter Instance Username</b>
                        </div>
                    </div>
                    <div class="col-lg-6 marginSpaceTop" >
                        <label for="">Choose Authentication Type</label>
                        <div class="input-groups">
                            <select id="pemFileDropdown2"  class="authenticationType width-100 form-control" cdata="catalyst" cat-validation="required">
                                <option value="password">Password</option>
                                <option value="pemFile">Pem File</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection authPassword marginSpaceTop">
                        <label for="exampleInputEmail1">Password</label>
                        <div class="input-groups">
                            <input type="password" class="form-control" id="importPasswordInput" required="true" cdata="catalyst" cat-validation="required"><span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-initialvalue="" style="visibility:hidden;">Required</span>
                            <b class="tooltip tooltip-top-right">
                                <i class="fa fa-lock txt-color-teal"></i> Please enter Instance Password</b>
                        </div>
                    </div>
                    <div class="col-lg-6 credentialSection authPemFile marginSpaceTop" >
                        <div class="smart-forms">
                            <label for="exampleInputEmail1">Pem File</label>
                            <div class="input-groups">
                                <label for="" name="field" class="file">
                                    <span class="button btn-primary">Browse</span>
                                    <input id="importPemfileInput" type="file" class="gui-file" onchange="$(this).next().val(this.files[0].name)">
                                    <input type="text" readonly="" class="gui-input">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="marginForButtons">
                        <label id="saveSpinner" class="hidden"><img class="marginleft5right25" src="img/select2-spinner.gif"></label>
                        <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="button" class="btn btn-primary importNodesBtn">Sync</button>
                    </div>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="providerSyncResultModal" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Importing Instances</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


<!--tab content over-->
<script type="text/javascript">
    //initialising the datatable before DOM Ready...
    if (!$.fn.dataTable.isDataTable('#tagsTable')) {
        var $tagsDatatable = $('#tagsTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }
    if (!$.fn.dataTable.isDataTable('#mappingprojectTable')) {
        var $mappingprojectDatatable = $('#mappingprojectTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }
    if (!$.fn.dataTable.isDataTable('#mappingenvTable')) {
        var $mappingenvDatatable = $('#mappingenvTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": false,
            "bLengthChange": false,
            "paging": false,
            "bFilter": false,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }]
        });
    }

    //initialising the datatable for Managed instances...
    if (!$.fn.dataTable.isDataTable('#instanceListTable')) {
        var $instanceManagedDatatable = $('#instanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            },{
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }
    //initialising the datatable for Assigned instances...
    if (!$.fn.dataTable.isDataTable('#unmanagedinstanceListTable')) {
        var $instanceUnManagedDatatable = $('#unmanagedinstanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            },{
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }
    //initialising the datatable for UnAssigned instances...
    if (!$.fn.dataTable.isDataTable('#unassignedinstanceListTable')) {
        var $instanceUnAssignedDatatable = $('#unassignedinstanceListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aaSorting": [[ 4, "asc" ]],
            "aoColumns": [{
                "bSortable": true
            }, {
                "bSortable": true
            }, {
                "bSortable": true
            }, {
                "bSortable": true
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            },{
                "bSortable": false
            }]

        });
    }

    //initialising the datatable for UnAssigned RDS(unassigned)...
    if (!$.fn.dataTable.isDataTable('#unassignedRDSListTable')) {
        var $rdsUnAssignedDatatable = $('#unassignedRDSListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aoColumns": [{
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }

    //initialising the datatable for S3 (unassigned)...
    if (!$.fn.dataTable.isDataTable('#unassignedS3ListTable')) {
        var $s3UnAssignedDatatable = $('#unassignedS3ListTable').DataTable({
            "pagingType": "full_numbers",
            "bInfo": true,
            "bLengthChange": true,
            "paging": true,
            "bFilter": true,
            "aoColumns": [{
                "bSortable": false,
                "sWidth": "250%"
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }, {
                "bSortable": false
            }]

        });
    }

    $(document).ready(function(e) {
        var urlParams = {};
        (window.onpopstate = function() {
            var url = window.location.href;
            var indexOfQues = url.lastIndexOf("?");
            if (indexOfQues != -1) {
                var sub = url.substring(indexOfQues + 1);
                var params = sub.split('&')
                for (var i = 0; i < params.length; i++) {
                    var paramParts = params[i].split('=');
                    urlParams[paramParts[0]] = paramParts[1];
                }
            }

        })();
        var urlproviderId = urlParams['provider'];
        var urlorgName = urlParams['org'];

        if (!urlproviderId) {
            return;
        }
        if(urlproviderId && urlproviderId.indexOf("#ajax") == -1){
            getTagsListData(urlproviderId);
            getManagedInstances();
            //calling the rds and s3 unassigned function to extract the data.
            getUnassignedRDSData();
            getUnassignedS3Data();
        }
        //loading Managed Data
        function getTagsListData(providerId) {
            $.get('/providers/' + providerId + '/tags', function(tagsList) {
                loadTagsTabData(tagsList,providerId);
            }).fail(function(jxhr) {
                var msg = "Tags List Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        function loadTagsTabData(tagsListData,providerId) {
            var $projecttagsList = $('#tagsProjectSelect');
            var $envtagsList = $('#tagsEnvSelect');
            $projecttagsList.empty();
            $envtagsList.empty();
            $tagsDatatable.clear().draw();

            $projecttagsList.append($('<option></option>').html("Choose Project"));
            $envtagsList.append($('<option></option>').html("Choose Environment"));
            for (var i = 0; i < tagsListData.length; i++) {
                var $tbody = $('#tagsTable tbody').empty();
                //For Dropdown

                $projecttagsList.append($('<option></option>').val(tagsListData[i].name).html(tagsListData[i].name));
                $envtagsList.append($('<option></option>').val(tagsListData[i].name).html(tagsListData[i].name));

                //For Table
                var $tr = $('<tr class=""></tr>');
                var $tdName = $('<td class="tagName"></td>').append(tagsListData[i].name);
                $tr.append($tdName);

                if(tagsListData[i].description){
                    var $inputTxt = '';
                    var tagsDescription = tagsListData[i].description;
                    $inputTxt = $('<input id="tagdescinputId'+i+'" value="'+tagsDescription+'" type="text" class="width-90 border-grey tagsDescInput"></input><a class="btn btn-primary saveBtnTagsCSS" title="Save"><i class="ace-icon fa fa-save bigger-110"></i></a>');
                }else{
                    var $inputTxt = '';
                    $inputTxt = $('<input id="tagdescinputId'+i+'" type="text" class="width-90 border-grey tagsDescInput"></input><a class="btn btn-primary saveBtnTagsCSS" title="Save"><i class="ace-icon fa fa-save bigger-110"></i></a>');
                }

                var $tdDesc = $('<td></td>').append($inputTxt);
                $tr.append($tdDesc);

                $tagsDatatable.row.add($tr).draw();
            }

            $('#tagsTable').on('keypress','.tagsDescInput',function(event){
                var keycode = (event.keyCode ? event.keyCode : event.which);
                if(keycode == '13'){
                    var $this = $(this);
                    var id = $this.attr('id');
                    var tagName = $this.parents().eq(1).find('.tagName').html();
                    var tagDesc = $this.parents().eq(1).find('input').val();

                    //Send the body update tag
                    var objupdatetagDesc = {};
                    objupdatetagDesc["description"] = tagDesc;
                    $.ajax({
                        url: '/providers/'+ providerId +'/tags/'+ tagName,
                        method: 'PUT',
                        data: JSON.stringify(objupdatetagDesc),
                        contentType: "application/json",
                        success: function() {
                            $('#'+id).css('background-color','lightyellow');
                        },
                        error: function(jxhr) {

                        }
                    });
                }
                //Stop the event from propogation to other handlers
                //If this line will be removed, then keypress event handler attached
                //at document level will also be triggered
                event.stopPropagation();
            });
            $('#tagsTable').on('click','.saveBtnTagsCSS',function(event){
                var $this = $(this);
                var id = $this.parents().eq(1).find('input').attr('id');
                var tagName = $this.parents().eq(1).find('.tagName').html();
                var tagDesc = $this.parents().eq(1).find('input').val();

                //Send the body update tag
                var objupdatetagDesc = {};
                objupdatetagDesc["description"] = tagDesc;
                $.ajax({
                    url: '/providers/'+ providerId +'/tags/'+ tagName,
                    method: 'PUT',
                    data: JSON.stringify(objupdatetagDesc),
                    contentType: "application/json",
                    success: function() {
                        $('#'+id).css('background-color','lightyellow');
                    },
                    error: function(jxhr) {

                    }
                });
            });
            /*var blankArr = [];
             loaddefaultTagMappingSelection(blankArr);*/
        }
        function loaddefaultTagMappingSelection(catalystEntityTypeListPassed){
            $.ajax({
                url: '/providers/'+urlproviderId+'/tag-mappings',
                method: 'GET',
                contentType: "application/json",
                success: function(tagsListSelected) {
                    //For tags tab.....
                    var $projecttagsList = $('#tagsProjectSelect');
                    var $envtagsList = $('#tagsEnvSelect');
                    var catalystEntityProjName = $('#projectnameLabelId').attr('catalystEntitytype');
                    var catalystEntityEnvName = $('#envnameLabelId').attr('catalystEntitytype');

                    for(var i=0;i<tagsListSelected.length;i++){
                        var objcatalystEntityType = tagsListSelected[i].catalystEntityType;
                        var objtagName = tagsListSelected[i].tagName;
                        var tagValues = tagsListSelected[i].tagValues;
                        var catalystEntityMapping = tagsListSelected[i].catalystEntityMapping;

                        if(objcatalystEntityType == catalystEntityProjName){
                            $projecttagsList.val(objtagName);
                            //For Mapping tab.....
                            //For project catalystEntityType
                            $mappingprojectDatatable.clear().draw();
                            var $tbody = $('#mappingprojectTable tbody').empty();

                            for(var j = 0; j < catalystEntityTypeListPassed.length; j++){
                                //For Table
                                var $tr = $('<tr id="'+catalystEntityTypeListPassed[j].rowid+'" class=""></tr>');

                                var $tdprojectName = $('<td class="mappingprojectName"></td>').append(catalystEntityTypeListPassed[j].projectname);
                                $tr.append($tdprojectName);


                                var $mappingprojectSelectList= $('<select class="mappingprojectSelectId"></select>');
                                $mappingprojectSelectList.empty();
                                $mappingprojectSelectList.append($('<option></option>').val('').html('-- None --'));
                                for(var k=0; k< tagValues.length; k++){
                                    if(tagValues[k] !=''){
                                        $mappingprojectSelectList.append($('<option></option>').val(tagValues[k]).html(tagValues[k]));
                                    }
                                }

                                var $tdprojectTagName = $('<td class="mappingprojectTagName"></td>').append($mappingprojectSelectList);
                                $tr.append($tdprojectTagName);

                                $tbody.append($tr);
                                $mappingprojectDatatable.row.add($tr).draw();

                                for(var l = 0; l < catalystEntityMapping.length; l++){

                                    if(catalystEntityTypeListPassed[j].rowid == catalystEntityMapping[l].catalystEntityId){
                                        $mappingprojectSelectList.val(catalystEntityMapping[l].tagValue);
                                    }
                                }
                            }
                        }
                        //For environment catalystEntityType
                        if(objcatalystEntityType == catalystEntityEnvName){
                            $envtagsList.val(objtagName);
                        }
                    }
                },
                error: function(jxhr) {

                }
            });

        }
        $('.btntagsFormSave').on('click',function(){
            var $projecttagsList = $('#tagsProjectSelect');
            var $envtagsList = $('#tagsEnvSelect');

            var catalystEntityProjName = $('#projectnameLabelId').attr('catalystEntitytype');
            var catalystEntityEnvName = $('#envnameLabelId').attr('catalystEntitytype');

            var tagsProjSelectedVal = $projecttagsList.val();
            var tagsenvSelectedVal = $envtagsList.val();

            if(tagsProjSelectedVal == tagsenvSelectedVal){
                bootbox.alert("Tag name cannot be same to create catalyst entity mapping");
                return;
            }

            //Creating the data to Post for Save tags.
            var tagsData = [{
                "catalystEntityType": catalystEntityProjName,
                "tagName": tagsProjSelectedVal
            },
                {
                    "catalystEntityType": catalystEntityEnvName,
                    "tagName": tagsenvSelectedVal
                }];
            $.ajax({
                url: '/providers/'+urlproviderId+'/tag-mappings',
                method: 'POST',
                data: JSON.stringify(tagsData),
                contentType: "application/json",
                success: function(tagsListPost) {
                    $('#spantagsformSaveId').fadeIn();
                    $('#spantagsformSaveId').html("Saved successfully");
                    $('#spantagsformSaveId').delay(2000).fadeOut();
                    getprojectData();
                    getenvironmentData();
                },
                error: function(jxhr) {

                }
            });
        });

        //Mapping tabs operation starts....
        getprojectData();
        getenvironmentData();
        //For Project Mapping
        function getprojectData(){
            $.get('/d4dMasters/readmasterjsonnew/4', function(projectist) {
                var orgId = urlorgName;
                var projectListArr = [];
                for (var i = 0; i < projectist.length; i++) {
                    for(var j=0;j<projectist[i].orgname.length;j++){
                        if(orgId == projectist[i].orgname[j]){
                            projectListArr.push(projectist[i]);
                        }
                    }
                };
                loaddefaultTagMappingSelection(projectListArr);
            }).fail(function(jxhr) {
                var msg = "Getting Project List Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        //For Environment Mapping
        function getenvironmentData(){
            $.get('/d4dMasters/readmasterjsonnew/3', function(envList) {
                var envListArr = [];
                var orgId = urlorgName;
                for (var i = 0; i < envList.length; i++) {
                    for(var j=0;j<envList[i].orgname.length;j++){
                        if(orgId == envList[i].orgname[j]){
                            envListArr.push(envList[i]);
                        }
                    }
                };
                envMappingList(envListArr);
            }).fail(function(jxhr) {
                var msg = "Project Mapping Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function envMappingList(envList){
            $mappingenvDatatable.clear().draw();

            $.get('/providers/'+urlproviderId+'/tag-mappings/environment', function(data) {
                if(data){
                    var $tbody = $('#mappingenvTable tbody').empty();
                    for(var i = 0; i < envList.length; i++){
                        //For Table
                        var $tr = $('<tr id="'+envList[i].rowid+'" class=""></tr>');

                        var $tdenvName = $('<td class="mappingenvName"></td>').append(envList[i].environmentname);
                        $tr.append($tdenvName);

                        var $mappingenvSelectList= $('<select class="mappingenvSelectId"></select>');
                        $mappingenvSelectList.empty();
                        $mappingenvSelectList.append($('<option></option>').val('').html('-- None --'));
                        for(var j=0; j< data.tagValues.length; j++){
                            if(data.tagValues[j] != ''){
                                $mappingenvSelectList.append($('<option></option>').val(data.tagValues[j]).html(data.tagValues[j]));
                            }
                        }

                        var $tdenvTagName = $('<td class="mappingenvTagName"></td>').append($mappingenvSelectList);
                        $tr.append($tdenvTagName);


                        $tbody.append($tr);
                        $mappingenvDatatable.row.add($tr).draw();

                        for(var k = 0; k < data.catalystEntityMapping.length; k++){
                            if(envList[i].rowid == data.catalystEntityMapping[k].catalystEntityId){
                                $mappingenvSelectList.val(data.catalystEntityMapping[k].tagValue);
                            }
                        }
                    }
                }
            }).fail(function(jxhr) {

            });
        }

        $('.btnprojectMappingSave').on('click',function(){
            var projectMappingObj = {
                "catalystEntityMapping": []
            };
            var counter =0;
            $('#mappingprojectTable tbody tr').each(function() {
                counter++;
                $tr = $(this);
                var projmappingcatalystEntityId = $tr.attr('id');
                var mappingprojectSelectTagName = $tr.find('.mappingprojectSelectId :selected').val();
                var mappingprojectName = $tr.find('.mappingprojectName').text();

                var objprojectMapping = {};
                objprojectMapping["catalystEntityId"] = projmappingcatalystEntityId;
                objprojectMapping["catalystEntityName"] = mappingprojectName;
                objprojectMapping["tagValue"] = mappingprojectSelectTagName;

                projectMappingObj.catalystEntityMapping.push(objprojectMapping);

                if(counter == $('#mappingprojectTable tbody tr').length){
                    $.ajax({
                        url: '/providers/'+urlproviderId+'/tag-mappings/project',
                        data: JSON.stringify(projectMappingObj),
                        type: 'PATCH',
                        contentType: "application/json",
                        success: function(data) {
                            $('#spanprojectMappingSaveId').fadeIn();
                            $('#spanprojectMappingSaveId').html('Saved successfully');
                            $('#spanprojectMappingSaveId').delay(2000).fadeOut();
                        },
                        error: function(jqxhr) {
                        }
                    });
                }
            });
        });


        $('.btnenvMappingSave').on('click',function(){
            var envMappingObj = {
                "catalystEntityMapping": []
            };
            var counter =0;
            var envMappingSequence = [];
            $('#mappingenvTable tbody tr').each(function() {
                counter++;
                $tr = $(this);
                var envmappingcatalystEntityId = $tr.attr('id');
                var mappingenvSelectTagName = $tr.find('.mappingenvSelectId :selected').val();
                var mappingenvName = $tr.find('.mappingenvName').text();

                var objenvMapping = {};
                objenvMapping["catalystEntityId"] = envmappingcatalystEntityId;
                objenvMapping["catalystEntityName"] = mappingenvName;
                objenvMapping["tagValue"] = mappingenvSelectTagName;

                envMappingObj.catalystEntityMapping.push(objenvMapping);
                if(counter == $('#mappingenvTable tbody tr').length){
                    $.ajax({
                        url: '/providers/'+urlproviderId+'/tag-mappings/environment',
                        data: JSON.stringify(envMappingObj),
                        type: 'PATCH',
                        contentType: "application/json",
                        success: function(data) {
                            $('#spanenvMappingSaveId').fadeIn();
                            $('#spanenvMappingSaveId').html('Saved successfully');
                            $('#spanenvMappingSaveId').delay(2000).fadeOut();
                        },
                        error: function(jqxhr) {
                            var msg = " ";
                            if (jxhr.responseJSON && jxhr.responseJSON.message) {
                                msg = jxhr.responseJSON.message;
                            } else if (jxhr.responseText) {
                                msg = jxhr.responseText;
                            }
                            $('#spanenvMappingSaveId').fadeIn();
                            $('#spanenvMappingSaveId').html(msg);
                            $('#spanenvMappingSaveId').delay(2000).fadeOut();
                        }
                    });
                }
            });
        });

        //Instances Tabs Starts here......
        var $chooseCtalystSelectId = $('#chooseCtalystSelectId');
        $chooseCtalystSelectId.change(function(e) {
            var catalystStatusType = $('#chooseCtalystSelectId :selected').attr('data-catalystStatus');
            if ($('#chooseCtalystSelectId :selected').text() == 'Managed') {
                $('#Managed').show();
                $('#Assigned').hide();
                $('#Unassigned').hide();
            } else if (catalystStatusType == 'Assigned') {
                $('#Managed').hide();
                $('#Assigned').show();
                $('#Unassigned').hide();
                getUnmanagedInstances();
            } else {
                $('#Managed').hide();
                $('#Assigned').hide();
                $('#Unassigned').show();
                getUnassignedInstances();
            }
        });

        var $orgListInput = $('#providerSyncOrgSelect').attr('disabled', 'disabled');
        var $bgList = $('#providerSyncBgSelect');
        var $projectList = $('#providerSyncProjectSelect');
        var $envList = $('#providerSyncEnvSelect');
        var $infraManagerList = $('#providerSyncInfraManagerSelect');

        $('#providerSyncBtn').click(function(e) {
            $('#saveSpinner').addClass('hidden');
            $('.importNodesBtn').removeAttr('disabled');
            var perm = haspermission('instancelaunch', 'execute');

            if (!perm) {
                bootbox.alert('Insufficient permission to perform operation.');
                $('#chefImportNodesModal').modal('hide');
                return;
            } else {
                var $checkBoxes = $('.nodeCheckBox:checked');
                if (!$checkBoxes.length) {
                    bootbox.alert('Please Choose instances first');
                    return;
                }
                $('#providerSyncModal').modal('show');
                $('#myForm12').trigger("reset");
                $envList.empty();

                $('#pemFileDropdown2').change();
            }
        });

        $(".authPassword").show();
        $(".authPemFile").hide();
        $('.authenticationType').change(function(e) {
            if (this.value == "password") {
                $(".authPassword").show();
                $(".authPemFile").hide();
            } else {
                $(".authPassword").hide();
                $(".authPemFile").show();
            }
        });


        var serviceURL = "../d4dMasters/";

        function getRelatedValues_Top(jsonID, comparedField, filterByValue, outputField) {
            var result = [];
            readMasterJson_Top(jsonID);
            if (d4ddata) {
                $.each(d4ddata, function(k, v) {
                    if (v[comparedField] == filterByValue && v[outputField]) {
                        result.push(v['rowid'] + '|' + v[outputField]);
                    }
                });
            }
            return (result);
        }

        function getRelatedValues_Top_rowid(jsonID, comparedField, filterByValue, outputField) {
            var result = [];
            readMasterJson_Top(jsonID);
            if (d4ddata) {
                $.each(d4ddata, function(k, v) {
                    if (v[comparedField] == filterByValue && v[outputField]) {
                        var rowids = v[outputField + '_rowid'].split(',');
                        var txts = v[outputField].split(',');
                        for (var i = 0; i < txts.length; i++) {
                            result.push(rowids[i] + '|' + txts[i]);
                        }
                    }
                });
            }
            return (result);
        }


        function readMasterJson_Top(section) {
            $.ajax({
                type: "get",
                dataType: "text",
                async: false,
                url: serviceURL + "readmasterjsonnew/" + section,
                success: function(data) {
                    d4ddata = JSON.parse(data);
                },
                failure: function(data) {
                    bootbox.alert(data.toString());
                }
            });
            return (d4ddata);
        }


        //loading provider with org
        $.get('/providers/' + urlproviderId, function(provider) {
            var org = provider.org
            $orgListInput.append($('<option></option>').val(org.rowid).html(org.orgname).attr('selected', 'selected'));
            $bgList.empty();
            $bgList.append($('<option></option>').val('choose').html('Choose'));
            var getBGs = getRelatedValues_Top(2, "orgname_rowid", org.rowid, "productgroupname");
            for (var i = 0; i < getBGs.length; i++) {
                if (getBGs[i].indexOf('|') >= 0) {
                    var txtval = getBGs[i].split('|');
                    $bgList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                }

            }

            $bgList.change(function(e) {
                var bgName = $(this).val();
                if (bgName == 'choose') {
                    return;
                }
                $projectList.empty();
                $projectList.append($('<option></option>').val('choose').html('Choose'));

                var getProjs = getRelatedValues_Top(4, "productgroupname_rowid", bgName, "projectname");
                for (var i = 0; i < getProjs.length; i++) {
                    if (getProjs[i].indexOf('|') >= 0) {
                        var txtval = getProjs[i].split('|');
                        $projectList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                    }
                }
            });
            $projectList.change(function(e) {
                var projName = $(this).val();
                if (projName == 'choose') {
                    return;
                }
                var getEnvs_ = getRelatedValues_Top_rowid(4, "rowid", projName, "environmentname");
                var getEnvs = getEnvs_.toString().replace(/"/g, '').split(',');
                for (var i = 0; i < getEnvs.length; i++) {
                    if (getEnvs[i].indexOf('|') >= 0) {
                        var txtval = getEnvs[i].split('|');
                        $envList.append($('<option></option>').val(txtval[0]).html(txtval[1]));
                    }
                }
            });
            // loading inframanagers
            $.get(serviceURL + 'organization/' + org.rowid + '/configmanagement/list', function(configMgmntList) {
                var $configManagementDropdown = $('#providerSyncInfraManagerSelect');
                for (var i = 0; i < configMgmntList.length; i++) {
                    var $options = $('<option></option>');
                    var name;
                    if (configMgmntList[i].configType === 'puppet') {
                        name = configMgmntList[i].puppetservername;
                    } else {
                        name = configMgmntList[i].configname;
                    }
                    $options.html(name);
                    $options.val(configMgmntList[i].rowid);
                    $configManagementDropdown.append($options);
                }
            });

        });

        function loadManagedInstances(managnedData) {
            $instanceManagedDatatable.clear().draw();
            var $tbody = $('#managedInstance tbody').empty();
            for (var i = 0; i < managnedData.managedInstances.length; i++) {
                var $tr = $('<tr class="managedInstance"></tr>').attr('data-id',managnedData.managedInstances[i]._id);
                var $tdId = $('<td></td>').append(managnedData.managedInstances[i].platformId);
                $tr.append($tdId);

                var $tdOs = $('<td></td>').append(managnedData.managedInstances[i].hardware.os);
                $tr.append($tdOs);

                var $tdIpAddress = $('<td></td>').append(managnedData.managedInstances[i].instanceIP);
                $tr.append($tdIpAddress);

                var region = '';
                if(managnedData.managedInstances[i].region){
                    region = managnedData.managedInstances[i].region;
                }else if (managnedData.managedInstances[i].providerData && managnedData.managedInstances[i].providerData.region) {
                    region = managnedData.managedInstances[i].providerData.region;
                }
                var $tdRegion = $('<td></td>').append(region);
                $tr.append($tdRegion);
                var $tdStatus = $('<td></td>').append(managnedData.managedInstances[i].instanceState);
                $tr.append($tdStatus);

                var $projectName = $('<td></td>').append(managnedData.managedInstances[i].projectName);
                $tr.append($projectName);
                var $environmentName = $('<td></td>').append(managnedData.managedInstances[i].environmentName);
                $tr.append($environmentName);

                var $button = '';

                if (managnedData.managedInstances[i].instanceState === 'terminated') {

                    $button = $('<div class="btn-group marginleft14"><button class="btn btn-danger pull-left btn-sg tableactionbutton globalTrackUrlRemove" data-placement="top" value="Remove" title="Delete"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');
                    $button.click(function() {
                        var $this = $(this);
                        var $tr = $this.parents('tr.managedInstance');
                        var id = $this.parents('tr').attr('data-id');
                        bootbox.confirm({
                            message: 'Are you sure you want to Delete Managed Instance -&nbsp;',
                            title: "Warning",
                            callback: function(result) {
                                if (result) {
                                    $.ajax({
                                        url: '/instances/' + id,
                                        method: 'DELETE',
                                        success: function() {
                                            $instanceManagedDatatable.row($tr).remove().draw(false);
                                        },
                                        error: function(jxhr) {
                                            bootbox.alert(result);
                                            var msg = "Unable to Delete Managed Instances please try again later";
                                            if (jxhr.responseJSON && jxhr.responseJSON.message) {
                                                msg = jxhr.responseJSON.message;
                                            } else if (jxhr.responseText) {
                                                msg = jxhr.responseText;
                                            }
                                            bootbox.alert(msg);
                                        }
                                    });
                                } else {
                                    return;
                                }
                            }
                        });
                        return false;
                    });
                }
                var $tdAction = $('<td></td>').append($button);
                $tr.append($tdAction);
                $tbody.append($tr);
                $instanceManagedDatatable.row.add($tr).draw();
            }
        }


        function loadUnmanagedInstances(unManagnedData) {
            $instanceUnManagedDatatable.clear().draw();
            var $tbody = $('#unManagedInstance tbody').empty();
            for (var i = 0; i < unManagnedData.unmanagedInstances.length; i++) {
                var $tr = $('<tr></tr>').attr('instanceId', unManagnedData.unmanagedInstances[i]._id);
                var $tdId = $('<td></td>').append(unManagnedData.unmanagedInstances[i].platformId);
                $tr.append($tdId);

                var $tdOs = $('<td></td>').append(unManagnedData.unmanagedInstances[i].os);
                $tr.append($tdOs);

                var $tdIpAddress = $('<td></td>').append(unManagnedData.unmanagedInstances[i].ip);
                $tr.append($tdIpAddress);

                var region = '';
                if(unManagnedData.unmanagedInstances[i].region){
                    region = unManagnedData.unmanagedInstances[i].region;
                }else if (unManagnedData.unmanagedInstances[i].providerData && unManagnedData.unmanagedInstances[i].providerData.region) {
                    region = unManagnedData.unmanagedInstances[i].providerData.region;
                }
                var $tdRegion = $('<td></td>').append(region);
                $tr.append($tdRegion);
                var $tdStatus = $('<td></td>').append(unManagnedData.unmanagedInstances[i].state);
                $tr.append($tdStatus);


                var $projectName = $('<td></td>').append(unManagnedData.unmanagedInstances[i].projectName);
                $tr.append($projectName);
                var $environmentName = $('<td></td>').append(unManagnedData.unmanagedInstances[i].environmentName);
                $tr.append($environmentName);


                var $input = '';
                if (unManagnedData.unmanagedInstances[i].state === 'running') {
                    $input = $('<input class="nodeCheckBox" type="checkbox">').val(unManagnedData.unmanagedInstances[i]._id);
                }
                var $tdAction = $('<td></td>').append($input);
                $tr.append($tdAction);
                $tbody.append($tr);
                $instanceUnManagedDatatable.row.add($tr).draw();
            }
        }


        function loadUnassignedInstances(unassignedData, envprojMappingObject){
            $instanceUnAssignedDatatable.clear().draw();
            for (var i = 0; i < unassignedData.instances.length; i++) {
                var $tbody = $('#unassignedinstanceListTable tbody').empty();
                var $tr = $('<tr></tr>').attr({ "instanceid" : unassignedData.instances[i].id, "projecttagsmapname" : envprojMappingObject.project, "envtagsmapname" : envprojMappingObject.environment });

                var $tdId = $('<td></td>').append(unassignedData.instances[i].platformId);
                $tr.append($tdId);

                var $tdOs = $('<td></td>').append(unassignedData.instances[i].os);
                $tr.append($tdOs);

                var $tdIpAddress = $('<td></td>').append(unassignedData.instances[i].ip);
                $tr.append($tdIpAddress);

                var $tdStatus = $('<td></td>').append(unassignedData.instances[i].state);
                $tr.append($tdStatus);

                //Loop to append the project from the tags
                if(unassignedData.instances[i].tags){
                    if(envprojMappingObject.project in unassignedData.instances[i].tags){
                        var projectTagName = unassignedData.instances[i].tags[envprojMappingObject.project];
                        var $inputTextProject = $('<input type="text" class="form-control projectTagName" value="'+projectTagName+'"></input>');

                        var $tdProjectTag = $('<td></td>').append($inputTextProject);
                        $tr.append($tdProjectTag);
                    }else{
                        var $inputTextProject = $('<input type="text" class="form-control projectTagName" value=""></input>');
                        var $tdProjectTag = $('<td></td>').append($inputTextProject);
                        $tr.append($tdProjectTag);
                    }

                    if(envprojMappingObject.environment in unassignedData.instances[i].tags){
                        var environmentTagName = unassignedData.instances[i].tags[envprojMappingObject.environment];
                        var $inputTextEnv = $('<input type="text" class="form-control envTagName" value="'+environmentTagName+'"></input>');
                        var $tdEnvTag = $('<td></td>').append($inputTextEnv);
                        $tr.append($tdEnvTag);
                    }else{
                        var $inputTextEnv = $('<input type="text" class="form-control envTagName" value=""></input>');
                        var $tdEnvTag = $('<td></td>').append($inputTextEnv);
                        $tr.append($tdEnvTag);
                    }
                }
                if(unassignedData.instances[i].tags == "undefined" || unassignedData.instances[i].tags == null){
                    var $inputTextProject = $('<input type="text" class="form-control projectTagName" value=""></input>');
                    var $tdProjectTag = $('<td></td>').append($inputTextProject);
                    $tr.append($tdProjectTag);

                    var $inputTextEnv = $('<input type="text" class="form-control envTagName" value=""></input>');
                    var $tdEnvTag = $('<td></td>').append($inputTextEnv);
                    $tr.append($tdEnvTag);
                }

                $inputCheckbox = $('<input class="nodeCheckBox" type="checkbox">');
                var $tdActionCheckbox = $('<td></td>').append($inputCheckbox);
                $tr.append($tdActionCheckbox);

                $tbody.append($tr);
                $instanceUnAssignedDatatable.row.add($tr).draw();
            }
        }
        //loading unAssigned RDS Data.
        function loadUnassignedRDSData(unassignedRDSData){
            $rdsUnAssignedDatatable.clear().draw();
            for (var i = 0; i < unassignedRDSData.resources.length; i++) {
                var $tbody = $('#unassignedRDSListTable tbody').empty();
                var $tr = $('<tr></tr>').attr({"rdsId" : unassignedRDSData.resources[i]._id});
                //creating td for RDS name..
                var $tdDbRDSName = $('<td></td>').append(unassignedRDSData.resources[i].resourceDetails.dbName);
                $tr.append($tdDbRDSName);
                //creating td for RDS Type..
                var $tdType = $('<td></td>').append(unassignedRDSData.resources[i].resourceDetails.dbEngine);
                $tr.append($tdType);
                //creating td for RDS Status..
                var $tdStatus = $('<td></td>').append(unassignedRDSData.resources[i].resourceDetails.dbInstanceStatus);
                $tr.append($tdStatus);
                //creating td for RDS Region..
                var $tdRegion = $('<td></td>').append(unassignedRDSData.resources[i].resourceDetails.region);
                $tr.append($tdRegion);
                //creating td for InstanceClass..
                var $tdInstanceClass = $('<td></td>').append(unassignedRDSData.resources[i].resourceDetails.dbInstanceClass);
                $tr.append($tdInstanceClass);

                var $tdMultiAZ;
                var multiAZ = unassignedRDSData.resources[i].resourceDetails.multiAZ
                if(multiAZ === false){
                    $tdMultiAZ = $('<td>false</td>');
                }
                else{
                    $tdMultiAZ = $('<td></td>').append(multiAZ);
                }
                $tr.append($tdMultiAZ);
                //creating td for Instance Created On
                var createdOn = unassignedRDSData.resources[i].resourceDetails.dbInstanceCreatedOn;
                var date = new Date().setTime(createdOn.timestamp);
                var taskTimestamp = new Date(createdOn).toLocaleString(); //converts to human readable strings
                var $tdInstanceCreatedOn = $('<td></td>').append(taskTimestamp);
                $tr.append($tdInstanceCreatedOn);
                $tbody.append($tr);
                $rdsUnAssignedDatatable.row.add($tr).draw();
            }
        }

        //loading unAssigned S3 data
        function loadUnassignedS3Data(unassignedS3Data){
            $s3UnAssignedDatatable.clear().draw();
            for (var i = 0; i < unassignedS3Data.resources.length; i++) {
                var $tbody = $('#unassignedS3ListTable tbody').empty();
                var $tr = $('<tr></tr>').attr({"s3Id" : unassignedS3Data.resources[i]._id});
                var $tdS3Bucket = $('<td></td>').append(unassignedS3Data.resources[i].resourceDetails.bucketName);
                $tr.append($tdS3Bucket);

                var $tdS3BucketOwner = $('<td></td>').append(unassignedS3Data.resources[i].resourceDetails.bucketOwnerName);
                $tr.append($tdS3BucketOwner);

                var $tdOrgName = $('<td></td>').append(unassignedS3Data.resources[i].masterDetails.orgName);
                $tr.append($tdOrgName);
                var $tdBucketSize = $('<td></td>').append(unassignedS3Data.resources[i].resourceDetails.bucketSize);
                $tr.append($tdBucketSize);
                var createdOn = unassignedS3Data.resources[i].resourceDetails.bucketCreatedOn;
                var date = new Date().setTime(createdOn.timestamp);
                var taskTimestamp = new Date(createdOn).toLocaleString(); //converts to human readable strings
                var $tdBucketCreatedOn = $('<td></td>').append(taskTimestamp);
                $tr.append($tdBucketCreatedOn);

                $tbody.append($tr);
                $s3UnAssignedDatatable.row.add($tr).draw();
            }
        }



        //get Managed Instance Data
        function getManagedInstances() {
            $.get('/providers/' + urlproviderId + '/managedInstances', function(managedInstances) {
                loadManagedInstances(managedInstances);
            }).fail(function(jxhr) {
                var msg = "Provider Sync Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        //get Assigned Instance Data
        function getUnmanagedInstances() {
            $.get('/providers/' + urlproviderId + '/unmanagedInstances', function(unmanagnedInstances) {
                if(unmanagnedInstances){
                    loadUnmanagedInstances(unmanagnedInstances);
                }
            }).fail(function(jxhr) {
                var msg = "Provider Sync unmanaged instances Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        //loading UnAssigned Data
        function getUnassignedInstances() {

            $.get('/providers/'+ urlproviderId +'/tag-mappings', function(tagsListSelected) {
                if(tagsListSelected){
                    var envprojMappingObject = {};
                    var catalystEntityProjName = $('#projectnameLabelId').attr('catalystEntitytype');
                    var catalystEntityEnvName = $('#envnameLabelId').attr('catalystEntitytype');

                    for(var i=0;i<tagsListSelected.length;i++){
                        var objcatalystEntityType = tagsListSelected[i].catalystEntityType;
                        var objtagName = tagsListSelected[i].tagName;

                        //Creating an object to map with unassigned instances(To get data for project and environment in every row)
                        if(objcatalystEntityType == catalystEntityProjName){
                            envprojMappingObject['project'] = objtagName;
                        }
                        if(objcatalystEntityType == catalystEntityEnvName){
                            envprojMappingObject['environment'] = objtagName;
                        }
                    }
                    getunassignedInstanceswithProjectandEnv(envprojMappingObject);
                }
            }).fail(function(jxhr) {
                var msg = "Tag mappings not loaded as behaved unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function getunassignedInstanceswithProjectandEnv(envprojMappingObject){
            $.get('/providers/'+ urlproviderId +'/unassigned-instances', function(unassignedInstances) {
                if(unassignedInstances){
                    loadUnassignedInstances(unassignedInstances,envprojMappingObject);
                }
            }).fail(function(jxhr) {
                var msg = "Unassigned Instances Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function getUnassignedRDSData(){
            $.get('/resources?filterBy=providerId:'+ urlproviderId +'+resourceType:RDS+category:unassigned', function(unassignedRDS) {
                if(unassignedRDS){
                    loadUnassignedRDSData(unassignedRDS);
                }
            }).fail(function(jxhr) {
                var msg = "Unassigned Instances Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }
        function getUnassignedS3Data(){
            $.get('/resources?filterBy=providerId:'+ urlproviderId +'+resourceType:S3+category:unassigned', function(unassignedS3) {
                if(unassignedS3){
                    loadUnassignedS3Data(unassignedS3);
                }
            }).fail(function(jxhr) {
                var msg = "Unassigned Instances Behaved Unexpectedly.";
                if (jxhr.responseJSON && jxhr.responseJSON.message) {
                    msg = jxhr.responseJSON.message;
                } else if (jxhr.responseText) {
                    msg = jxhr.responseText;
                }
                bootbox.alert(msg);
            });
        }

        $('#unassignedSyncBtn').on('click', function(e) {
            var updateInstanceTagsObj = {};
            var updateInstanceTagsArr = [];
            $('#unassignedinstanceListTable').find('tbody tr').filter(':has(:checkbox:checked)').each(function() {
                //Batch update instances tags
                var updateUniqueInstanceTagsObj = {};
                var instanceid = $(this).attr("instanceid");
                var projecttagsmapname = $(this).attr("projecttagsmapname");
                var envtagsmapname = $(this).attr("envtagsmapname");

                var projectTagName = $(this).find('.projectTagName').val();
                var envTagName = $(this).find('.envTagName').val();

                updateUniqueInstanceTagsObj["id"] = instanceid;
                updateUniqueInstanceTagsObj["tags"] = {};
                updateUniqueInstanceTagsObj["tags"][projecttagsmapname] = projectTagName;
                updateUniqueInstanceTagsObj["tags"][envtagsmapname] = envTagName;

                updateInstanceTagsArr.push(updateUniqueInstanceTagsObj);
            });
            updateInstanceTagsObj["instances"] = updateInstanceTagsArr;
            $.ajax({
                url: '/providers/'+urlproviderId+'/unassigned-instances',
                data: JSON.stringify(updateInstanceTagsObj),
                type: 'PATCH',
                contentType: "application/json",
                success: function(data) {
                    $('.margintop-25left250').fadeIn();
                    $('#spanunassignedformSaveId').text('Updated successfully');
                    $('.margintop-25left250').delay(2000).fadeOut();
                },
                error: function(jqxhr) {

                }
            });
        });

        $('.importNodesBtn').click(function(e) {
            var $checkBoxes = $('.nodeCheckBox:checked');
            var reqBody = {};
            reqBody.orgId = $orgListInput.val();
            reqBody.bgId = $bgList.val();
            reqBody.projectId = $projectList.val();
            reqBody.envId = $envList.val();
            //Added By Durgesh
            reqBody.orgName = $orgListInput.find('option:selected').text();
            reqBody.bgName = $bgList.find('option:selected').text();
            reqBody.projectName = $projectList.find('option:selected').text();
            reqBody.environmentName = $envList.find('option:selected').text();
            //End By Durgesh
            reqBody.configManagmentId = $infraManagerList.val();


            if (!((reqBody.bgId && reqBody.bgId.length) && (reqBody.projectId && reqBody.projectId.length) && reqBody.projectId !== 'choose' && reqBody.bgId !== 'choose')) {
                bootbox.alert('Please Select a Business Group & Project');
                return;
            }

            reqBody.instanceIds = [];
            $checkBoxes.each(function() {
                reqBody.instanceIds.push($(this).val());
            });

            reqBody.credentials = {};
            reqBody.credentials.username = $('#importUsernameInput').val();

            var $dropdown = $('#pemFileDropdown2');
            if (!($dropdown.val() === 'pemFile')) {
                reqBody.credentials.password = $('#importPasswordInput').val();
                if (!reqBody.credentials.username) {
                    bootbox.alert('Please Enter Username');
                    return;
                }
                if (!reqBody.credentials.password) {
                    bootbox.alert('Please Enter Password or Choose a Pem file');
                    return;
                }
                makeRequest();
            } else {
                var pemFileInput = $('#importPemfileInput').get(0);
                if (!reqBody.credentials.username) {
                    bootbox.alert('Please Enter Username');
                    return;
                }
                if (!pemFileInput.files.length) {
                    bootbox.alert('Please Choose a Pem file');
                    return;
                }
                var reader = new FileReader();
                reader.onload = function(e) {
                    reqBody.credentials.pemFileData = e.target.result;

                    makeRequest();

                };
                // Read in the image file as a data URL.
                reader.readAsText(pemFileInput.files[0]);

            }

            function makeRequest() {
                $('#saveSpinner').removeClass('hidden');
                $('.importNodesBtn').attr('disabled', 'disabled');
                $.post('../providers/' + urlproviderId + '/sync', reqBody, function(data) {
                    $('#providerSyncModal').modal('hide');
                    var $chefResultModalContainer = $('#providerSyncResultModal');
                    var $modalBody = $chefResultModalContainer.find('.modal-body');
                    $modalBody.empty();
                    var $progressBar = $('<progress value="0" max="' + reqBody.instanceIds.length + '"></progress>').css({
                        width: '100%'
                    });
                    var $msgDiv = $('<div class="messageDiv"></div>').css({
                        width: '100%'
                    });

                    $modalBody.append($progressBar).append($msgDiv);
                    $('#saveSpinner').addClass('hidden');

                    $('#chefImportNodesModal').modal('hide');
                    $chefResultModalContainer.modal('show');
                    var timeout;
                    var count = 0;

                    function pollTaskStatus(taskId, timestamp) {
                        timeout = setTimeout(function() {
                            $.get('../taskstatus/' + taskId + '/status?timestamp=' + timestamp, function(data) {
                                if (!data.completed) {
                                    if (data.statusList && data.statusList.length) {

                                        $progressBar.val(data.statusList.length);
                                        $msgDiv.empty();
                                        for (var i = 0; i < data.statusList.length; i++) {
                                            $msgDiv.append($('<div></div>').append(data.statusList[i].status.message));
                                        }

                                        pollTaskStatus(taskId, data.statusList[data.statusList.length - 1].timestamp);
                                    } else {
                                        pollTaskStatus(taskId, timestamp);
                                    }
                                } else {
                                    if (data.statusList && data.statusList.length) {
                                        $progressBar.val(data.statusList.length);
                                        $msgDiv.empty();
                                        for (var i = 0; i < data.statusList.length; i++) {
                                            $msgDiv.append($('<div></div>').append(data.statusList[i].status.message));
                                        }
                                    }
                                    $progressBar.val(reqBody.selectedNodes.length);
                                    if (reqBody.selectedNodes.length) {
                                        var nodeData = $($checkBoxes[0]).data('node');
                                        if (nodeData && nodeData.chef_environment) {
                                        }
                                    }
                                }
                            })
                        }, 1000);

                    }
                    pollTaskStatus(data.taskId, 0);
                    //Refreshing the workzone tree
                }).error(function() {
                    bootbox.alert('Unable to import instances. Please try again later');
                });
            }
        });

    });
</script>