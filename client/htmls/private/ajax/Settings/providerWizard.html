<div class="wizardFlow">
</div>
<!-- fieldsets -->
<div class="content">
   <form id="myForm54" enctype="mutlipart/form-data" action="/aws/providers" method="post">
      <div class="widget-box">
         <div class="widget-header">
               <h4 class="widget-margin" style="color:black;">Create Provider
              </h4>
         </div>
         <div class="widget-body" >
           <fieldset>
            <div class="widget-main">
               <section id="widget-grid" class="">
                  <!-- START ROW -->
                  <div class="row">
                     <!-- NEW COL START -->
                     <article class="col-sm-12 col-md-12 col-lg-12">
                        <!-- Widget ID (each widget will need unique ID)-->
                        <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false">
                           <!-- widget div-->
                           <div id="appender">
                              <!-- widget content -->
                              <div class="row">
                                 <div class="col-lg-6 col-md-6">
                                    <label for="name">Provider Type:
                                    <span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <select id="providertype" name="providerType" unique="true" uniqueconditionedby="orgname" class="form-control chooseOrganization width-100" style="vertical-align: central" cat-validation="required" cdata="catalyst" skiprowid="yes" onchange="UtilityMethods.providerChanged($(this).val());">
                                       <option value="">Select Provider</option>
                                       <option value="AWS">AWS</option>
                                       <option value="OPENSTACK">OPENSTACK</option>
                                       <option value="VMWARE">VMWARE</option>
                                       <option value="AZURE">AZURE</option>
                                    </select>
                                 </div>
                                 <div class="col-lg-6 col-md-6">
                                    <label for="">Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="providerName" placeholder="Enter Name of the Provider" id="name" class="form-control" type="text" cdata="catalyst" cat-validation="required,max15,nospace" cat-validation-openstack="required,max15,nospace" cat-validation-azure="required,max15,nospace" cat-validation-vmware="required,max15,nospace">
                                 </div>
                              </div>
                              <div class="row foraws">
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <span>
                                    <label style="margin-bottom: 0px; vertical-align: middle; margin-top: 5px;">
                                    Credentials:
                                    <span style="color: Red;" class="control-label">&nbsp;*</span>
                                    </label>
                                    </span>
                                    <span style="margin-right: 20px; margin-left: 20px;">
                                    <input type="radio" name="isDefault" value="false"
                                       style="vertical-align: middle;" id="credentials-accessKeys" checked>
                                    <label for="credentials-accessKeys" style="margin-bottom:0px; margin-top: 5px; vertical-align: middle;">
                                    Use access keys
                                    </label>
                                    </span>
                                    <span style="margin-right: 20px;">
                                    <input type="radio" name="isDefault" value="true"
                                       style="vertical-align: middle;" id="credentials-IAMRole">
                                    <label for="credentials-IAMRole" style="margin-bottom:0px; margin-top: 5px; vertical-align: middle;">
                                    Use IAM role
                                    </label>
                                    <span>
                                    <img class="tooltipMargin" data-toggle="popover" data-placement="left"
                                       title="Credentials are not required if catalyst instance is launched with an IAM role which has permissions to launch instances" src="img/help.png"/>
                                    </span>
                                    </span>
                                 </div>
                              </div>
                              <div class="row foraws aws-secret-info">
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Access Key:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="accessKey" id="accessKey" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation="required" placeholder="Enter the Access Key">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Secret Key:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="secretKey" id="secretKey" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation="required" placeholder="Enter the Secret Key">
                                 </div>
                              </div>
                              <div class="row forvmware">
                                 <div class="col-lg-6 col-md-6 appNameLabel">
                                    <label for="">Username:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="vmwareusername" id="vmwareusername" class="form-control" type="text" cdata="catalyst" cat-validation-vmware="required" placeholder="Enter Username">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel">
                                    <label for="">Password:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="vmwarepassword" id="vmwarepassword" class="form-control secretInfo" type="password" cdata="catalyst" cat-validation-vmware="required" placeholder="Enter the Password">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Host:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="vmwarehost" id="vmwarehost" class="form-control" type="text" cdata="catalyst" cat-validation-vmware="required" placeholder="Enter the Host">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">DC:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="vmwaredc" id="vmwaredc" class="form-control" type="text" cdata="catalyst" cat-validation-vmware="required" placeholder="Enter the Host">
                                 </div>
                              </div>
                              <div class="row foropenstack">
                                 <div class="col-lg-6 col-md-6 appNameLabel">
                                    <label for="">Username:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackusername" id="openstackusername" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter Username">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel">
                                    <label for="">Password:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackpassword" id="openstackpassword" class="form-control secretInfo" type="password" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Password">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Host:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackhost" id="openstackhost" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Host" onBlur="populateurls($(this));">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Project Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackprojectname" id="openstackprojectname" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Project Name">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Tenant ID:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstacktenantid" id="openstacktenantid" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Host">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Tenant Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstacktenantname" id="openstacktenantname" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Tenant Name">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Compute:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackendpointcompute" id="openstackendpointcompute" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Compute Service Endpoint">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Identity:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackendpointidentity" id="openstackendpointidentity" class="form-control" type="text" cdata="catalyst" cat-validation-openstack="required" placeholder="Enter the Compute Service Endpoint">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Network:</label>
                                    <input name="openstackendpointnetwork" id="openstackendpointnetwork" class="form-control" type="text" cdata="catalyst" placeholder="Enter the Network Service Endpoint" cat-validation-openstack="required">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Image:</label>
                                    <input name="openstackendpointimage" id="openstackendpointimage" class="form-control" type="text" cdata="catalyst" placeholder="Enter the Image Service Endpoint" cat-validation-openstack="required">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <label for="">Key Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="openstackkeyname" id="openstackkeyname" class="form-control" type="text" cat-validation-openstack="required" cdata="catalyst" placeholder="Enter Instance Key Name">
                                 </div>
                                 <div class="col-lg-6 col-md-6 appNameLabel margintop20">
                                    <div class="smart-forms">
                                       <label for="">Upload .pem file for Instance:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                       <label for="openstackinstancepem" name="field" class="field file">
                                          <div class="imgdiv" value="1"></div>
                                          <span class="button btn-primary">Browse</span><input name="openstackinstancepem" id="openstackinstancepem" keyfield="configname" type="file" class="gui-file file" name="fileObject"><input type="text" readonly="" class="gui-input fileOPPem" name="fileName"><input type="text" class="folderpath" style="display:none;" cdata="catalyst"/>
                                       </label>
                                    </div>
                                 </div>
                              </div>
                              <div class="row forhppubliccloud">
                                 <div class="col-lg-6 col-md-6">
                                    <label for="">Region:</label>
                                    <select id="hppubliccloudregion" name="hppubliccloudregion" class="chooseOrganization width-100" style="vertical-align: central" cdata="catalyst" skiprowid="yes">
                                       <option value="">Select Region</option>
                                       <option value="region-a.geo-1.identity.hpcloudsvc.com">US West</option>
                                       <option value="region-b.geo-1.identity.hpcloudsvc.com">US East</option>
                                    </select>
                                    <span data-val-controltovalidate="orgname" id="MainContent_Req_orgname" data-val="true" data-val-evaluationfunction="RequiredFieldValidatorEvaluateIsValid" data-val-initialvalue="" style="display:none;">Required</span>
                                 </div>
                                 <div class="col-lg-6 col-md-6">
                                    <label for="">Key Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="hppubliccloudkeyname" id="hppubliccloudkeyname" class="form-control" type="text" cdata="catalyst" placeholder="Enter Instance Key Name">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <div class="smart-forms">
                                       <label for="">Upload .pem file for Instance:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                       <label for="hpFileName" name="field" class="field file">
                                          <div class="imgdiv" value="1"></div>
                                          <span class="button btn-primary">Browse</span><input name="hpFileName" id="hpFileName" keyfield="configname" type="file" class="gui-file file" name="fileObject"><input type="text" readonly="" class="gui-input fileHPPem" name="fileName"><input type="text" class="folderpath" style="display:none;" cdata="catalyst" />
                                       </label>
                                    </div>
                                 </div>
                              </div>
                              <div class="row forazure azureBlock">
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Enter Subscription Id:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="azureSubscriptionId" id="azureSubscriptionId" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation-azure="required" placeholder="Enter the Subscription Id">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Enter Client Id:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="azureClientId" id="azureClientId" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation-azure="required" placeholder="Enter the Client Id">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Enter Client Secret:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="azureClientSecret" id="azureClientSecret" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation-azure="required" placeholder="Enter the Client Secret">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="">Enter Tenant Id:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <input name="azureTenantId" id="azureTenantId" class="form-control secretInfo" type="text" cdata="catalyst" cat-validation-azure="required" placeholder="Enter the Tenant Id">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <div class="smart-forms">
                                       <label for="">Upload .pem file:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                       <label for="azurepem" name="field" class="field file">
                                          <div class="imgdiv" value="1"></div>
                                          <span class="button btn-primary">Browse</span><input name="azurepem" id="azurepem" keyfield="configname" type="file" class="gui-file file" name="fileObject"><input type="text" readonly="" class="gui-input fileAzurePem" name="fileName"><input type="text" class="folderpath" style="display:none;" cdata="catalyst" />
                                       </label>
                                    </div>
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <div class="smart-forms">
                                       <label for="">Upload private key file:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                       <label for="azurekey" class="field file">
                                          <div class="imgdiv" value="1"></div>
                                          <span class="button btn-primary">Browse</span><input name="azurekey" id="azurekey" keyfield="configname" type="file" class="gui-file"><input type="text" readonly="" class="gui-input fileAzureKey" name="fileName">
                                       </label>
                                    </div>
                                 </div>
                              </div>
                              <div class="row">
                                 <div class="col-lg-6 col-md-6 margintop20 foraws">
                                    <label for="">S3 Bucket Name:</label>
                                    <span>
                                    <img data-toggle="popover" data-html="true" data-placement="left" title="S3 bucket to which AWS bills are delivered. NOTE: Detailed billing has to be enabled in AWS." src="img/help.png"/>
                                    </span>
                                    <input name="s3BucketName" id="s3BucketName" class="form-control" type="text" cdata="catalyst" placeholder="Enter the S3 Bucket Name">
                                 </div>
                                 <div class="col-lg-6 col-md-6 margintop20 foraws">
                                    <label for="">Planned Cost:</label>
                                    <span>
                                    <img data-toggle="popover" data-html="true" data-placement="left" title="AWS Planned Cost for a Month." src="img/help.png"/>
                                    </span>
                                    <input name="plannedCost" id="plannedCost" class="form-control" type="text" cdata="catalyst" placeholder="Enter the Planned Cost">
                                 </div>
                              </div>
                              <div class="row">
                                 <div class="col-lg-6 col-md-6 margintop20">
                                    <label for="name">Organization Name:<span style="color: Red;" class="control-label">&nbsp;*</span></label>
                                    <select id="orgId" name="orgId" class="form-control chooseOrganization width-100" style="vertical-align: central" cat-validation="required" cat-validation-openstack="required" cdata="catalyst" >
                                       <option value="">Select Organization</option>
                                    </select>
                                 </div>
                              </div>
                           </div>
                           <!-- end widget div -->
                        </div>
                        <!-- end widget -->
                     </article>
                     <!-- END COL -->
                  </div>
                  <!-- END ROW -->
               </section>
               <!-- end widget grid -->
            </div>
           </fieldset>
         </div>
         <div class="widget-toolbox clearfix">
            <div class="btn-group pull-right">
             <button name="next1" id="saveProviderWizard" style="margin-right:11px;" class="saveFormWizard btn btn-primary"><i class="ace-icon fa fa-check bigger-110"></i>&nbsp;Save</i></button>
             <input type="button" disabled="disabled" name="next1" id="next1" class="nextFormWizard btn btn-primary" value="Next"/>
          </div>
       </div>
      </div>
   </form>
</div>
<input type="hidden" id="providerHiddenId">
<input type="hidden" id="providerHiddenName">

<script type="text/javascript" src="js/jquery.form.js"></script>
<script>
   var orgIdForSetup = $('#orgDropdown').find('option:selected').val();
   var orgNameForSetup = $('#orgDropdown').find('option:selected').text();
   var $option = $('<option></option>').val(orgIdForSetup).html(orgNameForSetup);
   var providerIdForImage;
   $('#orgId').append($option);
       var providerWizardFlow = $('<ol id="providerWizard" class="bwizard-steps bwizard-stepsProviderConfig clearfix clickable"><li aria-selected="true" id="providerCreate" class="active btn-2 providerCreate" style="z-index: 4;"><span class="label badge-inverse">1</span><a href="ajax/Settings/providerWizard.html" class="hidden-phone">Create Providers</a></li><li aria-selected="true" style="z-index: 3;" id="imageCreate" class="btn-3 imageCreate"><span class="label">2</span><a href="ajax/Settings/vmImageWizard.html" class="not-activeAnchor hidden-phone">Create VmImages</a></li></ol>');
       $('.wizardFlow').append(providerWizardFlow);

       function getProviderValues() {
           $.get('/aws/providers/list', function(data) {
               for (var i = 0; i < data.length; i++) {
                   if (orgIdForSetup === data[i].orgId[0]) {
                       $('#providerHiddenName').val(data[i].providerName);
                       $('#myForm54').find('select#providerType').val(data[i].providerType.toLowerCase());
                       $('#providertype').trigger('change').attr('disabled', 'disabled');
                       $('#myForm54').find('input#name').val(data[i].providerName).attr('disabled', 'disabled');
                       $('#myForm54').find('input#s3BucketName').val(data[i].s3BucketName).attr('disabled', 'disabled');
                       $('#myForm54').find('input#plannedCost').val(data[i].plannedCost).attr('disabled', 'disabled');
                       $('#orgId').val(data[i].orgId[0]).attr('disabled', 'disabled');
                       var createTemplateInstance = new createTemplate($('#appender'));
                       for (var j = 0; j < data[i].keyPairs.length; j++) {
                           var $authPemFile = $('.authPemFile');
                           $authPemFile.find('input.filename').val(data[i].keyPairs[j].fileName).attr('disabled', 'disabled');
                           $('#myForm54').find('select.regionValue').val(data[i].keyPairs[j].region).attr('disabled', 'disabled');
                           $('#myForm54').find('select.keySecretValue').remove();
                           $('#myForm54').find('input#keySecretValue').removeClass('hidden').val(data[i].keyPairs[j].keyPairName).attr('disabled', 'disabled');
                           $('#myForm54').find('select.keyRegionValue').remove();
                           $('#myForm54').find('input#keyRegionValue').removeClass('hidden').val(data[i].keyPairs[j].region).attr('disabled', 'disabled');
                           $('#providerHiddenId').val(data[i].keyPairs[j].providerId);
                       }

                       $("input[name='isDefault'][value=" + data[i].isDefault + "]").attr('checked', true);
                       $("input[name='isDefault']").attr('disabled', true);
                       $('.aws-secret-info').hide();
                       $('.secretInfo').removeAttr('cat-validation');
                      // $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                       $('.saveFormWizard').addClass('hidden');
                       $('.nextFormWizard').removeAttr('disabled');
                   }
               }
           });
       }

       function getVmImages() {
        var providerIdForImage = $('#providerHiddenId').val();
        var providerNameForImage = $('#providerHiddenName').val();
         $('#myForm22').find('select#orgId').empty();
           $.get('/vmimages', function(data) {
                for(var i =0;i<data.length;i++){
                  if (orgIdForSetup === data[i].orgId[0]) {
                    if(providerIdForImage === data[i].providerId){
                    var $option = $('<option></option>').val(orgIdForSetup).html(orgNameForSetup);
                    $('#myForm22').find('select#orgId').append($option).attr('disabled','disabled');
                    var $optionForOs = $('<option></option>').val(data[i].osName).html(data[i].osName);  
                      $('#myForm22').find('select.providerVMImageDisplay').remove();
                      $('#myForm22').find('input.imageNameForVM').val(data[i].name).attr('disabled','disabled');
                      $('#myForm22').find('input#providerIdHiddenName').removeClass('hidden').val(providerNameForImage);
                      $('#myForm22').find('select#osType').remove();
                      $('#myForm22').find('input#osType').removeClass('hidden').val(data[i].osName);
                      $('#myForm22').find('input#imageidentifire').val(data[i].imageIdentifier).attr('disabled','disabled');
                      $('#myForm22').find('input#UserName').val(data[i].userName).attr('disabled','disabled');
                      $('.btn-3 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                      $('#myForm22').find('button.saveImageWizard').addClass('hidden');
                      $('.nextFormWizard').removeAttr('disabled');
                    }
                  }
                }
           });
       }
       $('.btn-2 a').click(function(e) {
           e.preventDefault();
           clicked = false;
           $('.contentSetting').load(this.getAttribute('href'));
       });
       $('.btn-3 a').click(function(e) {
           clicked = true;
           e.preventDefault();
           $('.nextFormWizard').removeAttr('disabled');
           $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
           $(this).parent('.bwizard-steps li').addClass('active');
           $('.content').load(this.getAttribute('href'));
           getVmImages();
           $('.btn-3 a').parent('.bwizard-steps li').removeClass('green-btn').addClass('active');
       });
       //api call for getting the status of wizard

       function getProviderWizardStatus(orgIdForSetup) {
            $.get('/setting-wizard/org/' + orgIdForSetup, function(data) {
               if (data.currentStep.name === 'Provider Configuration') {
                   if (data.currentStep.nestedSteps) {
                       var nestedSteps = data.currentStep.nestedSteps;
                       if (nestedSteps[0].name === 'Provider' && nestedSteps[0].isCompleted === true &&
                            nestedSteps[1].name === 'VMImages' && nestedSteps[1].isCompleted === false) {
                           $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
                            $('.btn-3 a').removeClass('not-activeAnchor');
                           $('.contentSetting').find('ol li#imageCreate').addClass('active');
                           $('.content').load('ajax/Settings/vmImageWizard.html');
                       } else {
                       }
                   }
               } else {
                   getProviderValues();
                   $('.btn-3 a').removeClass('not-activeAnchor');
                   $('.btn-2 a').parent('.bwizard-steps li').addClass('active');
                   $('.btn-3 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
               }
           });
       }
       orgIdForSetup = selectedDropdownValue;
       if (clicked) {
          if(orgIdForSetup){
              $('#wizardActionListLoader').show();
              getProviderWizardStatus(orgIdForSetup);
          }
           $('#wizardActionListLoader').hide();
       } else {
         if(orgIdForSetup){
            getProviderValues();
            getVmImages();
           $('.btn-3 a').removeClass('not-activeAnchor'); 
         }
       }
  


   var UtilityMethods = {
       initTooltip: function() {
           var $tool = $("[rel=tooltip]");
           if ($tool.length) {
               $tool.tooltip();
           }
       },
       getRandomNumber: function() {
           return parseInt(Math.random() * 10000000000);
       },
       getIdFromURL: function() {
           var options = location.toString().split('?');
           return options.length > 1 ? (options[1] !== "new" ? options[1] : "") : "";
       },
       initializeRegionlist: function() {
           $('select.region').off('change').on('change', checkForKeyPair);
       },
       emptyRegion: function() {
           $('select.region').val('').trigger('change');
       },
       emptyKeyPairs: function() {
           $('select.keyvalue').html('<option value="">Choose Any Key Pair</option>');
       },
       triggerRegionChange: function() {},
       providerChanged: function(pv) {
           if (pv == 'AZURE') {
               $('.foropenstack').hide();
               $('.forhppubliccloud').hide();
               $('.foraws').hide();
               $('.addNewRegion').hide();
               $('.forvmware').hide();
               $('.forazure').show();
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/aws/g, 'azure'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/vmware/g, 'azure'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/openstack/g, 'azure'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/hppubliccloud/g, 'azure'));
           } else if (pv == 'HPPUBLICCLOUD') {
               $('.foropenstack').show();
               $('.forhppubliccloud').show();
               $('.foraws').hide();
               $('.addNewRegion').hide();
               $('.forvmware').hide();
               $('.forazure').hide();
               $('#openstackinstancepem').closest('div').hide();
               $('#openstackkeyname').closest('div').hide();

               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/aws/g, 'hppubliccloud'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/vmware/g, 'hppubliccloud'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/openstack/g, 'hppubliccloud'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/azure/g, 'hppubliccloud'));
           } else if (pv == 'OPENSTACK') {
               $('.foropenstack').show();
               $('.forhppubliccloud').hide();
               $('.foraws').hide();
               $('.addNewRegion').hide();
               $('.forvmware').hide();
               $('.forazure').hide();
               $('#openstackinstancepem').closest('div').show();
               $('#openstackkeyname').closest('div').show();
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/aws/g, 'openstack'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/vmware/g, 'openstack'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/hppubliccloud/g, 'openstack'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/azure/g, 'openstack'));
           } else if (pv == 'VMWARE') {
               $('.foropenstack').hide();
               $('.forhppubliccloud').hide();
               $('.foraws').hide();
               $('.forvmware').show();
               $('.addNewRegion').hide();
               $('.forazure').hide();
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/aws/g, 'vmware'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/openstack/g, 'vmware'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/hppubliccloud/g, 'vmware'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/azure/g, 'vmware'));
           } else {
               $('.foropenstack').hide();
               $('.forhppubliccloud').hide();
               $('.foraws').show();
               $('.addNewRegion').show();
               $('.forvmware').hide();
               $('.forazure').hide();
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/openstack/g, 'aws'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/vmware/g, 'aws'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/hppubliccloud/g, 'aws'));
               $('#myForm54').attr('action', $('#myForm54').attr('action').replace(/azure/g, 'aws'));
           }
       }
   };

   function populateurls($host) {
       if ($('#providertype').val() == 'HPPUBLICCLOUD' && $host.val() != '') {
           if ($('#openstackendpointec2').val() == '')
               $('#openstackendpointec2').val($host.val());
           if ($('#openstackendpointcompute').val() == '')
               $('#openstackendpointcompute').val($host.val().replace('block', 'compute') + '/v2');
           if ($('#openstackendpointidentity').val() == '')
               $('#openstackendpointidentity').val($host.val().replace('block', 'identity') + ':35357/v2.0/');
           if ($('#openstackendpointimage').val() == '')
               $('#openstackendpointimage').val($host.val().replace('block', 'images') + ':443/v1.0');
           if ($('#openstackendpointnetwork').val() == '')
               $('#openstackendpointnetwork').val($host.val().replace('block', 'network') + '/v2.0');
       }
   }

   function bindChange_importPemFile() {
       $('input[type="file"]').off('change').on('change', function() {
           $(this).next().val(this.files[0].name);
           $(this).next().next().val($(this).val());
       });
   }

   function inLineReady() {
       $("input[type='text']").on("click", function() {
           $(this).select();
           $("#msgOrgName").hide();
       });
   }

   inLineReady();

   function appendLoader() {
       removeLoader();
       $("form[id*='myForm']").find("div.pull-right > input").attr('disabled', 'disabled').parent().prepend('<label id="masterssavespinner" class="" style="float:left;"><img  style="margin-left:5px;margin-right:25px;margin-top:8px;" src="img/select2-spinner.gif" /></label>');
   }

   function removeLoader() {
       $('#masterssavespinner').remove();
       $("form[id*='myForm']").find("div.pull-right > input").removeAttr('disabled');
   }


   function KeyChangeHandler(e) {
       var accessKey = $('#accessKey').val().trim(),
           secretKey = $('#secretKey').val().trim();
       var providerId = UtilityMethods.getIdFromURL();
       if ((accessKey && secretKey)) {
           $('select.region').trigger('change');
       } else if (providerId && providerId !== 'new') {
           $('select.region').trigger('change');
       } else {
           UtilityMethods.emptyRegion();
           UtilityMethods.emptyKeyPairs();
       }
   }

   function checkForKeyPair(e) {
       function loadKeyPair(accessKey, secretKey, isDefault, regionValue, providerId) {
           appendLoader();
           var data1 = new FormData();
           if (!providerId) {
               data1.append('accessKey', accessKey);
               data1.append('secretKey', secretKey);
               data1.append('region', regionValue);
               data1.append('isDefault', isDefault);
           } else if (providerId) {
               data1.append('region', regionValue);
               data1.append('isDefault', isDefault);
               data1.append('providerId', providerId);
           } else if (isDefault) {
               data1.append('region', regionValue);
               data1.append('isDefault', isDefault);
           }

           $.ajax({
               method: "POST",
               url: "/aws/providers/keypairs/list",
               data: data1,
               processData: false,
               contentType: false,
               error: function(XMLHttpRequest, textStatus, errorThrown) {
                   $('.modal-dialog').find('.close').trigger('click');
                   bootbox.alert(XMLHttpRequest.responseText);
                   $('#btnsubmit').attr('disabled', 'disabled');
                   $region.parents('.addNewRegion').find('select.keyvalue').html('<option value=""> Select Keypair</option>').val("");
                   removeLoader();
               }
           }).done(function(msg) {
               var str = '<option value="">Choose Any Key Pair</option>',
                   val = msg['KeyPairs'],
                   len = val.length;
               for (var i = 0; i < len; i++) {
                   str = str + '<option value="' + val[i].KeyName + '">' + val[i].KeyName + '</option>';
               }
               $region.parents('.addNewRegion').find('select.keyvalue').html(str).val('').each(function() {
                   $(this).attr('answer') ? $(this).val($(this).attr('answer')) : "";
               });
               $('#btnsubmit').removeAttr('disabled');
               removeLoader();
           });
       }

       var accessKey = $('#accessKey').val(),
           secretKey = $('#secretKey').val(),
           $region = $(this);
       region = $region.val();
       var providerId = UtilityMethods.getIdFromURL();
       var isDefault = $("input[name='isDefault']:checked").val();

       if (providerId && providerId != 'new' && region && region !== '') {
           loadKeyPair(null, null, false, region, providerId);
       } else if (accessKey && secretKey && accessKey !== '' && secretKey !== '' &&
           region && region !== '') {
           loadKeyPair(accessKey, secretKey, false, region, null);
       } else if (isDefault && region && region != '') {
           loadKeyPair(null, null, true, region, null);
       } else {
           $('#btnsubmit').attr('disabled', 'disabled');
       }

   }

   $(document).ready(function() {

       var $secretInfo = $('.secretInfo');
       var $awsInputs = $secretInfo.filter('[cat-validation]');
       var $vmwareInputs = $secretInfo.filter('[cat-validation-vmware]');
       var $azureInputs = $secretInfo.filter('[cat-validation-azure]');
       var $openStack = $secretInfo.filter('[cat-validation-openstack]');

       $("input[name='isDefault']").change(function() {
           if ($("#credentials-IAMRole").is(":checked")) {
               $('.aws-secret-info').hide();
               $secretInfo.removeAttr('cat-validation');
               $secretInfo.attr('disabled', 'disabled');
           } else {
               $('.aws-secret-info').show();
               $secretInfo.prop('cat-validation', 'required');
               $secretInfo.removeAttr('disabled');
           }
       });

       $("input[type='password']").val('');
       $("#name").focus();
       $('#accessKey').blur(KeyChangeHandler);
       $('#secretKey').blur(KeyChangeHandler);

       $('#providertype').val('AWS').trigger('change');
       $('#myForm54').ajaxForm({
           beforeSubmit: function(arr, $form, options) {
               if (location.toString().indexOf('?new') === -1 && $('#providertype').val() == 'AZURE') {
                   var azureSubscriptionId = $('#azureSubscriptionId').val();
                   arr.push({
                       name: 'azureSubscriptionId',
                       value: orgValue,
                       type: 'text',
                       required: false
                   })
               }
               // return false to cancel submit
               if ($('#providertype').val() == 'OPENSTACK' || $('#providertype').val() == 'HPPUBLICCLOUD') {
                   if (isFormValidOpenStack(null, 'cat-validation-openstack')) {
                       appendLoader();
                       return true;
                   } else
                       return false;
               } else if ($('#providertype').val() == 'VMWARE') {
                   if (isFormValidOpenStack(null, 'cat-validation-vmware')) {
                       appendLoader();
                       return true;
                   } else
                       return false;
               } else if ($('#providertype').val() == 'AZURE') {
                   if (isFormValidAzure(null, 'cat-validation-azure')) {
                       appendLoader();
                       return true;
                   } else
                       return false;
               } else {
                   if (isFormValid()) {
                       appendLoader();
                       return true;
                   } else {
                       return false;
                   }
               }
           },
           dataType: 'json',
           success: function(data, success) {
               if (data != 500) {
                   
               } else {
                   alert(data.toString());
               }
               $('.btn-3 a').removeClass('not-activeAnchor');
               removeLoader();
           },
           error: function(jqxhr) {
               removeLoader();
               console.log(jqxhr);
               if (jqxhr.status == 409) {
                   errormessageforInput('name', jqxhr.responseText);
               } else {
                   bootbox.alert(jqxhr.responseText);
               }
           },
           failure: function(data) {
               removeLoader();
               console.log(jqxhr);
               if (jqxhr.status == 409) {
                   errormessageforInput('name', jqxhr.responseText);
               } else {
                   bootbox.alert(jqxhr.responseText);
               }
           }
       });
   });

   if (!UtilityMethods.getIdFromURL()) {

       var createTemplateInstance = new createTemplate($('#appender'));
       $('#appender').append(createTemplateInstance.getFinalTemplate(true));
       bindChange_importPemFile();

       $('#myForm54').attr('action', '/aws/providers');
       getRegionList();
       $('select.region').change(checkForKeyPair);
       $('#openstackinstancepem').attr('cat-validation-openstack', 'required');
   }

   function getRegionList() {
       $.get('/vmimages/regions/list', function(data) {
           var str = '<option value="">Select Region</option>';
           for (var i = 0; i < data.length; i++) {
               str = str + '<option value="' + data[i].region + '">' + data[i].region_name + ' | ' + data[i].region + '</option>'
           }
           UtilityMethods.initializeRegionlist();

           $('select.region').each(function() {
               if (!$(this).val()) {
                   $(this).html(str);
               }
           }).each(function() {
               $(this).attr('answer') ? $(this).val($(this).attr('answer')) : "";
               if ($(this).attr('disabled')) {
                   $(this).trigger('change');
               }
           });
       });
   }

   function createTemplate(parentToAttach) {
       var that = this,
           parentEl = $(parentToAttach).addClass('customTemplateParent');
       var getAddButton = function(classs) {
               var title = ''
               if (classs == 'addRegion') {
                   titile = 'title="Add New Region" data-placement="top"';
               } else if (classs == 'addRow') {
                   titile = 'title="Add New Key Pair" data-placement="top"';
               }
               return '<img src="img/add.png" class="addimage ' + (classs ? classs : '') + '" ' + titile + ' rel="tooltip" data-placement="top" />'
           },

           getRemoveButton = function(classs) {
               var title = ''
               if (classs == 'removeRegion') {
                   titile = 'title="Remove this Region" data-placement="top"';
               } else if (classs == 'removeRow') {
                   titile = 'title="Remove this Key Pair" data-placement="top"';
               }
               return '<img src="img/remove.png" class="removeimage ' + (classs ? classs : '') + '" ' + titile + ' rel="tooltip"  />'
           },
           getKeyValueList = function() {
               return '<div class="col-lg-6 col-md-6 margintop20" style="width:47%;">' + '<label for="name">Select Key Pair:<span class="control-label redSpan">&nbsp;*</span></label>' + '<select id="' + UtilityMethods.getRandomNumber() + '" name="keyPairName" unique="true" uniqueconditionedby="orgname"  class="form-control chooseOrganization width-100 keyvalue secretInfo keySecretValue" ' + 'style="vertical-align:central" cat-validation="required" skiprowid="yes" cdata="catalyst">' + '  <option value="">Select Any Key Pair</option></select>' + '<input type="text" class="hidden form-control" id="keySecretValue"/>' + '</div>';
           };
       var getRegion = function() {
           return '<div class="row">' + '<div class="col-lg-6 col-md-6" style="width:47%">' + '<label for="name">Region:<span class="control-label redSpan">&nbsp;*</span></label>' + '<select id="' + UtilityMethods.getRandomNumber() + '" name="region" unique="true" uniqueconditionedby="orgname"  class="form-control region regionValue chooseOrganization width-100 secretInfo keyRegionValue" style="' + 'vertical-align:central" cat-validation="required" skiprowid="yes" cdata="catalyst">' + '<option value="">Select Region</option>' + '<option value="us-west-2">us-west-2</option>' + '</select>' + '<input type="text" class="hidden form-control" id="keyRegionValue"/>' + '</div></div>';
       };
       var getPemFileRow = function() {
           return '<div class="col-lg-6 col-md-6 authPemFile margintop20" style="display: block;"><div class="smart-forms" style="  margin-left: 7%;"><label for="">Upload .pem file for Provider<span class="control-label redSpan">&nbsp;*</span></label>' + '<label for="templatesicon" name="field" class="file">' + '<span class="button btn-primary btn-importbyIP" style="height:26px;line-height:22px;  padding: 1px ' + '14px;position: absolute;right:4px;margin-top: 4.5%;">Browse</span>' + '<input id="' + UtilityMethods.getRandomNumber() + '" type="file" class="gui-file file secretInfo" cdata="catalyst" cat-validation="required" name="fileObject">' + '<input type="text" readonly="" class="gui-input filename" name="fileName">' + '<input type="text" class="folderpath" style="display:none;" cdata="catalyst" />' + '</label></div></div>';
       };

       this.getRow = function(isAdd, isRemove, notrequired) {
           var str = '';
           if (isAdd) {
               str = getAddButton('addRow');
           } else if (isRemove) {
               str = getRemoveButton('removeRow');
           } else if (notrequired) {
               str = '';
           }
           return '<div class="row pemrow">' + getKeyValueList() + getPemFileRow() + str + '</div>';
       };

       this.getFinalTemplate = function(isAddApplicable, noOfRow) {
           noOfRow = noOfRow ? parseInt(noOfRow) : 1;
           var str = '';
           for (var i = 0; i < noOfRow; i++) {
               if (i == 0) {
                   str = str + that.getRow(false, false, false);
               } else {
                   str = str + that.getRow(false, false, false);
               }

           }
           return '<div class="addNewRegion margintop20">' + (isAddApplicable ? getAddButton('addRegion') : getRemoveButton('removeRegion')) + getRegion() + str + '</div>'
       };

       $(parentEl).delegate('.addimage', 'click', function() {
           if ($(this).hasClass('addRow')) {
               $(this).parent().parent().append(that.getRow(false, true)).find('select');
           } else if ($(this).hasClass('addRegion')) {
               $(this).parents('.customTemplateParent').append(that.getFinalTemplate()).find('select');
               getRegionList();
           }
           UtilityMethods.initTooltip();
           bindChange_importPemFile();
       });

       $(parentEl).delegate('.removeimage', 'click', function() {
           var parent = $(this).parent();
           if ($(this).hasClass('removeRow')) {

               parent.remove();

           } else if ($(this).hasClass('removeRegion') && !parent.find('select.keyvalue').attr('keyID')) {

               parent.remove();
           } else {
               bootbox.confirm('You are about to remove this KeyPair <strong>' + parent.find('select.keyvalue').val() + '</strong>', function(result) {
                   if (result) {
                       $.ajax({
                           type: "delete",
                           dataType: "text",
                           async: false,
                           url: "/aws/providers/keypairs/" + parent.find('select.keyvalue').attr('keyID'),
                           success: function(data) {
                               if (data != '401') {
                                   parent.remove();
                               } else {
                                   bootbox.alert('Insufficient permission to perform this operation.');
                               }
                           },
                           failure: function(data) {
                               bootbox.alert(data.responseText);
                           },
                           error: function(data) {
                               bootbox.alert(data.responseText);
                           }
                       });
                   }
               });
           }
           UtilityMethods.initTooltip();
       });
   }

   $(".nextFormWizard").click(function() {
      $('.content').empty();
      getVmImages();
       $('.btn-2 a').parent('.bwizard-steps li').removeClass('active').addClass('green-btn');
       $('.contentSetting').find('ol li#imageCreate').addClass('active');
       $('.content').load('ajax/Settings/vmImageWizard.html');
   });
</script>