<div class="row">
  <article class="col-sm-12 col-md-12 col-lg-12">
    <div class="widget-body" style="font-size:12px;">
      <ul id="myTab3" class="nav nav-tabs tabs-pull-left">
        <li class="pull-left active">
          <a href="#l2" id="tabheader" data-toggle="tab">Choose Template Type</a>
        </li>
        <!--new tab for CRUD operations for Blueprint-->
        <li class="pull-left View">
          <a href="#viewCreate" id="viewCreateNew" data-toggle="tab">Existing Blueprints</a>
        </li>
      </ul>
      <div id="myTabContent3" class="nav tab-content">
        <div class="tab-pane fade in active" id="l2">
          <span class="spanName pull-right">
              <label class="orgSelectDropDown"><b>Choose Organisation</b>:</label>
              <select id="selectOrgName" class="form-controlSelect">
              </select>
          </span>
          <input type="hidden" id="orgIDCheck"/>
          <section id="widget-grid" class="">
            <div class="row">
              <article class="col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-editbutton="false" data-widget-deletebutton="false">
                  <div role="content">
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body">
                      <div class="row">
                        <form id="wizard-1" novalidate="novalidate">
                          <div id="bootstrap-wizard-1" class="col-sm-12">
                            <div class="form-bootstrapWizard">
                              <ul class="bootstrapWizard form-wizard" style="margin-left:13%;display:none">
                                <li class="active" data-target="#step1">
                                  <a href="#tab1" data-toggle="tab"> <span class="step">1</span>  
                                  <span class="title"><b></b></span> 
                                  </a>
                                </li>
                                <li data-target="#step2">
                                  <a id="addlink" data-target='#tab2' data-toggle="tab" onclick="">
                                  <span class="step">2</span>  
                                  <span class="title"><b></b></span>
                                  </a>
                                </li>
                                <li data-target="#step3">
                                  <a href="#tab3" data-toggle="tab">
                                  <span class="step">3</span>  <span class="title"><b></b></span> 
                                  </a>
                                </li>
                                <li data-target="#step4">
                                  <a href="#tab4" data-toggle="tab">
                                  <span class="step">4</span>  <span class="title"><b></b></span> 
                                  </a>
                                </li>
                              </ul>
                              <div class="clearfix"></div>
                            </div>
                            <div class="tab-content">
                              <div class="tab-pane active" id="tab1" style="padding-bottom:20px;overflow-y: auto;">
                                <div id="templateContent" class="row " style="margin:0px;min-height:200px;">
                                </div>
                              </div>
                              <div class="tab-pane" id="tab2" style="padding-bottom:20px;overflow-y: auto;">
                                <div class="row " style="margin:0px">
                                  <div id="individualTemplateNameGrid" class="templatesAppfactory templates">
                                  </div>
                                  <div id="templatesDevopsRole" class="templatesdevopsrole templates" style="display:none">
                                  </div>
                                  <div class="templatesCloudformation templates" style="display:none">
                                  </div>
                                </div>
                              </div>
                              <div class="tab-pane" id="tab3" style="padding-bottom:20px;">
                                <div class="row">
                                  <div class="col-lg-12">
                                    <div class="col-lg-2">
                                      <div class="row  selectedTemplateArea" style="margin-bottom:10px;padding-left:10px;margin-left:0px;margin-right:0px;"> Test
                                      </div>
                                    </div>
                                    <div class="col-lg-10">
                                      <div class="panel-group smart-accordion-default" id="accordion-Design">
                                        <div class="panel panel-default divconfigureparameterrunlist">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseConfigureproviderParameter"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Provider Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseConfigureproviderParameter" class="panel-collapse collapse in">
                                            <div class="panel-body" style="padding-left: 20px;">
                                              <div class="col-lg-6 col-md-6">
                                                <label for="instanceOS">Choose Operating System:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="instanceOS" name="instanceOS" class="required chooseOS width-100">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6">
                                                <label for="providerId">Choose Provider:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="providerId" name="providerId" class="required chooseOSProvider width-100">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="imageId">Choose Available Images:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="imageId" name="imageId" class="required chooseSecurity width-100">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                                <label for="region">Choose Flavour:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="openstackflavour" name="openstackflavour" class="required chooseSecurity width-100">
                                                    <option value="">Select Flavour</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                                <label for="region">Network:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="openstacknetwork" name="openstacknetwork" class="chooseSecurity width-100">
                                                    <option value="">Select Network</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                                <label for="region">Subnet:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="openstacksubnet" name="openstacksubnet" class="chooseSecurity width-100">
                                                    <option value="">Select Subnet</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foropenstack" style="margin-top:15px;">
                                                <label for="region">Security Group:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="openstacksecuritygroup" name="openstacksecuritygroup" class="chooseSecurity width-100">
                                                    <option value="">Select Group</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 margintop15">
                                                <label>Do you want to configure Domain Name at the time of Blueprint Launch?:</label>
                                                <div class="input-groups">
                                                  <div class="radio">
                                                    <label><input type="radio" name="domainNameCheck">Yes</label>
                                                  </div>
                                                  <div class="radio">
                                                    <label><input type="radio" checked="true" name="domainNameCheck">No</label>
                                                  </div>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="region">Choose Region:<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="region" name="region" class="required chooseSecurity width-100">
                                                    <option value="">Select Region</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="vpcId">Select VPC:<span style="color:red">*</span></label>
                                                <label id="vpcSpinner" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                                                <div class="input-groups">
                                                  <select id="vpcId" name="vpcId" class="required chooseSelect chooseImage width-100">
                                                    <option value="">Select VPC</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="subnetId">Select Subnet:<span style="color:red">*</span></label>
                                                <label id="spinnerSubnet" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                                                <div class="input-groups">
                                                  <select id="subnetId" name="subnetId" class="required chooseSelect chooseImage width-100">
                                                    <option value="">Select Subnet</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="keypairId">Select KeyPair :<span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="keypairId" name="keypairId" class="required instanceType chooseInstance width-100">
                                                    <option value="">Choose KeyPair </option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="instancesize">Instance Size:<span class="control-label redSpan">&nbsp;*</span></label>
                                                <div class="input-groups">
                                                  <select id="instancesize" name="instancesize" class="required chooseOrganization width-100 chooseSelect" style="vertical-align:central">
                                                    <option value="">Choose Instanace Size</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="checkbox-toggle">Security Group:<span class="control-label redSpan">&nbsp;*</span></label>
                                                <label id="spinnerSecurityGroup" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                                                <div class="col-lg-6 smart-form multiselect inputGroups" style="  height: 140px;overflow-y: scroll;border:1px solid gray;padding: 0px;width:100%">
                                                  <div id="securityGroupIds" name="securityGroupIds"  multiselect="multiselect" datatype="select" datapath="" class="input-group col-md-12 widthBox" style="width:99%;margin-top:-1px;border:0px">
                                                  </div>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 foraws" style="margin-top:15px;">
                                                <label for="instanceCount">Instances to Launch:<span class="control-label redSpan">&nbsp;*</span></label>
                                                <div class="input-groups">
                                                  <select id="instanceCount" name="instanceCount" class="required chooseOrganization width-100 chooseSelect" style="vertical-align:central">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <!--To add the Swipe Functionality-->                            
                                            </div>
                                          </div>
                                        </div>
                                        <!--adding organisation parameters starts here-->
                                        <div class="panel panel-default divOrganizationParameter">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditorgParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Organization Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseEditorgParam" class="panel-collapse collapse">
                                            <div class="panel-body" style="padding-left: 8px;">
                                              <div class="col-lg-6 col-md-6">
                                                <label for="orgnameSelect">Choose Organization <span style="color:red">*</span></label>
                                                <div class="input-groups">
                                                  <select id="orgnameSelect" name="orgnameSelect" class="required chooseOrgselect2 width-100">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6">
                                                <label for="blueprintNameInput">Enter Blueprint Name:
                                                <span class="control-label redSpan">&nbsp;*</span></label>
                                                <div class="input-groups">
                                                  <input  id="blueprintNameInput" name="blueprintNameInput" class="required form-control" type="text" autofocus="autofocus">
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="bgListInput">Choose Business Group <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="bgListInput" name="bgListInput" class="required chooseBG width-100">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="projectListInput">Choose Project <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="projectListInput" name="projectListInput" class="required chooseProject width-100">
                                                  </select>
                                                </div>
                                              </div>
                                             <!--  <div class="col-lg-6 hidden" style="margin-top:5px;">
                                                <label for="">Assign Users<span style="color:red">*</span></label>
                                                <div class="userListLoadingContainer">
                                                </div>
                                                <select class="custom-scroll width-100" multiple="" id="userListSelect" style="display:none">
                                                </select> 
                                              </div>    -->  
                                              <div class="col-lg-6 col-md-6 forDocker dockerProjPort hidden notforCFT">
                                                <label for="category">Select Docker Image <span style="color:red">*</span>
                                                </label>
                                                <select id="dockerrepoListInput" class="chooseDockerContainer width-100">
                                                </select>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forDocker dockerProjPort hidden notforCFT">
                                                <label for="category">Available Repo Tags <span style="color:red">*</span>
                                                </label>                 
                                                <div id="dockerrepotagsdiv">
                                                </div>
                                              </div>
                                              <div class="col-lg-12 col-md-12 hidden">
                                                <div class="col-lg-6 col-md-6 forDocker dockerProjPort dockerLEFT notforCFT">
                                                  <label for="category" class="pull-left">Launch Parameters<a id="launchParamDocker" href="javascript:void(0);" onclick=""><i title="Add" class="icon-append fa fa-plus" ></i></a>
                                                  </label>               
                                                  <div class="btn-group pull-left">
                                                  </div>
                                                  <input type="text" id="dockerlaunchparameters" class="form-control" disabled="disabled" title="To edit click add"/>
                                                </div>
                                              </div>
                                              <!-- Docker Image selection table -->
                                              <div class="col-lg-12 col-md-12 forDocker notforCFT" style="margin-top:5px;">
                                                <label for="category">Docker Images<span style="color:red">*</span>
                                                </label>
                                                <a class="btn btn-primary adddockertemplate pull-right" onclick="showdockertemplateadder();" style="margin-bottom:5px;">Add</a>
                                                <table class="table table-striped table-bordered table-hover dataTable no-footer" id="compositedockertable" cellpadding="5px" width="100%" style="text-align:center">
                                                  <tr>
                                                    <th>Order</th>
                                                    <th>Name</th>
                                                    <th>Image Path</th>
                                                    <th>Tag</th>
                                                    <th>Launch Params</th>
                                                    <th>Action</th>
                                                  </tr>
                                                </table>
                                              </div>
                                              <!-- End Docker Image selection table -->
                                            </div>
                                          </div>
                                        </div>
                                        <!--configure runlist collapse starts here-->
                                        <div class="panel panel-default divRunlistParameter notforCFT notForDocker">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditRunlistParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Runlist Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseEditRunlistParam" class="panel-collapse collapse">
                                            <div class="panel-body" style="padding-left: 8px;">
                                              <div class="col-lg-6 col-md-6 notForDocker notforCFT" style="margin-top:19px">
                                                <label>
                                                <i style="color:#40baf1;font-size:16px;" class="ace-icon fa fa-list-ul"></i>   
                                                Edit Runlist
                                                </label>
                                                <a href="#chefRunlistModal" data-backdrop="false" data-toggle="modal" style="cursor:pointer;"> <img src="img/add.png" style="float:right;margin-top:6px;" class="addList" rel="tooltip" data-placement="top" title="Edit Runlist" /></a>
                                                <div style="height:146px;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                                  <table id="tableRunlistForBlueprint" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                                                    <thead>
                                                      <tr class="rowCustomStyle">
                                                        <th style="text-align:center">View Runlist</th>
                                                      </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                  </table>
                                                </div>
                                              </div>
                                              <div class="col-lg-4 col-md-4 notForDocker notforCFT" style="margin-top:25px;margin-left:2px;"><a style="font-size:14px!important" href="#modalForHelp" data-toggle="modal" id="dokuNew"><i class="fa fa-question"></i>&nbsp;Help</a>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <!--configure runlist collapse ends here-->
                                        <!--assign runlist modal-->
                                        <div class="modal fade" id="chefRunlistModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                                          <div class="modal-dialog">
                                            <div class="modal-content" style="width:800px">
                        <form role="form" class="cmxform" id="chefTaskRunlist" autocomplete="off">
                        <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                        </button>
                        <h4 class="modal-title">
                        <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Edit Runlist
                        </h4>
                        </div>
                        <div class="modal-body modal-height">
                        <div class="cookbookShow">
                        </div>
                        </div>
                        <div class="modal-footer">
                        <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="submit" class="btn btn-primary" id="saveRunlist">Update Runlist</button>  
                        </div>   
                        </form>
                        </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                        </div>
                        <!--modal for runlist ends here-->
                        <!--adding new collapse-->
                        <div class="panel panel-default appSeriesNameURL notForDocker notforCFT">
                        <div class="panel-heading">
                        <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseApp" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Application URL</a>
                        </h4>
                        </div>
                        <div id="CollapseApp" class="panel-collapse collapse">
                        <div class="row">
                        <div class="col-md-12">
                        <div class="col-md-12">
                        <div class="widget-box">
                        <div class="widget-header">
                        <h5 class="widget-title" style="color:#4e5964;">
                        <strong>Application URL</strong>
                        </h5>
                        <div class="widget-toolbar no-border">
                        <a id="newAppSeries" class="btn btn-minier btn-primary" href="#modalAppNameURL" data-toggle="modal">
                        <i class="ace-icon ace-icon fa fa-plus bigger-110"></i>
                        New
                        </a>                                                
                        </div>
                        </div>
                        <div class="widget-body">
                        <div class="widget-main" style="min-height:100px">
                        <div class="col-md-12 table-responsive" style="padding-left:0px; padding-right:0px;">
                        <table id="appTable" class="hidden" cellpadding="5px" width="100%">
                        <thead>
                        <tr class="rowCustomStyle">
                        <td>Name</td>
                        <td>URL</td>
                        <td>Action</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="hidden rowtemplate">
                        <td datafield="appName"></td>
                        <td datafield="appURL"></td>
                        <td>
                        <div class="btn-group tableactionWidth">
                        <button class="btn btn-xs btn-danger pull-left" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button>
                        <a class="btn btn-xs btn-info pull-left" title="Update">
                        <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </a>
                        </div>
                        </td>
                        </tr>
                        </tbody>
                        </table>
                        <table id="appUrlTable" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center";>
                        <thead>
                        <tr class="rowCustomStyle">
                        <td style="width:20%">Name</td>
                        <td style="width:40%">URL</td>
                        <td style="width:20%" class="">Action</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr><td colspan=3 id="appEntry">No Data Available</td></tr>
                        </tbody>
                        </table>
                        <div id="envtable_tools1"></div>
                        <div class="col-md-5">
                        </div>
                        </div>
                        </div>
                        <div class="widget-toolbox padding-8 clearfix dataTables_wrapper">
                        <div id="tableFooterLeft" class="pull-left"></div>
                        <div id="tableFooterRight" class="pull-right"></div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div><!--collapseapp ends here-->
                        </div>
                        <!--adding new collapse-->
                        <div class="panel panel-default notForDocker forCFT cftStackParameterArea" style="display:none">
                        <div class="panel-heading">
                        <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseStackParameters" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Stack Parameters</a>
                        </h4>
                        </div>
                        <div id="CollapseStackParameters" class="panel-collapse collapse">
                        <div class="panel-body" style="padding-left: 20px;">
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div> <!--tab pane ends here-->
                        <div class="tab-pane" id="tab4" style="padding-bottom:20px;overflow-y: auto;">
                        <div class="blueprintSaveSuccess blueprintMsgContainer"><div class="alert alert-success bootstrapSuccess"><img style="width:50px;height:40px" src="img/correct.png" alt="success"/>
                        <span class="blueprintNameSuccess" style="margin-left:20px;"></span>
                        <div style="margin-top:24px;text-align:center;"><button class="btn btn-primary"><a style="color:white;text-decoration:none" href="#ajax/DesignBlueprint.html?addnew" id="addanotherlink">&nbsp;&nbsp;Add New Blueprint</a></button>
                        </div>
                        </div>
                        </div>
                        <div class="blueprintSaveFail blueprintMsgContainer"><div class="alert alert-warning bootstrapFailure"><img style="width:50px;height:40px" src="img/warning.png" alt="warning"/>
                        <span style="margin-left:20px;">Unable to save blueprint. Please try again later.</span>
                        </div>
                        </div>
                        </div>
                        <footer class="footer">
                        <div style="text-align:center;" class="clearfix form-actions no-padding">
                        <div class="btn-group">
                        <ul class="pager wizard no-margin" style="margin-left:200px">
                        <li class="previous disabled">
                        <a style="border-radius:0px" class="btn btn-primary" href="javascript:void(0);"> Previous </a>
                        </li>
                        <li class="next" id="nextSpecificValue">
                        <a style="border-radius:0px;margin-left:5px;" class="btn btn-primary" href="javascript:void(0);"> Next </a>
                        </li>
                        </ul>
                        </div>
                        </div>
                        </footer>
                        </div>
                        </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </article>
            </div>
          </section>
        </div>
        <!--view for blueprints-->
        <!--blueprint tab-->
        <div class="tab-pane" id="viewCreate">
          <div class="jarviswidget jarviswidget-color-blueLight" id="wid-id-10" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-sortable="false">
            <div>
              <div class="widget-body no-padding">
                <form action="">
                  <div class="col-lg-12 awsExisting">
                    <div class="col-lg-4 col-md-4">
                      <label for="">Organization <!--<span style="color:red">*</span>--></label>
                      <select id="orgnameSelectExisting" class="chooseOrgSelectExisting width-100">
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-4">
                      <label for="">Business Group</label>
                      <select id="bgListInputExisting" class="chooseBGExisting width-100">
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-4">
                      <label for="category">Project
                      </label>
                      <select id="projectListInputExisting" class="chooseProjectExisting width-100">
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-4 hidden">
                      <label for="category">Environment</label>
                      <select  id="envListExisting" class="chooseEnvExisting width-100">
                      </select>
                    </div>
                  </div>
                </form>
                <div class="col-lg-12">
                  <div class="panel-group smart-accordion-default hidden" id="accordion-2" style="height:444px;overflow-y: auto;">                                 
                  </div>
                </div>
              </div>
            </div>
          </div>
          <footer class="footer">
            <div class="clearfix form-actions" style="text-align:center">
              <button class="btn pull-right btn-danger right-button" title="Remove Blueprint" onClick="removeSelectedBlueprint()" > <i class="fa fa-trash-o"></i></button>
            </div>
          </footer>
          <!--Launch div ends here-->
        </div>
        <!--tab-pane l2 gets over -->
        <!--modal for blueprint edit-->
        <div class="modal fade bs-example-modal-lg" id="blueprintEditResultContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel">Blueprint Edit</h4>
              </div>
              <div class="modal-body" style="padding:0px !important">
              </div>
              <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary blueprintUpdateBtn" data-dismiss="modal">Save Version</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        <!--modal for blueprint edit ends-->
        <!--updating the runlist while blueprint edit-->
        <div class="modal fade bs-example-modal-lg" id="chefRunModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-pencil-square-o txt-color-blue"></i>Update Runlist</h4>
              </div>
              <div class="modal-body" style="padding:0px !important">
                <div class="chefRunlistContainer">
                </div>
              </div>
              <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary btnUpdateInstanceRunlist">Update</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        <!--view ends here-->
      </div>
    </div>
  </article>
</div>
<!--app series-->
<div class="modal fade" id="modalAppNameURL" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <form role="form" id="appURLForm" autocomplete="off">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          &times;
          </button>
          <h4 class="modal-title">
            <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Add Application URL
          </h4>
        </div>
        <div class="modal-body appSeriesHeight">
          <!--app series-->
          <div class="applicationURLContainer" id="appSeries">
            <div class="col-lg-6 col-md-6 projectRepo">
              <label for="">Name:</label>
              <input placeholder="AppName" type="text" maxlength="8" name="appNameInput" class="form-control appName">
              <b class="tooltip tooltip-top-right">
              <i class="fa fa-user txt-color-teal"></i> Please enter Application</b>
            </div>
            <div class="col-lg-6 col-md-6 projectRepo">
              <label for="">URL:</label>
              <input placeholder="http://$host[:port]/appname" name="appNameURL" class="form-control appURL" type="text">
              <b class="tooltip tooltip-top-right">
              <i class="fa fa-user txt-color-teal"></i> Please enter URL</b>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <label id="nodeAppspinner" class=" hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
          <div class="marginForButtons">
            <button id="addAppBtn" class="btn btn-primary" type="submit">
            <i class="fa fa-upload fa-1x"></i>&nbsp;Add
            </button>
            <a class="btn btn-primary" type="submit" data-dismiss="modal">
            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
            </a>
          </div>
        </div>
      </form>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal for appSeries ends-->
<!--app series ends here-->
<!--launch docker-->
<!--launch docker-->
<div class="modal fade bs-example-modal-lg" id="myModalDockerTemplateContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-lg" style="width:580px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="DockerLaunch">Add a Docker Template</h4>
      </div>
      <div class="modal-body " style="height:117px">
        <section>
          <form id="dockerparamsform" action="">
            <div class="col-lg-6 col-md-6">
              <label for="category">Select Template<span style="color:red">*</span><span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
              </label>
              <select class="chooseSelect width-100" id="dockertemplateselector" onchange="imagechanged();">
              </select>
            </div>
            <div class="col-lg-6 col-md-6">
              <label for="category">Select Tag<span style="color:red">*</span><span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
              </label>
              <label id="dockertemplateSpinner" class="hidden"><img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
              <select class="chooseSelect width-100" id="dockertemplatetagselector">
              </select>
               <div class="small pull-right" style="margin-right:10px">
                  To get private repo tags, add a hub account in Settings > DevOps Setup > Docker
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="modal-footer">
        <button type="button" id="btnaddDockerTemplateToTable" class="btn btn-default btn-primary" onclick="addDockerTemplateToTable($('#dockertemplateselector option:selected').text(),$('#dockertemplateselector').val(),$('#dockertemplatetagselector').val(),$('#dockertemplateselector option:selected').attr('reponame'));$('#myModalDockerTemplateContainer').modal('hide');">
        <i class="fa fa-save fa-1x"></i>&nbsp;Add</button>
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">
        <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade bs-example-modal-lg" id="myModalLabelDockerContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="DockerLaunch">Launch Parameters-Docker Blueprints</h4>
      </div>
      <div class="modal-body dockerModalHeight">
        <section>
          <form id="dockerparamsform" action="">
            <div style="margin:0px;">
              <div class="col-lg-6 col-md-6">
                <label for="category">Container Name<span style="color:red">*</span><span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
                </label>
                <input type="text" id="Containernamefield" name="namefield" class="required form-control" placeholder="" dockerparamkey="--name" onclick="$('.dockerparamrequired').addClass('hidden')">
              </div>
              <div class="col-lg-6 col-md-6">
                <label for="category">Port Mappings
                </label>
                <input type="text" id="Portmappingfield" name="Portmappingfield" class=" form-control" placeholder="Map host ports to container ports" dockerparamkey="-p">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Volumes
                </label>
                <input type="text" id="Volumesfield" name="Volumesfield" class=" form-control" placeholder="Map host folders to container folders" dockerparamkey="-v">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Volumes-from
                </label>
                <input type="text" id="Volumes-fromfield" name="Volumes-fromfield" class=" form-control" placeholder="Comma separated container names" dockerparamkey="--volumes-from">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Linked Container
                </label>
                <input type="text" id="Linkedcontainerfield" name="Linkedcontainerfield" class=" form-control" placeholder="The name of a container this one links to" dockerparamkey="--link">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Environment Variables
                </label>
                <input type="text" id="Environmentvariablesfield" name="Environmentvariablesfield" class=" form-control" placeholder="" dockerparamkey="-e">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Startup Command
                </label>
                <input type="text" id="Startupcommandfield" name="Startupcommandfield" class=" form-control" placeholder="Optional startup command for the container" dockerparamkey="-c">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Additional Startup
                </label>
                <input type="text" id="additionalStartupcommandfield" name="additionalStartupcommandfield" class=" form-control" placeholder="Additional startup command for the container" dockerparamkey="-exec">
              </div>
              <div class="col-lg-6 hidden">
                <label for="category">Removed Linked Containers on Exit
                </label>
                <select class="chooseSelect width-100" id="Removelinkedcontainersonexitfield" placeholder="Should this & linked containers be removed on exit">
                  <option>False</option>
                  <option>True</option>
                </select>
              </div>
              <div class="col-lg-6 dockerModal hidden">
                <label for="category">Remove on Exit
                </label>
                <select class="chooseSelectExit width-100 " id="Removeonexitfield" placeholder="Should this container be removed when it exits">
                  <option>False</option>
                  <option>True</option>
                </select>
              </div>
              <div class="col-lg-6 hidden">
                <label for="">Startup Script</label>
                <label class="input input-file" for="file">
                  <div class="button">
                    <input type="file" id="Startupscriptfield" name="Startupscriptfield">Browse
                  </div>
                  <input type="text" readonly="">
                </label>
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-primary" onclick="if(generateDockerLaunchParams()!=''){$('#myModalLabelDockerContainer').modal('hide');}else{return(false);}">
        <i class="fa fa-save fa-1x"></i>&nbsp;Add</button>
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">
        <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel</button>
      </div>
    </div>
  </div>
</div>
<script type = "text/javascript">

  if (!$.fn.dataTable.isDataTable('#tableRunlistForBlueprint')) {
    $tasksRunlist = $('#tableRunlistForBlueprint').DataTable({
      "pagingType": "full_numbers",
      "bInfo": false,
      "bLengthChange": false,
      "paging": false,
      "bFilter": false,
      "aoColumns": [{
        "bSortable": false
      }]
    });
  }

function createRunlistTable(runlist) {
  //alert(runlist.length);
  //$('#tableRunlist').removeClass('hidden');
  $tasksRunlist.clear().draw();
  // alert(runlist.length);
  for (i = 0; i < runlist.length; i++) {
    var $runlistList = $('#tableRunlistForBlueprint');
    var $tr = $('<tr class="runlistRow"></tr>');
    var $tdName = $('<td class="runlistDescription">' + runlist[i] + '</td>');
    $tr.append($tdName);
    $runlistList.append($tr);
    $tasksRunlist.row.add($tr).draw();
  }
}

$('#saveRunlist').click(function(e) {
  var $ccrs = $('.cookbookShow').data('$ccrs');
  // alert($ccrs);
  console.log($ccrs);
  console.log($ccrs.getSelectedRunlist());
  var runlist = $ccrs.getSelectedRunlist();
  // alert(runlist);

  // alert('here');
  createRunlistTable($ccrs.getRunlistNames());
  $('#chefRunlistModal').modal('hide');
  return false;


});

function updatecompositedockertableemptymessage() {
  if ($('#compositedockertable').find('tr').length <= 1) {
    //no rows found add empty message
    $('#compositedockertable').append('<tr id="dockerimageemptytr"><td colspan="6" align="center">No images added</td></tr>');
  }

}
var providerselected = $('#blueprints').attr('providerselected');

$(document).ready(function() {
  $(".chooseOrgSelectExisting").select2();
  $(".chooseBGExisting").select2();
  $(".chooseProjectExisting").select2();
  $(".chooseEnvExisting").select2();
  $('#selectOrgName').trigger('change');
  var $addal = $("#addanotherlink"); //#ajax/Aws-Production.html?addnew
  if (window.url.indexOf('addnew') > 0)
    $addal.attr('href', '#ajax/DesignBlueprint.html?addanother');
  else
    $addal.attr('href', '#ajax/DesignBlueprint.html?addnew');



  $.ajax({
    type: "get",
    dataType: "json",
    async: false,
    url: "../organizations/getTreeNew",
    success: function(data) {
      console.log(data);
      data = JSON.parse(JSON.stringify(data));
      var $orgListInput = $('#orgnameSelectExisting');
      var $bgList = $('#bgListInputExisting');
      var $projectList = $('#projectListInputExisting');
      var $envList = $('#envListExisting');
      $orgListInput.change(function(e) {
        var orgName = $(this).val();
        if (orgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $bgList.empty();
        var getBg = orgBg[orgName];
        for (var i = 0; i < getBg.length; i++) {
          var $option = $('<option></option>').val(getBg[i].rowid).html(getBg[i].name);
          $bgList.append($option);
        }
        $bgList.trigger('change');
      });
      $bgList.change(function(e) {
        var bgName = $(this).val();
        if (bgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $projectList.empty();
        var getProjs = bgProjects[bgName];
        for (var i = 0; i < getProjs.length; i++) {
          var $option = $('<option></option>').val(getProjs[i].rowid).html(getProjs[i].name);
          $projectList.append($option);
        }
        $projectList.trigger('change');
      });

      var $spinnerProject = $('#spinnerProjectChange').addClass('hidden');
      $('#projectListInputExisting').change(function(e) {
        var reqBodyNew = {};
        $spinnerProject.removeClass('hidden');
        reqBodyNew.orgId = $orgListInput.val();
        reqBodyNew.bgId = $bgList.val();
        reqBodyNew.projectId = $projectList.val();
        reqBodyNew.envId = $envList.val();
        $.get('../organizations/' + reqBodyNew.orgId + '/businessgroups/' + reqBodyNew.bgId + '/projects/' + reqBodyNew.projectId + '/environments/' + reqBodyNew.envId + '/openstack', function(data) {
          console.log('success---3---4');
          //Syncing up the tree view based on url
          initializeBlueprintAreaNew(data.blueprints);
          $spinnerProject.addClass('hidden');
          if (data.blueprints.length > 0) {
            $('#accordion-2').removeClass('hidden');
            $spinnerProject.addClass('hidden');
          } else {
            $spinnerProject.addClass('hidden');
          }
        });
      }); //choose env gets over
      var bgProjects = {};
      var orgBg ={};
      for (var i = 0; i < data.length; i++) {
        $orgListInput.append($('<option></option>').val(data[i].rowid).html(data[i].name).data('bglist', data[i].businessGroups).data('envList', data[i].environments));
        orgBg[data[i].rowid] = data[i].businessGroups;
        for (var j = 0; j < data[i].businessGroups.length; j++) {
          var rowid = data[i].businessGroups[j].rowid;
          //$bgList.append($('<option></option').val(rowid).html(data[i].businessGroups[j].name));
          bgProjects[rowid] = data[i].businessGroups[j].projects;
        }
        for (var k = 0; k < data[i].environments.length; k++) {
          $envList.append($('<option></option').val(data[i].environments[k].rowid).html(data[i].environments[k].name))
        }
      }
      $orgListInput.trigger('change');
      $bgList.trigger('change');
      $('.chooseOrgSelectExisting').change(function(e) {
        if ($(this).val() == 'choose') {
          $('#accordion-2').addClass('hidden');
        }
        $('.chooseBGExisting').change();
        $('.chooseProjectExisting').change();
      });
    }
  }); //getTreeNew gets over here

  //form validation for blueprint save
  var validator = $('#wizard-1').validate({
    ignore: [],
    rules: {
      "checkbox-toggle": {
        required: true
      },
      blueprintNameInput: {
        maxlength: 25
      }
    },
    messages: {
      blueprintNameInput: {
        maxlength: "Limited to 25 characters"
      }
    },
    onkeyup: false,
    errorClass: "error",

    //put error message behind each form element
    errorPlacement: function(error, element) {
      console.log(error, element);
      var elem = $(element);
      if (element.parent('.input-groups').length) {
        error.insertBefore(element.parent());
      } else {
        if (element.parent('div.inputGroups')) {
          console.log(element);
          console.log(element.parent);
          error.insertBefore('div.inputGroups');
        }

        $("select.select2-me").each(function(index, el) {

          if ($(this).is("[data-rule-required]") &&
            $(this).attr("data-rule-required") == "true") {
            $(this).on('select2-close', function(e) {
              $(this).valid()
            });
          }
        });
      }
    },

    //When there is an error normally you just add the class to the element.
    // But in the case of select2s you must add it to a UL to make it visible.
    // The select element, which would otherwise get the class, is hidden from
    // view.
    highlight: function(element, errorClass, validClass) {
      var elem = $(element);
      if (elem.hasClass("select2-offscreen")) {
        $("#s2id_" + elem.attr("id") + " ul").addClass(errorClass);
      } else {
        elem.addClass(errorClass);
      }
    },

    //When removing make the same adjustments as when adding
    unhighlight: function(element, errorClass, validClass) {
      var elem = $(element);
      if (elem.hasClass("select2-offscreen")) {
        $("#s2id_" + elem.attr("id") + " ul").removeClass(errorClass);
      } else {
        elem.removeClass(errorClass);
      }
    }
  });
  $('a#addanotherlink').click(function(e) {
    validator.resetForm();
  });
  /*$('a#workZoneNew').click(function(e){
        alert('click');
        validator.resetForm();
    })*/
  $(document).on('change', '.select2-offscreen', function() {
    if (!$.isEmptyObject(validator.submitted)) {
      validator.form();
    }
  });

  $(document).on("select2-opening", function(arg) {
    var elem = $(arg.target);
    if ($("#s2id_" + elem.attr("id") + " ul").hasClass("myErrorClass")) {
      //jquery checks if the class exists before adding.
      $(".select2-drop ul").addClass("myErrorClass");
    } else {
      $(".select2-drop ul").removeClass("myErrorClass");
    }
  });

}); //document.ready gets over here
//the blueprint section gets over here.

$('#launchParamDocker').click(function() {
  $('#dockerparamsform')[0].reset();
  // loadLaunchParams(); //removed for compose
  $('.chooseSelectExit').change();
});


function generateDockerLaunchParams() {
  if ($('#Containernamefield').val() == '') {
    $('.dockerparamrequired').removeClass('hidden');
    return ('');
  }

  var launchparams = '';
  $('[dockerparamkey]').each(function() {
    if ($(this).val() != '') {
      var itms = $(this).val().split(',');
      for (itm in itms)
        launchparams += ' ' + $(this).attr('dockerparamkey') + ' ' + itms[itm];
    }
  });
  //$('#dockerlaunchparameters').val(launchparams); //removed for compose
  //alert(launchparams)
  $('#' + $('#myModalLabelDockerContainer').attr('saveto')).val(launchparams);

  return (launchparams);
}


function addDockerTemplateToTable(title, repopath, tagname, reponame) {
  var $cdt = $('#compositedockertable');
  var uniqueid = (Math.floor(Math.random() * 9000) + 1000).toString();
  //remove any empty row message from table
  $('#dockerimageemptytr').detach();
  var $dockertemplaterow = '<tr class="dockerimagesrow"><td >' + $cdt.find('tr').length + '</td><td paramtype="dockercontainerpathstitle">' + title + '</td><td  paramtype="dockercontainerpaths">' + repopath + '</td><td paramtype="dockerrepotags">' + tagname + '</td><td><input type="text" paramtype="dockerlaunchparameters" id="launchparam' + uniqueid + '" class=""><input type="hidden" paramtype="dockerreponame" id="dockerreponame' + uniqueid + '" class="" value="' + reponame + '"><a onclick="loadLaunchParams(\'launchparam' + uniqueid + '\');" href="javascript:void(0);"><i class="icon-append fa fa-list-alt fa-lg" title="Launch Parameters"></i></a></td><td ><a class="dockerimageselectorup" id="dockerimageselectorup' + uniqueid + '"  href="javascript:movetablerow(\'dockerimageselectorup\',' + uniqueid + ');"><i class="fa fa-chevron-circle-up fa-lg"></i></a><a class="dockerimageselectordown" id="dockerimageselectordown' + uniqueid + '" href="javascript:movetablerow(\'dockerimageselectordown\',' + uniqueid + ');" style="padding-left:5px;"><i class="fa fa-chevron-circle-down fa-lg"></i></a><button class="btn btn-xs btn-danger pull-right" value="Remove" title="Remove" id="dockerimageremove' + uniqueid + '" onClick="javascript:removeimage(\'dockerimageremove\',' + uniqueid + ');"><i class="ace-icon fa fa-trash-o fa-lg"></i></button></td></tr>';

  $cdt.append($dockertemplaterow);

}

function showdockertemplateadder() {

  $('#dockertemplateselector').select2('val', '');
  $('#dockertemplatetagselector').empty().select2('val', '');
  $('#myModalDockerTemplateContainer').modal('show');
}

function addrows() { //only for testing to be removed
  addDockerTemplateToTable('one', 'one/one', "latest");
  addDockerTemplateToTable('two', 'two/two', "latest");
  addDockerTemplateToTable('three', 'three/three', "latest");
}

function imagechanged__() {
  //tutum/centos //dockertemplatetagselector
  //alert('Docker Query -> ' +  '/d4dmasters/getdockertags/' + encodeURIComponent($(this).find('option:selected').attr('repopath')) + '/' + $dockerreponame);
  //alert('changed');
  $('#btnaddDockerTemplateToTable').attr('disabled', 'disabled');
  $('#dockertemplateSpinner').removeClass('hidden');
  $('#dockertemplatetagselector').empty().select2('val', '');
  $.get('/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'), function(data) {
    //Sample json given below
    //[{"layer": "cddde0cd", "name": "latest"}, {"layer": "3baf8932", "name": "6.4"}, {"layer": "d1c0a07f", "name": "6.5"}, {"layer": "a9dd9e89", "name": "centos5"}, {"layer": "02398e09", "name": "centos6"}, {"layer": "4e5b3b2f", "name": "centos7"}]
    $('#dockertemplateSpinner').addClass('hidden');
    if (data) {
      var tagJson = JSON.parse(data);
      var $dockertemplatetagselector = $('#dockertemplatetagselector');
      $dockertemplatetagselector.empty();
      tagJson.forEach(function(k, v) {
        //console.log('k:' + k + ' , v:' + v);
        //<p class="bg-success"><i style="padding-left:10px;padding-right:10px" class="ace-icon fa fa-check"></i>CentOS</p>
        $dockertemplatetagselector.append('<option value="' + tagJson[v].name + '">' + tagJson[v].name + '</option>');
        if (v >= tagJson.length - 1) {
          $('#btnaddDockerTemplateToTable').removeAttr('disabled');
        }
      });
      $dockertemplatetagselector.change();
    }
  });
}

function imagechanged() {
  $('#btnaddDockerTemplateToTable').attr('disabled', 'disabled');
  $('#dockertemplateSpinner').removeClass('hidden');
  $('#dockertemplatetagselector').empty().val('');
  if($('#dockertemplateselector option:selected').attr('reponame') == '')
    $('#dockertemplateselector option:selected').attr('reponame','null');

  //alert('url:' + '/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'));
  $.get('/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'), function(data) {
    $('#dockertemplateSpinner').addClass('hidden');
    if (data) {
      var tagJson = JSON.parse(data);
      var $dockertemplatetagselector = $('#dockertemplatetagselector');
      $dockertemplatetagselector.empty();
      tagJson.forEach(function(k, v) {
        $dockertemplatetagselector.append('<option value="' + tagJson[v].name + '">' + tagJson[v].name + '</option>');
        if (v >= tagJson.length - 1) {
          $('#btnaddDockerTemplateToTable').removeAttr('disabled');
        }
      });
      $dockertemplatetagselector.change();
    }
    
  });
}


function removeimage(what, index) {
  //alert(what + index);
  bootbox.confirm("Remove docker image?", function(result) {
    if (!result) {
      return;
    }
    var $lnk = $('#' + what + index);
    var row = $lnk.closest('.dockerimagesrow');
    row.detach();
    renumberDockerImageTable();
    //Add empty message when no rows found
    updatecompositedockertableemptymessage();
  });
}

function renumberDockerImageTable() {
  var $cdt = $('#compositedockertable').find('tr').each(function(i) {
    $(this).find('td').first().html(i);
  });

}

function movetablerow(what, index) {
  // alert('hit ' + what + index);
  var $lnk = $('#' + what + index);
  // var $row = $lnk.parent().parent().parent(); //current row
  // if (what === "dockerimageselectorup") {
  //     $row.insertBefore($row.prev());
  // } else if (what === "dockerimageselectordown") {
  //     $row.insertAfter($row.next());
  // } 
  var row = $lnk.closest('.dockerimagesrow');
  if (what === "dockerimageselectorup") {
    var prev = row.prev();
    if (prev.is('tr.dockerimagesrow')) {
      row.detach();
      prev.before(row);
      row.fadeOut();
      row.fadeIn();
    }
  } else {
    var next = row.next();
    if (next.is('tr.dockerimagesrow')) {
      row.detach();
      next.after(row);
      row.fadeOut();
      row.fadeIn();
    }
  }
  renumberDockerImageTable();
}


function loadLaunchParams(lpinput) {
  $('[dockerparamkey]').val('');
  if ($('#' + lpinput).val() != '') {
    //filling in -exec and -c 
    var fullparams = $('#' + lpinput).val();
    var execparam = fullparams.split(' -exec');
    var startupparam;
    if (execparam.length > 0 && typeof execparam[1] != "undefined") {
      // alert(execparam[1]);
      $('#additionalStartupcommandfield').val(execparam[1]);
      if (execparam[0].indexOf('-c') > 0) //found a startup command
      {
        startupparam = execparam[0].split(' -c');
        if (startupparam.length > 0) {
          $('#Startupcommandfield').val(startupparam[1]);
          fullparams = startupparam[0];
        } else {
          fullparams = startupparam[0];
        }
      } else
        fullparams = execparam[0];
    } else {
      startupparam = fullparams.split(' -c');
      if (startupparam.length > 0) {
        $('#Startupcommandfield').val(startupparam[1]);
        fullparams = startupparam[0];
      }
    }


    var params = fullparams.split(' -');
    for (para in params) {
      var subparam = params[para].split(' ');
      if (subparam.length > 0) {
        $inp = $('[dockerparamkey="-' + subparam[0] + '"]').first();
        if ($inp.val() != '')
          $inp.val($inp.val() + ',' + subparam[1]);
        else
          $inp.val(subparam[1]);
      }
    }
  }

  //alert(lpinput);
  $('#myModalLabelDockerContainer').attr('saveto', lpinput).modal('show');
}

function helperConstructOption(data, keyList, nameKey, valueKey) {
  function getOptionAppend(obj, keyList, nameKey, valueKey) {
    var str = '<option ';
    for (var i = 0; i < keyList.length; i++) {
      str = str + keyList[i] + '="' + obj[keyList[i]] + '" ';
    }
    str = str + 'value="' + obj[valueKey] + '" >' + obj[nameKey] + '</option>';
    return str;
  }

  var str = ''
  for (var i = 0; i < data.length; i++) {
    str = str + getOptionAppend(data[i], keyList, nameKey, valueKey);
  }
  return str;
}

function getProviderListold() {
  $.ajax({
    type: "GET",
    url: "/aws/providers",
    success: function(data) {
      data = typeof data == "string" ? JSON.parse(data) : data;
      console.log(data);
      var str = ' <option value="">Select Provider</option>',
        len = data.length;
      str = str + helperConstructOption(data, ['secretKey', 'accessKey', 'providerType'], 'providerName', '_id');
      $('#providerId').html(str);
    },
    failure: function(data) {
      alert(data.toString());
    }
  });
}

function getProviderList() {
  $.ajax({
    type: "GET",
    url: "/aws/providers",
    success: function(data) {
      data = typeof data == "string" ? JSON.parse(data) : data;
      console.log(data);
      var str = ' <option value="">Select Provider</option>',
        len = data.length;
      str = str + helperConstructOption(data, ['secretKey', 'accessKey', 'providerType'], 'providerName', '_id');
      //getting openstack provider list
      //alert('in');
      $.ajax({
        type: "GET",
        url: "/openstack/providers",
        success: function(data) {
          data = typeof data == "string" ? JSON.parse(data) : data;
          console.log(data);
          // alert(JSON.stringify(data));
          len = data.length;
          str += helperConstructOption(data, ['username', 'password', 'providerType'], 'providerName', '_id');

          $('#providerId').html(str);
          $("#providerId > option").each(function() {
            if ($(this).attr('providertype')) {
              if ($(this).attr('providertype') != providerselected.toUpperCase()) {
                $(this).detach();
              }
            }
          });
        },
        failure: function(data) {
          alert(data.toString());
        }
      });

      //end of openstack 

    },
    failure: function(data) {
      alert(data.toString());
    }
  });

}


function getImagesWithOSFilter() {

  function getFilteredList(data, value) {
    if (!value) {
      return data;
    }
    var list = [];
    for (var i = 0; i < data.length; i++) {
      if (data[i].osName.toLowerCase() === value.toLowerCase()) {
        list.push(data[i]);
      }
    }
    console.log(list);
    return list;
  }


  function loadData() {
    //alert(providerselected);
    var providerVal = $('#providerId').val();
    if (providerVal) {
      $.get("/vmimages/providers/" + providerVal, function(data) {
        var str = ' <option value="">Select Image</option>',
          data = getFilteredList(data, $('#instanceOS').val()),
          len = data.length;
        str = str + helperConstructOption(data, ['providerId', 'vType', 'osType', '_id'], 'name', 'imageIdentifier');
        $('#imageId').html(str);

        //setting image value for ami type and disabling it- vn
        if ($('.productdiv2.role-Selected').first().attr('templatetype') == 'ami') {
          var vmimage = JSON.parse($('.productdiv2.role-Selected').first().attr('imagedata'));
          $('#imageId').val(vmimage.imageIdentifier).attr('disabled', 'disabled');
        }
        //setting the selection
        $('#imageId').select2().trigger('change');
      });
    } else {
      $('#imageId').html('<option value="">Select Image</option>').select2().trigger('change');
    }

    if (providerselected == 'openstack') {
      $('.foraws').hide();
      $('.foropenstack').show();
      $('.foraws select').removeClass('required'); //removing all aws required fields. when openstatck
      //load each of the dropdowns
      //flavour
      $.get('/openstack/' + providerVal + '/flavors', function(data) {
        if (data) {
          var str = ' <option value="">Select Flavors</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.flavors.length; i++) {
            str += '<option value="' + data.flavors[i].id + '">' + data.flavors[i].name + '</option>';
            //alert(str);
          }
          $('#openstackflavour').html(str);
          $('#openstackflavour').select2().trigger('change');
        }
      });

      $.get('/openstack/' + providerVal + '/networks', function(data) {
        if (data) {
          var str = ' <option value="">Select Network</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.networks.length; i++) {
            str += '<option value="' + data.networks[i].id + '" subnets="' + data.networks[i].subnets.join() + '">' + data.networks[i].name + '</option>';
            //alert(str);
          }
          $('#openstacknetwork').html(str);
          $('#openstacknetwork').select2().trigger('change');
          $('#openstacknetwork').on('change', function() {
            // alert($(this).find(':selected').attr('subnets'));
            var ss = ' <option value="">Select Subnet</option>';
            var subn = $(this).find(':selected').attr('subnets').split(',');

            for (var i = 0; i < subn.length; i++) {
              ss += '<option value="' + subn[i] + '">' + subn[i] + '</option>';
            }

            $('#openstacksubnet').html(ss);
            $('#openstacksubnet').select2().trigger('change');
          });
        }
      });

      $.get('/openstack/' + providerVal + '/securityGroups', function(data) {
        if (data) {
          var str = ' <option value="">Select Group</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.security_groups.length; i++) {
            str += '<option value="' + data.security_groups[i].id + '">' + data.security_groups[i].name + '</option>';
            //alert(str);
          }
          $('#openstacksecuritygroup').html(str);
          $('#openstacksecuritygroup').select2().trigger('change');
        }
      });

    } else {
      $('.foraws').show();
      $('.foropenstack').hide();
      $('.foraws select').addClass('required'); //to be tested.
    }
  }

  $('#providerId').on('change', loadData);
  $('#instanceOS').on('change', loadData);
}


function getSecurityCheckedList() {
  var list = []
  $('#securityGroupIds').find('input[type="checkbox"]:checked').each(function() {
    list.push(this.value);
  });

  return list;
}

function getImageInstances() {
  $('#imageId').on('change', function() {
    $.get("/vmimages/instancesizes/all/list", function(data) {
      var vType = $('#imageId').find('option:selected').attr('vType'),
        str = '<option value=""> Select Instance Size</option>';
      var list = [];

      for (var i = 0; i < data.length; i++) {
        for (var key in data[i]) {
          if (vType == key) {
            list = data[i][key];
            break;
          }
        }
      }
      for (var i = 0; i < list.length; i++) {
        str = str + '<option value="' + list[i] + '">' + list[i] + '</option>'
      }
      $('#instancesize').html(str).select2();

    });

  });
}
var regionList;

function getCompleteRegionList() {
  $.get('/vmimages/regions/list', function(data) {
    regionList = data;
  });
}
getCompleteRegionList();


function getSecurityGroup() {

  function bringAllOpenFirst(data) {
    var temp, index;
    for (var i = 0; i < data.length; i++) {
      if (data[i].GroupName == "all_open") {
        temp = data[i];
        index = i;
        break;
      }
    }
    if (temp) {

      data[index] = data[0];
      data[0] = temp;
    }
    return data;
  }

  function populateData() {
    var $provider = $('#providerId');
    var accessKey = $provider.find("option:selected").attr('accessKey');
    secretKey = $provider.find("option:selected").attr('secretKey');
    region = $('#region').val();
    vpcId = $('#vpcId').val();
    var $spinnerSecurityGroup = $('#spinnerSecurityGroup').addClass('hidden');
    if (accessKey && secretKey && region && vpcId) {
      $spinnerSecurityGroup.removeClass('hidden');
      $.ajax({
        url: '/aws/providers/vpc/' + vpcId + '/securitygroups',
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(list) {

          var str = '',
            getTemplate = function(val, name) {
              return '<label class="toggle font-sm" style="padding-left:4px;"><input onclick="if($(this).is(&quot;:checked&quot;)) {$(this).closest(&quot;label&quot;).' +
                'css(&quot;background-color&quot;,&quot;#eeeeee&quot;);$(this).css(&quot;border-color&quot;,&quot;#3b9ff3&quot;);}else{$(this).closest(&quot;label&quot;).css(&quot;background-color&quot;,&quot;#ffffff&quot;);$(this).css(&quot;border-' +
                'color&quot;,&quot;red&quot;);}" type="checkbox" id="checkbox-toggle" name="checkbox-toggle" rowid="1ae4f099-7adc-4089-81c6-db2248774142"' +
                'value="' + val + '" style="width:100%"><i data-swchoff-text="NO" data-swchon-text="YES"></i>' + name + '</label>';
            },
            list = bringAllOpenFirst(list),
            len = list.length;
          for (var i = 0; i < len; i++) {
            str = str + getTemplate(list[i].GroupId, list[i].GroupId + ' | ' + list[i].GroupName);
          }
          $spinnerSecurityGroup.addClass('hidden');
          $('#securityGroupIds').html('').append(str);

        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#securityGroupIds').html('');
    }
  }

  $('#vpcId').on('change', populateData);
}

function getkeypairList() {
  function getRegionName(regionValue) {
    for (var i = 0; i < regionList.length; i++) {
      if (regionList[i].region.toLowerCase() == regionValue.toLowerCase()) {
        return regionList[i].region_name;
      }
    }
  }
  $('#providerId').on('change', function() {

    var key = $(this).val();
    if (key) {
      $.get('/aws/providers/' + key, function(data) {
        var keylist = data.keyPairs;
        var str = '<option value="">Select KeyPairs</option>';

        for (var i = 0; i < keylist.length; i++) {
          str = str + '<option value="' + keylist[i]._id + '">' + keylist[i].keyPairName + '</option>';
        }
        $('#keypairId').html(str).select2();

        /*bring Region list from providers*/
        var str1 = '<option value="">Select Region</option>';
        for (var i = 0; i < keylist.length; i++) {
          str1 = str1 + '<option value="' + keylist[i].region + '">' + getRegionName(keylist[i].region) + ' | ' + keylist[i].region + '</option>';
        }
        $('#region').html(str1).select2();

      });
    }

  });
}

function getVPC() {

  function populateData() {
    var $provider = $('#providerId');
    var $spinner = $('#vpcSpinner').addClass('hidden');
    var accessKey = $provider.find("option:selected").attr('accessKey'),
      secretKey = $provider.find("option:selected").attr('secretKey'),
      region = $('#region').val();


    if (accessKey && secretKey && region) {
      //alert('region');
      $spinner.removeClass('hidden');
      $.ajax({
        url: "/aws/providers/describe/vpcs",
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(data) {

          console.log(data);
          var str = '';
          var filteredData = [];
          for (var i = 0; i < data.Vpcs.length; i++) {
            if (data.Vpcs[i].State.toLowerCase() == "available") {
              filteredData.push(data.Vpcs[i]);
            }
          }
          for (var i = 0; i < filteredData.length; i++) {
            if (filteredData[i].IsDefault) {
              str = str + '<option selected value="' + filteredData[i].VpcId + '">' + filteredData[i].VpcId + ' (' + filteredData[i].CidrBlock + ') Default</option>';
            } else {
              str = str + '<option value="' + filteredData[i].VpcId + '">' + filteredData[i].VpcId + ' (' + filteredData[i].CidrBlock + ') ' +
                (filteredData[i].Tags.length ? filteredData[i].Tags[0].Value : "") + '</option>';
            }
          }
          $('#vpcId').html(str).select2().trigger('change');
          $spinner.addClass('hidden');
        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#vpcId').html('<option value="">Select VPC</option>').select2()
    }
  }

  $('#providerId').on('change', populateData);
  $('#region').on('change', populateData);
}

function getSubnet() {
  function populateData() {
    var $provider = $('#providerId');
    var $spinnerSubnet = $('#spinnerSubnet').addClass('hidden');
    var accessKey = $provider.find("option:selected").attr('accessKey'),
      secretKey = $provider.find("option:selected").attr('secretKey'),
      region = $('#region').val(),
      vpcId = $('#vpcId').val();
    if (accessKey && secretKey && region && vpcId) {
      $spinnerSubnet.removeClass('hidden');
      $.ajax({
        url: "/aws/providers/vpc/" + vpcId + "/subnets",
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(data) {
          console.log(data);
          var str = '<option value="">Select Subnet</option>';
          var filteredData = [];
          for (var i = 0; i < data.Subnets.length; i++) {
            if (data.Subnets[i].State.toLowerCase() == "available") {
              filteredData.push(data.Subnets[i]);
            }
          }
          for (var i = 0; i < filteredData.length; i++) {
            str = str + '<option value="' + filteredData[i].SubnetId + '">' + filteredData[i].SubnetId + ' (' + filteredData[i].AvailabilityZone + ') ' +
              (filteredData[i].Tags.length ? filteredData[i].Tags[0].Value : "") + '</option>';

          }
          $spinnerSubnet.addClass('hidden');
          $('#subnetId').html(str).select2();
        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#subnetId').html('<option value="">Select Subnet</option>').select2()
    }
  }

  $('#vpcId').on('change', populateData);
}

function resetForm() {
  $('[multiselect]').empty();
}


var blueprintstartup = function() {
  openStackLoadData();
  getProviderList();
  getImageInstances();
  getSecurityGroup();
  getkeypairList();
  getVPC();
  getSubnet();
  getImagesWithOSFilter();

  console.log("Orgname===>" + localStorage.getItem('selectedOrgName'));
  $.get('../aws/ec2/amiids', function(data) {
    var $instanceOS = $('#instanceOS');
    $instanceOS.append('<option value="">Select Operating System</option>')
    for (var i = 0; i < data.length; i++) {
      $option = $('<option data-instanceOS="' + data[i].osType + '" value="' + data[i].os_name + '">' + data[i].os_name + '</option>');
      $option.data('supportedInstanceType', data[i].supportedInstanceType);
      $instanceOS.append($option);
    }
    var $instanceType = $('#intanceTypeControl');
    $instanceOS.change(function(e) {
      $instanceType.empty();

      $selectedOption = $(this).find('option:selected');
      var supportedInstanceType = $selectedOption.data('supportedInstanceType');
      console.log(supportedInstanceType);
      if (typeof supportedInstanceType != 'undefined') {
        for (var i = 0; i < supportedInstanceType.length; i++) {
          var $option = $('<option></option>').val(supportedInstanceType[i]).html(supportedInstanceType[i]);
          $instanceType.append($option);
        }
      }
      $instanceType.select2();


    });
    $instanceOS.select2();
    $instanceOS.trigger('change');

  });

  $(".chooseOrgselect2").select2();
  $(".chooseOS").select2();
  $(".chooseOSProvider").select2();
  $(".chooseSecurity").select2();
  $(".chooseInstance").select2();
  $(".chooseBG").select2();
  $(".chooseProject").select2();
  $(".chooseEnv").select2();
  $(".chooseDockerContainer").select2();
  $(".chooseSelectExit").select2();

  var sortbyid = function SortByID(x, y) {
    return x.position - y.position;
  }

  $('#selectOrgName').change(function(e) {
    openStackLoadData();
  });

  function openStackLoadData() {
    $.get('/d4dMasters/readmasterjsonnew/16', function(data) {
      data = JSON.parse(data);
      var rowLength = data.length;
      var containerTemp = "";
      var selectedrow = false;
      var getDesignTypeImg;
      var getDesignTypeRowID;

      for (var i = 0; i < rowLength; i += 1) {
        switch (data[i]['templatetype']) {
          case "chef":
            data[i]['position'] = 0;
            break;
          case "ami":
            data[i]['position'] = 1;
            break;
          case "arm":
            data[i]['position'] = 2;
            break;
          case "docker":
            data[i]['position'] = 3;
            break;
        }
      }
      data.sort(sortbyid);

      var selectCheck = $('#selectOrgName').val();
      $('#orgIDCheck').val(selectCheck);
      for (var i = 0; i < rowLength; i += 1) {
        $("#templateContent").empty();
        if (providerselected && providerselected == 'openstack' && data[i]['templatetype'] && data[i]['templatetype'] == 'cft' || data[i]['templatetype'] == 'arm' || data[i]['templatetype'] == 'composite')
          continue;
        getDesignTypeImg = data[i]['templatetype'];
        if (selectCheck == data[i].orgname_rowid) {
          switch (data[i].templatetype) {
            case "chef":
              getDesignTypeImg = '/d4dMasters/image/16ae9c94-19f6-485a-8c17-9af7a0f5f23d__designtemplateicon__Appfactory.png';
              break;
            case "ami":
              getDesignTypeImg = '/d4dMasters/image/9d14d362-493e-4d62-b029-a6761610b017__designtemplateicon__DevopsRoles.png';
              break;
            case "docker":
              getDesignTypeImg = '/d4dMasters/image/b02de7dd-6101-4f0e-a95e-68d74cec86c0__designtemplateicon__Docker.png';
              break;
            case "arm":
              getDesignTypeImg = '/d4dMasters/image/4fdda07b-c1bd-4bad-b1f4-aca3a3d7ebd9__designtemplateicon__Cloudformation.png';
              break;
          }
          getDesignTypeRowID = data[i]['rowid'];
          if (getDesignTypeImg) {
            if (getDesignTypeImg.indexOf('/d4dMasters/image') === -1) {
              getDesignTypeImg = "/d4dMasters/image/" + getDesignTypeRowID + "__designtemplateicon__" + getDesignTypeImg;
            }
            containerTemp += '<div class="" style="width:222px;float:left">' + ' <div id=grid' + i + ' class="blueprintdiv appfactory" data-' + 'templateType="' + data[i]
              ['templatetypename'] + '" data-gallerytype="' + data[i]['templatetype'] + '">' + '<div style="">' +
              '<img  style="height:25px;padding:2px" alt="" src="img/app-store-' + 'icons/Logoheader.png"><span style="padding-top:4px;position:absolute;' +
              'padding-left: 4px;">' + '<b>' + data[i]['templatetypename'] + '</b>' + '</span></div>' +
              '<div style="padding-top:10px;padding-left:0px;text-align:center;">' + '<img alt="Template Icon" ' + 'src="' + getDesignTypeImg +
              '" style="height:60px;width:auto;">' + '</div></div></div>';
          } else {
            containerTemp += '<div class="" style="width:222px;float:left">' + ' <div id=grid' + i + ' class="blueprintdiv appfactory" data-' + 'templateType="' + data[i]
              ['templatetypename'] + '" data-gallerytype="' + data[i]['templatetype'] + '">' + '<div style="">' +
              '<img  style="height:25px;padding:2px" alt="" src="img/app-store-' + 'icons/Logoheader.png"><span style="padding-top:4px;position:absolute;' +
              'padding-left: 4px;">' + '<b>' + data[i]['templatetypename'] + '</b>' + '</span></div>' + '<div style="padding-top:10px;padding-left:27px;">' +
              '<img style="height:40px;width:auto;" alt="" ' + 'src="img/logo.png">' + '</div></div></div>';
          }
        }
      }
      $("#templateContent").append(containerTemp);
      $("#templateContent #grid0").addClass("role-Selected");
    });
  };

  $('#templateContent').on("click", '.blueprintdiv', function() {
    $('#templateContent .role-Selected').removeClass('role-Selected');
    $(this).addClass('role-Selected');

  });
  $('#individualTemplateNameGrid').on("click", '.productdiv2', function() {
    if (!$(this).hasClass('role-Selected')) {
      $('#individualTemplateNameGrid').find('.role-Selected').removeClass('role-Selected');
      $(this).addClass('role-Selected');
      resetForm();
    }
  });
}

var reqBody;
var $wizard = $('#bootstrap-wizard-1').bootstrapWizard({
  'tabClass': 'form-wizard',
  'onNext': function(tab, navigation, index) {

    console.log(navigation, index)
    if (index === 1) {
      $('#viewCreateNew').addClass('hidden');
      $('#selectOrgName').attr('disabled', true);
      $("#tabheader").html('Choose Templates');
      var $selectedItem = $('.role-Selected');
      if (!$selectedItem.length) {
        alert('please choose a blueprint design');
        return false;
      }
      var $clone = $selectedItem.clone().removeClass('role-Selected');
      var selectedText = $clone.attr("data-templateType");
      //hiding to move to next tag when docker selected
      $('#individualTemplateNameGrid').hide();
      var getID = parseInt($clone.attr("id").replace("grid", ""), 10);
      var gallerytype = $clone.attr("data-gallerytype");
      var templateurl = "/d4dMasters/readmasterjsonnew/17";
      if (gallerytype == 'ami') {
        // alert('to build a new selection by updating the url');
        templateurl = '/vmimages';
      }
      $.ajax({
        url: templateurl,
        dataType: "json",
        type: "GET",
        cache: "true",
        success: function(data) {
          console.log('templateData ==> ', data);
          var rowGridLength = (data.length);
          var getIndividualData = "";
          var getTempName;
          var getRowID, getImage;
          //alert(JSON.stringify(data));
          //alert('check');
          for (var z = 0; z < rowGridLength; z += 1) {

            if (gallerytype == 'ami') {

              getRowID = data[z]['_id'];

              getTemplateType = data[z]['osType'];
              getImage = 'img/osIcons/' + getTemplateType + '.png';
              getTempName = data[z]['name'];
              getImageData = '\'' + JSON.stringify(data[z]) + '\'';
              //alert(getImageData);
              if(data[z]['providerType'] && data[z]['providerType'] == 'openstack') //fix to only display images for openstack
              {
              getIndividualData += '<div class="col-sm-3 col-lg-2 col-md-3">' +
                '<div class="productdiv2" data-templateId="' + getTempName + '" data-' +
                'templateComponent="component' + z + '" ' +
                'imagedata=' + getImageData +
                'data-templateName="' + getTempName + '" data-' +
                'templateType="' + gallerytype + '" templatetype="' + gallerytype + '" templatename="' + getTempName + '" templatescookbooks="">' +
                '<ul class="list-unstyled system-prop" style="text-align:center;">' +
                '<li><img style="height:40px;width:auto;" alt="" ' +
                'src="' + getImage + '">' +
                '</li><li style="font-size:12px;"><u><b>' + getTempName + '</b></u></li></ul></div></div>';
              }
              if (z >= rowGridLength - 1) {
                $('#individualTemplateNameGrid').show();
              }
              continue;
            }


            //iterate thhrough columns to get correct column and value
            var selectedrow = false;
            var currField = null;

            getTempName = data[z]['templatename'];


            getRowID = data[z]['rowid'];
            getImage = data[z]['templatesicon_filename'];
            getTemplateType = data[z]['templatetypename'];
            console.log(getTemplateType);

            if (selectedText.trim() != getTemplateType.trim())
              continue;

            gettemplatescookbooks = data[z]['templatescookbooks'].replace(/"/g, "");
            dockercontainerpathstitle = data[z]['dockercontainerpathstitle'];
            dockercontainerpaths = data[z]['dockercontainerpaths'];
            dockerreponame = data[z]['dockerreponame'];
            //To be removed and converted to reference when the new master model is implemented.
            dockerusername = '';
            dockercred = '';
            dockeremail = '';


            console.log('here end ' + dockercontainerpathstitle);
            //added to the docker template adder pop-up : Vinod
            $('#dockertemplateselector').append('<option value="' + dockercontainerpaths + '" title="' + dockercontainerpaths + '" reponame="' + dockerreponame + '">' + getTempName  + '</option>'); //dockercontainerpathstitle

            var templateImgUrl = "img/logo.png";
            if (getImage) {
              templateImgUrl = "/d4dMasters/image/" + getRowID + "__templatesicon__" + getImage
            }
            var templateFileName = ''
            if (data[z]['template_filename']) {
              templateFileName = getRowID + '__template__' + data[z]['template_filename'];
            }
            getIndividualData += '<div class="col-sm-3 col-lg-2 col-md-3">' +
              '<div class="productdiv2" data-templateId="' + getTempName + '" data-' +
              'templateComponent="component' + z + '" ' +
              'dockercontainerpathstitle="' + dockercontainerpathstitle + '" ' +
              'dockercontainerpaths="' + dockercontainerpaths + '" ' +
              'dockerreponame="' + dockerreponame + '" ' +
              'data-templateName="' + getTempName + '" data-' +
              'templateType="' + gallerytype + '" templatetype="' + getTemplateType + '" templatename="' + getTempName + '" templatescookbooks="' + gettemplatescookbooks + '" cftTemplateFileName="' + templateFileName + '">' +
              '<ul class="list-unstyled system-prop" style="text-align:center;">' +
              '<li><img style="height:40px;width:auto;" alt="" ' +
              'src="' + templateImgUrl + '">' +
              '</li><li style="font-size:12px;"><u><b>' + getTempName + '</b></u></li>';

            if (getTemplateType != "Docker" && getTemplateType != "docker") {
              var cb = $chefCookbookRoleSelector.getRunlistNames(gettemplatescookbooks.split(','));
              var licb = '';
              //alert(cb.length);
              for (var cbi = 0; cbi < cb.length; cbi++) {
                licb += '<li style="font-size:10px;" blueprinttype="other">' + cb[cbi] + '</li>';
              }
              $('#individualTemplateNameGrid').show();
            } else //when template type is docker
            {
              //  alert(dockerreponame);
              var cb = dockercontainerpathstitle.split(',');
              var cbpath = dockercontainerpaths.split(',');
              var licb = '';
              //alert(cb.length);
              for (var cbi = 0; cbi < cb.length; cbi++) {
                licb += '<li style="font-size:10px;" path="' + cbpath[cbi] + '" title="Container" blueprinttype="dockercontainer">' + cb[cbi] + '</li>';
              }
              $('#individualTemplateNameGrid').hide();
            }

            getIndividualData += licb + '</ul></div></div>';


          }
          $("#individualTemplateNameGrid").html("").css('display','block');
          //$("#individualTemplateNameGrid").append(getParent);
          $("#individualTemplateNameGrid").append(getIndividualData).find('.productdiv2').first().click();
          
          var wizard = $wizard.data('bootstrapWizard');
          if ($('#individualTemplateNameGrid').children('div').length) {
            wizard.enableNextBtn();
          } else {
            bootbox.alert({
              message: "There are no templates available. Navigate to Settings to add a few.",
              title: "Warning"
            });
            wizard.disableNextBtn();
          }
        }


      });
      $('#tab' + (index + 1)).find('.temp').empty().append($clone);
      $('.' + $selectedItem.attr('data-templateType')).find('.productdiv2:first').trigger('click');

    } else if (index == 2) {
      $("#tabheader").html('Choose Template');
      getProviderList();
      //If a docker type of template selected then select the Org 
      var $selectedItem = $('.role-Selected');
      if (!$selectedItem.length) {
        alert('please choose a blueprint design');
        return false;
      }
      //Selection of Orgname from the org selected. Fix for CAT -1885
      $('#orgnameSelect').val($('#orgIDCheck').val());
      console.log('role-Selected before ==> ', $('#tab2 .role-Selected').length);
      if ($('.productdiv2.role-Selected').length > 0) {
        //Setting controls connected to docker to hidden
        $('.forDocker').hide();
        $('.notForDocker').show();
        $('.forCFT').hide();

        $('.cookbookShow').parent().show();
        //createRunlistTable(runlist);
        $('.divconfigureparameterrunlist').show();
        $('.divchefrunlist').show();

        if ($('.productdiv2.role-Selected').first().attr('templatetype') == "Docker" || $('.productdiv2.role-Selected').first().attr('templatetype') == "docker") {
          //Checking if docker then only Edit organization paramerters are to be shown
          //Checking if docker then only Edit organization paramerters are to be shown
          //Inserting the selected template to the docker image list
          var $dockerdiv = $('#tab2').find('.productdiv2.role-Selected').first();
          $('.dockerimagesrow').detach();
          addDockerTemplateToTable($dockerdiv.attr('templatename'), $dockerdiv.attr('dockercontainerpaths'), 'latest', $dockerdiv.attr('dockerreponame'), '--name ' + $dockerdiv.attr('templatename'));

          if (!$('#CollapseEditorgParam').hasClass('in')) {
            $('a[href="#CollapseEditorgParam"]').click();
          }
          $('div.selectedTemplateArea').first().addClass('hidden').parent().addClass('hidden'); //hiding card view in template
          $('.divconfigureparameterrunlist').hide();
          $('.divchefrunlist').hide();
          //When docker stepping to 4th tab

          $('#orgnameSelect').trigger('change');
          //$('a[href="#tab3"]').first().trigger('click');

          //populating the docker repo titles
          var $dockerrepotitles = $('.productdiv2.role-Selected').attr('dockercontainerpathstitle').split(',');
          var $dockerrepopaths = $('.productdiv2.role-Selected').attr('dockercontainerpaths').split(',');
          var $dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');
          var $dockerrepoListInput = $('#dockerrepoListInput');
          $dockerrepoListInput.empty();

          $dockerrepotitles.forEach(function(k, v) {
            var $opt = $('<option value="' + $dockerrepotitles[v] + '" repopath="' + $dockerrepopaths[v] + '">' + $dockerrepotitles[v] + '</option>');
            $dockerrepoListInput.append($opt);
          });
          updatecompositedockertableemptymessage();
          //Setting the appropriate tags
          //Attaching the change event to pull tags for the select repo
          $dockerrepoListInput.change(function(e) {
            //tutum/centos
            //alert('Docker Query -> ' +  '/d4dmasters/getdockertags/' + encodeURIComponent($(this).find('option:selected').attr('repopath')) + '/' + $dockerreponame);
            $.get('/d4dmasters/getdockertags/' + encodeURIComponent($(this).find('option:selected').attr('repopath')) + '/' + $dockerreponame, function(data) {
              //Sample json given below
              //[{"layer": "cddde0cd", "name": "latest"}, {"layer": "3baf8932", "name": "6.4"}, {"layer": "d1c0a07f", "name": "6.5"}, {"layer": "a9dd9e89", "name": "centos5"}, {"layer": "02398e09", "name": "centos6"}, {"layer": "4e5b3b2f", "name": "centos7"}]

              if (data) {
                var tagJson = JSON.parse(data);
                var $dockerrepotagsdiv = $('#dockerrepotagsdiv');

                $dockerrepotagsdiv.empty();
                var dockerrepotags = [];
                tagJson.forEach(function(k, v) {
                  //<p class="bg-success"><i style="padding-left:10px;padding-right:10px" class="ace-icon fa fa-check"></i>CentOS</p>
                  if (v < 3) {
                    $('#dockerrepotagsdiv').append('<div class="codelistitem" style="margin-top:2px;padding-top:2px;border:1px solid #eeeeee; background-color:#eeeeee !important;height:26px;"><p class="bg-success"><i style="padding-left:10px;padding-right:10px" class="ace-icon fa fa-check"></i>' + tagJson[v].name + '</p></div>');
                    if (dockerrepotags == '')
                      dockerrepotags += tagJson[v].name;
                    else
                      dockerrepotags += ',' + tagJson[v].name;
                  }
                  //limiting the number to the top 5
                });
                $('.productdiv2.role-Selected').first().attr('dockerrepotags', dockerrepotags);
                $('.productdiv2.role-Selected').first().attr('dockerimagename', $dockerrepoListInput.val());
              }
            });
          });
          //dockerrepotagsul
          $dockerrepoListInput.trigger('change');

          //End Setting appropriate tags
          //polulate the docker tags
          var $dockerrepotagsul = $('#dockerrepotagsul');
          $('.forDocker').show();
          $('.notForDocker').hide();
          //return (true);
          //return (true);
        } else if ($('.productdiv2.role-Selected').first().attr('templatetype') == "CloudFormation") {
          $('.notforCFT').hide();
          $('.forCFT').show();
          $('.divconfigureparameterrunlist').hide();
          $('.divchefrunlist').hide();
          if (!$('#CollapseEditorgParam').hasClass('in')) {
            $('a[href="#CollapseEditorgParam"]').click();
          }
          var $panelBody = $('#CollapseStackParameters').find('.panel-body').empty();;
          var cftTemplateFileName = $('.productdiv2.role-Selected').attr('cftTemplateFileName');



          $panelBody.append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');


          $.ajax({
            type: "GET",
            url: "/aws/providers",
            success: function(data) {
              data = typeof data == "string" ? JSON.parse(data) : data;
              console.log(data);
              var providerStr = '<option value="">Select Provider</option>';
              for (var i = 0; i < data.length; i++) {
                if (data[i].providerType === 'AWS') {
                  providerStr = providerStr + '<option value="' + data[i]._id + '">' + data[i].providerName + '</option>';
                }
              }
              var $providerInput = $('<select id="cftProviderInput" class="form-control"></select>').append(providerStr);
              var $providerInputContainer = $('<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel">Choose Provider</span></label><div class="input-groups"></div></div>');
              $providerInputContainer.find('.input-groups').append($providerInput);

              $.get('/vmimages/regions/list', function(regionList) {

                regionList = typeof regionList == "string" ? JSON.parse(regionList) : regionList;
                var regionOptStr = '<option value="">Select Region</option>';
                for (var i = 0; i < regionList.length; i++) {
                  regionOptStr = regionOptStr + '<option value="' + regionList[i].region + '">' + regionList[i].region_name + '</option>';

                }
                var $regionInput = $('<select id="cftRegionInput" class="form-control"></select>').append(regionOptStr);
                var $regionInputContainer = $('<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel required">Choose Region</span></label><div class="input-groups"></div></div>');
                $regionInputContainer.find('.input-groups').append($regionInput);



                $.get('/d4dMasters/cftTemplate?templateFile=' + cftTemplateFileName, function(data) {

                  var templateData = {};
                  try {
                    templateData = JSON.parse(data);
                  } catch (err) {
                    console.log(err);
                    bootbox.alert("Invalid template file");
                    // var wizard = $wizard.data('bootstrapWizard');
                    // wizard.disableNextBtn();
                    return;
                  }
                  // var formHtmlDivHtml = '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label for="">Instance Username: <span class="control-label redSpan">&nbsp;*</span></label><div class="input-groups"><input id="cftStackInstanceUsernameInput" class="form-control" type="text" autofocus="autofocus" aria-required="true"></div></div>';
                  var formHtmlDivHtml = '';


                  //                                $panelBody.empty().append(formHtmlDivHtml).append($providerInputContainer).append('<input type="hidden" id="cftTemplateFileInput" value="'+cftTemplateFileName+'"/>');
                  $panelBody.empty().append($regionInputContainer).append($providerInputContainer).append(formHtmlDivHtml).append('<input type="hidden" id="cftTemplateFileInput" value="' + cftTemplateFileName + '"/>');



                  var parameters = templateData.Parameters;
                  if (parameters) {
                    var keys = Object.keys(parameters);
                    for (var i = 0; i < keys.length; i++) {
                      var parameter = parameters[keys[i]];
                      var $parameterInput;
                      if (parameter.AllowedValues) {
                        $parameterInput = $('<select class="cftParameterInput form-control"></select>');
                        for (var j = 0; j < parameter.AllowedValues.length; j++) {
                          var $option = $('<option></option>').val(parameter.AllowedValues[j]).html(parameter.AllowedValues[j]);
                          $parameterInput.append($option);
                        }
                      } else {
                        $parameterInput = $('<input class="cftParameterInput form-control" type="text" autofocus="autofocus">');
                      }
                      if (parameter.Default) {
                        $parameterInput.val(parameter.Default);
                      }
                      $parameterInput.attr('data-cftParameter-type', parameter.type);
                      $parameterInput.attr('data-cftParameter-name', keys[i]);

                      var $inputContainer = $('<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel"></span></label><div class="input-groups"></div></div>');
                      $inputContainer.find('.input-groups').append($parameterInput);
                      $inputContainer.find('.cftParameterLabel').append(keys[i]);

                      if (parameter.Description) {
                        var $desc = $('<span></span>').attr('title', parameter.Description).append('&nbsp;&nbsp;<i class="fa fa-question"/>');
                        $inputContainer.find('.cftParameterLabelContainer').append($desc);
                      }
                      $panelBody.append($inputContainer);

                    }
                  }
                  var resources = templateData.Resources;
                  var resourceKeys = Object.keys(resources);
                  var $panelGroup = $('<div class="panel-group smart-accordion-default col-lg-12 col-md-12" id="cft-resource-editArea" style="margin-top:5px"></div>');

                  var $panel = $('<div class="panel panel-default cft-resource-editPanel"><div class="panel-heading"><h4 class="panel-title"><a class="panel-toggle" data-toggle="collapse" data-parent="#cft-resource-editArea" href="#" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i><span class="heading-text"></span></a></h4></div><div id="CollapseEditorgParam" class="panel-collapse collapse" style="height: auto;"><div class="panel-body" style="padding-left: 8px;"></div></div></div>');

                  var $inputContainerTemplate = $('<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftResourceLabelContainer" for=""><span class="cftResourceLabel"></span></label><div class="input-groups"></div></div>');
                  var $resourceInputTemplate = $('<input class="cftResourceInput form-control" type="text" autofocus="autofocus">');



                  var hasResource = false;

                  // for runlist input
                  var $orgListInput = $('#orgnameSelect');
                  $orgListInput.change(function() {
                    $this = $(this);
                    if ($this.val() === 'choose') {
                      return;
                    }
                    var $ccrs = $chefCookbookRoleSelector($this.val(), function(data) {

                    }, null);

                    $('.cftResourceRunlistInput').empty().append($ccrs).data('$ccrs', $ccrs);
                  });


                  for (var i = 0; i < resourceKeys.length; i++) {
                    if (resources[resourceKeys[i]].Type === "AWS::EC2::Instance") {
                      var $clone = $panel.clone();
                      $clone.find('.heading-text').html('Configure Resource : ' + resourceKeys[i]);
                      $clone.find('.panel-collapse').attr('id', 'cftResource-' + resourceKeys[i]);
                      $clone.find('.panel-toggle').attr('href', '#cftResource-' + resourceKeys[i]);

                      // for username
                      var $inputUsernameContainer = $inputContainerTemplate.clone();
                      var $inputUsername = $resourceInputTemplate.clone();
                      $inputUsername.addClass('cftResourceUsernameInput');
                      $inputUsernameContainer.find('.input-groups').append($inputUsername);
                      $inputUsernameContainer.find('.cftResourceLabel').html('Instance Username');

                      //for resourceLogicalId 
                      var $inputLogicalId = $resourceInputTemplate.clone();
                      $inputLogicalId.addClass('cftResourceLogicalIdInput');
                      $inputLogicalId.attr('type', 'hidden');
                      $inputLogicalId.val(resourceKeys[i]);

                      // for chefRunlist

                      var $inputChefRunlistContainer = $('<div class="col-lg-12 col-md-12 cftResourceRunlistInput"></div>');
                      if ($orgListInput.val().toLowerCase() !== 'choose') {
                        var $ccrs = $chefCookbookRoleSelector($orgListInput.val(), function(data) {

                        }, []);

                        $inputChefRunlistContainer.empty().append($ccrs).data('$ccrs', $ccrs);

                      }



                      $clone.find('.panel-body').append($inputUsernameContainer);
                      $clone.find('.panel-body').append($inputLogicalId);
                      $clone.find('.panel-body').append($inputChefRunlistContainer);



                      $panelGroup.append($clone);
                      hasResource = true;
                    }

                  }
                  if (hasResource) {
                    $panelBody.append($panelGroup);

                  }
                });

              });


            },
            failure: function(data) {
              alert(data.toString());
            }
          });



        } else {
          //setting the instance count drop down
          $('#instanceCount').val("1").select2();
          if ($('.productdiv2.role-Selected').first().attr('templatetype') == "ami") {
            var vmimage = JSON.parse($('.productdiv2.role-Selected').first().attr('imagedata'));
            $('#instanceOS').val(vmimage.osName);
            $('#instanceOS').change().attr('disabled', 'disabled');
            $('#providerId').val(vmimage.providerId);
            $('#providerId').change().attr('disabled', 'disabled');
            $('#orgnameSelect').attr('disabled', 'disabled');
          } else {
            $('#instanceOS').removeAttr('disabled');
            $('#providerId').removeAttr('disabled');

            $('#orgnameSelect').removeAttr('disabled');
          }
          if (!$('#CollapseConfigureproviderParameter').hasClass('in')) {
            $('a[href="#CollapseConfigureproviderParameter"]').click();
          }
        }
      }

      console.log('role-Selected after ==> ', $('#tab2 .role-Selected').length);

      var $clone = $selectedItem.clone().removeClass('role-Selected');
      var selectedText = $clone.attr("data-templateType");
      if ($selectedItem.attr('data-templateType') == 'desktopProvisoning') {
        wizard.show(4);
        return false;
      }
      if ($('#tab2 .role-Selected').length > 0) {
        console.log('cloning');
        $('#tab3 .selectedTemplateArea').empty().append($('#tab2 .role-Selected').clone());
      }
      //force clicking orgnameSelect
      $('#orgnameSelect').trigger('change');
      $(".chooseBG").change();
      $(".chooseBG").select2('data', null);
      $('.chooseProject').select2('data', null)
        // $(".chooseEnv").change();
      $(".chooseDockerContainer").change();
      var validatorForm = $("#wizard-1").validate();
      validatorForm.resetForm();


    } else if (index == 3) {
      if ($wizard.data('secondClick')) {

        return true;
      }
      //alert('before validation');
      var isValid = $('#wizard-1').valid();
      //alert('after validation ' + isValid);
      var tempType = $('.role-Selected').data('templatetype').toLowerCase();


      if (tempType !== "docker" && tempType !== 'cloudformation' && !isValid) {

        bootbox.alert({
          message: "Valiadtion failed. Do check the configuration before submitting.",
          title: "Error"
        });
        return false;

      } else {

        bootbox.confirm({
          message: "Are you sure want to submit this Blueprint Data? Press Ok to Continue",
          title: "Confirm",
          callback: function(result) {
            if (result) {

              $("#tabheader").html('Create Blueprint');
              var $selectedTemplateArea = $('.selectedTemplateArea');
              var $selectedItem = $selectedTemplateArea.find('.productdiv2');
              console.log($selectedItem.length);
              if (!$selectedItem.length) {
                alert('please choose a template');
                return false;
              }

              if ($('#orgnameSelect').val() === 'choose') {
                alert('please choose an Organization');
                return false;
              }


              reqBody = {};
              reqBody.templateId = $selectedItem.attr('data-templateId');
              reqBody.templateType = $selectedItem.attr('data-templateType');
              reqBody.templateComponents = $selectedItem.attr('data-templateComponent').split(',');
              reqBody.dockercontainerpathstitle = $selectedItem.attr('dockercontainerpathstitle');
              reqBody.dockercontainerpaths = $selectedItem.attr('dockercontainerpaths');
              reqBody.dockerlaunchparameters = $('#dockerlaunchparameters').val();
              reqBody.dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');



              //constructing the docker composite json.
              var dockercompose = [];
              var dockerimages = {};
              console.log($('#compositedockertable').find('.dockerimagesrow').length);
              $('.dockerimagesrow').each(function() {
                dockerimages = {};
                $(this).find('[paramtype]').each(function() {
                  console.log($(this).text() + $(this).val());
                  dockerimages[$(this).attr('paramtype')] = $(this).text() + $(this).val();
                });
                dockercompose.push(dockerimages);
              });
              //alert(JSON.stringify(dockercompose));
              reqBody.dockercompose = dockercompose;

              //Get all the runlist 
              var cbs = [];
              var $ccrs = $('.cookbookShow').data('$ccrs');
              cbs = $ccrs.getSelectedRunlist();
              reqBody.runlist = cbs.join(); //$('#cookbookSelect').val();
              //reqBody.chefServerId = $('#cookbookSelect').data('chefServerId',);
              var $ccrs = $('.cookbookShow').data('$ccrs');
              reqBody.chefServerId = $ccrs.getChefServerId();
              reqBody.instanceType = $('select.instanceType').val();
              reqBody.instanceOS = $('#instanceOS').val();
              reqBody.instanceCount = $('#instanceCount').val();
              console.log(reqBody);


              console.log("reqBody ==>", reqBody);
              if (!reqBody || reqBody == "undefined") {
                console.log('resetting');
                var reqBody = {};
              }
              //reqBody.runlist = $('#cookbookSelect').val();
              var $ccrs = $('.cookbookShow').data('$ccrs');
              var cbs = [];
              cbs = $ccrs.getSelectedRunlist();
              reqBody.runlist = cbs; //$('#cookbookSelect').val();
              //reqBody.chefServerId = $('#cookbookSelect').data('chefServerId');
              reqBody.chefServerId = $ccrs.getChefServerId();
              console.log("instanceType ==>", $('select.instanceType').val());
              reqBody.instanceType = $('select.instanceType').val();

              var $instanceOsoptionsSelected = $('#instanceOS').find('option:selected');
              console.log($('#instanceOS').val());
              // alert($('#instanceOS').val());
              console.log($instanceOsoptionsSelected);

              reqBody.instanceOS = $instanceOsoptionsSelected.attr('data-instanceOS');
              reqBody.instanceAmiid = $instanceOsoptionsSelected.attr('data-amiid');
              reqBody.instanceUsername = $instanceOsoptionsSelected.attr('data-amiid-username');
              // reqBody.instanceOS = $('#instanceOS').val();
              reqBody.templateId = $('.productdiv2.role-Selected').attr('data-templateId');
              reqBody.templateType = $('.productdiv2.role-Selected').attr('data-templateType');
              reqBody.templateComponents = $('.productdiv2.role-Selected').attr('data-templateComponent').split(',');

              //    reqBody.dockercontainerpathstitle = $('.productdiv2.role-Selected').attr('dockercontainerpathstitle');
              reqBody.dockercontainerpaths = $('#dockerrepoListInput :selected').attr('repopath'); //$('.productdiv2.role-Selected').attr('dockercontainerpaths');
              reqBody.dockerrepotags = $('.productdiv2.role-Selected').attr('dockerrepotags');
              reqBody.dockerimagename = $('#dockerrepoListInput').val();
              reqBody.dockerlaunchparameters = $('#dockerlaunchparameters').val();
              reqBody.dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');
              //alert(reqBody.dockerreponame);
              reqBody.iconpath = $('.productdiv2.role-Selected').find('img[src*="__templatesicon__"]').first().attr('src');
              reqBody.orgId = $('#orgnameSelect').val();
              reqBody.bgId = $('#bgListInput').val();
              reqBody.projectId = $('#projectListInput').val();
              //reqBody.envId = $('#envList').val();
              var imageIdentifier = $('#imageId').val();
              var imageId = $('#imageId').find('option:selected').attr('_id');
              var securityGroupIds = getSecurityCheckedList();
              var providerId = $('#providerId').val();
              var keyPairId = $('#keypairId').val();
              var instanceType = $('#instancesize').val();
              var vpcId = $('#vpcId').val();
              var subnetId = $('#subnetId').val();
              var region = $('#region').val();
              // var instanceOS=$('#instanceOS').data('instanceOS')

              // reqBody.providerId=providerId;
              reqBody.keyPairId = keyPairId;
              reqBody.securityGroupIds = securityGroupIds;
              reqBody.instanceType = instanceType;
              reqBody.instanceAmiid = imageIdentifier;
              reqBody.instanceUsername = 'root';
              reqBody.vpcId = vpcId;
              reqBody.subnetId = subnetId;
              reqBody.imageId = imageId;
              reqBody.providerId = providerId;
              //alert(reqBody.providerId);
              reqBody.name = $('#blueprintNameInput').val();
              /*if (($('.role-Selected').data('templatetype')).toLowerCase() != "docker") {
                           // return false;
                        }*/
              //Openstack variables.
              reqBody.imageIdentifier = imageId;
              reqBody.openstackflavor = $('#openstackflavour').val();
              reqBody.openstacknetwork = $('#openstacknetwork').val();
              reqBody.openstacksecurityGroupIds = $('#openstacksecuritygroup').val();
              reqBody.openstacksubnet = $('#openstacksubnet').val();

              reqBody.instanceCount = 1;
              reqBody.instanceImageName = imageIdentifier;


              // $('#userListSelect').find('option').attr('selected', 'selected');
              // reqBody.users = $('#userListSelect').val();

              // if (!reqBody.users) {
              //   alert("Please choose users");
              //   return false;
              // }
              //Checking for docker blueprint images
              if (($('.productdiv2.role-Selected').first().attr('templatetype') == "Docker" || $('.productdiv2.role-Selected').first().attr('templatetype') == "docker") && $('#dockerimageemptytr').length > 0) {
                //no rows found add empty message
                alert("Please add atleast one image");
                return false;
              }
              //alert(JSON.stringify(reqBody));
              var appUrls = [];
              var $appUrlTableBody = $('#appUrlTable tbody');
              var $trs = $appUrlTableBody.find('tr');
              //alert($trs.length);
              $trs.each(function(e) {
                var $this = $(this);
                appUrls.push($this.data('appUrlData'));
              });
              reqBody.appUrls = appUrls;

              // for cft templates
              //reqBody.stackName = $('#cftStackNameInput').val();
              reqBody.cftProviderId = $('#cftProviderInput').val();
              reqBody.region = $('#cftRegionInput').val();
              var cftParameters = [];
              $('.cftParameterInput').each(function() {
                var $this = $(this);
                var parameterObj = {
                  ParameterKey: $this.attr('data-cftParameter-name'),
                  ParameterValue: $this.val(),
                  type: $this.attr('data-cftParameter-type')
                }
                cftParameters.push(parameterObj);
              });
              reqBody.cftStackParameters = cftParameters;
              reqBody.cftTemplateFile = $('#cftTemplateFileInput').val();
              //reqBody.cftInstanceUserName = $('#cftStackInstanceUsernameInput').val();
              var cftInstances = [];

              $('.cft-resource-editPanel').each(function() {
                var $this = $(this);
                var runlist = [];
                var $ccrs = $this.find('.cftResourceRunlistInput').data('$ccrs');
                if ($ccrs) {
                  runlist = $ccrs.getSelectedRunlist();
                }

                var instanceObj = {
                  logicalId: $this.find('.cftResourceLogicalIdInput').val(),
                  username: $this.find('.cftResourceUsernameInput').val(),
                  runlist: runlist
                };
                cftInstances.push(instanceObj);
              });
              reqBody.cftInstances = cftInstances;



              $('.blueprintMsgContainer').hide();
              if (($('.role-Selected').data('templatetype')).toLowerCase() != "docker") {
                reqBody.blueprintType = "instance_launch";
                if (($('.role-Selected').data('templatetype')).toLowerCase() === 'cloudformation') {
                  reqBody.blueprintType = 'aws_cf';
                }
                if ($('#providerId').find("option:selected").attr('providertype').toLowerCase() == 'openstack') {
                  reqBody.blueprintType = 'openstack_launch';
                }

                $.post('/organizations/' + reqBody.orgId + '/businessgroups/' + reqBody.bgId + '/projects/' + reqBody.projectId + '/blueprints', {
                  blueprintData: reqBody
                }, function(data) {
                  console.log(data);
                  //  alert(JSON.stringify(data));
                  var validatorForm = $("#wizard-1").validate();
                  validatorForm.resetForm();

                  // alert(JSON.stringify(data));
                  $('.blueprintSaveSuccess').show();
                  $('.blueprintNameSuccess').html('Blueprint&nbsp;&nbsp;<a id="blueprintInfo" data-toggle="modal">' + data.name + '</a>&nbsp;&nbsp;Saved Successfully');
                  $wizard.data('secondClick', true);
                  var wizard = $wizard.data('bootstrapWizard');
                  wizard.next();
                  wizard.disablePreviouBtn();
                  if (tempType === 'softwarestack' || tempType === 'osimage') {
                    $('a#blueprintInfo').attr('href', '#modalForRead').click(function(e) {
                      var $blueprintReadContainer = $('#modalForRead');
                      if (tempType === 'softwarestack') {
                        $('.modal-title').html('Blueprint Information-Software Stack');
                      }
                      if (tempType === 'osimage') {
                        $('.modal-title').html('Blueprint Information-OSImage');
                      }
                      //condition for getting the OS,instanceType,version...
                      $blueprintReadContainer.modal('show');
                      //for getting the blueprint name
                      $blueprintReadContainer.find('.modal-body #blueprintNameInputNew').val(data.name);
                      //for getting the OsName
                      $blueprintReadContainer.find('.modal-body #instanceOSNew').val(data.blueprintConfig.cloudProviderData.instanceOS);
                      //for getting the instance Size
                      $blueprintReadContainer.find('.modal-body #instancesizeNew').val(data.blueprintConfig.cloudProviderData.instanceType);
                      //for getting the version
                      $blueprintReadContainer.find('.modal-body #instanceVersion').val(data.blueprintConfig.infraManagerData.latestVersion);
                      //for getting the SubnetId
                      $blueprintReadContainer.find('.modal-body #instanceSubnetId').val(data.blueprintConfig.cloudProviderData.subnetId);
                      //loop for getting the Security Group
                      $blueprintReadContainer.find('.modal-body #instanceSecurityGroupId').val(data.blueprintConfig.cloudProviderData.securityGroupIds);
                      $blueprintReadContainer.find('.modal-body #instanceVPC').val(data.blueprintConfig.cloudProviderData.vpcId);
                      // loop for getting runlist
                      for (var j = 0; j < data.blueprintConfig.infraManagerData.versionsList.length; j++) {
                        $blueprintReadContainer.find('.modal-body #instanceRunlist').val(data.blueprintConfig.infraManagerData.versionsList[j].runlist);
                      }
                      //for getting the image Name
                      $.ajax({
                        type: "GET",
                        url: "/vmimages/" + data.blueprintConfig.cloudProviderData.imageId,
                        success: function(data) {
                          console.log(data);
                          $blueprintReadContainer.find('.modal-body #instanceImage').val(data.name);
                          //alert(data.name);
                        }
                      });
                      //for getting the Provider name,Type,Region,KeyPair
                      $.ajax({
                        type: "GET",
                        url: "/aws/providers/" + data.blueprintConfig.cloudProviderId,
                        success: function(data) {
                          $blueprintReadContainer.find('.modal-body #instanceProviderName').val(data.providerName);
                          $blueprintReadContainer.find('.modal-body #instanceProviderType').val(data.providerType);
                          // loop for getting region and Keypair
                          for (var k = 0; k < data.keyPairs.length; k++) {
                            $blueprintReadContainer.find('.modal-body #instanceRegion').val(data.keyPairs[k].region);
                            $blueprintReadContainer.find('.modal-body #instancekeyPair').val(data.keyPairs[k].keyPairName);
                          }
                        },
                        failure: function(data) {
                          alert(data.toString());
                        }
                      });
                      $blueprintReadContainer.find('.modal-body #blueprintTemplateType').val(data.templateType);
                      $.ajax({
                        type: "get",
                        dataType: "json",
                        async: false,
                        url: "../organizations/getTreeNew",
                        success: function(dataTree) {
                          console.log(data);
                          data = JSON.parse(JSON.stringify(data));
                          //  alert(JSON.stringify(data));
                          $.get("/d4dMasters/readmasterjsonnew/4", function(tdata) {
                            for (var i = 0; i < tdata.length; i += 1) {
                              if (data.orgId == tdata[i].orgname_rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintORG').val(tdata[i].orgname[0]);
                              }
                              if (data.bgId == tdata[i].productgroupname_rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintBU').val(tdata[i].productgroupname);
                              }
                              if (data.projectId == tdata[i].rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintProject').val(tdata[i].projectname);
                              }
                            }
                          });
                        }
                      });
                    });
                  } else if (tempType === 'cloudformation') {
                    $('a#blueprintInfo').attr('href', '#modalForReadCFT').click(function(e) {
                      var $blueprintReadContainerCFT = $('#modalForReadCFT');
                      $('.modal-title').html('Blueprint Information-CFT');
                      $blueprintReadContainerCFT.modal('show');
                      //for getting the blueprint name
                      $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(data.name);
                      $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(data.templateType);
                      if (!data.version) {
                        data.version = "1";
                      }
                      $blueprintReadContainerCFT.find('.modal-body #instanceVersion').val(data.version);
                      $.ajax({
                        type: "get",
                        dataType: "json",
                        async: false,
                        url: "../organizations/getTreeNew",
                        success: function(dataTree) {
                          console.log(data);
                          data = JSON.parse(JSON.stringify(data));
                          $.get("/d4dMasters/readmasterjsonnew/4", function(tdata) {
                            for (var i = 0; i < tdata.length; i += 1) {
                              if (data.orgId == tdata[i].orgname_rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintORG').val(tdata[i].orgname[0]);
                              }
                              if (data.bgId == tdata[i].productgroupname_rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintBU').val(tdata[i].productgroupname);
                              }
                              if (data.projectId == tdata[i].rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintProject').val(tdata[i].projectname);
                              }
                            }
                          });
                        }
                      });
                    });
                  }
                  //for getting the blueprint name
                }).error(function(xhr) {
                  $('.blueprintSaveFail').find('h3').first().html(xhr.responseText);
                  $('.blueprintSaveFail').show();
                });
                console.log('final', reqBody);

              } else {
                reqBody.blueprintType = "docker";
                $.post('/organizations/' + reqBody.orgId + '/businessgroups/' + reqBody.bgId + '/projects/' + reqBody.projectId + '/blueprints', {
                  blueprintData: reqBody
                }, function(data) {
                  console.log(data);
                  var validatorFormDocker = $("#wizard-1").validate();
                  validatorFormDocker.resetForm();
                  $('.blueprintSaveSuccess').show();
                  $('.blueprintNameSuccess').html('Blueprint&nbsp;&nbsp;<b>' + data.name + '</b>&nbsp;&nbsp;Saved Successfully');
                  $wizard.data('secondClick', true);
                  var wizard = $wizard.data('bootstrapWizard');
                  wizard.next();
                  wizard.disablePreviouBtn();
                }).error(function(xhr) {
                  $('.blueprintSaveFail').find('h3').first().html(xhr.responseText);
                  $('.blueprintSaveFail').show();
                });
                console.log('final', reqBody);
              }

            }
          }
        }).find('.modal-header').css('background-color', 'ghostwhite');
      }
      return false;
    }


  },
  'onPrevious': function(tab, navigation, index) {
    //console.log(index);
    if (index === 0) {
      $("#tabheader").html('Choose Template Type');
      $('#viewCreateNew').removeClass('hidden');
      $('#selectOrgName').attr('disabled', false);
      var wizard = $wizard.data('bootstrapWizard');
      wizard.enableNextBtn();
    } else if (index === 1) {
      $("#tabheader").html('Choose Templates');
    } else if (index === 2) {
      $("#tabheader").html('Choose Template');
    } else if (index === 3) {
      $("#tabheader").html('Create Blueprint');
      var validatorForm = $("#wizard-1").validate();
      validatorForm.resetForm();
    }

  }
});


var $rolesCards = $('.blueprintdiv')

$('.blueprintdiv').on("click", function() {
  //alert("Inside");
  $rolesCards.removeClass('role-Selected');
  if ($(this).hasClass('role-Selected')) {
    $(this).removeClass('role-Selected');
  } else {
    $(this).addClass('role-Selected');
  }
  // $('.templates').hide();
  // console.log($(this).attr('data-templateType'));
  // $('.'+$(this).attr('data-templateType')).show();
  //$('.next a').attr('disabled',false);
});

var $selectedTemplate = $('.productdiv2').click(function(e) {
  $selectedTemplate.removeClass('role-Selected');
  console.log("this ==> ", this);
  var $this = $(this);
  $('.selectedTemplateArea').empty().append($this.clone(false).css({
    'cursor': 'auto'
  }));

  $this.addClass('role-Selected');
});

$.ajax({
  type: "get",
  dataType: "json",
  async: false,
  url: "../organizations/getTreeForbtv",
  success: function(data) {
    console.log(data);
    $('#selectOrgName').trigger('change');
    data = JSON.parse(JSON.stringify(data));
    var $orgListInput = $('#orgnameSelect');
    $bgList = $('#bgListInput');
    var $envList = $('#envList');
    for (var i = 0; i < data.length; i++) {
      $('#selectOrgName').append($('<option></option>').val(data[i].rowid).html(data[i].name));
      $orgListInput.append($('<option></option>').val(data[i].rowid).html(data[i].name).data('bglist', data[i].nodes).data('project', data[i].nodes[0].nodes).data('envList', data[i]
        .nodes[0].nodes));
    }
    $orgListInput.change(function(e) {
      var orgName = $(this).val();
      if (orgName == 'choose') {
        return;
      }
      var $selectedOrgOption = $(this).find(":selected");
      $bgList.empty();
      $bgList.append($('<option></option>').val('choose').html('Choose'));
      var getBGs = $selectedOrgOption.data('bglist');
      if (getBGs != null) {
        for (var i = 0; i < getBGs.length; i++) {
          $bgList.append($('<option></option>').val(getBGs[i].rowid).html(getBGs[i].name).data('projList', getBGs[i].nodes));
        }
      }
      var $cookbookShow = $('.cookbookShow').empty();
      $cookbookShow.append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
      var tcb = [];
      var $card = $('#tab3').find('div[class*="productdiv2"]').first();
      if ($card.length) {
        var templatescookbooks = $card.attr('templatescookbooks');
        if (templatescookbooks) {
          tcb = templatescookbooks.split(',');
        }
      }
      console.log(tcb);
      console.log('tcbdhd == >', tcb);
      var $ccrs = $chefCookbookRoleSelector(orgName, function(data) {}, tcb);
      console.log("Variables>>>>>" + $ccrs);
      $cookbookShow.empty();
      $cookbookShow.append($ccrs);
      var currentRunlistNames = $ccrs.getRunlistNames(tcb);
      $tasksRunlist.clear().draw();
      for (var i = 0; i < currentRunlistNames.length; i++) {
        var $runlistList = $('#tableRunlistForBlueprint');
        var $tr = $('<tr class="runlistRow"></tr>');
        var $tdName = $('<td class="runlistDescription">' + currentRunlistNames[i] + '</td>');
        $tr.append($tdName);
        $runlistList.append($tr);
        $tasksRunlist.row.add($tr).draw();
      }
      $cookbookShow.data('$ccrs', $ccrs)
    });
    var $projectList = $('#projectListInput');
    $bgList.change(function(e) {
      var bgName = $(this).val();
      if (bgName == 'choose') {
        return;
      }
      var $selectedOrgOption = $(this).find(":selected");
      $projectList.empty();
      $projectList.append($('<option></option>').val('choose').html('Choose'));
      var getProjs = $selectedOrgOption.data('projList');
      for (var i = 0; i < getProjs.length; i++) {
        $projectList.append($('<option></option>').val(getProjs[i].rowid).html(getProjs[i].name));
      }
    });
  }
});

/*
(function() {

  var $loadingContainer = $('.userListLoadingContainer').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />').show();
  $.get('../users', function(userList) {
    var $userListSelect = $('#userListSelect').empty();
    userList = JSON.parse(userList);
    userList.sort(function(a, b) {
      var keyA = Object.keys(a);
      var keyB = Object.keys(b);

      if (keyA[0] < keyB[0]) return -1;
      if (keyA[0] > keyB[0]) return 1;
      return 0;
    });
    for (var i = 0; i < userList.length; i++) {
      var keys = Object.keys(userList[i]);
      var $option = $('<option></option>').append(keys[0]).val(keys[0]);
      $userListSelect.append($option);
    }
    $loadingContainer.hide();
    $userListSelect.show();
  }).error(function() {
    $loadingContainer.empty().append('Unable to load users. Please try again later.');
  });
})();
*/

$(document).ready(function() {
  $("#blueprintNameInput").focus();
});

$('#newAppSeries').click(function(e) {
  $('#appURLForm').trigger("reset");

});
$('#addAppBtn').click(function(e) {
  var rowCount1 = $('#appUrlTable').find('tbody > tr').length;
  //alert(rowCount1);    
  if (rowCount1 === 2) {
    $('#newAppSeries').addClass('hidden');
    return;
  }
});

$('#appURLForm').submit(function(e) {
  var regexpURL = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;

  var $row = $('<tr/>');
  var appName = $(this).find('.appName').val();
  var appUrl = $(this).find('.appURL').val();
  if (!(appName)) {
    alert("Please Enter Name");
    return false;
  }
  if (!(appUrl)) {
    alert('Please Enter URL');
    return false;
  }

  if (!regexpURL.test(appUrl)) {
    alert('Please Enter a Valid URL');
    return false;
  }

  $row.data('appUrlData', {
    name: appName,
    url: appUrl
  })


  var $tdName = $('<td/>');
  $tdName.append(appName);
  var $tdURL = $('<td/>');
  $tdURL.append(appUrl);

  var $tdAction = $('<td/>');
  $tdAction.append('<div class="btn-group"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteURL" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');

  //<button class="btn btn-xs btn-info pull-left EditURL" title="Update"><i class="ace-icon fa fa-pencil bigger-120"></i></button>
  $tdAction.find('.deleteURL').click(function() {
    $row.remove();
    var rowCount2 = $('#appUrlTable').find('tbody > tr').length;
    if (rowCount2 === 1) {
      $('#appEntry').removeClass('hidden');
      return;
    }
    if (rowCount2 < 3) {
      //alert(rowCount2);
      $('#newAppSeries').removeClass('hidden');
      return;
    }
  });

  $row.append($tdName).append($tdURL).append($tdAction);
  $('#appUrlTable').find('tbody').append($row);
  $('#modalAppNameURL').modal('hide');
  $('#appEntry').addClass('hidden');
  return false;

});



/**************************************Blueprint.js*************************************/

/*Binding Click events to Blueprints*/

/*function initializeBluePrints() {
                   // bindClick_bluePrintUpdateNew();
                   // bindClick_updateInstanceRunListNew();
                }*/



//Initializing the blueprint area according to the Template-Type and showing
//the differnt template types whenever a blueprint is added
function initializeBlueprintAreaNew(data) {



  var reqBodyNew = {};
  var $orgListInput = $('#orgnameSelectExisting');

  reqBodyNew.orgId = $orgListInput.val();

  var $AppFactpanelBody = $('.appFactoryPanel').find('.panel-body');
  $AppFactpanelBody.empty();

  var $devopsRolepanelBody = $('.devopsRolePanel').find('.panel-body');
  $devopsRolepanelBody.empty();

  var $desktopProvisioningPanelBody = $('.desktopProvisioningPanel').find('.panel-body');
  $devopsRolepanelBody.empty();

  //alert(orgId + "/" + projectId + "/" + envId + data.length);

  //Displaying the Template Types.
  $.get("/d4dMasters/readmasterjsonnew/16", function(tdata) {
    tdata = JSON.parse(tdata);
    var rowLength = tdata.length;
    //alert(rowLength);
    var $containerTempNew = "";
    var selectedrow = false;
    var getDesignTypeImg;
    var getDesignTypeRowID;
    var getDesignTypeName;
    var getDesignType;
    $('#accordion-2').empty();
    //alert(JSON.stringify(tdata));
    for (var i = 0; i < rowLength; i += 1) {
      getDesignTypeImg = tdata[i]['designtemplateicon_filename'];
      getDesignTypeRowID = tdata[i]['rowid'];
      getDesignTypeName = tdata[i]['templatetypename'];
      getDesignType = tdata[i]['templatetype'];


      //Extracting the TT definitions. Add New Template types
      var $currRolePanel = null;
      //alert(getDesignTypeName);
      switch (getDesignTypeName) {
        case "AppFactory":
          $AppFactpanelBody = $('<div class="panel-body AppFactory"></div>');
          $currRolePanel = $AppFactpanelBody;
          break;
        case "DevopsRoles":
          $DevopsRolespanelBody = $('<div class="panel-body DevopsRoles"></div>');
          $currRolePanel = $DevopsRolespanelBody;
          break;
        case "CloudFormation":
          $CloudFormationBody = $('<div class="panel-body CloudFormation"></div>');
          $currRolePanel = $CloudFormationBody;
          break;
        case "Docker":
          $DockerpanelBody = $('<div class="panel-body Docker"></div>');
          $currRolePanel = $DockerpanelBody;
          break;
        case "Desktop":
          $DesktopProvisioningPanelBody = $('<div class="panel-body Desktop"></div>');
          $currRolePanel = $DesktopProvisioningPanelBody;
          break;
        case "Environment":
          $EnvironmentpanelBody = $('<div class="panel-body Environment"></div>');
          $currRolePanel = $EnvironmentpanelBody;
          break;

      }
      console.log(tdata);
      if ($("div." + tdata[i]['templatetype']).length === 0) {
        $containerTempNew = '<div class="panel panel-default blueprintContainer hidden">' +
          '<div class="panel-heading">' +

          '<h4 class="panel-title">' +
          '<a href="#collapse' + i + '" data-parent="#accordion-2" data-toggle="collapse" class="collapsed"> ' +
          '<i class="fa fa-fw fa-plus-circle txt-color-blue"></i> ' +
          '<i class="fa fa-fw fa-minus-circle txt-color-red"></i>' + getDesignTypeName + '</a>' +
          '</h4></div><div class="panel-collapse collapse" id="collapse' + i + '">' +
          '<div class="panel-body ' + getDesignType + '"></div>' +
          '</div>';
        $('#accordion-2').append($containerTempNew);
      }
    }
    //To fix template id and template type
    // alert('in' + data.length);

    for (var i = 0; i < data.length; i++) {
      (function(i) {
        console.log(data[i]);
        //alert(data[i]);

        //Find a panel-body with the template type class
        var $currRolePanel = $('#accordion-2').find('.' + data[i].templateType);
        //   alert($currRolePanel.length);
        if ($currRolePanel.length > 0) {
          var $itemContainer = $('<div></div>').addClass("productdiv4");

          var $itemBody = $('<div></div>').addClass('productdiv1 cardimage').attr('data-blueprintId', data[i]._id).attr('data-projectId', data[i].projectId).attr('data-envId', data[i].envId).attr('data-chefServerId', data[i].chefServerId).attr('data-templateType', data[i].templateType);
          var $ul = $('<ul></ul>').addClass('list-unstyled system-prop').css({
            'text-align': 'center'
          });
          var $liRead = $('<a style="float:right;margin:5px;cursor:pointer" class="readBtn"><div class="moreInfo"></div></a>').attr('data-toggle', 'tooltip').attr('data-placement', 'top').attr('title', 'More Info');
          $ul.append($liRead);
          var $img
          if (data[i].iconpath)

          {
            if (data[i].templateType == "Docker" || data[i].templateType == "docker") {
              $img = $('<img />').attr('src', 'img/galleryIcons/Docker.png').attr('alt', data[i].name).addClass('cardLogo');
            } else
              $img = $('<img />').attr('src', data[i].iconpath).attr('alt', data[i].name).addClass('cardLogo');
          } else
            $img = $('<img />').attr('src', 'img/imgo.jpg').attr('alt', data[i].name).addClass('cardLogo');
          var $liImage = $('<li></li>').append($img);
          $ul.append($liImage);

          var $liCardName = $('<li title="' + data[i].name + '"></li>').addClass('Cardtextoverflow').html('<u><b>' + data[i].name + '</b></u>');

          $ul.append($liCardName);

          var $selecteditBtnContainer = $('<div style="position:absolute;padding-left:27px;bottom:11px;"></div>');
          //      if (data[i].versionsList) {

          var $selectVerEdit = $('<a style="padding:0px 4px;margin-left:3px;border-radius:5px;" class="bpEditBtn"><i class="ace-icon fa fa-pencil"></i></a>').addClass('btn btn-primary').attr('data-toggle', 'tooltip').attr('data-placement', 'top').attr('title', 'Edit');
          var $selectVer = null;
          var tagLabel = '';
          //Docker Check
          if (data[i].templateType == "Docker" || data[i].templateType == "docker") {
            console.log("data[i}" + JSON.stringify(data[i]));
            $selectVer = $('<select style="padding:1px;margin-right:5px;"></select>').addClass('dockerrepotagselect').attr('data-blueprintId', data[i]._id);
            $itemBody.attr('dockerreponame', data[i].dockerreponame);
            $itemBody.attr('dockerrepotags', data[i].dockerrepotags);
            $itemBody.attr('dockercontainerpaths', data[i].dockercontainerpaths);

            if (data[i].dockerlaunchparameters)
              $itemBody.attr('dockerlaunchparameters', 't ' + data[i].dockerlaunchparameters);
           /* var $liDockerRepoName = $('<li title="Docker Repo Name" ><i class="fa fa-check-square" style="padding-right:5px"/>' + data[i].dockerreponame + '</li>');
            $ul.append($liDockerRepoName);
            if (data[i].dockerrepotags && data[i].dockerrepotags != '') {
              $selectVer.empty();
              var dockerrepostags = data[i].dockerrepotags.split(',');
              $.each(dockerrepostags, function(k) {
                $selectVer.append('<option value="' + dockerrepostags[k] + '">' + dockerrepostags[k] + '</option>');
              });
            }*/
            $selectVer.hide();
            $selectVerEdit.hide();
            //for software stack and os image
            function getOrgProjDetails(id) {
              var orgName = $("#orgnameSelectExisting option:selected").text();
              var bgName = $('#bgListInputExisting option:selected').text();
              var projName = $('#projectListInputExisting option:selected').text();
              var $blueprintReadContainer = $(id);
              $blueprintReadContainer.find('.modal-body #blueprintORG').val(orgName);
              $blueprintReadContainer.find('.modal-body #blueprintBU').val(bgName);
              $blueprintReadContainer.find('.modal-body #blueprintProject').val(projName);
              var $blueprintReadContainerCFT = $(id);
              $blueprintReadContainerCFT.find('.modal-body #blueprintORGCFT').val(orgName);
              $blueprintReadContainerCFT.find('.modal-body #blueprintBUCFT').val(bgName);
              $blueprintReadContainerCFT.find('.modal-body #blueprintProjectCFT').val(projName);
            }
            (function(blueprint) {
              $liRead.click(function(e) {
                var $blueprintReadContainerCFT = $('#modalForReadCFT');
                $('.modal-title').html('Blueprint Information-Docker');
                $blueprintReadContainerCFT.modal('show');
                //for getting the blueprint name
                $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(blueprint.name);
                $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(blueprint.templateType);
                if (!blueprint.version) {
                  blueprint.version = "1";
                }
                $blueprintReadContainerCFT.find('.modal-body #instanceVersion').val(blueprint.version);
                getOrgProjDetails($blueprintReadContainerCFT);
              });
            })(data[i]);
          } else {
            $selectVer = $('<select style="padding:1px;padding-left:5px;"></select>').addClass('blueprintVersionDropDown').attr('data-blueprintId', data[i]._id);
            if (data[i].templateType === 'chef' || data[i].templateType === 'ami') {
              $selectVerEdit.hide();
              $selectVer.hide();
              //code for info about blueprints
              (function(blueprint) {
                $liRead.click(function(e) {
                  var $blueprintReadContainer = $('#modalForRead');
                  $blueprintReadContainer.find('.modal-body #blueprintNameInputNew').val(blueprint.name);
                  if (blueprint.templateType === 'chef') {
                    $('.modal-title').html('Blueprint Information-Software Stack');
                  }
                  if (blueprint.templateType === 'ami') {
                    $('.modal-title').html('Blueprint Information-OSImage');
                  }
                  //for getting the image Name
                  $.ajax({
                    type: "GET",
                    url: "/vmimages/" + blueprint.blueprintConfig.cloudProviderData.imageId,
                    success: function(data) {
                      console.log(data);
                      $blueprintReadContainer.find('.modal-body #instanceImage').val(data.name);
                    }
                  });
                  //for getting the Provider name,Type,Region,KeyPair
                  $.ajax({
                    type: "GET",
                    url: "/openstack/providers/" + blueprint.blueprintConfig.cloudProviderId,
                    success: function(data) {
                      $blueprintReadContainer.find('.modal-body #instanceProviderName').val(data.providerName);
                      $blueprintReadContainer.find('.modal-body #instanceProviderType').val(data.providerType);
                      // loop for getting region and Keypair
                      for (var k = 0; k < data.keyPairs.length; k++) {
                        $blueprintReadContainer.find('.modal-body #instanceRegion').val(data.keyPairs[k].region);
                        $blueprintReadContainer.find('.modal-body #instancekeyPair').val(data.keyPairs[k].keyPairName);
                      }
                    },
                    failure: function(data) {
                      alert(data.toString());
                    }
                  });
                  var $parent = $(this).parents('.cardimage');
                  var version = $parent.find('.blueprintVersionDropDown').val();
                  $blueprintReadContainer.modal('show');
                  //for getting the blueprint name
                  //for getting the OsName
                  $blueprintReadContainer.find('.modal-body #instanceOSNew').val(blueprint.blueprintConfig.cloudProviderData.instanceOS);
                  //for getting the instance Size
                  $blueprintReadContainer.find('.modal-body #instancesizeNew').val(blueprint.blueprintConfig.cloudProviderData.instanceType);
                  //for getting the SubnetId
                  $blueprintReadContainer.find('.modal-body #instanceSubnetId').val(blueprint.blueprintConfig.cloudProviderData.subnetId);
                  //loop for getting the Security Group
                  $blueprintReadContainer.find('.modal-body #instanceSecurityGroupId').val(blueprint.blueprintConfig.cloudProviderData.securityGroupIds);
                  //for getting the VPC
                  $blueprintReadContainer.find('.modal-body #instanceVPC').val(blueprint.blueprintConfig.cloudProviderData.vpcId)
                    // loop for getting runlist
                  for (var j = 0; j < blueprint.blueprintConfig.infraManagerData.versionsList.length; j++) {
                    $blueprintReadContainer.find('.modal-body #instanceRunlist').val(blueprint.blueprintConfig.infraManagerData.versionsList[j].runlist);
                    //for getting the version
                    $blueprintReadContainer.find('.modal-body #instanceVersion').val(blueprint.blueprintConfig.infraManagerData.versionsList[j].ver);
                  }
                  $blueprintReadContainer.find('.modal-body #blueprintTemplateType').val(blueprint.templateType);
                  getOrgProjDetails($blueprintReadContainer);
                });
              })(data[i]);
            } else if (data[i].templateType === 'cft' || data[i].templateType === 'arm') {
              $selectVerEdit.hide();
              $selectVer.hide();
              (function(blueprint) {
                $liRead.click(function(e) {
                  var $blueprintReadContainerCFT = $('#modalForReadCFT');
                  if (blueprint.templateType == 'arm') {
                    $blueprintReadContainerCFT.find('.modal-title').html('Blueprint Information-ARM');
                  } else {
                    $blueprintReadContainerCFT.find('.modal-title').html('Blueprint Information-CFT');
                  }
                  $blueprintReadContainerCFT.modal('show');
                  //for getting the blueprint name
                  $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(blueprint.name);
                  $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(blueprint.templateType);
                  $.ajax({
                    type: "get",
                    dataType: "json",
                    async: false,
                    url: "../organizations/getTreeNew",
                    success: function(dataTree) {
                      console.log(data);
                      data = JSON.parse(JSON.stringify(data));
                      for (var j = 0; j < dataTree.length; j++) {
                        (function(j) {
                          $blueprintReadContainerCFT.find('.modal-body #blueprintORG').val(dataTree[j].name);
                          for (var p = 0; p < dataTree[j].businessGroups.length; p++) {
                            (function(p) {
                              $blueprintReadContainerCFT.find('.modal-body #blueprintBU').val(dataTree[j].businessGroups[p].name);
                              for (var x = 0; x < dataTree[j].businessGroups[p].projects.length; x++) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintProject').val(dataTree[j].businessGroups[p].projects[x].name);
                              }
                            })
                            (p);
                          }
                        })
                        (j);
                      }
                    }
                  });
                });
              })(data[i]);
            }

            //for updating 
            $selectVerEdit.click(function(e) {

              var $parent = $(this).parents('.cardimage');
              var $blueprintEditResultContainer = $('#blueprintEditResultContainer');


              $blueprintEditResultContainer.modal('show');

              var projectId = $parent.attr('data-projectId');
              var envId = $parent.attr('data-envId');
              var blueprintId = $parent.attr('data-blueprintId');
              var chefServerId = $parent.attr('data-chefServerId');
              var version = $parent.find('.blueprintVersionDropDown').val();
              $.get('../blueprints/' + blueprintId + '/versions/' + version, function(versionData) {
                console.log('blueprint data', versionData);
                var $ccrs = $chefCookbookRoleSelector(reqBodyNew.orgId, function(data) {

                }, versionData.runlist);
                //alert(JSON.stringify(data));
                $ccrs.find('#cookbooksrecipesselectedList').attr('data-blueprintId', blueprintId);
                $blueprintEditResultContainer.find('.modal-body').empty().append($ccrs).data('$ccrs', $ccrs);



              }).error(function() {
                $blueprintEditResultContainer.find('.modal-body').empty();
                $blueprintEditResultContainer.find('.modal-body').append('<span>Oops! Something went wrong. Please try again later</span>');
              });

            });
          }
          if (localStorage.getItem('userRole') !== '[Consumer]') {
            var $li = $('<li></li>').css({
              "font-size": '10px'
            }).append(tagLabel, $selectVer, $selectVerEdit);

          } else {
            var $li = $('<li></li>').css({
              "font-size": '10px'
            }).append(tagLabel, $selectVer);


          }

          if ($selectVer.attr('class').indexOf('dockerrepotagselect') < 0) {
            //    alert(data[i].blueprintConfig.infraManagerData.versionsList.length);
            // console.log("+++++++++++++++ "+i);
            //   console.log("sdasadsds" + JSON.stringify(data[i].blueprintConfig.infraManagerData.versionsList));

            if (typeof data[i].blueprintConfig.infraManagerData !== 'undefined') {
              for (var j = 0; j < data[i].blueprintConfig.infraManagerData.versionsList.length; j++) {



                var $options = $('<option></option>').append(data[i].blueprintConfig.infraManagerData.versionsList[j].ver).val(data[i].blueprintConfig.infraManagerData.versionsList[j].ver);
                $selectVer.append($options);


              }
            }
          }
          $selecteditBtnContainer.append($li);


          //}
          $itemBody.append($ul);
          $itemBody.append($selecteditBtnContainer);
          $itemContainer.append($itemBody);

          //Find the template type container and add to it.
          //var $currpanel = $('#accordion-2').find('div[".' +  data[i].templateType + '"]').first();
          //alert($currpanel.length);
          $currRolePanel.append($itemContainer);
          //enabling the bluepintContiner div when item added.
          $currRolePanel.closest('.blueprintContainer').removeClass('hidden');
          // alert($currRolePanel.html());
          $currRolePanel.parent().parent().show();
          //Attaching the selection event.
          if (i == (data.length - 1)) {
            var $productdiv1 = $('.productdiv1');

            $productdiv1.click(function(e) {

              $productdiv1.removeClass('role-Selected1');
              $(this).addClass('role-Selected1');
            });
          }

        }
      })(i);

    }
    //for loop for data ends here...

    // $("#myTabContent3").append(containerTemp);
    // $("#templateContent #grid0").addClass("role-Selected");
    if ($('#accordion-2').length > 0) {
      console.log('object ==>', $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a'));
      $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a').click();
    }
    //pageSetUp();
  }); //end of readmasterjson to be pushed to the end of the function.

  $('#accordion-2').on('show.bs.collapse', function(e) {
    console.log(e.target);
    $(e.target).find('.productdiv1').first().click();

  });
  //Expanding the fist Accordion.

};

//Updating blueprints
/* function bindClick_bluePrintUpdateNew() {
                    $('.blueprintUpdateBtn').click(function(e) {

                        var $blueprintEditResultContainer = $('#blueprintEditResultContainer');
                        var $ccrs = $blueprintEditResultContainer.find('.modal-body').data('$ccrs');

                        var $selectedRunlist = $ccrs.find('#cookbooksrecipesselectedList');
                        var blueprintId = $ccrs.find('#cookbooksrecipesselectedList').attr('data-blueprintId');
                        if (blueprintId) {
                            var runlist = $ccrs.getSelectedRunlist();
                            

                            var blueprintData = {
                                runlist: runlist,
                                expirationDays: 0,
                            };

                            $.post('../blueprints/' + blueprintId + '/update', {
                                blueprintUpdateData: blueprintData
                            }, function(data) {
                                $('.blueprintVersionDropDown[data-blueprintId="' + blueprintId + '"]').append($('<option value="' + data.version + '">' + data.version + '</option>').attr('selected', true));
                                console.log(data);
                                $blueprintEditResultContainer.modal('hide');
                            });

                        }
                    });
                }*/

//Updating the blueprint Runlist
/* function bindClick_updateInstanceRunListNew() {
                    // Blueprint runtlist updation
                    $('.btnUpdateInstanceRunlist').click(function(e) {
                        bootbox.confirm("Update runlist?", function(result) {
                            if (!result) {
                                return;
                            }
                            $chefRunModalContainer = $('#chefRunModalContainer');
                            var $ccrs = $chefRunModalContainer.find('.chefRunlistContainer').data('$ccrs');
                    
                            
                            var instanceId = $ccrs.find('#cookbooksrecipesselectedList').attr('data-instanceId');

                            var runlist = $ccrs.getSelectedRunlist();
                            
                            if (!runlist.length) {
                                bootbox.alert('Runlist is empty');
                                return;
                            }


                            console.log(runlist);
                            $.post('../instances/' + instanceId + '/updateRunlist', {
                                runlist: runlist
                            }, function(data) {
                                $chefRunModalContainer.modal('hide');
                                var $parent = $('.domain-roles-caption[data-instanceId="' + instanceId + '"]');
                                var $parentTr = $('#tableinstanceview tr[data-instanceId="' + instanceId + '"]');
                                //console.log($('.domain-roles-caption[data-instanceId="' + instanceId + '"]'), $parent.find('.instance-bootstrap-list-image'));
                                $parent.find('.instance-bootstrap-list-image').data('runlist', runlist);
                                var $backRunlistContainer = $parent.parents('.card').find('.cardBackRunlistContaner').empty();
                                for (var j = 0; j < runlist.length; j++) {
                                    var $divComponentItem;

                                    $divComponentItem = $('<span title="' + runlist[j] + '" style="margin-top:8px;overflow:hidden;text-overflow:ellipsis;width:130px;color:#3a87ad"></span>').addClass('instance-details-item').append(runlist[j]);
                                    $backRunlistContainer.append($divComponentItem);
                                }

                                $parentTr.find('.instance-bootstrap-list-image').data('runlist', runlist);
                                $parent.find('.moreInfo').trigger('click');
                                console.log(data);
                            }).fail(function(jxObj) {
                                if (jxObj.status == '401')
                                    bootbox.alert('Inssuficient permission to perform operation.');
                            });
                        });


                    });
                }*/

//for removing the selected blueprint in the Existing Blueprints tab
function removeSelectedBlueprint() {
  var blueprintId = $('.productdiv1.role-Selected1').attr('data-blueprintid');
  if (blueprintId) {
    //found now delete
    bootbox.confirm("Are you sure you would like to remove this blueprint?", function(result) {
      //  alert(result);
      if (!result) {
        return;
      } else {
        //alert(result);
        $.ajax({
          url: '/blueprints/' + blueprintId,
          type: 'DELETE',
          success: function(data) {
            if (data) {
              var $bcc = $('.productdiv1.role-Selected1').closest('.blueprintContainer');
              $('.productdiv1.role-Selected1').parent().detach();
              //Check if the closest bluprintcontainer is empty, if empty then hide it.
              // alert($bcc.find('.panel-body').children().length);
              if ($bcc.find('.panel-body').children().length <= 0) {
                $bcc.addClass('hidden');
              }
            } else
              alert(data);
          }
        });
      }
    });
  } else {
    bootbox.alert({
      message: 'Please select a blueprint to remove.',
      title: 'Warning'
    });
  }
}
blueprintstartup(); 
</script>