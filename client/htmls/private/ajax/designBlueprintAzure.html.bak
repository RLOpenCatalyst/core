<!--html content starts here-->
<div class="row">
  <article class="col-sm-12 col-md-12 col-lg-12">
    <div class="widget-body" style="font-size:12px;">
      <ul id="myTab3" class="nav nav-tabs tabs-pull-left">
        <li class="pull-left  active">
          <a href="#viewCreate" id="viewCreateNew" data-toggle="tab">Blueprints</a>
        </li>
        <li class="pull-left View blueprintnewbutton">
          <a href="#l2" id="tabheader" data-toggle="tab">New</a>
        </li>
        <li class="pull-left View blueprintEditbutton hidden">
          <a href="#viewEdit" id="tabheader" data-toggle="tab">Edit</a>
        </li>
      </ul>
      <div id="myTabContent3" class="nav tab-content">
        <div class="tab-pane " id="l2">
          <span class="spanName pull-right">
              <label class="orgSelectDropDown"><b>Choose Organisation</b>:</label>
              <select id="selectOrgName" class="form-controlSelect form-control">
              </select>
           </span>
          <input type="hidden" id="orgIDCheck"/>
          <section id="widget-grid" class="">
            <div class="row">
              <article class="col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget jarviswidget-color-darken" id="wid-id-1" data-widget-editbutton="false" data-widget-deletebutton="false">
                  <div role="content">
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body">
                      <div class="row">
                        <form id="wizard-1" novalidate="novalidate">
                          <div id="bootstrap-wizard-1" class="col-sm-12">
                            <div class="form-bootstrapWizard">
                              <ul class="bootstrapWizard form-wizard" style="margin-left:13%;display:none">
                                <li class="active" data-target="#step1">
                                  <a href="#tab1" data-toggle="tab">
                                  <span class="step">1</span>
                                  <span class="title"><b></b></span>
                                  </a>
                                </li>
                                <li data-target="#step2">
                                  <a id="addlink" data-target='#tab2' data-toggle="tab" onclick="">
                                  <span class="step">2</span>
                                  <span class="title"><b></b></span>
                                  </a>
                                </li>
                                <li data-target="#step3">
                                  <a href="#tab3" data-toggle="tab">
                                  <span class="step">3</span>
                                  <span class="title"><b></b></span>
                                  </a>
                                </li>
                                <li data-target="#step4">
                                  <a href="#tab4" data-toggle="tab">
                                  <span class="step">4</span>
                                  <span class="title"><b></b></span>
                                  </a>
                                </li>
                              </ul>
                              <div class="clearfix"></div>
                            </div>
                            <div class="tab-content"  id="newbpcontainer">
                              <div class="tab-pane active" id="tab1" style="padding-bottom:20px;overflow-y: auto;">
                                <div id="templateContent" class="row " style="margin:0px;min-height:200px;">
                                </div>
                              </div>
                              <div class="tab-pane" id="tab2" style="padding-bottom:20px;overflow-y: auto;">
                                <div class="row " style="margin:0px">
                                  <div id="individualTemplateNameGrid" class="templatesAppfactory templates">
                                  </div>
                                  <div id="templatesDevopsRole" class="templatesdevopsrole templates" style="display:none">
                                  </div>
                                  <div class="templatesCloudformation templates hidden" style="display:none">
                                  </div>
                                </div>
                              </div>
                              <div class="tab-pane" id="tab3" style="padding-bottom:20px;">
                                <div class="row">
                                  <div class="col-lg-12">
                                    <div class="col-lg-2">
                                      <div class="row  selectedTemplateArea" style="margin-bottom:10px;padding-left:10px;margin-left:0px;margin-right:0px;"> Test
                                      </div>
                                    </div>
                                    <div class="col-lg-10">
                                      <div class="panel-group smart-accordion-default" id="accordion-Design">
                                        <div class="panel panel-default divconfigureparameterrunlist">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseConfigureproviderParameter"> <i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Provider Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseConfigureproviderParameter" class="panel-collapse collapse in">
                                            <div class="panel-body" style="padding-left: 20px;">
                                              <div class="col-lg-6 col-md-6">
                                                <label for="instanceOS">Choose Operating System:
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="instanceOS" name="instanceOS" class="required chooseOS width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6">
                                                <label for="providerId">Choose Provider:
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups"> 
                                                  <select id="providerId" name="providerId" class="required chooseOSProvider width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="imageId">Choose Available Images:
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="imageId" name="imageId" class="required chooseSecurity width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="region">Security Group Ports:
                                                <span style="color:red">*</span>
                                                </label>
                                                <input name="securotyGrp" Placeholder="Enter ports separated by comma" id="securotyGrp" class="required form-control" type="text" cdata="catalyst">
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="region">Choose Location:
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="location" name="location" class="required chooseSecurity width-100 form-control">
                                                    <option value="">Select Region</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="vpcId">Select VPC:
                                                <span style="color:red">*</span>
                                                </label>
                                                <label id="vpcSpinner" class="hidden">
                                                <img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif">
                                                </label>
                                                <div class="input-groups">
                                                  <select id="vpcId" name="vpcId" class="required chooseSelect chooseImage width-100 form-control">
                                                    <option value="">Select VPC</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="subnetId">Select Subnet:
                                                <span style="color:red">*</span>
                                                </label>
                                                <label id="spinnerSubnet" class="hidden">
                                                <img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif">
                                                </label>
                                                <div class="input-groups">
                                                  <select id="subnetId" name="subnetId" class="required chooseSelect chooseImage width-100 form-control">
                                                    <option value="">Select Subnet</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="instancesize">Instance Size:
                                                <span class="control-label redSpan">&nbsp;*</span>
                                                </label>
                                                <label id="spinnerSize" class="hidden">
                                                <img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif">
                                                </label>
                                                <div class="input-groups">
                                                  <select id="instancesize" name="instancesize" class="required chooseOrganization width-100 chooseSelect form-control" style="vertical-align:central">
                                                    <option value="">Choose Instanace Size</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forazure" style="margin-top:15px;">
                                                <label for="instanceCount">Instances to Launch:
                                                <span class="control-label redSpan">&nbsp;*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="instanceCount" name="instanceCount" class="required chooseOrganization width-100 chooseSelect form-control" style="vertical-align:central">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                  </select>
                                                </div>
                                              </div>
                                              <!--To add the Swipe Functionality-->
                                            </div>
                                          </div>
                                        </div>
                                        <!--adding organisation parameters starts here-->
                                        <div class="panel panel-default divOrganizationParameter">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditorgParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Organization Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseEditorgParam" class="panel-collapse collapse">
                                            <div class="panel-body" style="padding-left: 8px;">
                                              <div class="col-lg-6 col-md-6">
                                                <label for="orgnameSelect">Choose Organization
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="orgnameSelect" name="orgnameSelect" class="required chooseOrgselect2 width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6">
                                                <label for="blueprintNameInput">Enter Blueprint Name:
                                                <span class="control-label redSpan">&nbsp;*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <input id="blueprintNameInput" name="blueprintNameInput" class="required form-control" type="text" autofocus="autofocus">
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="bgListInput">Choose Business Group
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="bgListInput" name="bgListInput" class="required chooseBG width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <div class="col-lg-6 col-md-6" style="margin-top:15px;">
                                                <label for="projectListInput">Choose Project
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="input-groups">
                                                  <select id="projectListInput" name="projectListInput" class="required chooseProject width-100 form-control">
                                                  </select>
                                                </div>
                                              </div>
                                              <!-- <div class="col-lg-6 hidden" style="margin-top:5px;">
                                                <label for="">Assign Users
                                                <span style="color:red">*</span>
                                                </label>
                                                <div class="userListLoadingContainer">
                                                </div>
                                                <select class="custom-scroll width-100 form-control" multiple="" id="userListSelect" style="display:none">
                                                </select>
                                              </div> -->
                                              <div class="col-lg-6 col-md-6 forDocker dockerProjPort hidden notforCFT">
                                                <label for="category">Select Docker Image
                                                <span style="color:red">*</span>
                                                </label>
                                                <select id="dockerrepoListInput" class="chooseDockerContainer width-100 form-control">
                                                </select>
                                              </div>
                                              <div class="col-lg-6 col-md-6 forDocker dockerProjPort hidden notforCFT">
                                                <label for="category">Available Repo Tags
                                                <span style="color:red">*</span>
                                                </label>
                                                <div id="dockerrepotagsdiv">
                                                </div>
                                              </div>
                                              <div class="col-lg-12 col-md-12 hidden">
                                                <div class="col-lg-6 col-md-6 forDocker dockerProjPort dockerLEFT notforCFT">
                                                  <label for="category" class="pull-left">Launch Parameters<a id="launchParamDocker" href="javascript:void(0);" onclick=""><i title="Add" class="icon-append fa fa-plus" ></i></a>
                                                  </label>
                                                  <div class="btn-group pull-left">
                                                  </div>
                                                  <input type="text" id="dockerlaunchparameters" class="form-control" disabled="disabled" title="To edit click add" />
                                                </div>
                                              </div>
                                              <!-- Docker Image selection table -->
                                              <div class="col-lg-12 col-md-12 forDocker notforCFT" style="margin-top:5px;">
                                                <label for="category">Docker Images
                                                <span style="color:red">*</span>
                                                </label>
                                                <a class="btn btn-primary adddockertemplate pull-right" onclick="showdockertemplateadder();" style="margin-bottom:5px;">Add</a>
                                                <table class="table table-striped table-bordered table-hover dataTable no-footer" id="compositedockertable" cellpadding="5px" width="100%" style="text-align:center">
                                                  <tr>
                                                    <th>Order</th>
                                                    <th>Name</th>
                                                    <th>Image Path</th>
                                                    <th>Tag</th>
                                                    <th>Launch Params</th>
                                                    <th>Action</th>
                                                  </tr>
                                                </table>
                                              </div>
                                              <!-- End Docker Image selection table -->
                                            </div>
                                          </div>
                                        </div>
                                        <!--configure runlist collapse starts here-->
                                        <div class="panel panel-default divRunlistParameter notforCFT notForDocker">
                                          <div class="panel-heading">
                                            <h4 class="panel-title">
                                              <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseEditRunlistParam" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Runlist Parameters</a>
                                            </h4>
                                          </div>
                                          <div id="CollapseEditRunlistParam" class="panel-collapse collapse">
                                            <div class="panel-body" style="padding-left: 8px;">
                                              <div class="col-lg-6 col-md-6 notForDocker notforCFT" style="margin-top:19px">
                                                <label>
                                                <i style="color:#40baf1;font-size:16px;" class="ace-icon fa fa-list-ul"></i> Edit Runlist
                                                </label>
                                                <a href="#chefRunlistModal" data-backdrop="false" data-toggle="modal" style="cursor:pointer;">
                                                <img src="img/add.png" style="float:right;margin-top:6px;" class="addList" rel="tooltip" data-placement="top" title="Edit Runlist" />
                                                </a>
                                                <div style="height:146px;overflow-y:auto;" id="dbNameTable_wrapper" class="dataTables_wrapper no-footer">
                                                  <table id="tableRunlistForBlueprint" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center" ;>
                                                    <thead>
                                                      <tr class="rowCustomStyle">
                                                        <th style="text-align:center">View Runlist</th>
                                                      </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                  </table>
                                                </div>
                                              </div>
                                              <div class="col-lg-4 col-md-4 notForDocker notforCFT" style="margin-top:25px;margin-left:2px;"><a style="font-size:14px!important" href="#modalForHelp" data-toggle="modal" id="dokuNew"><i class="fa fa-question"></i>&nbsp;Help</a>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <!--configure runlist collapse ends here-->
                                        <!--assign runlist modal-->
                                        <div class="modal fade" id="chefRunlistModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
                                          <div class="modal-dialog">
                                            <div class="modal-content" style="width:800px">
                        <form role="form" class="cmxform" id="chefTaskRunlist" autocomplete="off">
                        <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                        </button>
                        <h4 class="modal-title">
                        <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Edit Runlist
                        </h4>
                        </div>
                        <div class="modal-body modal-height">
                        <div class="cookbookShow">
                        </div>
                        </div>
                        <div class="modal-footer">
                        <a type="button" class="btn btn-default" data-dismiss="modal">Close</a>
                        <button type="submit" class="btn btn-primary" id="saveRunlist">Update Runlist</button>
                        </div>
                        </form>
                        </div>
                        <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-dialog -->
                        </div>
                        <!--modal for runlist ends here-->
                        <!--adding new collapse-->
                        <div class="panel panel-default appSeriesNameURL notForDocker notforCFT">
                        <div class="panel-heading">
                        <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseApp" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Application URL</a>
                        </h4>
                        </div>
                        <div id="CollapseApp" class="panel-collapse collapse">
                        <div class="row">
                        <div class="col-md-12">
                        <div class="col-md-12">
                        <div class="widget-box">
                        <div class="widget-header">
                        <h5 class="widget-title" style="color:#4e5964;">
                        <strong>Application URL</strong>
                        </h5>
                        <div class="widget-toolbar no-border">
                        <a id="newAppSeries" class="btn btn-minier btn-primary" href="#modalAppNameURL" data-toggle="modal">
                        <i class="ace-icon ace-icon fa fa-plus bigger-110"></i> New
                        </a>
                        </div>
                        </div>
                        <div class="widget-body">
                        <div class="widget-main" style="min-height:100px">
                        <div class="col-md-12 table-responsive" style="padding-left:0px; padding-right:0px;">
                        <table id="appTable" class="hidden" cellpadding="5px" width="100%">
                        <thead>
                        <tr class="rowCustomStyle">
                        <td>Name</td>
                        <td>URL</td>
                        <td>Action</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="hidden rowtemplate">
                        <td datafield="appName"></td>
                        <td datafield="appURL"></td>
                        <td>
                        <div class="btn-group tableactionWidth">
                        <button class="btn btn-xs btn-danger pull-left" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button>
                        <a class="btn btn-xs btn-info pull-left" title="Update">
                        <i class="ace-icon fa fa-pencil bigger-120"></i>
                        </a>
                        </div>
                        </td>
                        </tr>
                        </tbody>
                        </table>
                        <table id="appUrlTable" class="table table-striped table-bordered table-hover dataTable no-footer" cellpadding="5px" width="100%" style="text-align:center" ;>
                        <thead>
                        <tr class="rowCustomStyle">
                        <td style="width:20%">Name</td>
                        <td style="width:40%">URL</td>
                        <td style="width:20%" class="">Action</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                        <td colspan=3 id="appEntry">No Data Available</td>
                        </tr>
                        </tbody>
                        </table>
                        <div id="envtable_tools1"></div>
                        <div class="col-md-5">
                        </div>
                        </div>
                        </div>
                        <div class="widget-toolbox padding-8 clearfix dataTables_wrapper">
                        <div id="tableFooterLeft" class="pull-left"></div>
                        <div id="tableFooterRight" class="pull-right"></div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        <!--collapseapp ends here-->
                        </div>
                        <!--adding new collapse-->
                        <div class="panel panel-default notForDocker forCFT cftStackParameterArea" style="display:none">
                        <div class="panel-heading">
                        <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#accordion-Design" href="#CollapseStackParameters" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i>Configure Template Parameters</a>
                        </h4>
                        </div>
                        <div id="CollapseStackParameters" class="panel-collapse collapse">
                        <div class="panel-body" style="padding-left: 20px;">
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        </div>
                        <!--tab pane ends here-->
                        <div class="tab-pane" id="tab4" style="padding-bottom:20px;overflow-y: auto;">
                        <div class="blueprintSaveSuccess blueprintMsgContainer">
                        <div class="alert alert-success bootstrapSuccess">
                        <img style="width:50px;height:40px" src="img/correct.png" alt="success" />
                        <span class="blueprintNameSuccess" style="margin-left:20px;"></span>
                        <div style="margin-top:24px;text-align:center;">
                        <button class="btn btn-primary"><a style="color:white;text-decoration:none" href="#ajax/DesignBlueprintAzure.html?addnew" id="addanotherlink">&nbsp;&nbsp;Add New Blueprint</a></button>
                        </div>
                        </div>
                        </div>
                        <div class="blueprintSaveFail blueprintMsgContainer">
                        <div class="alert alert-warning bootstrapFailure">
                        <img style="width:50px;height:40px" src="img/warning.png" alt="warning" />
                        <span style="margin-left:20px;">Unable to save blueprint. Please try again later.</span>
                        </div>
                        </div>
                        </div>
                        <footer class="footer">
                        <div style="text-align:center;" class="clearfix form-actions no-padding">
                        <div class="btn-group">
                        <ul class="pager wizard no-margin" style="margin-left:200px">
                        <li class="previous disabled">
                        <a style="border-radius:0px" class="btn btn-primary" href="javascript:void(0);"> Previous </a>
                        </li>
                        <li class="next" id="nextSpecificValue">
                        <a style="border-radius:0px;margin-left:5px;" class="btn btn-primary" href="javascript:void(0);"> Next </a>
                        </li>
                        </ul>
                        </div>
                        </div>
                        </footer>
                        </div>
                        </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </article>
            </div>
          </section>
        </div>
        <!--view for blueprints-->
        <!--blueprint tab-->
        <div class="tab-pane fade in active" id="viewCreate">
          <div class="jarviswidget jarviswidget-color-blueLight" id="wid-id-10" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false"
            data-widget-sortable="false">
            <div>
              <div class="widget-body no-padding">
                <form action="">
                  <div class="col-lg-12 awsExisting">
                    <div class="col-lg-4 col-md-4">
                      <label for="">Choose Organization
                      <span style="color:red">*</span>
                      </label>
                      <select id="orgnameSelectExisting" class="chooseOrgSelectExisting width-100 form-control">
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-4">
                      <label for="">Business Group</label>
                      <select id="bgListInputExisting" class="chooseBGExisting width-100 form-control">
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-4">
                      <label for="category">Project
                      </label>
                      <select id="projectListInputExisting" class="chooseProjectExisting width-100 form-control">
                      </select>
                    </div>
                    <div class="col-lg-3 col-md-3 hidden">
                      <label for="category">Environment</label>
                      <select id="envListExisting" class="chooseEnvExisting width-100 form-control">
                      </select>
                    </div>
                    <div class="col-lg-12">
                      <label id="spinnerProject" class="hidden"><img  style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif"></label>
                      <label id="npbpmsg" class="npbpmsg hidden">No blueprints found</label>
                      <div class="panel-group smart-accordion-default hidden" id="accordion-2">                                 
                      </div>
                    </div>
                  </div>
                </form>
                <div class="col-lg-12">
                  <div class="panel-group smart-accordion-default hidden" id="accordion-2" style="height:444px;overflow-y: auto;">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <footer class="footer">
            <div class="clearfix form-actions" style="text-align:center">
              <button class="btn pull-right btn-danger right-button" title="Remove Blueprint" onClick="removeSelectedBlueprint()"> <i class="fa fa-trash-o"></i></button>
               <button class="btn pull-right btn-primary right-button" title="Copy Blueprint" onClick="showbpcopydialog();" > <i class="fa fa-copy"></i></button>
            </div>
          </footer>
          <!--Launch div ends here-->
        </div>
       <!--tab-pane l2 gets over -->
        <div class="tab-pane fade in" id="viewEdit">
          <!-- Do Not remove this div. Will be populated on page load -->
          <div class="bpeditcontainer" id="bpeditcontent">
          </div>

          <footer class="footer">
                <div style="text-align:center;height:60px;margin-bottom: -3px" class="clearfix form-actions">
                  <div class="btn-group">
                      
                      <button class="btn btn-primary" onclick="closeblueprintedit();">Cancel</button>
                   
                      <button class="btn btn-primary marginleft15" onclick="saveblueprint();">Save</button>
                   
                  </div>
                </div>
          </footer>
        </div>
        <!--modal for blueprint edit-->
        <div class="modal fade bs-example-modal-lg" id="blueprintEditResultContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">Blueprint Edit</h4>
              </div>
              <div class="modal-body" style="padding:0px !important">
              </div>
              <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary blueprintUpdateBtn" data-dismiss="modal">Save Version</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        <!--modal for blueprint edit ends-->
        <!--updating the runlist while blueprint edit-->
        <div class="modal fade bs-example-modal-lg" id="chefRunModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-pencil-square-o txt-color-blue"></i>Update Runlist</h4>
              </div>
              <div class="modal-body" style="padding:0px !important">
                <div class="chefRunlistContainer">
                </div>
              </div>
              <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary btnUpdateInstanceRunlist">Update</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
        <!--view ends here-->
      </div>
    </div>
  </article>
</div>

 <!-- Copy bp pop-up -->
<div class="modal fade bs-example-modal-lg" id="copyBlueprintModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content modal-copybp">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-list-ol txt-color-blue"></i>&nbsp;Select target</h4>
            </div>
            <div class="modal-body" style="height:232px;">
                <div class="bpcopyContainer">
                    <div class="col-lg-12 col-md-12">
                        <label for="">Organization
                            <!-- <span style="color:red">*</span> --></label>
                        <select id="orgnameSelectExistingforcopy" class="chooseOrgSelectExistingforcopy width-100 form-control">
                        </select>
                    </div>
                    <div class="col-lg-12 col-md-12">
                        <label for="" class="lblbpc">Business Group</label>
                        <select id="bgListInputExistingforcopy" class="chooseBGExistingforcopy width-100 form-control">
                        </select>
                    </div>
                    <div class="col-lg-12 col-md-12">
                        <label for="projectListInputExistingforcopy" class="lblbpc">Project
                        </label>
                        <select id="projectListInputExistingforcopy" class="chooseProjectExistingforcopy width-100 form-control">
                        </select>
                    </div>
                    <div class="col-lg-12 col-md-12 hidden">
                        <label for="envListExistingforcopy" class="lblbpc">Environment</label>
                        <select id="envListExistingforcopy" class="chooseEnvExistingforcopy hidden width-100 form-control">
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 0px !important; padding-right: 8px; padding-top: 7px;">
                <label class="pull-left bpcopycount">3 blueprints selected</label>
                <button type="button" class="btn btn-default btn-primary btncopybp" onclick="copySelectedBlueprint();">Copy</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<!--app series-->
<div class="modal fade" id="modalAppNameURL" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog">
    <div class="modal-content">
      <form role="form" id="appURLForm" autocomplete="off">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
          &times;
          </button>
          <h4 class="modal-title">
            <i class="fa fa-th-list txt-color-blue"></i>&nbsp;&nbsp;Add Application URL
          </h4>
        </div>
        <div class="modal-body appSeriesHeight">
          <!--app series-->
          <div class="applicationURLContainer" id="appSeries">
            <div class="col-lg-6 col-md-6 projectRepo">
              <label for="">Name:</label>
              <input placeholder="AppName" type="text" maxlength="8" name="appNameInput" class="form-control appName">
              <b class="tooltip tooltip-top-right">
              <i class="fa fa-user txt-color-teal"></i> Please enter Application</b>
            </div>
            <div class="col-lg-6 col-md-6 projectRepo">
              <label for="">URL:</label>
              <input placeholder="http://$host[:port]/appname" name="appNameURL" class="form-control appURL" type="text">
              <b class="tooltip tooltip-top-right">
              <i class="fa fa-user txt-color-teal"></i> Please enter URL</b>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <label id="nodeAppspinner" class=" hidden">
          <img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif">
          </label>
          <div class="marginForButtons">
            <button id="addAppBtn" class="btn btn-primary" type="submit">
            <i class="fa fa-upload fa-1x"></i>&nbsp;Add
            </button>
            <a class="btn btn-primary" type="submit" data-dismiss="modal">
            <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel
            </a>
          </div>
        </div>
      </form>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>

<!-- Version and Edit pop-up -->
<div class="modal fade bs-example-modal-lg" id="versionModalContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-vs">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="myModalLabel"><i class="fa fa-list-ol txt-color-blue"></i>&nbsp;Versions</h4>
            </div>
            <div class="modal-body versionModalBody">
                <div class="versionpopupContainer">
                    <label for="">Select a version</label>
                    <div id="selbpv" class="selbpv" size="10">
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="margin-top:0px !important;">
                <button type="button" class="btn btn-default btn-primary btnVersionEdit">Edit</button>
                <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- /.modal for appSeries ends-->
<!--app series ends here-->
<!--launch docker-->
<!--launch docker-->
<div class="modal fade bs-example-modal-lg" id="myModalDockerTemplateContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-lg" style="width:580px">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true">&times;</span>
        <span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title" id="DockerLaunch">Add a Docker Template</h4>
      </div>
      <div class="modal-body " style="height:117px">
        <section>
          <form id="dockerparamsform" action="">
            <div class="col-lg-6 col-md-6">
              <label for="category">Select Template
              <span style="color:red">*</span>
              <span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
              </label>
              <select class="chooseSelect width-100 form-control" id="dockertemplateselector" onchange="imagechanged();">
              </select>
            </div>
            <div class="col-lg-6 col-md-6">
              <label for="category">Select Tag
              <span style="color:red">*</span>
              <span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
              </label>
              <label id="dockertemplateSpinner" class="hidden">
              <img style="margin-left:5px;margin-right:25px;" src="img/select2-spinner.gif">
              </label>
              <select class="chooseSelect width-100 form-control" id="dockertemplatetagselector">
              </select>
               <div class="small pull-right" style="margin-right:10px">
                  To get private repo tags, add a hub account in Settings > DevOps Setup > Docker
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="modal-footer">
        <button type="button" id="btnaddDockerTemplateToTable" class="btn btn-default btn-primary" onclick="addDockerTemplateToTable($('#dockertemplateselector option:selected').text(),$('#dockertemplateselector').val(),$('#dockertemplatetagselector').val(),$('#dockertemplateselector option:selected').attr('reponame'));$('#myModalDockerTemplateContainer').modal('hide');">
        <i class="fa fa-save fa-1x"></i>&nbsp;Add</button>
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">
        <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade bs-example-modal-lg" id="myModalLabelDockerContainer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true">&times;</span>
        <span class="sr-only">Close</span>
        </button>
        <h4 class="modal-title" id="DockerLaunch">Launch Parameters-Docker Blueprints</h4>
      </div>
      <div class="modal-body dockerModalHeight">
        <section>
          <form id="dockerparamsform" action="">
            <div style="margin:0px;">
              <div class="col-lg-6 col-md-6">
                <label for="category">Container Name
                <span style="color:red">*</span>
                <span class="dockerparamrequired hidden" style="color:red">&nbsp;Required</span>
                </label>
                <input type="text" id="Containernamefield" name="namefield" class="required form-control" placeholder="" dockerparamkey="--name" onclick="$('.dockerparamrequired').addClass('hidden')">
              </div>
              <div class="col-lg-6 col-md-6">
                <label for="category">Port Mappings
                </label>
                <input type="text" id="Portmappingfield" name="Portmappingfield" class=" form-control" placeholder="Map host ports to container ports" dockerparamkey="-p">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Volumes
                </label>
                <input type="text" id="Volumesfield" name="Volumesfield" class=" form-control" placeholder="Map host folders to container folders" dockerparamkey="-v">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Volumes-from
                </label>
                <input type="text" id="Volumes-fromfield" name="Volumes-fromfield" class=" form-control" placeholder="Comma separated container names" dockerparamkey="--volumes-from">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Linked Container
                </label>
                <input type="text" id="Linkedcontainerfield" name="Linkedcontainerfield" class=" form-control" placeholder="The name of a container this one links to" dockerparamkey="--link">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Environment Variables
                </label>
                <input type="text" id="Environmentvariablesfield" name="Environmentvariablesfield" class=" form-control" placeholder="" dockerparamkey="-e">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Startup Command
                </label>
                <input type="text" id="Startupcommandfield" name="Startupcommandfield" class=" form-control" placeholder="Optional startup command for the container" dockerparamkey="-c">
              </div>
              <div class="col-lg-6 col-md-6 dockerModal">
                <label for="category">Additional Startup
                </label>
                <input type="text" id="additionalStartupcommandfield" name="additionalStartupcommandfield" class=" form-control" placeholder="Additional startup command for the container" dockerparamkey="-exec">
              </div>
              <div class="col-lg-6 hidden">
                <label for="category">Removed Linked Containers on Exit
                </label>
                <select class="chooseSelect width-100 form-control" id="Removelinkedcontainersonexitfield" placeholder="Should this & linked containers be removed on exit">
                  <option>False</option>
                  <option>True</option>
                </select>
              </div>
              <div class="col-lg-6 dockerModal hidden">
                <label for="category">Remove on Exit
                </label>
                <select class="chooseSelectExit width-100 form-control " id="Removeonexitfield" placeholder="Should this container be removed when it exits">
                  <option>False</option>
                  <option>True</option>
                </select>
              </div>
              <div class="col-lg-6 hidden">
                <label for="">Startup Script</label>
                <label class="input input-file" for="file">
                  <div class="button">
                    <input type="file" id="Startupscriptfield" name="Startupscriptfield">Browse
                  </div>
                  <input type="text" readonly="">
                </label>
              </div>
            </div>
          </form>
        </section>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-primary" onclick="if(generateDockerLaunchParams()!=''){$('#myModalLabelDockerContainer').modal('hide');}else{return(false);}">
        <i class="fa fa-save fa-1x"></i>&nbsp;Add</button>
        <button type="button" class="btn btn-default btn-primary" data-dismiss="modal">
        <i class="fa fa-undo fa-1x"></i>&nbsp;Cancel</button>
      </div>
    </div>
  </div>
</div>
<div id="configureVMModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Configure VMs</h4>
      </div>
      <div class="modal-body">
        <fieldset></fieldset>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary configureVMSaveBtn" data-dismiss="modal">Save</button>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<!--html  content ends here-->

<script type="text/javascript">
var checkandupdateRunlistTable = function(){
  if (!$.fn.dataTable.isDataTable('#tableRunlistForBlueprint')) {
    $tasksRunlist = $('#tableRunlistForBlueprint').DataTable({
      "pagingType": "full_numbers",
      "bInfo": false,
      "bLengthChange": false,
      "paging": false,
      "bFilter": false,
      "aoColumns": [{
        "bSortable": false
      }]
    });
  }
}
checkandupdateRunlistTable();

//Used for maintaining one copy of the form for edit or new
var $formBPEdit;
var $formBPNew;

function createRunlistTable(runlist) {

  $tasksRunlist.clear().draw();
  for (i = 0; i < runlist.length; i++) {
    var $runlistList = $('#tableRunlistForBlueprint');
    var $tr = $('<tr class="runlistRow"></tr>');
    var $tdName = $('<td class="runlistDescription">' + runlist[i] + '</td>');
    $tr.append($tdName);
    $runlistList.append($tr);
    $tasksRunlist.row.add($tr).draw();
  }
}

$('#saveRunlist').click(function(e) {
  var $ccrs = $('.cookbookShow').data('$ccrs');
  console.log($ccrs);
  console.log($ccrs.getSelectedRunlist());
  var runlist = $ccrs.getSelectedRunlist();
  createRunlistTable($ccrs.getRunlistNames());
  $('#chefRunlistModal').modal('hide');
  return false;


});

function updatecompositedockertableemptymessage() {
  if ($('#compositedockertable').find('tr').length <= 1) {
    //no rows found add empty message
    $('#compositedockertable').append('<tr id="dockerimageemptytr"><td colspan="6" align="center">No images added</td></tr>');
  }

}
var providerselected = $('#blueprints').attr('providerselected');
$(document).ready(function() {
  $(".chooseOrgSelectExisting");
  $(".chooseBGExisting");
  $(".chooseProjectExisting");
  $(".chooseEnvExisting");
   $('#orgnameSelect');
  $('#selectOrgName').trigger('change');
 

  var $addal = $("#addanotherlink"); //#ajax/Aws-Production.html?addnew
  if (window.url.indexOf('addnew') > 0)
    $addal.attr('href', '#ajax/DesignBlueprintAzure.html?addanother');
  else
    $addal.attr('href', '#ajax/DesignBlueprintAzure.html?addnew');



  $.ajax({
    type: "get",
    dataType: "json",
    async: false,
    url: "../organizations/getTreeNew",
    success: function(data) {
      console.log(data);
      data = JSON.parse(JSON.stringify(data));
      var $orgListInput = $('#orgnameSelectExisting');
      var $bgList = $('#bgListInputExisting');
      var $projectList = $('#projectListInputExisting');
      var $envList = $('#envListExisting');
      var $projectList = $('#projectListInputExisting');


      var $orgListInputforcopy = $('#orgnameSelectExistingforcopy');
      var $bgListforcopy = $('#bgListInputExistingforcopy');
      var $projectListforcopy = $('#projectListInputExistingforcopy');
      var $envListforcopy = $('#envListExistingforcopy');


      $bgList.change(function(e) {
        var bgName = $(this).val();
        if (bgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $projectList.empty();
        var getProjs = bgProjects[bgName];
        for (var i = 0; i < getProjs.length; i++) {
          var $option = $('<option></option>').val(getProjs[i].rowid).html(getProjs[i].name);
          $projectList.append($option);
        }
        $projectList.trigger('change');
      });

      $bgListforcopy.change(function(e) {
        var bgName = $(this).val();
        if (bgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $projectListforcopy.empty();
        var getProjs = bgProjects[bgName];
        for (var i = 0; i < getProjs.length; i++) {
          var $option = $('<option></option>').val(getProjs[i].rowid).html(getProjs[i].name);
          $projectListforcopy.append($option);
        }
        $projectListforcopy.trigger('change');
      });



      var $spinnerProject = $('#spinnerProjectChange').addClass('hidden');
      $('#projectListInputExisting').change(function(e) {
        var reqBodyNew = {};
        $spinnerProject.removeClass('hidden');
        reqBodyNew.orgId = $orgListInput.val();
        reqBodyNew.bgId = $bgList.val();
        reqBodyNew.projectId = $projectList.val();
        reqBodyNew.envId = $envList.val();
        $.get('../organizations/' + reqBodyNew.orgId + '/businessgroups/' + reqBodyNew.bgId + '/projects/' + reqBodyNew.projectId + '/environments/' + reqBodyNew.envId + '/azure', function(data) {
          console.log('success---3---4');
          //Syncing up the tree view based on url
          initializeBlueprintAreaNew(data.blueprints);
          $spinnerProject.addClass('hidden');
          if (data.blueprints.length > 0) {
            $('#accordion-2').removeClass('hidden');
            $spinnerProject.addClass('hidden');
          } else {
            $spinnerProject.addClass('hidden');
          }
        });
      }); //choose env gets over
      var bgProjects = {};
      for (var i = 0; i < data.length; i++) {
        console.log(data[i].businessGroups);
        $orgListInput.append($('<option></option>').val(data[i].rowid).html(data[i].name).data('bglist', data[i].businessGroups).data('envList', data[i].environments));
        $orgListInputforcopy.append($('<option></option>').val(data[i].rowid).html(data[i].name).data('bglist', data[i].businessGroups).data('envList', data[i].environments));
        for (var j = 0; j < data[i].businessGroups.length; j++) {
          var rowid = data[i].businessGroups[j].rowid;
          $bgList.append($('<option></option').val(rowid).html(data[i].businessGroups[j].name));
          bgProjects[rowid] = data[i].businessGroups[j].projects;
          $bgListforcopy.append($('<option></option').val(rowid).html(data[i].businessGroups[j].name));
        }
        $bgListforcopy.trigger('change');
        for (var k = 0; k < data[i].environments.length; k++) {
          $envList.append($('<option></option').val(data[i].environments[k].rowid).html(data[i].environments[k].name))
        }
      }
      $('#orgnameSelectExisting');
      $bgList.trigger('change');
      

      $('.chooseOrgSelectExisting').change(function(e) {
        if ($(this).val() == 'choose') {
          $('#accordion-2').addClass('hidden');
        }
        $('.chooseBGExisting').change();
        $('.chooseProjectExisting').change();
      });

      $('.chooseOrgSelectExistingforcopy').change(function(e) {
        
        $('.chooseBGExistingforcopy').change();
        $('.chooseProjectExistingforcopy').change();
      });
    }
  }); //getTreeNew gets over here

  //form validation for blueprint save
  var validator = $('#wizard-1').validate({
    ignore: [],
    rules: {
      "checkbox-toggle": {
        required: true
      },
      blueprintNameInput: {
        maxlength: 25
      }
    },
    messages: {
      blueprintNameInput: {
        maxlength: "Limited to 25 characters"
      }
    },
    onkeyup: false,
    errorClass: "error",

    //put error message behind each form element
    errorPlacement: function(error, element) {
      console.log(error, element);
      var elem = $(element);
      if (element.parent('.input-groups').length) {
        error.insertBefore(element.parent());
      } else {
        if (element.parent('div.inputGroups')) {
          console.log(element);
          console.log(element.parent);
          error.insertBefore('div.inputGroups');
        }

        $("select.select2-me").each(function(index, el) {

          if ($(this).is("[data-rule-required]") &&
            $(this).attr("data-rule-required") == "true") {
            $(this).on('select2-close', function(e) {
              $(this).valid()
            });
          }
        });
      }
    },

    //When there is an error normally you just add the class to the element.
    // But in the case of select2s you must add it to a UL to make it visible.
    // The select element, which would otherwise get the class, is hidden from
    // view.
    highlight: function(element, errorClass, validClass) {
      var elem = $(element);
      if (elem.hasClass("select2-offscreen")) {
        $("#s2id_" + elem.attr("id") + " ul").addClass(errorClass);
      } else {
        elem.addClass(errorClass);
      }
    },

    //When removing make the same adjustments as when adding
    unhighlight: function(element, errorClass, validClass) {
      var elem = $(element);
      if (elem.hasClass("select2-offscreen")) {
        $("#s2id_" + elem.attr("id") + " ul").removeClass(errorClass);
      } else {
        elem.removeClass(errorClass);
      }
    }
  });
  $('a#addanotherlink').click(function(e) {
    validator.resetForm();
  });
  $(document).on('change', '.select2-offscreen', function() {
    if (!$.isEmptyObject(validator.submitted)) {
      validator.form();
    }
  });

  $(document).on("select2-opening", function(arg) {
    var elem = $(arg.target);
    if ($("#s2id_" + elem.attr("id") + " ul").hasClass("myErrorClass")) {
      //jquery checks if the class exists before adding.
      $(".select2-drop ul").addClass("myErrorClass");
    } else {
      $(".select2-drop ul").removeClass("myErrorClass");
    }
  });

  $formBPNew = $('#tab3').clone();
  $formBPEdit = $('#tab3').clone().append('<input type="hidden" id="blueprintId">');

}); //document.ready gets over here
//the blueprint section gets over here.

$('#launchParamDocker').click(function() {
  $('#dockerparamsform')[0].reset();
  $('.chooseSelectExit').change();
});


function generateDockerLaunchParams() {
  if ($('#Containernamefield').val() == '') {
    $('.dockerparamrequired').removeClass('hidden');
    return ('');
  }

  var launchparams = '';
  $('[dockerparamkey]').each(function() {
    if ($(this).val() != '') {
      var itms = $(this).val().split(',');
      for (itm in itms)
        launchparams += ' ' + $(this).attr('dockerparamkey') + ' ' + itms[itm];
    }
  });
  $('#' + $('#myModalLabelDockerContainer').attr('saveto')).val(launchparams);

  return (launchparams);
}


function addDockerTemplateToTable(title, repopath, tagname, reponame,optionallaunchparams) {
  var $cdt = $('#compositedockertable');
  var uniqueid = (Math.floor(Math.random() * 9000) + 1000).toString();
  //remove any empty row message from table
  $('#dockerimageemptytr').detach();
  if (!optionallaunchparams) {
    optionallaunchparams = '';
  }
  var $dockertemplaterow = '<tr class="dockerimagesrow"><td >' + $cdt.find('tr').length + '</td><td paramtype="dockercontainerpathstitle">' + title + '</td><td  paramtype="dockercontainerpaths">' + repopath + '</td><td paramtype="dockerrepotags">' + tagname + '</td><td><input type="text" paramtype="dockerlaunchparameters" id="launchparam' + uniqueid + '" class="" value=" ' + optionallaunchparams + '"><input type="hidden" paramtype="dockerreponame" id="dockerreponame' + uniqueid + '" class="" value="' + reponame + '"><a onclick="loadLaunchParams(\'launchparam' + uniqueid + '\');" href="javascript:void(0);"><i class="icon-append fa fa-list-alt fa-lg" title="Launch Parameters"></i></a></td><td ><a class="dockerimageselectorup" id="dockerimageselectorup' + uniqueid + '"  href="javascript:movetablerow(\'dockerimageselectorup\',' + uniqueid + ');"><i class="fa fa-chevron-circle-up fa-lg"></i></a><a class="dockerimageselectordown" id="dockerimageselectordown' + uniqueid + '" href="javascript:movetablerow(\'dockerimageselectordown\',' + uniqueid + ');" style="padding-left:5px;"><i class="fa fa-chevron-circle-down fa-lg"></i></a><button class="btn btn-xs btn-danger pull-right" value="Remove" title="Remove" id="dockerimageremove' + uniqueid + '" onClick="javascript:removeimage(\'dockerimageremove\',' + uniqueid + ');"><i class="ace-icon fa fa-trash-o fa-lg"></i></button></td></tr>';

  $cdt.append($dockertemplaterow);

}

function showdockertemplateadder() {
$('#dockertemplateselector').val('');
  $('#dockertemplatetagselector').empty().val('');
  //populating template selector with templates
  var templateurl = "/d4dMasters/readmasterjsonnew/17";
  $('#dockertemplateselector').empty().val('');
  $('#dockertemplatetagselector').empty().val('');
  $.get('/d4dMasters/readmasterjsonnew/17',function(data){
    if(data.length > 0)
    {
     var rowGridLength = (data.length);
     for (var z = 0; z < rowGridLength; z += 1) {
       //console.log(data[z]["templatetypename"].toLowerCase());
       var dockercontainerpathstitle = data[z]['dockercontainerpathstitle'];
       var dockercontainerpaths = data[z]['dockercontainerpaths'];
       var dockerreponame = data[z]['dockerreponame'];
       var getTempName = data[z]['templatename']
       if(data[z]["templatetypename"].toLowerCase() === 'docker'){
         $('#dockertemplateselector').append('<option value="' + dockercontainerpaths + '" title="' + dockercontainerpaths + '" reponame="' + dockerreponame + '">' + getTempName  + '</option>'); //dockercontainerpathstitle
       }
     }
    }
    $('#myModalDockerTemplateContainer').modal('show');
  });
}

function addrows() { //only for testing to be removed
  addDockerTemplateToTable('one', 'one/one', "latest");
  addDockerTemplateToTable('two', 'two/two', "latest");
  addDockerTemplateToTable('three', 'three/three', "latest");
}

function imagechanged__() {
  $('#btnaddDockerTemplateToTable').attr('disabled', 'disabled');
  $('#dockertemplateSpinner').removeClass('hidden');
  $('#dockertemplatetagselector').empty().select2('val', '');
  $.get('/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'), function(data) {
    $('#dockertemplateSpinner').addClass('hidden');
    if (data) {
      var tagJson = JSON.parse(data);
      var $dockertemplatetagselector = $('#dockertemplatetagselector');
      $dockertemplatetagselector.empty();
      tagJson.forEach(function(k, v) {
        $dockertemplatetagselector.append('<option value="' + tagJson[v].name + '">' + tagJson[v].name + '</option>');
        if (v >= tagJson.length - 1) {
          $('#btnaddDockerTemplateToTable').removeAttr('disabled');
        }
      });
      $dockertemplatetagselector.change();
    }
  });
}

function imagechanged() {
  $('#btnaddDockerTemplateToTable').attr('disabled', 'disabled');
  $('#dockertemplateSpinner').removeClass('hidden');
  $('#dockertemplatetagselector').empty().val('');
  if($('#dockertemplateselector option:selected').attr('reponame') == '')
    $('#dockertemplateselector option:selected').attr('reponame','null');

  //alert('url:' + '/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'));
  $.get('/d4dmasters/getdockertags/' + encodeURIComponent($('#dockertemplateselector').val().replace(/\//g, "$$$")) + '/' + $('#dockertemplateselector option:selected').attr('reponame'), function(data) {
    $('#dockertemplateSpinner').addClass('hidden');
    if (data) {
      var tagJson = JSON.parse(data);
      var $dockertemplatetagselector = $('#dockertemplatetagselector');
      $dockertemplatetagselector.empty();
      tagJson.forEach(function(k, v) {
        $dockertemplatetagselector.append('<option value="' + tagJson[v].name + '">' + tagJson[v].name + '</option>');
        if (v >= tagJson.length - 1) {
          $('#btnaddDockerTemplateToTable').removeAttr('disabled');
        }
      });
      $dockertemplatetagselector.change();
    }
    
  });
}


function removeimage(what, index) {
  bootbox.confirm("Remove docker image?", function(result) {
    if (!result) {
      return;
    }
    var $lnk = $('#' + what + index);
    var row = $lnk.closest('.dockerimagesrow');
    row.detach();
    renumberDockerImageTable();
    //Add empty message when no rows found
    updatecompositedockertableemptymessage();
  });
}

function renumberDockerImageTable() {
  var $cdt = $('#compositedockertable').find('tr').each(function(i) {
    $(this).find('td').first().html(i);
  });

}

function movetablerow(what, index) {
  var $lnk = $('#' + what + index);
  var row = $lnk.closest('.dockerimagesrow');
  if (what === "dockerimageselectorup") {
    var prev = row.prev();
    if (prev.is('tr.dockerimagesrow')) {
      row.detach();
      prev.before(row);
      row.fadeOut();
      row.fadeIn();
    }
  } else {
    var next = row.next();
    if (next.is('tr.dockerimagesrow')) {
      row.detach();
      next.after(row);
      row.fadeOut();
      row.fadeIn();
    }
  }
  renumberDockerImageTable();
}


function loadLaunchParams(lpinput) {
  $('[dockerparamkey]').val('');
  if ($('#' + lpinput).val() != '') {
    //filling in -exec and -c
    var fullparams = $('#' + lpinput).val();
    var execparam = fullparams.split(' -exec');
    var startupparam;
    if (execparam.length > 0 && typeof execparam[1] != "undefined") {
      $('#additionalStartupcommandfield').val(execparam[1]);
      if (execparam[0].indexOf('-c') > 0) //found a startup command
      {
        startupparam = execparam[0].split(' -c');
        if (startupparam.length > 0) {
          $('#Startupcommandfield').val(startupparam[1]);
          fullparams = startupparam[0];
        } else {
          fullparams = startupparam[0];
        }
      } else
        fullparams = execparam[0];
    } else {
      startupparam = fullparams.split(' -c');
      if (startupparam.length > 0) {
        $('#Startupcommandfield').val(startupparam[1]);
        fullparams = startupparam[0];
      }
    }


    var params = fullparams.split(' -');
    for (para in params) {
      var subparam = params[para].split(' ');
      if (subparam.length > 0) {
        $inp = $('[dockerparamkey="-' + subparam[0] + '"]').first();
        if ($inp.val() != '')
          $inp.val($inp.val() + ',' + subparam[1]);
        else
          $inp.val(subparam[1]);
      }
    }
  }
  $('#myModalLabelDockerContainer').attr('saveto', lpinput).modal('show');
}

function helperConstructOption(data, keyList, nameKey, valueKey) {
  function getOptionAppend(obj, keyList, nameKey, valueKey) {
    var str = '<option ';
    for (var i = 0; i < keyList.length; i++) {
      str = str + keyList[i] + '="' + obj[keyList[i]] + '" ';
    }
    str = str + 'value="' + obj[valueKey] + '" >' + obj[nameKey] + '</option>';
    return str;
  }

  var str = ''
  for (var i = 0; i < data.length; i++) {
    str = str + getOptionAppend(data[i], keyList, nameKey, valueKey);
  }
  return str;
}

function getProviderListold() {
  $.ajax({
    type: "GET",
    url: "/aws/providers",
    success: function(data) {
      data = typeof data == "string" ? JSON.parse(data) : data;
      console.log(data);
      var str = ' <option value="">Select Provider</option>',
        len = data.length;
      str = str + helperConstructOption(data, ['secretKey', 'accessKey', 'providerType'], 'providerName', '_id');
      $('#providerId').html(str);
    },
    failure: function(data) {
      alert(data.toString());
    }
  });
}

function getProviderList() {
  $.ajax({
    type: "GET",
    url: "/azure/providers",
    success: function(data) {
      data = typeof data == "string" ? JSON.parse(data) : data;
      console.log(data);
      var str = ' <option value="">Select Provider</option>',
        len = data.length;
      str += helperConstructOption(data, ['username', 'password', 'providerType'], 'providerName', '_id');
      $('#providerId').html(str);
    },
    failure: function(data) {
      alert(data.toString());
    }
  });

}


function getImagesWithOSFilter() {

  function getFilteredList(data, value) {
    if (!value) {
      return data;
    }
    var list = [];
    for (var i = 0; i < data.length; i++) {
      if (data[i].osName.toLowerCase() === value.toLowerCase()) {
        list.push(data[i]);
      }
    }
    console.log(list);
    return list;
  }


  function loadData() {
   
    var providerVal = $('#providerId').val();
    if (providerVal) {
      $.get("/vmimages/providers/" + providerVal, function(data) {
        var str = ' <option value="">Select Image</option>',
          data = getFilteredList(data, $('#instanceOS').val()),
          len = data.length;
        str = str + helperConstructOption(data, ['providerId', 'vType', 'osType', '_id'], 'name', 'imageIdentifier');

        $('#imageId').html(str).trigger('change');
        if($('#imageId').attr('savedval'))
          helpersetselectvalue($('#imageId'),'_id',$('#imageId').attr('savedval'));       
        //setting image value for ami type and disabling it- vn
        if ($('.productdiv2.role-Selected').first().attr('templatetype') == 'ami') {
          var vmimage = JSON.parse($('.productdiv2.role-Selected').first().attr('imagedata'));
          $('#imageId').val(vmimage.imageIdentifier).attr('disabled', 'disabled');
          //alert($('#instanceOS option').length);
        }
      });
    } else {
      $('#imageId').html('<option value="">Select Image</option>').trigger('change');
    }
    if (providerselected == 'azure') {
      $('.forazure').show();
      if(providerVal && providerVal!= ''){
        $.get('/azure/' + providerVal + '/locations', function(data) {
          console.log("locations response:", data);
          data = JSON.parse(data);

          if (data) {

            var temp = data.Locations.Location;
            console.log("locations:", temp.length);

            var str = ' <option value="">Select Location</option>';
            for (var i = 0; i < temp.length; i++) {

              var flavorsByLocation = temp[i].ComputeCapabilities.VirtualMachinesRoleSizes.RoleSize;
              var flavorsList = [];

              for (var j = 0; j < flavorsByLocation.length; j++) {
                flavorsList.push(flavorsByLocation[j]);
              }
              console.log(temp[i].Name);

              str += '<option value="' + temp[i].Name + '" flavors=' + flavorsList.join() + '>' + temp[i].Name + '</option>';
            }

            $('#location').html(str);

            $('#location').on('change', function() {
              $('#vpcSpinner').removeClass('hidden');
              var selectedLocation = $(this).val();

              $.get('/azure/' + providerVal + '/networks', function(data) {
                console.log("networks response:", data);
                data = JSON.parse(data);


                if (data) {

                  var networks = data.VirtualNetworkSites.VirtualNetworkSite;
                  console.log("networks:", networks);

                  var str = ' <option value="">Select VPC</option>';
                  var isNetwroksExists = false;

                  for (var i = 0; i < networks.length; i++) {
                    if (selectedLocation == networks[i].Location) {

                      var subnets = [];
                      var temp = networks[i].Subnets.Subnet;

                      if (temp.length) {
                        for (var j = 0; j < temp.length; j++) {
                          subnets.push(temp[j].Name);
                        }
                      } else {
                        subnets.push(temp.Name);
                      }

                      str += '<option value="' + networks[i].Name + '" subnets="' + subnets.join() + '">' + networks[i].Name + '</option>';

                      isNetwroksExists = true;
                    }
                  }

                  if (!isNetwroksExists) {
                    str = '<option value="">No Networks exists in this location</option>';
                  }

                  $('#vpcId').html(str);
                 

                  $('#vpcSpinner').addClass('hidden');

                  $('#vpcId').trigger('change');

                  $('#vpcId').on('change', function() {
                    $('#spinnerSubnet').removeClass('hidden');
                    var ss = ' <option value="">Select Subnet</option>';
                    var subn = $(this).find(':selected').attr('subnets').split(',');

                    for (var i = 0; i < subn.length; i++) {
                      ss += '<option value="' + subn[i] + '">' + subn[i] + '</option>';
                    }

                    $('#subnetId').html(ss);
                    if($('#subnetId').attr('savedval'))
                    {
                      helpersetselectvalue($('#subnetId'),'value',$('#subnetId').attr('savedval'));
                    }
                    $('#spinnerSubnet').addClass('hidden');
                    $('#subnetId').trigger('change');
                  });
                  if($('#vpcId').attr('savedval'))
                  {
                    helpersetselectvalue($('#vpcId'),'value',$('#vpcId').attr('savedval'));
                  }
                }
              });

              $('#spinnerSize').removeClass('hidden');

              console.log("flavors:", $(this).find(':selected').attr('flavors'));

              var flavors = $(this).find(':selected').attr('flavors').split(',');
              var sizeOption = ' <option value="">Choose Instanace Size</option>';

              for (var i = 0; i < flavors.length; i++) {
                sizeOption += '<option value="' + flavors[i] + '">' + flavors[i] + '</option>';
              }

              $('#instancesize').html(sizeOption);
              if($('#vpcId').attr('savedval'))
              {
                helpersetselectvalue($('#vpcId'),'value',$('#vpcId').attr('savedval'));
              }
               if($('#instancesize').attr('savedval'))
              {
                helpersetselectvalue($('#instancesize'),'value',$('#instancesize').attr('savedval'));
              }

              $('#instancesize').trigger('change');

              $('#spinnerSize').addClass('hidden');

            });

            if($('#location').attr('savedval'))
            {
              helpersetselectvalue($('#location'),'value',$('#location').attr('savedval'));
              if ($('.productdiv2.role-Selected').first().attr('templatetype') == "ami") {
                $('#instanceOS').attr('disabled', 'disabled');
                $('#providerId').attr('disabled', 'disabled');
                $('#imageId').attr('disabled', 'disabled');
              }
            }
          }
        });
      }
    } else if (providerselected == 'openstack') {
      $('.foraws').hide();
      $('.foropenstack').show();
      $('.foraws select').removeClass('required'); //removing all aws required fields. when openstatck
      //load each of the dropdowns
      //flavour
      $.get('/openstack/' + providerVal + '/flavors', function(data) {
        if (data) {
          var str = ' <option value="">Select Flavors</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.flavors.length; i++) {
            str += '<option value="' + data.flavors[i].id + '">' + data.flavors[i].name + '</option>';

          }
          $('#openstackflavour').html(str);
          $('#openstackflavour').trigger('change');
        }
      });

      $.get('/openstack/' + providerVal + '/networks', function(data) {
        if (data) {
          var str = ' <option value="">Select Network</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.networks.length; i++) {
            str += '<option value="' + data.networks[i].id + '" subnets="' + data.networks[i].subnets.join() + '">' + data.networks[i].name + '</option>';

          }
          $('#openstacknetwork').html(str);
          $('#openstacknetwork').trigger('change');
          $('#openstacknetwork').on('change', function() {

            var ss = ' <option value="">Select Subnet</option>';
            var subn = $(this).find(':selected').attr('subnets').split(',');

            for (var i = 0; i < subn.length; i++) {
              ss += '<option value="' + subn[i] + '">' + subn[i] + '</option>';
            }

            $('#openstacksubnet').html(ss);
            $('#openstacksubnet').trigger('change');
          });
        }
      });

      $.get('/openstack/' + providerVal + '/securityGroups', function(data) {
        if (data) {
          var str = ' <option value="">Select Group</option>';
          var data = JSON.parse(JSON.stringify(data));
          for (var i = 0; i < data.security_groups.length; i++) {
            str += '<option value="' + data.security_groups[i].id + '">' + data.security_groups[i].name + '</option>';
          }
          $('#openstacksecuritygroup').html(str);
          $('#openstacksecuritygroup').trigger('change');
        }
      });

    } else {
      $('.foraws').show();
      $('.foropenstack').hide();
      $('.foraws select').addClass('required'); //to be tested.
    }
  }

  $('#providerId').on('change', loadData);
  $('#instanceOS').on('change', loadData);
}

function setSecurityCheckedList(list) {
  //alert(list);
  $.each(list,function(index,val){
    $('#securityGroupIds').find('input[value="' + val + '"]').removeAttr('checked').trigger('click');
  });
}

function getSecurityCheckedList() {
  var list = []
  $('#securityGroupIds').find('input[type="checkbox"]:checked').each(function() {
    list.push(this.value);
  });

  return list;
}

function getImageInstances() {
  $('#imageId').on('change', function() {
    $.get("/vmimages/instancesizes/all/list", function(data) {
      var vType = $('#imageId').find('option:selected').attr('vType'),
        str = '<option value=""> Select Instance Size</option>';
      var list = [];

      for (var i = 0; i < data.length; i++) {
        for (var key in data[i]) {
          if (vType == key) {
            list = data[i][key];
            break;
          }
        }
      }
      for (var i = 0; i < list.length; i++) {
        str = str + '<option value="' + list[i] + '">' + list[i] + '</option>'
      }
      $('#instancesize').html(str);

    });

  });
}
var regionList;

function getCompleteRegionList() {
  $.get('/vmimages/regions/list', function(data) {
    regionList = data;
  });
}
getCompleteRegionList();


function getSecurityGroup() {

  function bringAllOpenFirst(data) {
    var temp, index;
    for (var i = 0; i < data.length; i++) {
      if (data[i].GroupName == "all_open") {
        temp = data[i];
        index = i;
        break;
      }
    }
    if (temp) {

      data[index] = data[0];
      data[0] = temp;
    }
    return data;
  }

  function populateData() {
    var $provider = $('#providerId');
    var accessKey = $provider.find("option:selected").attr('accessKey');
    secretKey = $provider.find("option:selected").attr('secretKey');
    region = $('#region').val();
    vpcId = $('#vpcId').val();
    var $spinnerSecurityGroup = $('#spinnerSecurityGroup').addClass('hidden');
    if (accessKey && secretKey && region && vpcId) {
      $spinnerSecurityGroup.removeClass('hidden');
      $.ajax({
        url: '/aws/providers/vpc/' + vpcId + '/securitygroups',
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(list) {

          var str = '',
            getTemplate = function(val, name) {
              return '<label class="toggle font-sm" style="padding-left:4px;"><input onclick="if($(this).is(&quot;:checked&quot;)) {$(this).closest(&quot;label&quot;).' +
                'css(&quot;background-color&quot;,&quot;#eeeeee&quot;);$(this).css(&quot;border-color&quot;,&quot;#3b9ff3&quot;);}else{$(this).closest(&quot;label&quot;).css(&quot;background-color&quot;,&quot;#ffffff&quot;);$(this).css(&quot;border-' +
                'color&quot;,&quot;red&quot;);}" type="checkbox" id="checkbox-toggle" name="checkbox-toggle" rowid="1ae4f099-7adc-4089-81c6-db2248774142"' +
                'value="' + val + '" style="width:100%"><i data-swchoff-text="NO" data-swchon-text="YES"></i>' + name + '</label>';
            },
            list = bringAllOpenFirst(list),
            len = list.length;
          for (var i = 0; i < len; i++) {
            str = str + getTemplate(list[i].GroupId, list[i].GroupId + ' | ' + list[i].GroupName);
          }
          $spinnerSecurityGroup.addClass('hidden');
          $('#securityGroupIds').html('').append(str);

        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#securityGroupIds').html('');
    }
  }

  $('#vpcId').on('change', populateData);
}

function getkeypairList() {
  function getRegionName(regionValue) {
    for (var i = 0; i < regionList.length; i++) {
      if (regionList[i].region.toLowerCase() == regionValue.toLowerCase()) {
        return regionList[i].region_name;
      }
    }
  }
  $('#providerId').on('change', function() {

    var key = $(this).val();
    if (key) {
      $.get('/aws/providers/' + key, function(data) {
        var keylist = data.keyPairs;
        var str = '<option value="">Select KeyPairs</option>';

        for (var i = 0; i < keylist.length; i++) {
          str = str + '<option value="' + keylist[i]._id + '">' + keylist[i].keyPairName + '</option>';
        }
        $('#keypairId').html(str);

        /*bring Region list from providers*/
        var str1 = '<option value="">Select Region</option>';
        for (var i = 0; i < keylist.length; i++) {
          str1 = str1 + '<option value="' + keylist[i].region + '">' + getRegionName(keylist[i].region) + ' | ' + keylist[i].region + '</option>';
        }
        $('#region').html(str1);

      });
    }

  });
}

function getVPC() {

  function populateData() {
    var $provider = $('#providerId');
    var $spinner = $('#vpcSpinner').addClass('hidden');
    var accessKey = $provider.find("option:selected").attr('accessKey'),
      secretKey = $provider.find("option:selected").attr('secretKey'),
      region = $('#region').val();


    if (accessKey && secretKey && region) {
      //alert('region');
      $spinner.removeClass('hidden');
      $.ajax({
        url: "/aws/providers/describe/vpcs",
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(data) {

          console.log(data);
          var str = '';
          var filteredData = [];
          for (var i = 0; i < data.Vpcs.length; i++) {
            if (data.Vpcs[i].State.toLowerCase() == "available") {
              filteredData.push(data.Vpcs[i]);
            }
          }
          for (var i = 0; i < filteredData.length; i++) {
            if (filteredData[i].IsDefault) {
              str = str + '<option selected value="' + filteredData[i].VpcId + '">' + filteredData[i].VpcId + ' (' + filteredData[i].CidrBlock + ') Default</option>';
            } else {
              str = str + '<option value="' + filteredData[i].VpcId + '">' + filteredData[i].VpcId + ' (' + filteredData[i].CidrBlock + ') ' +
                (filteredData[i].Tags.length ? filteredData[i].Tags[0].Value : "") + '</option>';
            }
          }
          $('#vpcId').html(str).trigger('change');
          $spinner.addClass('hidden');
        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#vpcId').html('<option value="">Select VPC</option>');
    }
  }

  $('#providerId').on('change', populateData);
  $('#region').on('change', populateData);
}

function getSubnet() {
  function populateData() {
    var $provider = $('#providerId');
    var $spinnerSubnet = $('#spinnerSubnet').addClass('hidden');
    var accessKey = $provider.find("option:selected").attr('accessKey'),
      secretKey = $provider.find("option:selected").attr('secretKey'),
      region = $('#region').val(),
      vpcId = $('#vpcId').val();
    if (accessKey && secretKey && region && vpcId) {
      $spinnerSubnet.removeClass('hidden');
      $.ajax({
        url: "/aws/providers/vpc/" + vpcId + "/subnets",
        method: "post",
        data: {
          "accessKey": accessKey,
          "secretKey": secretKey,
          "region": region
        },
        success: function(data) {
          console.log(data);
          var str = '<option value="">Select Subnet</option>';
          var filteredData = [];
          for (var i = 0; i < data.Subnets.length; i++) {
            if (data.Subnets[i].State.toLowerCase() == "available") {
              filteredData.push(data.Subnets[i]);
            }
          }
          for (var i = 0; i < filteredData.length; i++) {
            str = str + '<option value="' + filteredData[i].SubnetId + '">' + filteredData[i].SubnetId + ' (' + filteredData[i].AvailabilityZone + ') ' +
              (filteredData[i].Tags.length ? filteredData[i].Tags[0].Value : "") + '</option>';

          }
          $spinnerSubnet.addClass('hidden');
          $('#subnetId').html(str);

          if($('#subnetId').attr('savedval'))
          {
            helpersetselectvalue($('#subnetId'),'value',$('#subnetId').attr('savedval'));
          }

        },
        error: function(xhr) {
          bootbox.alert(xhr.responseText);
        }

      });
    } else {
      $('#subnetId').html('<option value="">Select Subnet</option>')
    }
  }

  $('#vpcId').on('change', populateData);
}

function resetForm() {
  $('[multiselect]').empty();
}



var dataLoader = function() {
  
  getProviderList();
  getImageInstances();
  getSecurityGroup();
  getkeypairList();
  getVPC();
  getSubnet();
  getImagesWithOSFilter();
  loadUserlist();
  console.log("Orgname===>" + localStorage.getItem('selectedOrgName'));
  $.get('../aws/ec2/amiids', function(data) {
    var $instanceOS = $('#instanceOS');
    $instanceOS.html('').append('<option value="">Select Operating System</option>')
    for (var i = 0; i < data.length; i++) {
      $option = $('<option data-instanceOS="' + data[i].osType + '" value="' + data[i].os_name + '">' + data[i].os_name + '</option>');
      $option.data('supportedInstanceType', data[i].supportedInstanceType);
      $instanceOS.append($option);
    }
    var $instanceType = $('#intanceTypeControl');
    $instanceOS.change(function(e) {
      $instanceType.empty();
      $selectedOption = $(this).find('option:selected');
      var supportedInstanceType = $selectedOption.data('supportedInstanceType');
      console.log(supportedInstanceType);
      if (typeof supportedInstanceType != 'undefined') {
        for (var i = 0; i < supportedInstanceType.length; i++) {
          var $option = $('<option></option>').val(supportedInstanceType[i]).html(supportedInstanceType[i]);
          $instanceType.append($option);
        }
      }
      //$instanceType;
    });
   // $instanceOS;
    $instanceOS.trigger('change');

  });

 // $(".chooseOrgselect2");
 // $("#vpcId");
//  $('#subnetId');
//  $(".chooseOS");
//  $(".chooseOSProvider");
//  $(".chooseSecurity");
 // $(".chooseInstance").select2();
 // $(".chooseBG").select2();
 // $(".chooseProject").select2();
 // $(".chooseEnv").select2();
//  $(".chooseDockerContainer").select2();
  //$(".chooseSelectExit").select2();

 
  $('#selectOrgName').change(function(e) {
    azureLoadData();
  });
  

  $('#templateContent').on("click", '.blueprintdiv', function() {
    $('#templateContent .role-Selected').removeClass('role-Selected');
    $(this).addClass('role-Selected');

  });
  $('#individualTemplateNameGrid').on("click", '.productdiv2', function() {
    if (!$(this).hasClass('role-Selected')) {
      $('#individualTemplateNameGrid').find('.role-Selected').removeClass('role-Selected');
      $(this).addClass('role-Selected');
      resetForm();
    }
  });
}

var reqBody;
var armVMEvalConfig;
$('.configureVMSaveBtn').click(function() {
  $wizard.data('armVMsecondClick', true);
  var wizard = $wizard.data('bootstrapWizard');
  wizard.next();

});

function azureLoadData() {
    var sortbyid = function SortByID(x, y) {
      return x.position - y.position;
    }
    $.get('/d4dMasters/readmasterjsonnew/16', function(data) {
      data = JSON.parse(data);
      var rowLength = data.length;
      var containerTemp = "";
      var selectedrow = false;
      var getDesignTypeImg;
      var getDesignTypeRowID;

      for (var i = 0; i < rowLength; i += 1) {
        switch (data[i]['templatetype']) {
          case "chef":
            data[i]['position'] = 0;
            break;
          case "ami":
            data[i]['position'] = 1;
            break;
          case "arm":
            data[i]['position'] = 2;
            break;
          case "docker":
            data[i]['position'] = 3;
            break;
        }
      }
      data.sort(sortbyid);

      var selectCheck = $('#selectOrgName').val();
      $('#orgIDCheck').val(selectCheck);
      for (var i = 0; i < rowLength; i += 1) {
        $("#templateContent").empty();
        if (data[i]['templatetype'] && data[i]['templatetype'] == 'cft')
          continue;
        getDesignTypeImg = data[i]['templatetype'];
        if (selectCheck == data[i].orgname_rowid) {
          switch (data[i].templatetype) {
            case "chef":
              getDesignTypeImg = '/d4dMasters/image/16ae9c94-19f6-485a-8c17-9af7a0f5f23d__designtemplateicon__Appfactory.png';
              break;
            case "ami":
              getDesignTypeImg = '/d4dMasters/image/9d14d362-493e-4d62-b029-a6761610b017__designtemplateicon__DevopsRoles.png';
              break;
            case "docker":
              getDesignTypeImg = '/d4dMasters/image/b02de7dd-6101-4f0e-a95e-68d74cec86c0__designtemplateicon__Docker.png';
              break;
            case "arm":
              getDesignTypeImg = '/d4dMasters/image/4fdda07b-c1bd-4bad-b1f4-aca3a3d7ebd9__designtemplateicon__Cloudformation.png';
              break;
          }
          getDesignTypeRowID = data[i]['rowid'];
          if (getDesignTypeImg) {
            if (getDesignTypeImg.indexOf('/d4dMasters/image') === -1) {
              getDesignTypeImg = "/d4dMasters/image/" + getDesignTypeRowID + "__designtemplateicon__" + getDesignTypeImg;
            }
            containerTemp += '<div class="" style="width:222px;float:left">' + ' <div id=grid' + i + ' class="blueprintdiv appfactory" data-' + 'templateType="' + data[i]
              ['templatetypename'] + '" data-gallerytype="' + data[i]['templatetype'] + '">' + '<div style="">' +
              '<img  style="height:25px;padding:2px" alt="" src="img/app-store-' + 'icons/Logoheader.png"><span style="padding-top:4px;position:absolute;' +
              'padding-left: 4px;">' + '<b>' + data[i]['templatetypename'] + '</b>' + '</span></div>' +
              '<div style="padding-top:10px;padding-left:0px;text-align:center;">' + '<img alt="Template Icon" ' + 'src="' + getDesignTypeImg +
              '" style="height:60px;width:auto;">' + '</div></div></div>';
          } else {
            containerTemp += '<div class="" style="width:222px;float:left">' + ' <div id=grid' + i + ' class="blueprintdiv appfactory" data-' + 'templateType="' + data[i]
              ['templatetypename'] + '" data-gallerytype="' + data[i]['templatetype'] + '">' + '<div style="">' +
              '<img  style="height:25px;padding:2px" alt="" src="img/app-store-' + 'icons/Logoheader.png"><span style="padding-top:4px;position:absolute;' +
              'padding-left: 4px;">' + '<b>' + data[i]['templatetypename'] + '</b>' + '</span></div>' + '<div style="padding-top:10px;padding-left:27px;">' +
              '<img style="height:40px;width:auto;" alt="" ' + 'src="img/logo.png">' + '</div></div></div>';
          }
        }
      }
      $("#templateContent").append(containerTemp);
      $("#templateContent #grid0").addClass("role-Selected");
    });
  };

var formInitializer = function(editing,callback1){
   //$("#tabheader").html('Choose Template');
      //getProviderList();
      dataLoader();
      //If a docker type of template selected then select the Org
      var $selectedItem = $('.role-Selected');

      if (!$selectedItem.length && !editing) {
        alert('Please choose a blueprint design');
        return false;
      }
      //Selection of Orgname from localstorage

      $('#orgnameSelect').val($('#orgIDCheck').val());
      $('#orgnameSelect').attr('disabled', true);
      console.log('role-Selected before ==> ', $('#tab2 .role-Selected').length);

      if ($('.productdiv2.role-Selected').length > 0) {
        //Setting controls connected to docker to hidden
        $('.forDocker').hide();
        $('.notForDocker').show();
        $('.forCFT').hide();

        $('.cookbookShow').parent().show();

        $('.divconfigureparameterrunlist').show();
        $('.divchefrunlist').show();

        if ($('.productdiv2.role-Selected').first().attr('templatetype') == "Docker" || $('.productdiv2.role-Selected').first().attr('templatetype') == "docker") {
          //Checking if docker then only Edit organization paramerters are to be shown
          //Checking if docker then only Edit organization paramerters are to be shown
          //Inserting the selected template to the docker image list
          var $dockerdiv = $('#tab2').find('.productdiv2.role-Selected').first();
          $('.dockerimagesrow').detach();

          if(editing){
            var compdock = $('#compositedockertable').attr('savedval');
            if(compdock){
              compdock = JSON.parse(compdock);
              for(var dci =0; dci < compdock.length;dci++){
                addDockerTemplateToTable(compdock[dci].dockercontainerpathstitle, compdock[dci].dockercontainerpaths, compdock[dci].dockerrepotags, compdock[dci].dockerreponame, compdock[dci].dockerlaunchparameters);
              }
            }
          }
          else
            addDockerTemplateToTable($dockerdiv.attr('templatename'), $dockerdiv.attr('dockercontainerpaths'), 'latest', $dockerdiv.attr('dockerreponame'), '--name ' + $dockerdiv.attr('templatename'));
          if (!$('#CollapseEditorgParam').hasClass('in')) {
            $('a[href="#CollapseEditorgParam"]').click();
          }
          $('div.selectedTemplateArea').first().addClass('hidden').parent().addClass('hidden'); //hiding card view in template
          $('.divconfigureparameterrunlist').hide();
          $('.divchefrunlist').hide();
          //When docker stepping to 4th tab

          $('#orgnameSelect').trigger('change');


          // //populating the docker repo titles
          // var $dockerrepotitles = $('.productdiv2.role-Selected').attr('dockercontainerpathstitle').split(',');
          // var $dockerrepopaths = $('.productdiv2.role-Selected').attr('dockercontainerpaths').split(',');
          // var $dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');
          // var $dockerrepoListInput = $('#dockerrepoListInput');
          // $dockerrepoListInput.empty();

          // $dockerrepotitles.forEach(function(k, v) {
          //   var $opt = $('<option value="' + $dockerrepotitles[v] + '" repopath="' + $dockerrepopaths[v] + '">' + $dockerrepotitles[v] + '</option>');
          //   $dockerrepoListInput.append($opt);
          // });
          // updatecompositedockertableemptymessage();
          // //Setting the appropriate tags
          // //Attaching the change event to pull tags for the select repo
          // $dockerrepoListInput.change(function(e) {

          //   $.get('/d4dmasters/getdockertags/' + encodeURIComponent($(this).find('option:selected').attr('repopath')) + '/' + $dockerreponame, function(data) {


          //     if (data) {
          //       var tagJson = JSON.parse(data);
          //       var $dockerrepotagsdiv = $('#dockerrepotagsdiv');

          //       $dockerrepotagsdiv.empty();
          //       var dockerrepotags = [];
          //       tagJson.forEach(function(k, v) {

          //         if (v < 3) {
          //           $('#dockerrepotagsdiv').append(
          //             '<div class="codelistitem" style="margin-top:2px;padding-top:2px;border:1px solid #eeeeee; background-color:#eeeeee !important;height:26px;"><p class="bg-success"><i style="padding-left:10px;padding-right:10px" class="ace-icon fa fa-check"></i>' +
          //             tagJson[v].name + '</p></div>');
          //           if (dockerrepotags == '')
          //             dockerrepotags += tagJson[v].name;
          //           else
          //             dockerrepotags += ',' + tagJson[v].name;
          //         }
          //         //limiting the number to the top 5
          //       });
          //       $('.productdiv2.role-Selected').first().attr('dockerrepotags', dockerrepotags);
          //       $('.productdiv2.role-Selected').first().attr('dockerimagename', $dockerrepoListInput.val());
          //     }
          //   });
          // });

          // $dockerrepoListInput.trigger('change');

          // //End Setting appropriate tags
          // //polulate the docker tags
          // var $dockerrepotagsul = $('#dockerrepotagsul');
          $('.forDocker').show();
          $('.notForDocker').hide();

        } else if ($('.productdiv2.role-Selected').first().attr('templatetype') == "ARMTemplate" || $('.productdiv2.role-Selected').first().attr('templatetype') == "arm") {
          $('.notforCFT').hide();
          $('.forCFT').show();
          $('.divconfigureparameterrunlist').hide();
          $('.divchefrunlist').hide();
          if (!$('#CollapseEditorgParam').hasClass('in')) {
            $('a[href="#CollapseEditorgParam"]').click();
          }
          var $panelBody = $('#CollapseStackParameters').find('.panel-body').empty();;
          var cftTemplateFileName = $('.productdiv2.role-Selected').attr('cftTemplateFileName');



          $panelBody.append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');


          $.ajax({
            type: "GET",
            url: "/azure/providers",
            success: function(data) {
              data = typeof data == "string" ? JSON.parse(data) : data;
              console.log("provider data ==>", data);
              var providerStr = '<option value="">Select Provider</option>';
              for (var i = 0; i < data.length; i++) {
                providerStr = providerStr + '<option value="' + data[i]._id + '">' + data[i].providerName + '</option>';
              }
              var $providerInput = $('<select id="cftProviderInput" class="form-control"></select>').append(providerStr);
              var $providerInputContainer = $(
                '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel">Choose Provider</span><span class="control-label redSpan">&nbsp;*</span></label><div class="input-groups"></div></div>');
              $providerInputContainer.find('.input-groups').append($providerInput);

              var $regionInput = $('<select id="cftRegionInput" class="form-control"></select>');
              var $regionInputContainer = $(
                '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel required">Choose Region</span><span class="control-label redSpan">&nbsp;*</span></label><div class="input-groups"></div></div>');
              $regionInputContainer.find('.input-groups').append($regionInput);

              var $resourceInput = $('<select id="cftResourceGroupInput" class="form-control"></select>');
              var $resourceInputContainer = $(
                '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel required">Choose Resource Group</span><span class="control-label redSpan">&nbsp;*</span></label><div class="input-groups"></div></div>'
              );
              $resourceInputContainer.find('.input-groups').append($resourceInput);



              function loadLocations() {

                $.get('/azure/' + $(this).val() + '/locations', function(regionList) {


                  regionList = typeof regionList == "string" ? JSON.parse(regionList) : regionList;
                  if (regionList.Locations && regionList.Locations.Location) {
                    regionList = regionList.Locations.Location;
                    var regionOptStr = '<option value="">Select Region</option>';
                    for (var i = 0; i < regionList.length; i++) {
                      regionOptStr = regionOptStr + '<option value="' + regionList[i].Name + '">' + regionList[i].DisplayName + '</option>';

                    }
                    $regionInput.html(regionOptStr);
                  }

                });
              }

              function loadResourceGroups() {
                $.get('/azure-arm/' + $(this).val() + '/resourceGroups', function(resourceGroups) {
                  resourceGroups = typeof resourceGroups == "string" ? JSON.parse(resourceGroups) : resourceGroups;
                  if (resourceGroups.value && resourceGroups.value.length) {
                    resourceGroups = resourceGroups.value;
                    var resourceOptStr = '<option value="">Select Resource Group</option>';
                    for (var i = 0; i < resourceGroups.length; i++) {
                      resourceOptStr = resourceOptStr + '<option value="' + resourceGroups[i].name + '">' + resourceGroups[i].name + '</option>';

                    }
                    $resourceInput.html(resourceOptStr);
                    if(editing){
                      $resourceInput.val($resourceInput.attr('savedval'));
                    }
                  }

                });
              }

              $providerInput.change(loadResourceGroups);
              $panelBody.empty().append($providerInputContainer).append($resourceInputContainer);

              $.get('/d4dMasters/cftTemplate?templateFile=' + cftTemplateFileName, function(data) {

                var templateData = {};
                try {
                  templateData = JSON.parse(data);
                } catch (err) {
                  console.log(err);
                  bootbox.alert("Invalid template file");
                  return;
                }
                var formHtmlDivHtml = '';
                $panelBody.append(formHtmlDivHtml).append('<input type="hidden" id="cftTemplateFileInput" value="' + cftTemplateFileName + '"/>');
                var parameters = templateData.parameters;
                if (parameters) {
                  var keys = Object.keys(parameters);
                  for (var i = 0; i < keys.length; i++) {
                    var parameter = parameters[keys[i]];
                    var $parameterInput;
                    if (parameter.allowedValues) {
                      $parameterInput = $('<select class="cftParameterInput form-control"></select>');
                      for (var j = 0; j < parameter.allowedValues.length; j++) {
                        var $option = $('<option></option>').val(parameter.allowedValues[j]).html(parameter.allowedValues[j]);
                        $parameterInput.append($option);
                      }
                    } else {
                      if (parameter.type === 'securestring') {
                        $parameterInput = $('<input class="cftParameterInput form-control" type="password" autofocus="autofocus">');

                      } else {

                        $parameterInput = $('<input class="cftParameterInput form-control" type="text" autofocus="autofocus">');
                      }
                    }
                    if (parameter.defaultValue) {
                      $parameterInput.val(parameter.defaultValue);
                    }
                    $parameterInput.attr('data-cftParameter-type', parameter.type);
                    $parameterInput.attr('data-cftParameter-name', keys[i]);

                    var $inputContainer = $(
                      '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftParameterLabelContainer" for=""><span class="cftParameterLabel"></span><span class="control-label redSpan">&nbsp;*</span></label><div class="input-groups"></div></div>');
                    $inputContainer.find('.input-groups').append($parameterInput);
                    $inputContainer.find('.cftParameterLabel').append(keys[i]);

                    if (parameter.metadata && parameter.metadata.description) {
                      var $desc = $('<span></span>').attr('title', parameter.metadata.description).append('&nbsp;&nbsp;<i class="fa fa-question"/>');
                      $inputContainer.find('.cftParameterLabelContainer').append($desc);
                    }
                    $panelBody.append($inputContainer);

                  }
                }
                var resources = templateData.resources;
                var hasResource = false;

                // for runlist input
                var $orgListInput = $('#orgnameSelect');
                $orgListInput.change(function() {
                  $this = $(this);
                  if ($this.val() === 'choose') {
                    return;
                  }
                  var $ccrs = $chefCookbookRoleSelector($this.val(), function(data) {

                  }, null);

                  $('.cftResourceRunlistInput').empty().append($ccrs).data('$ccrs', $ccrs);
                });
                var vmCount = 0;
                var foundVMResources = [];

                for (var i = 0; i < resources.length; i++) {
                  if (resources[i].type === "Microsoft.Compute/virtualMachines") {
                    foundVMResources.push(resources[i]);
                    continue;
                    hasResource = true;
                  }
                }
                if (foundVMResources.length) {
                  armVMEvalConfig = {}; // flag for vm configured
                  armVMEvalConfig.variables = templateData.variables;
                  armVMEvalConfig.vms = foundVMResources;
                } else {
                  armVMEvalConfig = null;
                }
                
                if(editing)
                  callback1();
              });
            },
            failure: function(data) {
              alert(data.toString());
            }
          });
        } else {
          //setting the instance count drop down
          $('#instanceCount').val("1");
          if ($('.productdiv2.role-Selected').first().attr('templatetype') == "ami") {
            var vmimage = JSON.parse($('.productdiv2.role-Selected').first().attr('imagedata'));
            $('#instanceOS').val(vmimage.osName);
            $('#instanceOS').change().attr('disabled', 'disabled');
            $('#providerId').val(vmimage.providerId);
            $('#orgnameSelect').attr('disabled', 'disabled');

          } else {
            $('#instanceOS').removeAttr('disabled');
            $('#providerId').removeAttr('disabled');

            $('#orgnameSelect').removeAttr('disabled');
          }
          if (!$('#CollapseConfigureproviderParameter').hasClass('in')) {
            $('a[href="#CollapseConfigureproviderParameter"]').click();
          }
        }
      }

      console.log('role-Selected after ==> ', $('#tab2 .role-Selected').length);

      var $clone = $selectedItem.clone().removeClass('role-Selected');
      var selectedText = $clone.attr("data-templateType");
      if ($selectedItem.attr('data-templateType') == 'desktopProvisoning') {
        wizard.show(4);
        return false;
      }
      if ($('#tab2 .role-Selected').length > 0) {
        console.log('cloning');
        $('#tab3 .selectedTemplateArea').empty().append($('#tab2 .role-Selected').clone());
      }
      //force clicking orgnameSelect
      $('#orgnameSelect').trigger('change');
      $(".chooseBG").change();
      $(".chooseBG").select2('data', null);
      $('.chooseProject').select2('data', null)
      $(".chooseDockerContainer").change();
      var validatorForm = $("#wizard-1").validate();
      validatorForm.resetForm();

}

var saveblueprint = function(tempType){
  bootbox.confirm({
          message: "Are you sure want to submit this Blueprint Data? Press Ok to Continue",
          title: "Confirm",
          callback: function(result) {
            if (result) {

              //$("#tabheader").html('Create Blueprint');
              var $selectedTemplateArea = $('.selectedTemplateArea');
              var $selectedItem = $selectedTemplateArea.find('.productdiv2');
              console.log($selectedItem.length);
              if (!$selectedItem.length) {
                alert('please choose a template');
                return false;
              }

              if ($('#orgnameSelect').val() === 'choose') {
                alert('please choose an Organization');
                return false;
              }


              reqBody = {};
              if($('#bpeditcontent').find('input#blueprintId')){
                  reqBody.blueprintId = $('#bpeditcontent').find('input#blueprintId').val();
                }
              reqBody.templateId = $selectedItem.attr('data-templateId');
              reqBody.templateType = $selectedItem.attr('data-templateType');
              reqBody.templateComponents = $selectedItem.attr('data-templateComponent').split(',');
              reqBody.dockercontainerpathstitle = $selectedItem.attr('dockercontainerpathstitle');
              reqBody.dockercontainerpaths = $selectedItem.attr('dockercontainerpaths');
              reqBody.dockerlaunchparameters = $('#dockerlaunchparameters').val();
              reqBody.dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');



              //constructing the docker composite json.
              var dockercompose = [];
              var dockerimages = {};
              console.log($('#compositedockertable').find('.dockerimagesrow').length);
              $('.dockerimagesrow').each(function() {
                dockerimages = {};
                $(this).find('[paramtype]').each(function() {
                  console.log($(this).text() + $(this).val());
                  dockerimages[$(this).attr('paramtype')] = $(this).text() + $(this).val();
                });
                dockercompose.push(dockerimages);
              });

              reqBody.dockercompose = dockercompose;

              //Get all the runlist
              var cbs = [];
              var $ccrs = $('.cookbookShow').data('$ccrs');
              cbs = $ccrs.getSelectedRunlist();
              reqBody.runlist = cbs.join();

              var $ccrs = $('.cookbookShow').data('$ccrs');
              reqBody.chefServerId = $ccrs.getChefServerId();
              reqBody.instanceType = $('select.instanceType').val();
              reqBody.instanceOS = $('#instanceOS').val();
              reqBody.instanceCount = $('#instanceCount').val();
              console.log(reqBody);


              console.log("reqBody ==>", reqBody);
              if (!reqBody || reqBody == "undefined") {
                console.log('resetting');
                var reqBody = {};
              }

              var $ccrs = $('.cookbookShow').data('$ccrs');
              var cbs = [];
              cbs = $ccrs.getSelectedRunlist();
              reqBody.runlist = cbs;

              reqBody.chefServerId = $ccrs.getChefServerId();
              console.log("instanceType ==>", $('select.instanceType').val());
              reqBody.instanceType = $('select.instanceType').val();

              var $instanceOsoptionsSelected = $('#instanceOS').find('option:selected');
              console.log($('#instanceOS').val());

              console.log($instanceOsoptionsSelected);

              reqBody.instanceOS = $instanceOsoptionsSelected.attr('data-instanceOS');
              reqBody.instanceAmiid = $instanceOsoptionsSelected.attr('data-amiid');
              reqBody.instanceUsername = $instanceOsoptionsSelected.attr('data-amiid-username');

              reqBody.templateId = $('.productdiv2.role-Selected').attr('data-templateId');
              reqBody.templateType = $('.productdiv2.role-Selected').attr('data-templateType');
              reqBody.templateComponents = $('.productdiv2.role-Selected').attr('data-templateComponent').split(',');


              reqBody.dockercontainerpaths = $('#dockerrepoListInput :selected').attr('repopath');
              reqBody.dockerrepotags = $('.productdiv2.role-Selected').attr('dockerrepotags');
              reqBody.dockerimagename = $('#dockerrepoListInput').val();
              reqBody.dockerlaunchparameters = $('#dockerlaunchparameters').val();
              reqBody.dockerreponame = $('.productdiv2.role-Selected').attr('dockerreponame');

              reqBody.iconpath = $('.productdiv2.role-Selected').find('img[src*="__templatesicon__"]').first().attr('src');
              reqBody.orgId = $('#orgnameSelect').val();
              reqBody.bgId = $('#bgListInput').val();
              reqBody.projectId = $('#projectListInput').val();

              var imageIdentifier = $('#imageId').val();
              var imageId = $('#imageId').find('option:selected').attr('_id');

              var securityGroupPorts = $('#securotyGrp').val();
              var providerId = $('#providerId').val();
              var keyPairId = $('#keypairId').val();
              var instanceType = $('#instancesize').val();
              var vpcId = $('#vpcId').val();
              var subnetId = $('#subnetId').val();
              var region = $('#location').val();

              reqBody.keyPairId = keyPairId;
              reqBody.securityGroupPorts = securityGroupPorts;
              reqBody.instanceType = instanceType;
              reqBody.instanceAmiid = imageIdentifier;
              reqBody.instanceUsername = 'root';
              reqBody.vpcId = vpcId;
              reqBody.subnetId = subnetId;
              reqBody.imageId = imageId;
              reqBody.providerId = providerId;
              reqBody.region = region;
              reqBody.name = $('#blueprintNameInput').val();
              //Openstack variables.
              reqBody.imageIdentifier = imageId;
              reqBody.openstackflavor = $('#openstackflavour').val();
              reqBody.openstacknetwork = $('#openstacknetwork').val();
              reqBody.openstacksecurityGroupIds = $('#openstacksecuritygroup').val();
              reqBody.openstacksubnet = $('#openstacksubnet').val();
              reqBody.instanceCount = $('#instanceCount').val();
              reqBody.instanceImageName = imageIdentifier;

              /*
              $('#userListSelect').find('option').attr('selected', 'selected');
              reqBody.users = $('#userListSelect').val();
              // if (!reqBody.users) {
              //   alert("Please choose users");
              //   return false;
              // }*/

              //Checking for docker blueprint images
              if (($('.productdiv2.role-Selected').first().attr('templatetype') == "Docker" || $('.productdiv2.role-Selected').first().attr('templatetype') == "docker") && $('#dockerimageemptytr').length > 0) {
                //no rows found add empty message
                alert("Please add atleast one image");
                return false;
              }
              var appUrls = [];
              var $appUrlTableBody = $('#appUrlTable tbody');
              var $trs = $appUrlTableBody.find('tr');
              $trs.each(function(e) {
                var $this = $(this);
                appUrls.push($this.data('appUrlData'));
              });
              reqBody.appUrls = appUrls;

              // for cft templates
              reqBody.cftProviderId = $('#cftProviderInput').val();
              var cftParameters = [];
              $('.cftParameterInput').each(function() {
                var $this = $(this);
                var parameterObj = {
                  ParameterKey: $this.attr('data-cftParameter-name'),
                  ParameterValue: $this.val(),
                  type: $this.attr('data-cftParameter-type')
                }
                cftParameters.push(parameterObj);
              });
              reqBody.cftStackParameters = cftParameters;
              reqBody.cftTemplateFile = $('#cftTemplateFileInput').val();
              reqBody.resourceGroup = $('#cftResourceGroupInput').val();
              console.log($('#cftResourceGroupInput').length, $('#cftResourceGroupInput').val());
              var instanceObj = {};
              $('.cft-resource-editPanel').each(function() {
                var $this = $(this);
                var runlist = [];
                var $ccrs = $this.find('.cftResourceRunlistInput').data('$ccrs');
                if ($ccrs) {
                  runlist = $ccrs.getSelectedRunlist();
                }

                var $inputResource = $this.find('.cftResourceLogicalIdInput');
                instanceObj[$inputResource.val()] = {
                  username: $inputResource.attr('data-username'),
                  password: $inputResource.attr('data-password'),
                  runlist: runlist
                };
              });
              reqBody.cftInstances = instanceObj;

              $('.blueprintMsgContainer').hide();
              var prefix = '#newbpcontainer ';
              if(reqBody.blueprintId){
                prefix = '#bpeditcontent ';
              }

              if (($(prefix + '.role-Selected').data('templatetype')).toLowerCase() != "docker") {
                reqBody.blueprintType = "instance_launch";
                if (($(prefix + '.role-Selected').data('templatetype')).toLowerCase() === 'cloudformation') {
                  reqBody.blueprintType = 'aws_cf';
                } else if (($(prefix + '.role-Selected').data('templatetype')).toLowerCase() == 'armtemplate' || ($(prefix + '.role-Selected').data('templatetype')).toLowerCase() == 'arm') {
                  reqBody.blueprintType = 'azure_arm';
                } else if ($('#providerId').find("option:selected").attr('providertype').toLowerCase() == 'hppubliccloud') {
                  reqBody.blueprintType = 'hppubliccloud_launch';
                } else if ($('#providerId').find("option:selected").attr('providertype').toLowerCase() == 'azure') {
                  reqBody.blueprintType = 'azure_launch';
                }

                console.log("Blueprint post:", reqBody);

                $.post('/organizations/' + reqBody.orgId + '/businessgroups/' + reqBody.bgId + '/projects/' + reqBody.projectId + '/blueprints', {
                  blueprintData: reqBody
                }, function(data) {
                  //in edit mode refresh the blueprints page
                    if(reqBody.blueprintId){
                      $('#projectListInputExisting').trigger('change'); //refresh the blueprints page
                      closeblueprintedit(reqBody.blueprintId);
                      return;
                    }


                  var validatorForm = $("#wizard-1").validate();
                  validatorForm.resetForm();
                  $('.blueprintSaveSuccess').show();
                  $('.blueprintNameSuccess').html('Blueprint&nbsp;&nbsp;<a id="blueprintInfo" data-toggle="modal">' + data.name + '</a>&nbsp;&nbsp;Saved Successfully');
                  $wizard.data('secondClick', true);
                  var wizard = $wizard.data('bootstrapWizard');
                  wizard.next();
                  wizard.disablePreviouBtn();
                  if (tempType === 'softwarestack' || tempType === 'osimage') {
                    $('a#blueprintInfo').attr('href', '#modalForRead').click(function(e) {
                      var $blueprintReadContainer = $('#modalForRead');
                      if (tempType === 'softwarestack') {
                        $('.modal-title').html('Blueprint Information-Software Stack');
                      }
                      if (tempType === 'osimage') {
                        $('.modal-title').html('Blueprint Information-OSImage');
                      }
                      //condition for getting the OS,instanceType,version...
                      $blueprintReadContainer.modal('show');
                      //for getting the blueprint name
                      $blueprintReadContainer.find('.modal-body #blueprintNameInputNew').val(data.name);
                      //for getting the OsName
                      $blueprintReadContainer.find('.modal-body #instanceOSNew').val(data.blueprintConfig.cloudProviderData.instanceOS);
                      //for getting the instance Size
                      $blueprintReadContainer.find('.modal-body #instancesizeNew').val(data.blueprintConfig.cloudProviderData.instanceType);
                      //for getting the version
                      $blueprintReadContainer.find('.modal-body #instanceVersion').val(data.blueprintConfig.infraManagerData.latestVersion);
                      //for getting the SubnetId
                      $blueprintReadContainer.find('.modal-body #instanceSubnetId').val(data.blueprintConfig.cloudProviderData.subnetId);
                      //loop for getting the Security Group
                      $blueprintReadContainer.find('.modal-body #instanceSecurityGroupId').val(data.blueprintConfig.cloudProviderData.securityGroupIds);
                      $blueprintReadContainer.find('.modal-body #instanceVPC').val(data.blueprintConfig.cloudProviderData.vpcId);
                      // loop for getting runlist
                      for (var j = 0; j < data.blueprintConfig.infraManagerData.versionsList.length; j++) {
                        $blueprintReadContainer.find('.modal-body #instanceRunlist').val(data.blueprintConfig.infraManagerData.versionsList[j].runlist);
                      }
                      //for getting the image Name
                      $.ajax({
                        type: "GET",
                        url: "/vmimages/" + data.blueprintConfig.cloudProviderData.imageId,
                        success: function(data) {
                          console.log(data);
                          $blueprintReadContainer.find('.modal-body #instanceImage').val(data.name);
                          //alert(data.name);
                        }
                      });
                      //for getting the Provider name,Type,Region,KeyPair
                      $.ajax({
                        type: "GET",
                        url: "/aws/providers/" + data.blueprintConfig.cloudProviderId,
                        success: function(data) {
                          $blueprintReadContainer.find('.modal-body #instanceProviderName').val(data.providerName);
                          $blueprintReadContainer.find('.modal-body #instanceProviderType').val(data.providerType);
                          // loop for getting region and Keypair
                          for (var k = 0; k < data.keyPairs.length; k++) {
                            $blueprintReadContainer.find('.modal-body #instanceRegion').val(data.keyPairs[k].region);
                            $blueprintReadContainer.find('.modal-body #instancekeyPair').val(data.keyPairs[k].keyPairName);
                          }
                        },
                        failure: function(data) {
                          alert(data.toString());
                        }
                      });
                      $blueprintReadContainer.find('.modal-body #blueprintTemplateType').val(data.templateType);
                      $.ajax({
                        type: "get",
                        dataType: "json",
                        async: false,
                        url: "../organizations/getTreeNew",
                        success: function(dataTree) {
                          console.log(data);
                          data = JSON.parse(JSON.stringify(data));
                          //  alert(JSON.stringify(data));
                          $.get("/d4dMasters/readmasterjsonnew/4", function(tdata) {
                            for (var i = 0; i < tdata.length; i += 1) {
                              if (data.orgId == tdata[i].orgname_rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintORG').val(tdata[i].orgname[0]);
                              }
                              if (data.bgId == tdata[i].productgroupname_rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintBU').val(tdata[i].productgroupname);
                              }
                              if (data.projectId == tdata[i].rowid) {
                                $blueprintReadContainer.find('.modal-body #blueprintProject').val(tdata[i].projectname);
                              }
                            }
                          });
                        }
                      });
                    });
                  } else if (tempType === 'armtemplate') {
                    $('a#blueprintInfo').attr('href', '#modalForReadCFT').click(function(e) {
                      var $blueprintReadContainerCFT = $('#modalForReadCFT');
                      $('.modal-title').html('Blueprint Information-CFT');
                      $blueprintReadContainerCFT.modal('show');
                      //for getting the blueprint name
                      $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(data.name);
                      $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(data.templateType);
                      $.ajax({
                        type: "get",
                        dataType: "json",
                        async: false,
                        url: "../organizations/getTreeNew",
                        success: function(dataTree) {
                          console.log(data);
                          data = JSON.parse(JSON.stringify(data));
                          $.get("/d4dMasters/readmasterjsonnew/4", function(tdata) {
                            for (var i = 0; i < tdata.length; i += 1) {
                              if (data.orgId == tdata[i].orgname_rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintORG').val(tdata[i].orgname[0]);
                              }
                              if (data.bgId == tdata[i].productgroupname_rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintBU').val(tdata[i].productgroupname);
                              }
                              if (data.projectId == tdata[i].rowid) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintProject').val(tdata[i].projectname);
                              }
                            }
                          });
                        }
                      });
                    });
                  }
                }).error(function(xhr) {
                  $('.blueprintSaveFail').find('h3').first().html(xhr.responseText);
                  $('.blueprintSaveFail').show();
                });
                console.log('final', reqBody);

              } else {
                reqBody.blueprintType = "docker";
                $.post('/organizations/' + reqBody.orgId + '/businessgroups/' + reqBody.bgId + '/projects/' + reqBody.projectId + '/blueprints', {
                  blueprintData: reqBody
                }, function(data) {
                  console.log(data);
                  if(reqBody.blueprintId){
                      $('#projectListInputExisting').trigger('change'); //refresh the blueprints page
                      closeblueprintedit(reqBody.blueprintId);
                      return;
                  }
                  var validatorFormDocker = $("#wizard-1").validate();
                  validatorFormDocker.resetForm();
                  $('.blueprintSaveSuccess').show();
                  $('.blueprintNameSuccess').html('Blueprint&nbsp;&nbsp;<b>' + data.name + '</b>&nbsp;&nbsp;Saved Successfully');
                  $wizard.data('secondClick', true);
                  var wizard = $wizard.data('bootstrapWizard');
                  wizard.next();
                  wizard.disablePreviouBtn();
                }).error(function(xhr) {
                  $('.blueprintSaveFail').find('h3').first().html(xhr.responseText);
                  $('.blueprintSaveFail').show();
                });
                console.log('final', reqBody);
              }

            }
          }
        }).find('.modal-header').css('background-color', 'ghostwhite');
}


var $wizard = $('#bootstrap-wizard-1').bootstrapWizard({
  'tabClass': 'form-wizard',
  'onNext': function(tab, navigation, index) {
    console.log(navigation, index)
    if (index === 1) {
      $('#viewCreateNew').addClass('hidden');
      $('#selectOrgName').attr('disabled', true);
     // $("#tabheader").html('Choose Templates');
      var $selectedItem = $('.role-Selected');
      if (!$selectedItem.length) {
        alert('please choose a blueprint design');
        return false;
      }
      var $clone = $selectedItem.clone().removeClass('role-Selected');
      var selectedText = $clone.attr("data-templateType");
      //hiding to move to next tag when docker selected
      $('#individualTemplateNameGrid').hide();
      var getID = parseInt($clone.attr("id").replace("grid", ""), 10);
      var gallerytype = $clone.attr("data-gallerytype");
      var templateurl = "/d4dMasters/readmasterjsonnew/17";
      if (gallerytype == 'ami') {
        templateurl = '/vmimages';
      }
      $.ajax({
        url: templateurl,
        dataType: "json",
        type: "GET",
        cache: "true",
        success: function(data) {
          console.log('templateData ==> ', data);
          var rowGridLength = (data.length);
          var getIndividualData = "";
          var getTempName;
          var getRowID, getImage;
          for (var z = 0; z < rowGridLength; z += 1) {

            if (gallerytype == 'ami') {

              getRowID = data[z]['_id'];

              getTemplateType = data[z]['osType'];
              getImage = 'img/osIcons/' + getTemplateType + '.png';
              getTempName = data[z]['name'];
              getImageData = '\'' + JSON.stringify(data[z]) + '\'';
              
              if(data[z]['providerType'] && data[z]['providerType'] == 'azure') //fix to only display images for aws
              {
              getIndividualData += '<div class="col-sm-3 col-lg-2 col-md-3">' +
                '<div class="productdiv2" data-templateId="' + getTempName + '" data-' +
                'templateComponent="component' + z + '" ' +
                'imagedata=' + getImageData +
                'data-templateName="' + getTempName + '" data-' +
                'templateType="' + gallerytype + '" templatetype="' + gallerytype + '" templatename="' + getTempName + '" templatescookbooks="">' +
                '<ul class="list-unstyled system-prop" style="text-align:center;">' +
                '<li><img style="height:40px;width:auto;" alt="" ' +
                'src="' + getImage + '">' +
                '</li><li style="font-size:12px;"><u><b>' + getTempName + '</b></u></li></ul></div></div>';
              }
              if (z >= rowGridLength - 1) {
                $('#individualTemplateNameGrid').show();
              }
              continue;
            }


            //iterate thhrough columns to get correct column and value
            var selectedrow = false;
            var currField = null;

            getTempName = data[z]['templatename'];


            getRowID = data[z]['rowid'];
            getImage = data[z]['templatesicon_filename'];
            getTemplateType = data[z]['templatetypename'];
            console.log(getTemplateType);

            if (selectedText.trim() != getTemplateType.trim())
              continue;

            gettemplatescookbooks = data[z]['templatescookbooks'].replace(/"/g, "");
            dockercontainerpathstitle = data[z]['dockercontainerpathstitle'];
            dockercontainerpaths = data[z]['dockercontainerpaths'];
            dockerreponame = data[z]['dockerreponame'];
            //To be removed and converted to reference when the new master model is implemented.
            dockerusername = '';
            dockercred = '';
            dockeremail = '';


            //console.log('here end ' + dockercontainerpathstitle);
            //added to the docker template adder pop-up : Vinod
            $('#dockertemplateselector').append('<option value="' + dockercontainerpaths + '" title="' + dockercontainerpaths + '" reponame="' + dockerreponame + '">' + getTempName  + '</option>'); //dockercontainerpathstitle
            var templateImgUrl = "img/logo.png";
            if (getImage) {
              templateImgUrl = "/d4dMasters/image/" + getRowID + "__templatesicon__" + getImage
            }
            var templateFileName = ''
            if (data[z]['template_filename']) {
              templateFileName = getRowID + '__template__' + data[z]['template_filename'];
            }
            getIndividualData += '<div class="col-sm-3 col-lg-2 col-md-3">' +
              '<div class="productdiv2" data-templateId="' + getTempName + '" data-' +
              'templateComponent="component' + z + '" ' +
              'dockercontainerpathstitle="' + dockercontainerpathstitle + '" ' +
              'dockercontainerpaths="' + dockercontainerpaths + '" ' +
              'dockerreponame="' + dockerreponame + '" ' +
              'data-templateName="' + getTempName + '" data-' +
              'templateType="' + gallerytype + '" templatetype="' + getTemplateType + '" templatename="' + getTempName + '" templatescookbooks="' + gettemplatescookbooks + '" cftTemplateFileName="' + templateFileName + '">' +
              '<ul class="list-unstyled system-prop" style="text-align:center;">' +
              '<li><img style="height:40px;width:auto;" alt="" ' +
              'src="' + templateImgUrl + '">' +
              '</li><li style="font-size:12px;"><u><b>' + getTempName + '</b></u></li>';

            if (getTemplateType != "Docker" && getTemplateType != "docker") {
              var cb = $chefCookbookRoleSelector.getRunlistNames(gettemplatescookbooks.split(','));
              var licb = '';
              for (var cbi = 0; cbi < cb.length; cbi++) {
                licb += '<li style="font-size:10px;" blueprinttype="other">' + cb[cbi] + '</li>';
              }
              $('#individualTemplateNameGrid').show();
            } else //when template type is docker
            {

              var cb = dockercontainerpathstitle.split(',');
              var cbpath = dockercontainerpaths.split(',');
              var licb = '';

              for (var cbi = 0; cbi < cb.length; cbi++) {
                licb += '<li style="font-size:10px;" path="' + cbpath[cbi] + '" title="Container" blueprinttype="dockercontainer">' + cb[cbi] + '</li>';
              }
              $('#individualTemplateNameGrid').hide();
            }

            getIndividualData += licb + '</ul></div></div>';
          }
          $("#individualTemplateNameGrid").html("").css('display','block');
          $("#individualTemplateNameGrid").append(getIndividualData).find('.productdiv2').first().click();
          var wizard = $wizard.data('bootstrapWizard');
          if ($('#individualTemplateNameGrid').children('div').length) {
            wizard.enableNextBtn();
          } else {
            bootbox.alert({
              message: "There are no templates available. Navigate to Settings to add a few.",
              title: "Warning"
            });
            wizard.disableNextBtn();
          }
        }


      });

      $('#tab' + (index + 1)).find('.temp').empty().append($clone);
      $('.' + $selectedItem.attr('data-templateType')).find('.productdiv2:first').trigger('click');

    } else if (index == 2) {
       // alert('in');
        formInitializer();
     


    } else if (index == 3) {
      if ($wizard.data('secondClick')) {
        return true;
      }
      if ($('.productdiv2.role-Selected').first().attr('templatetype') == "ARMTemplate" || $('.productdiv2.role-Selected').first().attr('templatetype') == "arm"){
        if (!$wizard.data('armVMsecondClick')) {


          if (armVMEvalConfig) {

            var cftParameters = {};
            var $cftParametersInput = $('.cftParameterInput');
            for (var i = 0; i < $cftParametersInput.length; i++) {
              var $parameterInput = $($cftParametersInput[i]);
              if ($parameterInput.val()) {
                cftParameters[$parameterInput.attr('data-cftParameter-name')] = {};
                var value = $parameterInput.val();
                if ($parameterInput.attr('data-cftParameter-type') === 'int') {
                  value = parseFloat($parameterInput.val());
                }
                cftParameters[$parameterInput.attr('data-cftParameter-name')].value = value;
              } else {
                bootbox.alert("Please fill all the parameters value");
                return false;
              }
            }

            $.post('/azure-arm/evaluateVMs', {
              parameters: cftParameters,
              variables: armVMEvalConfig.variables,
              vms: armVMEvalConfig.vms,

            }, function(vms) {
              vmConfigured = true;
              console.log('evaluated VMS==>', vms);
              var $panelGroup = $('<div class="panel-group smart-accordion-default col-lg-12 col-md-12" id="cft-resource-editArea" style="margin-top:5px"></div>');

              var $panel = $(
                '<div class="panel panel-default cft-resource-editPanel"><div class="panel-heading"><h4 class="panel-title"><a class="panel-toggle" data-toggle="collapse" data-parent="#cft-resource-editArea" href="#" class="collapsed"><i class="fa fa-fw fa-plus-circle txt-color-blue"></i> <i class="fa fa-fw fa-minus-circle txt-color-red"></i><span class="heading-text"></span></a></h4></div><div id="CollapseEditorgParam" class="panel-collapse collapse" style="height: auto;"><div class="panel-body" style="padding-left: 8px;"></div></div></div>'
              );

              var $inputContainerTemplate = $(
                '<div class="col-lg-6 col-md-6" style="margin-top: 10px;"><label class="cftResourceLabelContainer" for=""><span class="cftResourceLabel"></span></label><div class="input-groups"></div></div>');
              var $resourceInputTemplate = $('<input class="cftResourceInput form-control" type="text" autofocus="autofocus">');
              var $orgListInput = $('#orgnameSelect');

              for (var i = 0; i < vms.length; i++) {
                var $clone = $panel.clone();
                var name = vms[i].name;

                $clone.find('.heading-text').html('Configure VM : ' + name);
                $clone.find('.panel-collapse').attr('id', 'cftResource-' + name);
                $clone.find('.panel-toggle').attr('href', '#cftResource-' + name);


                //for resourceLogicalId
                var $inputLogicalId = $resourceInputTemplate.clone();
                $inputLogicalId.addClass('cftResourceLogicalIdInput');
                $inputLogicalId.attr('type', 'hidden');
                $inputLogicalId.val(name);
                var username = vms[i].username;
                var password = vms[i].password;
                $inputLogicalId.attr('data-username', username);
                $inputLogicalId.attr('data-password', password);


                // for chefRunlist

                var $inputChefRunlistContainer = $('<div class="col-lg-12 col-md-12 cftResourceRunlistInput"></div>');

                if ($orgListInput.val().toLowerCase() !== 'choose') {
                  var $ccrs = $chefCookbookRoleSelector($orgListInput.val(), function(data) {

                  }, []);

                  $inputChefRunlistContainer.empty().append($ccrs).data('$ccrs', $ccrs);
                }
                $clone.find('.panel-body').append($inputLogicalId);
                $clone.find('.panel-body').append($inputChefRunlistContainer);



                $panelGroup.append($clone);

              }
              $('#configureVMModal').find('fieldset').empty().append($panelGroup);
              $('#configureVMModal').modal('show');


            });
            return false;
          }
        } else {
          $wizard.data('armVMsecondClick', false);
        }
      }


      var isValid = $('#wizard-1').valid();

      var tempType = $('.role-Selected').data('templatetype').toLowerCase();

      if (tempType !== "docker" && tempType !== 'cloudformation' && tempType !== 'armtemplate' && !isValid) {

        bootbox.alert({
          message: "Valiadtion failed. Do check the configuration before submitting.",
          title: "Error"
        });
        return false;

      } else {
        saveblueprint(tempType);
        
      }
      return false;
    }


  },
  'onPrevious': function(tab, navigation, index) {
    if (index === 0) {
      //$("#tabheader").html('Choose Template Type');
      $('#viewCreateNew').removeClass('hidden');
      $('#selectOrgName').attr('disabled', false);
      var wizard = $wizard.data('bootstrapWizard');
      wizard.enableNextBtn();
    } else if (index === 1) {
     // $("#tabheader").html('Choose Templates');
    } else if (index === 2) {
     // $("#tabheader").html('Choose Template');
    } else if (index === 3) {
    //  $("#tabheader").html('Create Blueprint');
      var validatorForm = $("#wizard-1").validate();
      validatorForm.resetForm();
    }

  }
});


var $rolesCards = $('.blueprintdiv')

$('.blueprintdiv').on("click", function() {
  $rolesCards.removeClass('role-Selected');
  if ($(this).hasClass('role-Selected')) {
    $(this).removeClass('role-Selected');
  } else {
    $(this).addClass('role-Selected');
  }
});

var $selectedTemplate = $('.productdiv2').click(function(e) {
  $selectedTemplate.removeClass('role-Selected');
  console.log("this ==> ", this);
  var $this = $(this);
  $('.selectedTemplateArea').empty().append($this.clone(false).css({
    'cursor': 'auto'
  }));

  $this.addClass('role-Selected');
});


var OrgdataLoader = function(editing){
  $.ajax({
    type: "get",
    dataType: "json",
    async: false,
    url: "../organizations/getTreeForbtv",
    success: function(data) {
      console.log(data);
      $('#selectOrgName').trigger('change');
      data = JSON.parse(JSON.stringify(data));
      var $orgListInput = $('#orgnameSelect');
      $bgList = $('#bgListInput');
      var $envList = $('#envList');
      for (var i = 0; i < data.length; i++) {
        $('#selectOrgName').append($('<option></option>').val(data[i].rowid).html(data[i].name));
        $orgListInput.append($('<option></option>').val(data[i].rowid).html(data[i].name).data('bglist', data[i].nodes).data('project', data[i].nodes[0].nodes).data('envList', data[i]
          .nodes[0].nodes));
      }
      $orgListInput.change(function(e) {
        var orgName = $(this).val();
        if (orgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $bgList.empty();
        $bgList.append($('<option></option>').val('choose').html('Choose'));
        var getBGs = $selectedOrgOption.data('bglist');
        if (getBGs != null) {
          for (var i = 0; i < getBGs.length; i++) {
            $bgList.append($('<option></option>').val(getBGs[i].rowid).html(getBGs[i].name).data('projList', getBGs[i].nodes));
          }
          if($bgList.attr('savedval'))
            helpersetselectvalue($bgList,'value',$bgList.attr('savedval'));

        }
        var $cookbookShow = $('.cookbookShow').empty();
        $cookbookShow.append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />');
        var tcb = [];
        var $card = $('#tab3').find('div[class*="productdiv2"]').first();
        if ($card.length) {
          var templatescookbooks = $card.attr('templatescookbooks');
          if (templatescookbooks) {
            tcb = templatescookbooks.split(',');
          }else{ //should be edit mode
            if($('#tableRunlistForBlueprint').attr('savedval'))
              tcb = $('#tableRunlistForBlueprint').attr('savedval').split(',');
          }
        }else{

          if($('#tableRunlistForBlueprint').attr('savedval'))
            tcb = $('#tableRunlistForBlueprint').attr('savedval').split(',');
        }
        console.log(tcb);
        console.log('tcbdhd == >', tcb);
        var $ccrs = $chefCookbookRoleSelector(orgName, function(data) {}, tcb);
        console.log("Variables>>>>>" + $ccrs);
        $cookbookShow.empty();
        $cookbookShow.append($ccrs);
        var currentRunlistNames = $ccrs.getRunlistNames(tcb);
        $tasksRunlist.clear().draw();
        for (var i = 0; i < currentRunlistNames.length; i++) {
          var $runlistList = $('#tableRunlistForBlueprint');
          var $tr = $('<tr class="runlistRow"></tr>');
          var $tdName = $('<td class="runlistDescription">' + currentRunlistNames[i] + '</td>');
          $tr.append($tdName);
          $runlistList.append($tr);
          $tasksRunlist.row.add($tr).draw();
        }
        $cookbookShow.data('$ccrs', $ccrs)
      });
      var $projectList = $('#projectListInput');
      $bgList.change(function(e) {
        var bgName = $(this).val();
        if (bgName == 'choose') {
          return;
        }
        var $selectedOrgOption = $(this).find(":selected");
        $projectList.empty();
        $projectList.append($('<option></option>').val('choose').html('Choose'));
        var getProjs = $selectedOrgOption.data('projList');
        for (var i = 0; i < getProjs.length; i++) {
          $projectList.append($('<option></option>').val(getProjs[i].rowid).html(getProjs[i].name));
        }
        //setting the read values
        if($projectList.attr('savedval'))
          {
            helpersetselectvalue($projectList,'value',$projectList.attr('savedval'));
            //locking Org BG and Project during edit
            $('#orgnameSelect').attr('disabled','disabled');
            $bgList.attr('disabled','disabled');
            $projectList.attr('disabled','disabled');
          }

      });
    }
  });
}

OrgdataLoader(); //Wrapped for editing

var loadUserlist = function() {
  var $loadingContainer = $('.userListLoadingContainer').empty().append('<img class="center-block" style="height:50px;width:50px;margin-top: 10%;margin-bottom: 10%;" src="img/loading.gif" />').show();
  $.get('../users', function(userList) {
    var $userListSelect = $('#userListSelect').empty();
    userList = JSON.parse(userList);
    userList.sort(function(a, b) {
      var keyA = Object.keys(a);
      var keyB = Object.keys(b);

      if (keyA[0] < keyB[0]) return -1;
      if (keyA[0] > keyB[0]) return 1;
      return 0;
    });
    for (var i = 0; i < userList.length; i++) {
      var keys = Object.keys(userList[i]);
      var $option = $('<option></option>').append(keys[0]).val(keys[0]);
      $userListSelect.append($option);
    }
    $loadingContainer.hide();
    $userListSelect.show();
  }).error(function() {
    $loadingContainer.empty().append('Unable to load users. Please try again later.');
  });

}

loadUserlist();

$(document).ready(function() {
  $("#blueprintNameInput").focus();
});

$('#newAppSeries').click(function(e) {
  $('#appURLForm').trigger("reset");

});
$('#addAppBtn').click(function(e) {
  var rowCount1 = $('#appUrlTable').find('tbody > tr').length;
  if (rowCount1 === 2) {
    $('#newAppSeries').addClass('hidden');
    return;
  }
});

$('#appURLForm').submit(function(e) {
  var regexpURL = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;

  var $row = $('<tr/>');
  var appName = $(this).find('.appName').val();
  var appUrl = $(this).find('.appURL').val();
  if (!(appName)) {
    alert("Please Enter Name");
    return false;
  }
  if (!(appUrl)) {
    alert('Please Enter URL');
    return false;
  }

  if (!regexpURL.test(appUrl)) {
    alert('Please Enter a Valid URL');
    return false;
  }

  $row.data('appUrlData', {
    name: appName,
    url: appUrl
  })


  var $tdName = $('<td/>');
  $tdName.append(appName);
  var $tdURL = $('<td/>');
  $tdURL.append(appUrl);

  var $tdAction = $('<td/>');
  $tdAction.append('<div class="btn-group"><button class="btn btn-danger pull-left btn-sg tableactionbutton deleteURL" value="Remove" title="Remove"><i class="ace-icon fa fa-trash-o bigger-120"></i></button></div>');

  $tdAction.find('.deleteURL').click(function() {
    $row.remove();
    var rowCount2 = $('#appUrlTable').find('tbody > tr').length;
    if (rowCount2 === 1) {
      $('#appEntry').removeClass('hidden');
      return;
    }
    if (rowCount2 < 3) {
      $('#newAppSeries').removeClass('hidden');
      return;
    }
  });

  $row.append($tdName).append($tdURL).append($tdAction);
  $('#appUrlTable').find('tbody').append($row);
  $('#modalAppNameURL').modal('hide');
  $('#appEntry').addClass('hidden');
  return false;

});


function cachesavedvalues(blueprintdata){
  var $content = $('#tab3');
  if(blueprintdata){
    $content.find('#orgnameSelect').attr('savedval',blueprintdata.orgId);
    $content.find('#blueprintNameInput').attr('savedval',blueprintdata.name);
    $content.find('#bgListInput').attr('savedval',blueprintdata.bgId);
    $content.find('#projectListInput').attr('savedval',blueprintdata.projectId);
    $content.find('#appUrlTable').attr('savedval',JSON.stringify(blueprintdata.appUrls));
    if(blueprintdata.nexus){
      $content.find('#chooseNexusServer').attr('savedval',blueprintdata.nexus.repoId);
      //$content.find('#chooseRepository').attr('savedval',blueprintdata.nexus.url); //To be checked.
      $content.find('#chooseGroupId').attr('savedval',blueprintdata.nexus.groupId);
      $content.find('#chooseArtifacts').attr('savedval',blueprintdata.nexus.artifactId);
      $content.find('#chooseVersions').attr('savedval',blueprintdata.nexus.version);
      $content.find('#repositoryUrl').attr('savedval',blueprintdata.nexus.url);
    }
    if(blueprintdata.blueprintConfig){
      $content.find('#compositedockertable').attr('savedval',JSON.stringify(blueprintdata.blueprintConfig.dockerCompose));
      if(blueprintdata.blueprintConfig.cloudProviderData){
        $content.find('#instanceOS').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.instanceOS);
        $content.find('#imageId').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.imageId);
        $content.find('#vpcId').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.vpcId);
        $content.find('#subnetId').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.subnetId);
        $content.find('#keypairId').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.keyPairId);
        $content.find('#instancesize').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.instanceType);
        $content.find('#securotyGrp').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.securityGroupIds);
        $content.find('#instanceCount').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.instanceCount);
        $content.find('#location').attr('savedval',blueprintdata.blueprintConfig.cloudProviderData.region);
      }
      if(blueprintdata.blueprintConfig.infraManagerData){
        if(blueprintdata.blueprintConfig.infraManagerData.versionsList[0]){
          $content.find('#tableRunlistForBlueprint').attr('savedval',blueprintdata.blueprintConfig.infraManagerData.versionsList[0].runlist);
        }
      }
      $content.find('#providerId').attr('savedval',blueprintdata.blueprintConfig.cloudProviderId);
      
    }
   }
}

function helpersetselectvalue($selectctrl,prop,propvalue){
  //alert(prop + ' ' + propvalue);
  $selectctrl.find('option').each(function(){
    if($(this).attr(prop) == propvalue)
    {
      $selectctrl.val($(this).attr('value'));
    }
  });
  $selectctrl.trigger('change');
}

function displaySavedBPValues(){
  var $content = $('#bpeditcontent');
  //$content.find('#instanceOS').val($content.find('#instanceOS').attr('data-instanceos')).trigger('change');
  helpersetselectvalue($content.find('#instanceOS'),'data-instanceos',$content.find('#instanceOS').attr('savedval'));
  
  //Blueprint Name
  $content.find('#blueprintNameInput').val($content.find('#blueprintNameInput').attr('savedval'));
  $content.find('#securotyGrp').val($content.find('#securotyGrp').attr('savedval'));
  $content.find('#instanceCount').val($content.find('#instanceCount').attr('savedval'));
  helpersetselectvalue($content.find('#providerId'),'value',$content.find('#providerId').attr('savedval'));

  //updating the runlist table
  // if($('#tableRunlistForBlueprint').attr('savedval'))
  // {
  //  var rlist = $('#tableRunlistForBlueprint').attr('savedval').split(',');
  //  createRunlistTable(rlist);
  // }

  //alert($content.find('#blueprintNameInput').val());
  ///$contnet.find('#blueprintNameInput').val($contnet.find('#blueprintNameInput').attr('savedval'));
  //$content.find('#imageId').val($content.find('#imageId').attr('savedval')).trigger('change');
}
//Initializing the blueprint area according to the Template-Type and showing
//the differnt template types whenever a blueprint is added
function loadblueprintedit(blueprintId,baseblueprintId) {
    $('#myTab3 li').addClass('hidden');
    $('#myTab3 li.blueprintEditbutton').removeClass('hidden');
    $('#versionModalContainer').modal('hide');
   // alert(blueprintId);
    $('#tab3').remove();
    //removing selection of template from new screen
    $('#tab2').find('.productdiv2').removeClass('role-Selected');

    $.get('/blueprints/' + blueprintId,function(blueprintdata){
      if(blueprintdata){
        
        $('#myTab3 a[href="#viewEdit"]').tab('show');
        var $newformBPEdit = $formBPEdit.clone();
        $('#bpeditcontent').append($newformBPEdit);
        $('#bpeditcontent').find('#tab3 *').unbind();
        cachesavedvalues(blueprintdata);
        //$('#myTab5').attr('blueprintdata',JSON.stringify(blueprintdata));
        $('#bpeditcontent .productdiv2').detach(); //removing existing cardview on edit screen
        $('#bpeditcontent').find('input#blueprintId').val(baseblueprintId); //setting the blueprintid for edit

        var $prod2 = $('<div class="hidden productdiv2 role-Selected"></div>');

        $prod2.attr('dockerreponame',blueprintdata.blueprintConfig.dockerRepoName);
        $prod2.attr('data-templateId', blueprintdata.templateId);
        $prod2.attr('data-templateType',blueprintdata.templateType);
        $prod2.attr('templatetype',blueprintdata.templateType);

        $prod2.attr('data-templateComponent', 'component1'); //to check
        $prod2.attr('dockerrepotags', blueprintdata.blueprintConfig.dockerRepoTags);
        
        $prod2.attr('cfttemplatefilename', blueprintdata.blueprintConfig.templateFile);

        $('#bpeditcontent .selectedTemplateArea').html('');
        //adding produtdiv2 for saving
        $('#bpeditcontent .selectedTemplateArea').append($prod2);
        
        
        
        if(blueprintdata.blueprintType == 'azure_arm'){
        
        formInitializer(true,function(){
          var $content = $('#tab3');

          if(blueprintdata.blueprintConfig.parameters)
          {
            var keys = Object.keys(blueprintdata.blueprintConfig.parameters);
            for (var i = 0; i < keys.length; i++) {
              var parameter = blueprintdata.blueprintConfig.parameters[keys[i]];
             
              $content.find('input[data-cftparameter-name="' + keys[i] + '"]').val(blueprintdata.blueprintConfig.parameters[keys[i]].value);
            }
           
          }
          if(blueprintdata.blueprintConfig)
          {
            helpersetselectvalue($('#cftProviderInput'),'value',blueprintdata.blueprintConfig.cloudProviderId);
            $content.find('#cftResourceGroupInput').attr('savedval',blueprintdata.blueprintConfig.resourceGroup);
          }
          //alert('out' + $content.find('#cftRegionInput').length);
          // $content.find('#cftRegionInput').val(blueprintdata.blueprintConfig.region);
          // $content.find('#cftProviderInput').val(blueprintdata.blueprintConfig.cloudProviderId);
          // if(blueprintdata.blueprintConfig.instances)
          //   {
          //     for(var insti = 0; insti < blueprintdata.blueprintConfig.instances.length;insti++){
          //       $content.find('#cftResource-' + blueprintdata.blueprintConfig.instances[insti].logicalId + ' .cftResourceUsernameInput').val(blueprintdata.blueprintConfig.instances[insti].username);
          //       var $ccrs = $chefCookbookRoleSelector(blueprintdata.orgId, function(data) {},blueprintdata.blueprintConfig.instances[insti].runlist);
          //                 $content.find('#cftResource-' + blueprintdata.blueprintConfig.instances[insti].logicalId + ' .cftResourceRunlistInput').empty().append($ccrs).data('$ccrs', $ccrs);
          //     }
              

          //   }



          // for(var spi = 0; spi < blueprintdata.blueprintConfig.parameters.length;spi++){
          //   $content.find('input[data-cftparameter-name="' + blueprintdata.blueprintConfig.stackParameters[spi].ParameterKey + '"]').val(blueprintdata.blueprintConfig.stackParameters[spi].ParameterValue);
          // }

          
        });
      }else{
        formInitializer(true);
      }

        checkandupdateRunlistTable();
        OrgdataLoader(); //reloading Org params section 
        $('#orgnameSelect').trigger('change'); 
        
        //Add a productdiv2 with required elements for form rendering
        var $card = $('#viewCreate .productdiv1[data-blueprintid="' + blueprintId + '"]').clone();
        $card.find('button').detach();
        $card.find('.moreInfo').detach();
        $card.appendTo($('#bpeditcontent .selectedTemplateArea')); //appending selected card view
        $('.selectedTemplateArea .productdiv2').append('<img src="' + $('.selectedTemplateArea').find('img[src*="__templatesicon__"]').first().attr('src') + '">');
        displaySavedBPValues();
        $('select').addClass('form-control');
      }
      else{

      }
    });
    
    
    //To Do
    //Show Save and Cancel button.

}

function closeblueprintedit(blueprintId) {
    $('#myTab3 li').removeClass('hidden');
    $('#myTab3 li.blueprintEditbutton').addClass('hidden');
    $('#myTab3 a[href="#viewCreate"]').tab('show');
    $('#tab3').remove();
    var $newformBPNew = $formBPNew.clone();
    $('#bpeditcontent .productdiv2').detach(); //removing existing cardview on edit screen
    $('#newbpcontainer').append($newformBPNew);
   // formInitializer();
   OrgdataLoader(); //reloading Org params section 
   $('#orgnameSelect').trigger('change'); 
}

function sortResults(versions,prop, asc) {
    versions = versions.sort(function(a, b) {
      a[prop] = parseInt(a[prop]);
      b[prop] = parseInt(b[prop]);
        if (asc) return (a[prop] > b[prop]) ? 1 : ((a[prop] < b[prop]) ? -1 : 0);
        else return (b[prop] > a[prop]) ? 1 : ((b[prop] < a[prop]) ? -1 : 0);
    });
    return(versions);
}


/**************************************Blueprint.js*************************************/
//Initializing the blueprint area according to the Template-Type and showing
//the differnt template types whenever a blueprint is added
function initializeBlueprintAreaNew(data) {
  var reqBodyNew = {};
  var $orgListInput = $('#orgnameSelectExisting');

  reqBodyNew.orgId = $orgListInput.val();

  var $AppFactpanelBody = $('.appFactoryPanel').find('.panel-body');
  $AppFactpanelBody.empty();

  var $devopsRolepanelBody = $('.devopsRolePanel').find('.panel-body');
  $devopsRolepanelBody.empty();

  var $desktopProvisioningPanelBody = $('.desktopProvisioningPanel').find('.panel-body');
  $devopsRolepanelBody.empty();
  $('#accordion-2').empty();
  //Displaying the Template Types.
  $.get("/d4dMasters/readmasterjsonnew/16", function(tdata) {
    tdata = JSON.parse(tdata);
    var rowLength = tdata.length;
    var $containerTempNew = "";
    var selectedrow = false;
    var getDesignTypeImg;
    var getDesignTypeRowID;
    var getDesignTypeName;
    var getDesignType;
    
    for (var i = 0; i < rowLength; i += 1) {
      getDesignTypeImg = tdata[i]['designtemplateicon_filename'];
      getDesignTypeRowID = tdata[i]['rowid'];
      getDesignTypeName = tdata[i]['templatetypename'];
      getDesignType = tdata[i]['templatetype'];


      //Extracting the TT definitions. Add New Template types
      var $currRolePanel = null;
      switch (getDesignTypeName) {
        case "AppFactory":
          $AppFactpanelBody = $('<div class="panel-body AppFactory"></div>');
          $currRolePanel = $AppFactpanelBody;
          break;
        case "DevopsRoles":
          $DevopsRolespanelBody = $('<div class="panel-body DevopsRoles"></div>');
          $currRolePanel = $DevopsRolespanelBody;
          break;
        case "CloudFormation":
          $CloudFormationBody = $('<div class="panel-body CloudFormation"></div>');
          $currRolePanel = $CloudFormationBody;
          break;
        case "Docker":
          $DockerpanelBody = $('<div class="panel-body Docker"></div>');
          $currRolePanel = $DockerpanelBody;
          break;
        case "Desktop":
          $DesktopProvisioningPanelBody = $('<div class="panel-body Desktop"></div>');
          $currRolePanel = $DesktopProvisioningPanelBody;
          break;
        case "Environment":
          $EnvironmentpanelBody = $('<div class="panel-body Environment"></div>');
          $currRolePanel = $EnvironmentpanelBody;
          break;

      }
      console.log(tdata);
      if ($("div." + tdata[i]['templatetype']).length === 0) {
        if(getDesignTypeName == 'CloudFormation')
          continue; //skipping couldformation for azure
        $containerTempNew = '<div class="panel panel-default blueprintContainer hidden">' +
          '<div class="panel-heading">' +

          '<h4 class="panel-title">' +
          '<a href="#collapse' + i + '" data-parent="#accordion-2" data-toggle="collapse" class="collapsed"> ' +
          '<i class="fa fa-fw fa-plus-circle txt-color-blue"></i> ' +
          '<i class="fa fa-fw fa-minus-circle txt-color-red"></i>' + getDesignTypeName + '</a>' +
          '</h4></div><div class="panel-collapse collapse" id="collapse' + i + '">' +
          '<div class="panel-body ' + getDesignType + '"></div>' +
          '</div>';
        $('#accordion-2').append($containerTempNew);

      }
    }
    //To fix template id and template type
    for (var i = 0; i < data.length; i++) {
      (function(i) {
        console.log(data[i]);
        //Find a panel-body with the template type class
        var $currRolePanel = $('#accordion-2').find('.' + data[i].templateType);
        if ($currRolePanel.length > 0) {
          var $itemContainer = $('<div></div>').addClass("productdiv4");

          var $itemBody = $('<div></div>').addClass('productdiv1 cardimage').attr('data-blueprintId', data[i]._id).attr('data-projectId', data[i].projectId).attr('data-envId', data[i].envId).attr('data-chefServerId', data[i].chefServerId).attr(
            'data-templateType', data[i].templateType);
          var $ul = $('<ul></ul>').addClass('list-unstyled system-prop').css({
            'text-align': 'center'
          });
          var $liRead = $('<a style="float:right;margin:5px;cursor:pointer" class="readBtn"><div class="moreInfo"></div></a>').attr('data-toggle', 'tooltip').attr('data-placement', 'top').attr('title', 'More Info');
          $ul.append($liRead);
          var $img
          if (data[i].iconpath)

          {
            if (data[i].templateType == "Docker" || data[i].templateType == "docker") {
              $img = $('<img />').attr('src', 'img/galleryIcons/Docker.png').attr('alt', data[i].name).addClass('cardLogo');
            } else
              $img = $('<img />').attr('src', data[i].iconpath).attr('alt', data[i].name).addClass('cardLogo');
          } else
            $img = $('<img />').attr('src', 'img/imgo.jpg').attr('alt', data[i].name).addClass('cardLogo');
          var $liImage = $('<li></li>').append($img);
          $ul.append($liImage);

          var $liCardName = $('<li title="' + data[i].name + '"></li>').addClass('Cardtextoverflow').html('<u><b>' + data[i].name + '</b></u>');

          var $selecteditBtnContainer = $('<div style="position:absolute;padding-left:27px;bottom:11px;"></div>');
          var $selectVerEdit = $('<a style="padding:0px 4px;margin-left:3px;border-radius:5px;" class="bpEditBtn"><i class="ace-icon fa fa-pencil"></i></a>').addClass('btn btn-primary').attr('data-toggle', 'tooltip').attr('data-placement', 'top').attr('title', 'Edit');

          //Versions sections
          var $linkVersions = $('<button class="btn btn-primary bpvicon" title="Edit"></button>');

          var _versions = [];

          if (data[i].versions)
              _versions = sortResults(data[i].versions, 'version');
          $linkVersions.append('<i class="fa fa-pencil bpvi"></i>')
          $linkVersions.attr('blueprintId', data[i]._id);
          if (data[i].versions) {
              $linkVersions.attr('versions', JSON.stringify(_versions));
              if (_versions[0].name) {
                  $liCardName = $('<li title="' + _versions[0].name + '"></li>').addClass('Cardtextoverflow').html('<u><b>' + _versions[0].name + '</b></u>');
                  $itemBody.attr('data-blueprintId', _versions[0].id);
              }

          } else {
              $linkVersions.attr('versions', '[]');
          }
          


          $ul.append($liCardName);

          $linkVersions.click(function(e) {
              //Get the lastest version
              var lastversion = $(this).attr('blueprintId'); //default version
              if (JSON.parse($(this).attr('versions')).length >= 1) {
                  var vjson = JSON.parse($(this).attr('versions'));
                  lastversion = vjson[0].id; //its sorted to have latest on top.
              }
              //alert(lastversion); //56d6aba3e220755c5519cf33
              //load the edit screen. Currently loaded from popup. Call that funcction.
              if (lastversion) {
                  loadblueprintedit(lastversion, $(this).attr('blueprintId')); //base version required for UI
              } else {
                  bootbox.alert({
                      message: 'Blueprint data error. Could not read.',
                      title: 'Warning'
                  });
              }
          });

          var $selecteditBtnContainer = $('<div style="position:absolute;padding-left:27px;bottom:11px;"></div>');

          var $selectVerEdit = $('<a style="padding:0px 4px;margin-left:3px;border-radius:5px;" class="bpEditBtn"><i class="ace-icon fa fa-pencil"></i></a>').addClass('btn btn-primary').attr('data-toggle', 'tooltip').attr('data-placement',
            'top').attr('title', 'Edit');
          var $selectVer = null;
          var tagLabel = '';
          //Docker Check
          if (data[i].templateType == "Docker" || data[i].templateType == "docker") {
            console.log("data[i}" + JSON.stringify(data[i]));
            $selectVer = $('<select style="padding:1px;margin-right:5px;" class="form-control"></select>').addClass('dockerrepotagselect').attr('data-blueprintId', data[i]._id);
            $itemBody.attr('dockerreponame', data[i].dockerreponame);
            $itemBody.attr('dockerrepotags', data[i].dockerrepotags);
            $itemBody.attr('dockercontainerpaths', data[i].dockercontainerpaths);

            if (data[i].dockerlaunchparameters)
              $itemBody.attr('dockerlaunchparameters', 't ' + data[i].dockerlaunchparameters);
            var $liDockerRepoName = $('<li title="Docker Repo Name" ><i class="fa fa-check-square" style="padding-right:5px"/>' + data[i].dockerreponame + '</li>');
            //$ul.append($liDockerRepoName);
            if (data[i].dockerrepotags && data[i].dockerrepotags != '') {
              $selectVer.empty();
              var dockerrepostags = data[i].dockerrepotags.split(',');
              $.each(dockerrepostags, function(k) {
                $selectVer.append('<option value="' + dockerrepostags[k] + '">' + dockerrepostags[k] + '</option>');
              });
            }
            $selectVer.hide();
            $selectVerEdit.hide();
            function getOrgProjDetails(id) {
              var orgName = $("#orgnameSelectExisting option:selected").text();
              var bgName = $('#bgListInputExisting option:selected').text();
              var projName = $('#projectListInputExisting option:selected').text();
              var $blueprintReadContainer = $(id);
              $blueprintReadContainer.find('.modal-body #blueprintORG').val(orgName);
              $blueprintReadContainer.find('.modal-body #blueprintBU').val(bgName);
              $blueprintReadContainer.find('.modal-body #blueprintProject').val(projName);
              var $blueprintReadContainerCFT = $(id);
              $blueprintReadContainerCFT.find('.modal-body #blueprintORG').val(orgName);
              $blueprintReadContainerCFT.find('.modal-body #blueprintBU').val(bgName);
              $blueprintReadContainerCFT.find('.modal-body #blueprintProject').val(projName);
            }
            (function(blueprint) {
              $liRead.click(function(e) {
                var $blueprintReadContainerCFT = $('#modalForReadCFT');
                $('.modal-title').html('Blueprint Information-Docker');
                $blueprintReadContainerCFT.modal('show');
                //for getting the blueprint name
                $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(blueprint.name);
                $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(blueprint.templateType);
                getOrgProjDetails($blueprintReadContainerCFT);
              });
            })(data[i]);
          } else {
            $selectVer = $('<select style="padding:1px;padding-left:5px;" class="form-control"></select>').addClass('blueprintVersionDropDown').attr('data-blueprintId', data[i]._id);

            if (data[i].templateType === 'chef' || data[i].templateType === 'ami') {
              $selectVerEdit.hide();
              $selectVer.hide();
              //code for info about blueprints
              (function(blueprint) {
                $liRead.click(function(e) {
                  var $blueprintReadContainer = $('#modalForRead');
                  $blueprintReadContainer.find('.modal-body #blueprintNameInputNew').val(blueprint.name);
                  if (blueprint.templateType === 'chef') {
                    $('.modal-title').html('Blueprint Information-Software Stack');
                  }
                  if (blueprint.templateType === 'ami') {
                    $('.modal-title').html('Blueprint Information-OSImage');
                  }
                  //for getting the image Name
                  $.ajax({
                    type: "GET",
                    url: "/vmimages/" + blueprint.blueprintConfig.cloudProviderData.imageId,
                    success: function(data) {
                      console.log(data);
                      $blueprintReadContainer.find('.modal-body #instanceImage').val(data.name);
                    }
                  });
                  //for getting the Provider name,Type,Region,KeyPair
                  $.ajax({
                    type: "GET",
                    url: "/aws/providers/" + blueprint.blueprintConfig.cloudProviderId,
                    success: function(data) {
                      $blueprintReadContainer.find('.modal-body #instanceProviderName').val(data.providerName);
                      $blueprintReadContainer.find('.modal-body #instanceProviderType').val(data.providerType);
                      // loop for getting region and Keypair
                      for (var k = 0; k < data.keyPairs.length; k++) {
                        $blueprintReadContainer.find('.modal-body #instanceRegion').val(data.keyPairs[k].region);
                        $blueprintReadContainer.find('.modal-body #instancekeyPair').val(data.keyPairs[k].keyPairName);
                      }
                    },
                    failure: function(data) {
                      alert(data.toString());
                    }
                  });
                  var $parent = $(this).parents('.cardimage');
                  var version = $parent.find('.blueprintVersionDropDown').val();
                  $blueprintReadContainer.modal('show');
                  //for getting the blueprint name
                  //for getting the OsName
                  $blueprintReadContainer.find('.modal-body #instanceOSNew').val(blueprint.blueprintConfig.cloudProviderData.instanceOS);
                  //for getting the instance Size
                  $blueprintReadContainer.find('.modal-body #instancesizeNew').val(blueprint.blueprintConfig.cloudProviderData.instanceType);
                  //for getting the SubnetId
                  $blueprintReadContainer.find('.modal-body #instanceSubnetId').val(blueprint.blueprintConfig.cloudProviderData.subnetId);
                  //loop for getting the Security Group
                  $blueprintReadContainer.find('.modal-body #instanceSecurityGroupId').val(blueprint.blueprintConfig.cloudProviderData.securityGroupIds);
                  //for getting the VPC
                  $blueprintReadContainer.find('.modal-body #instanceVPC').val(blueprint.blueprintConfig.cloudProviderData.vpcId)
                    // loop for getting runlist
                  for (var j = 0; j < blueprint.blueprintConfig.infraManagerData.versionsList.length; j++) {
                    $blueprintReadContainer.find('.modal-body #instanceRunlist').val(blueprint.blueprintConfig.infraManagerData.versionsList[j].runlist);
                    //for getting the version
                    $blueprintReadContainer.find('.modal-body #instanceVersion').val(blueprint.blueprintConfig.infraManagerData.versionsList[j].ver);
                  }
                  $blueprintReadContainer.find('.modal-body #blueprintTemplateType').val(blueprint.templateType);
                  getOrgProjDetails($blueprintReadContainer);
                });
              })(data[i]);
            } else if (data[i].templateType === 'cft' || data[i].templateType === 'arm') {
              $selectVerEdit.hide();
              $selectVer.hide();
              (function(blueprint) {
                $liRead.click(function(e) {
                  var $blueprintReadContainerCFT = $('#modalForReadCFT');
                  if (blueprint.templateType == 'arm') {
                    $blueprintReadContainerCFT.find('.modal-title').html('Blueprint Information-ARM');
                  } else {
                    $blueprintReadContainerCFT.find('.modal-title').html('Blueprint Information-CFT');
                  }
                  $blueprintReadContainerCFT.modal('show');
                  //for getting the blueprint name
                  $blueprintReadContainerCFT.find('.modal-body #blueprintNameCFT').val(blueprint.name);
                  $blueprintReadContainerCFT.find('.modal-body #blueprintTemplateTypeCFT').val(blueprint.templateType);
                  $.ajax({
                    type: "get",
                    dataType: "json",
                    async: false,
                    url: "../organizations/getTreeNew",
                    success: function(dataTree) {
                      console.log(data);
                      data = JSON.parse(JSON.stringify(data));
                      for (var j = 0; j < dataTree.length; j++) {
                        (function(j) {
                          $blueprintReadContainerCFT.find('.modal-body #blueprintORG').val(dataTree[j].name);
                          for (var p = 0; p < dataTree[j].businessGroups.length; p++) {
                            (function(p) {
                              $blueprintReadContainerCFT.find('.modal-body #blueprintBU').val(dataTree[j].businessGroups[p].name);
                              for (var x = 0; x < dataTree[j].businessGroups[p].projects.length; x++) {
                                $blueprintReadContainerCFT.find('.modal-body #blueprintProject').val(dataTree[j].businessGroups[p].projects[x].name);
                              }
                            })
                            (p);
                          }
                        })
                        (j);
                      }
                    }
                  });
                });
              })(data[i]);
            }

            //for updating
            $selectVerEdit.click(function(e) {

              var $parent = $(this).parents('.cardimage');
              var $blueprintEditResultContainer = $('#blueprintEditResultContainer');


              $blueprintEditResultContainer.modal('show');

              var projectId = $parent.attr('data-projectId');
              var envId = $parent.attr('data-envId');
              var blueprintId = $parent.attr('data-blueprintId');
              var chefServerId = $parent.attr('data-chefServerId');
              var version = $parent.find('.blueprintVersionDropDown').val();
              $.get('../blueprints/' + blueprintId + '/versions/' + version, function(versionData) {
                console.log('blueprint data', versionData);
                var $ccrs = $chefCookbookRoleSelector(reqBodyNew.orgId, function(data) {

                }, versionData.runlist);
                $ccrs.find('#cookbooksrecipesselectedList').attr('data-blueprintId', blueprintId);
                $blueprintEditResultContainer.find('.modal-body').empty().append($ccrs).data('$ccrs', $ccrs);



              }).error(function() {
                $blueprintEditResultContainer.find('.modal-body').empty();
                $blueprintEditResultContainer.find('.modal-body').append('<span>Oops! Something went wrong. Please try again later</span>');
              });

            });
          }
          if (localStorage.getItem('userRole') !== '[Consumer]') {
            var $li = $('<li></li>').css({
              "font-size": '10px'
            }).append(tagLabel, $selectVer, $selectVerEdit);

          } else {
            var $li = $('<li></li>').css({
              "font-size": '10px'
            }).append(tagLabel, $selectVer);


          }

          if ($selectVer.attr('class').indexOf('dockerrepotagselect') < 0) {
            if (typeof data[i].blueprintConfig.infraManagerData !== 'undefined') {
              for (var j = 0; j < data[i].blueprintConfig.infraManagerData.versionsList.length; j++) {
                var $options = $('<option></option>').append(data[i].blueprintConfig.infraManagerData.versionsList[j].ver).val(data[i].blueprintConfig.infraManagerData.versionsList[j].ver);
                $selectVer.append($options);


              }
            }
          }
          $selecteditBtnContainer.append($li);
          $ul.append($linkVersions);

          $itemBody.append($ul);
          $itemBody.append($selecteditBtnContainer);
          $itemContainer.append($itemBody);
          $currRolePanel.append($itemContainer);
          //enabling the bluepintContiner div when item added.
          $currRolePanel.closest('.blueprintContainer').removeClass('hidden');
          $currRolePanel.parent().parent().show();
          //Attaching the selection event.
          if (i == (data.length - 1)) {
            var $productdiv1 = $('.productdiv1');

            $productdiv1.click(function(e) {
              if ($(this).hasClass('role-Selected1')) {
                  $(this).removeClass('role-Selected1');
              } else {
                  $(this).addClass('role-Selected1');
              }
            });
          }

        }
      })(i);

    }
    //for loop for data ends here...
    if ($('#accordion-2').length > 0) {
      console.log('object ==>', $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a'));
      $('#accordion-2').find('.blueprintContainer:not(.hidden)').first().find('.panel-heading a').click();
    }
  }); //end of readmasterjson to be pushed to the end of the function.

  $('#accordion-2').on('show.bs.collapse', function(e) {
    console.log(e.target);
   // $(e.target).find('.productdiv1').first().click();

  });
  //Expanding the fist Accordion.

};

function showbpcopydialog(){

  var blueprintId = [];
  $('.productdiv1.role-Selected1').each(function(){
    blueprintId.push($(this).attr('data-blueprintid'));
  });
  if (blueprintId.length > 0) {
      $('#copyBlueprintModal').modal('show'); 
      $('#copyBlueprintModal').find('label.bpcopycount').html(blueprintId.length + ' blueprint(s) selected.');
  }else {
    bootbox.alert({
      message: 'Please select a blueprint to copy.',
      title: 'Warning'
    });
  }
}

function copySelectedBlueprint(){
  var blueprintId = [];
  $('.productdiv1.role-Selected1').each(function(){
    blueprintId.push($(this).attr('data-blueprintid'));
  });
  var orgid = $('#orgnameSelectExistingforcopy').val();
  var buid = $('#bgListInputExistingforcopy').val();
  var projid = $('#projectListInputExistingforcopy').val();
  
  var copyobj = {
    orgid : orgid,
    buid : buid,
    projid: projid,
    blueprints : blueprintId
  }
  $.post('/blueprints/copy',copyobj,function(msg,data){
    if(data == 'success'){
      $('#copyBlueprintModal').modal('hide');
    }
  });
}
//for removing the selected blueprint in the Existing Blueprints tab
function removeSelectedBlueprint() {
  var blueprintId = $('.productdiv1.role-Selected1').attr('data-blueprintid');
  if (blueprintId) {
    //found now delete
    bootbox.confirm("Are you sure you would like to remove this blueprint?", function(result) {
      if (!result) {
        return;
      } else {
        $.ajax({
          url: '/blueprints/' + blueprintId,
          type: 'DELETE',
          success: function(data) {
            if (data) {
              var $bcc = $('.productdiv1.role-Selected1').closest('.blueprintContainer');
              $('.productdiv1.role-Selected1').parent().detach();
              if ($bcc.find('.panel-body').children().length <= 0) {
                $bcc.addClass('hidden');
              }
            } else
              alert(data);
          }
        });
      }
    });
  } else {
    bootbox.alert({
      message: 'Please select a blueprint to remove.',
      title: 'Warning'
    });
  }
}
azureLoadData();
dataLoader();
</script>
